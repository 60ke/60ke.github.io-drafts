<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>python解释器初探</title>
      <link href="2021/04/29/python%E8%A7%A3%E9%87%8A%E5%99%A8%E5%88%9D%E6%8E%A2/"/>
      <url>2021/04/29/python%E8%A7%A3%E9%87%8A%E5%99%A8%E5%88%9D%E6%8E%A2/</url>
      
        <content type="html"><![CDATA[<span id="more"></span><h2 id="1-解释器概念"><a href="#1-解释器概念" class="headerlink" title="1.解释器概念"></a>1.解释器概念</h2><h3 id="1-1先看wiki中的定义"><a href="#1-1先看wiki中的定义" class="headerlink" title="1.1先看wiki中的定义:"></a>1.1先看wiki中的定义:</h3><p><em>In computer science, an interpreter is a computer program that directly executes instructions written in a programming or scripting language, without requiring them previously to have been compiled into a machine language program.</em></p><p>大意为:*解释器是一种可以执行无需编译为机器码的脚步或程序语言的计算机程序.*如果执行的程序由虚拟机器语言或类似于机器语言的程序设计语言写成,解释器也可被称作虚拟机。<br>与解释器对应还有编译器.编译器（compiler）是一种计算机程序，它会将某种编程语言写成的源代码（原始语言）转换成另一种编程语言（目标语言）。通常会将源代码编译为机器语言。<br>其实解释器编译器并没有一个标准的定义,随着计算机科学发发展他们之间的界限变得模糊。</p><h3 id="1-2解释器种类"><a href="#1-2解释器种类" class="headerlink" title="1.2解释器种类"></a>1.2解释器种类</h3><p>按照解释器执行程序的方法可将解释器分为以下三类:<br>1.直接执行高级语言(如shell内置的编译器)<br>2.转换高级编程语言到更有效率的字节码（Bytecode），并执行字节码(如:Python,Ruby,Perl,MATLAB)<br>3.用解释器包含的编译器对高级语言进行编译，并指示中央处理器执行编译后的程序（如：JIT）</p><h3 id="1-3解释器的优缺点"><a href="#1-3解释器的优缺点" class="headerlink" title="1.3解释器的优缺点"></a>1.3解释器的优缺点</h3><p>以下为与编译器的对比:<br>####1.3.1 优点<br>由于解释器是边解释边执行的,这就使得它具备动态优化,可以边运行边调试易于debug,开发效率高,跨平台<br>####1.3.2 缺点<br>同样由于解释器边解释边执行的运行过程,导致其内存占用高,因为解释器需要保存更多程序的信息，运行时,同时其运行的本质是由运行时运行的,而运行时又是运行在物理机(虚拟机)之上,所以其运行时间也会加长。</p><h2 id="2简单的解释器实现"><a href="#2简单的解释器实现" class="headerlink" title="2简单的解释器实现"></a>2简单的解释器实现</h2><h3 id="2-1-大体流程"><a href="#2-1-大体流程" class="headerlink" title="2.1 大体流程"></a>2.1 大体流程</h3><p>我们要构造的解释器运行流程如下:<br>解析器加载待执行的指令,然后对指令进行解析、执行最终返回执行的结果<br><img src="https://gitee.com/worileqing/upic/raw/master/uPic/interpreter.png" alt="interpreter"></p><h3 id="2-2-构造执行场景"><a href="#2-2-构造执行场景" class="headerlink" title="2.2 构造执行场景"></a>2.2 构造执行场景</h3><p>现有变量<code>a</code>和<code>b</code>值分别为<code>2</code>和<code>3</code>当我们输入<code>a+b</code>时通过解释器解析执行并返回输出的结果,我们</p><h3 id="2-2-python代码实现"><a href="#2-2-python代码实现" class="headerlink" title="2.2 python代码实现"></a>2.2 python代码实现</h3><p>先构造待执行的指令集:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">to_exec = &#123;</span><br><span class="line">    <span class="string">&quot;instructions&quot;</span>: [</span><br><span class="line">        (<span class="string">&quot;LOAD_VALUE&quot;</span>, <span class="number">0</span>),</span><br><span class="line">        (<span class="string">&quot;STORE_NAME&quot;</span>,<span class="number">0</span>),</span><br><span class="line">        (<span class="string">&quot;LOAD_VALUE&quot;</span>,<span class="number">1</span>),</span><br><span class="line">        (<span class="string">&quot;STORE_NAME&quot;</span>,<span class="number">1</span>),</span><br><span class="line">        (<span class="string">&quot;LOAD_NAME&quot;</span>,<span class="number">0</span>),</span><br><span class="line">        (<span class="string">&quot;LOAD_NAME&quot;</span>,<span class="number">1</span>),</span><br><span class="line">        (<span class="string">&quot;ADD_TWO_VALUES&quot;</span>, <span class="literal">None</span>),</span><br><span class="line">        (<span class="string">&quot;PRINT_ANSWER&quot;</span>, <span class="literal">None</span>)</span><br><span class="line">    ],                    <span class="comment">#指令集</span></span><br><span class="line">    <span class="string">&quot;numbers&quot;</span>: [<span class="number">2</span>, <span class="number">3</span>],    <span class="comment">#值</span></span><br><span class="line">    <span class="string">&quot;names&quot;</span>: [<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>]    <span class="comment">#变量</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>to_exec </p>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>终端录屏</title>
      <link href="2021/04/29/%E7%BB%88%E7%AB%AF%E5%BD%95%E5%B1%8F/"/>
      <url>2021/04/29/%E7%BB%88%E7%AB%AF%E5%BD%95%E5%B1%8F/</url>
      
        <content type="html"><![CDATA[<p>今天突然看到一个书签<code>http://showterm.io</code>,<code>showterm</code>是一个终端录屏工具但是现在,感觉用的人不多了,除了<code>showterm</code>以外还有<a href="https://github.com/icholy/ttygif">ttygif</a>,<a href="https://github.com/faressoft/terminalizer">terminalizer</a>,<a href="https://github.com/asciinema/asciinema">asciinema</a></p><h2 id="ttygif"><a href="#ttygif" class="headerlink" title="ttygif"></a>ttygif</h2><p><code>C</code>开发的录屏工具,mac下使用<code>brew install ttygif</code>即可安装</p><ul><li><p>录制</p><p>ttyrec + 自定义的录制名</p></li><li><p>保存<br>ttygif + <code>自定义的录制名</code> (-s 可设定倍速)</p></li><li><p>效果示意<br><img src="https://i.loli.net/2021/04/29/tQY7A2rhTNfmMqX.gif" alt="tQY7A2rhTNfmMqX"><br>本来有个13M的比较全的录屏但是gitee只支持1M文件的非登录可见,同时需要注意的是录屏录取的是整个终端,而不是当前的标签页(录屏过程切换其它标签,则切换后的标签的显示内容也会被录下)</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> shell </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数据结构之子字符串查找</title>
      <link href="2021/04/16/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B9%8B%E5%AD%90%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%9F%A5%E6%89%BE/"/>
      <url>2021/04/16/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B9%8B%E5%AD%90%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%9F%A5%E6%89%BE/</url>
      
        <content type="html"><![CDATA[<p>实现一个查找 substring 的函数。如果在母串中找到了子串，返回子串在母串中出现的下标，如果没有找到，返回 -1，如果子串是空串，则返回 0 。</p><p>go语言可以用<code>strings</code>直接实现</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;strings&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">strStr</span><span class="params">(haystack <span class="keyword">string</span>, needle <span class="keyword">string</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> strings.Index(haystack, needle)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>strings</code>中的index是Rabin–Karp算法实现的<br>实现同样的功能的算法还有<br>sunday算法</p><p>kmp算法</p><p>相关链接:<a href="https://segmentfault.com/a/1190000016554961">https://segmentfault.com/a/1190000016554961</a></p>]]></content>
      
      
      <categories>
          
          <category> go </category>
          
      </categories>
      
      
        <tags>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>go调用RUST</title>
      <link href="2021/04/06/go%E8%B0%83%E7%94%A8RUST/"/>
      <url>2021/04/06/go%E8%B0%83%E7%94%A8RUST/</url>
      
        <content type="html"><![CDATA[<h2 id="无参函数调用"><a href="#无参函数调用" class="headerlink" title="无参函数调用"></a>无参函数调用</h2><p>先写一个rust的lib项目生成动态库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo new --lib embed</span><br></pre></td></tr></table></figure><ul><li>Cargo.toml<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[package]</span></span><br><span class="line"><span class="attr">name</span> = <span class="string">&quot;embed&quot;</span></span><br><span class="line"><span class="attr">version</span> = <span class="string">&quot;0.1.0&quot;</span></span><br><span class="line"><span class="attr">authors</span> = [<span class="string">&quot;k &lt;2589788697@qq.com&gt;&quot;</span>]</span><br><span class="line"><span class="attr">edition</span> = <span class="string">&quot;2018&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html</span></span><br><span class="line"></span><br><span class="line"><span class="section">[dependencies]</span></span><br><span class="line"></span><br><span class="line"><span class="section">[lib]</span></span><br><span class="line"><span class="attr">name</span> = <span class="string">&quot;embed&quot;</span></span><br><span class="line"><span class="attr">crate-type</span> = [<span class="string">&quot;dylib&quot;</span>]</span><br></pre></td></tr></table></figure></li><li>lib.rs<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::thread;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#[no_mangle]</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">process</span></span>()&#123;</span><br><span class="line">    <span class="keyword">let</span> handles:<span class="built_in">Vec</span>&lt;_&gt;=(<span class="number">0</span>..=<span class="number">10</span>).map(|_|&#123;</span><br><span class="line">        thread::spawn(||&#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="keyword">mut</span> x = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="number">0</span>..<span class="number">5000000</span>&#123;</span><br><span class="line">                x += <span class="number">1</span></span><br><span class="line">            &#125;</span><br><span class="line">            x</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;).collect();</span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> handles&#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;thread finished with count=&#123;&#125;&quot;</span>,h.join().map_err(|_|<span class="string">&quot;could not join a thread&quot;</span>).unwrap());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>编译<br>运行 <code>cargo build --release</code>得到<code>libembed.dylib</code></li></ul><p>将文件按照如下放置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">├── Cargo.lock</span><br><span class="line">├── Cargo.toml</span><br><span class="line">├── src</span><br><span class="line">│   ├── a.out</span><br><span class="line">│   ├── interface.h</span><br><span class="line">│   ├── lib.rs</span><br><span class="line">│   ├── libembed.dylib</span><br><span class="line">│   ├── main.c</span><br><span class="line">│   └── test.go</span><br></pre></td></tr></table></figure><ul><li>interface.h<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">process</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure></li></ul><ul><li>main.c<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;interface.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    process();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>编译运行C<br><code>gcc main.c -L. -lembed &amp;&amp; ./a.out</code><br>PS:linux下编译<code>gcc main.c -L. -lembed -Wl,-rpath=./</code><br><code>-Wl,-rpath=./</code>用于指定程序运行寻找库的路径<br>运行结果<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">thread finished with count=5000000</span><br><span class="line">thread finished with count=5000000</span><br><span class="line">thread finished with count=5000000</span><br><span class="line">thread finished with count=5000000</span><br><span class="line">thread finished with count=5000000</span><br><span class="line">thread finished with count=5000000</span><br><span class="line">thread finished with count=5000000</span><br><span class="line">thread finished with count=5000000</span><br><span class="line">thread finished with count=5000000</span><br><span class="line">thread finished with count=5000000</span><br><span class="line">thread finished with count=5000000</span><br></pre></td></tr></table></figure></li><li>test.go<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">#cgo LDFLAGS: -L./ -lembed</span></span><br><span class="line"><span class="comment">#include &quot;interface.h&quot;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;C&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">C.process()</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><code>go run test.go</code>结果与C运行一致</li></ul><h2 id="有参函数调用"><a href="#有参函数调用" class="headerlink" title="有参函数调用"></a>有参函数调用</h2><ul><li>lib.rs<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[repr(C)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    a:<span class="built_in">u32</span>,</span><br><span class="line">    b:<span class="built_in">u32</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#[no_mangle]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function"><span class="keyword">fn</span> <span class="title">process</span></span>(test:*<span class="keyword">const</span> Test)&#123;</span><br><span class="line">    <span class="keyword">unsafe</span>&#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,(*test).a);</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,(*test).b)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><code>cargo build --release --out-dir . -Z unstable-options</code></li><li>main.c<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> a;</span><br><span class="line">    <span class="keyword">int</span> b;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(struct Test *test)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Test</span> <span class="title">test</span> =</span> &#123;<span class="number">3</span>,<span class="number">4</span>&#125;;</span><br><span class="line">    process(&amp;test);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><code>gcc main.c -L. -lembed -Wl,-rpath=./ &amp;&amp; ./a.out</code></li></ul><p>output</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">3</span><br><span class="line">4</span><br></pre></td></tr></table></figure><ul><li><p>interface.h</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> a;</span><br><span class="line">    <span class="keyword">int</span> b;</span><br><span class="line">&#125; Test;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">process</span><span class="params">(struct Test *test)</span></span>;</span><br></pre></td></tr></table></figure></li><li><p>test.go</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">#cgo LDFLAGS: -L./ -lembed -Wl,-rpath=./</span></span><br><span class="line"><span class="comment">#include &quot;interface.h&quot; //非标准c头文件，所以用引号</span></span><br><span class="line"><span class="comment">typedef struct Test</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    int a;</span></span><br><span class="line"><span class="comment">    int b;</span></span><br><span class="line"><span class="comment">&#125; Test; #可以放但是不建议(建议放入interface.h)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;C&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">test := C.Test&#123;a: <span class="number">3</span>, b: <span class="number">4</span>&#125;</span><br><span class="line">C.process(&amp;test)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="字符串指针返回"><a href="#字符串指针返回" class="headerlink" title="字符串指针返回"></a>字符串指针返回</h2><p>很多数据结构在跨语言调用,得在各个语言来回解析,比较麻烦,我们直接以json字符串传递解析可以极大的简化问题的处理</p></li><li><p>lib.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::thread;</span><br><span class="line"><span class="keyword">use</span> libc::c_int;</span><br><span class="line"><span class="keyword">use</span> libc::c_char;</span><br><span class="line"><span class="keyword">use</span> std::ffi::&#123;CStr,CString&#125;;</span><br><span class="line"><span class="keyword">use</span> json;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#[no_mangle]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function"><span class="keyword">fn</span> <span class="title">process</span></span>(a:c_int)&#123;</span><br><span class="line">    <span class="keyword">let</span> handles:<span class="built_in">Vec</span>&lt;_&gt;=(<span class="number">0</span>..=<span class="number">10</span>).map(|_|&#123;</span><br><span class="line">        thread::spawn(||&#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="keyword">mut</span> x = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="number">0</span>..<span class="number">5000000</span>&#123;</span><br><span class="line">                x += <span class="number">1</span></span><br><span class="line">            &#125;</span><br><span class="line">            x</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;).collect();</span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> handles&#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;thread finished with count=&#123;&#125;&quot;</span>,h.join().map_err(|_|<span class="string">&quot;could not join a thread&quot;</span>).unwrap());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125; have done&quot;</span>,a)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[no_mangle]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function"><span class="keyword">fn</span> <span class="title">json_parse</span></span>(c_buf:*<span class="keyword">const</span> c_char)-&gt; *<span class="keyword">const</span> c_char&#123;</span><br><span class="line">    <span class="keyword">let</span> c_str = <span class="keyword">unsafe</span> &#123; CStr::from_ptr(c_buf) &#125;.to_str().unwrap();</span><br><span class="line">    <span class="keyword">let</span> parsed = json::parse(c_str).unwrap();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,parsed[<span class="string">&quot;a&quot;</span>]);</span><br><span class="line">    <span class="keyword">let</span> data = r#<span class="string">&quot;</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">            &quot;</span>name<span class="string">&quot;: &quot;</span>John Doe<span class="string">&quot;,</span></span><br><span class="line"><span class="string">            &quot;</span>age<span class="string">&quot;: 43,</span></span><br><span class="line"><span class="string">            &quot;</span>phones<span class="string">&quot;: [</span></span><br><span class="line"><span class="string">                &quot;</span>+<span class="number">44</span> <span class="number">1234567</span><span class="string">&quot;,</span></span><br><span class="line"><span class="string">                &quot;</span>+<span class="number">44</span> <span class="number">2345678</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">            ]</span></span><br><span class="line"><span class="string">        &#125;&quot;</span>#;</span><br><span class="line">        CString::new(data).unwrap().into_raw()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>main.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;interface.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    process(<span class="number">3</span>);</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *str = <span class="string">&quot;&#123;\&quot;a\&quot;: 3&#125;&quot;</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *ret_str = json_parse(str);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,ret_str);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>interface.h</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">process</span><span class="params">(<span class="keyword">int</span> a)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">const</span> <span class="keyword">char</span> * <span class="title">json_parse</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *c_buf)</span></span>;</span><br></pre></td></tr></table></figure></li></ul><ul><li>test.go<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">#cgo LDFLAGS: -L./ -lembed</span></span><br><span class="line"><span class="comment">#include &quot;interface.h&quot; //非标准c头文件，所以用引号</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;C&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">C.process(C.<span class="keyword">int</span>(<span class="number">3</span>))</span><br><span class="line">ret_ptr := C.json_parse(C.CString(<span class="string">`&#123;&quot;a&quot;:3&#125;`</span>))</span><br><span class="line">fmt.Println(C.GoString(ret_ptr))</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> go </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rust </tag>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>M1-vscode-lldb</title>
      <link href="2021/03/18/M1-vscode-lldb/"/>
      <url>2021/03/18/M1-vscode-lldb/</url>
      
        <content type="html"><![CDATA[<p>M1的vscode商店中的lldb当前无法直接使用,通过GitHub issue踩坑操作,最终不完美可用(有时候会崩溃)<br>1.重新编译vscode-lldb</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#lvm and vscode-lldb dependecies</span></span><br><span class="line"></span><br><span class="line">sudo port install cmake nodejs15 npm6</span><br><span class="line">Building stuff</span><br><span class="line">build llvm</span><br><span class="line"></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/llvm/llvm-project.git</span><br><span class="line"><span class="built_in">cd</span> llvm-project ; mkdir build ; <span class="built_in">cd</span> build</span><br><span class="line">cmake ../llvm -DLLVM_ENABLE_PROJECTS=<span class="string">&quot;clang;libcxx;lldb&quot;</span></span><br><span class="line">make lldb lldb-server</span><br><span class="line">That is going to take a <span class="keyword">while</span>.</span><br><span class="line"></span><br><span class="line"><span class="comment"># create a zip with llvm</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> lldb</span><br><span class="line">zip -r lldb-m1.zip bin/ lib/liblldb.12.0.0git.dylib lib/liblldb.dylib</span><br><span class="line">The content of the archive will be used by vscode-lldb later.</span><br><span class="line">Note that the content of lldb-m1.zip will probably only work on your <span class="built_in">local</span> machine as a lot of other dependencies are left outside (e.g. debugserver and required libs).</span><br><span class="line"></span><br><span class="line"><span class="comment"># building vscode-lldb</span></span><br><span class="line"></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/vadimcn/vscode-lldb.git</span><br><span class="line"><span class="built_in">cd</span> vscode-lldb</span><br><span class="line">git submodule update --init --recursive</span><br><span class="line">npm install</span><br><span class="line">mkdir build ; <span class="built_in">cd</span> build</span><br><span class="line">mkdir lldb</span><br><span class="line">mv &lt;location of lldb-m1.zip you create belore&gt; lldb/</span><br><span class="line">LLDB_PACKAGE=./lldb-m1.zip cmake ..</span><br><span class="line"><span class="comment"># replaced x86_64-apple-darwin to aarch64-apple-darwin in CMakeLists.txt and azure-pipelines.yml.</span></span><br><span class="line">make vsix_full</span><br><span class="line"><span class="comment"># If everything goes well:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># mv codelldb-full.vsix codelldb-aarch64-darwin.vsix</span></span><br><span class="line"><span class="comment"># Install the official vscode-lldb extension and reload.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Install codelldb-aarch64-darwin.vsix via &quot;Install from VSIX...&quot; in the extension menu of VSCode Exploratory.</span></span><br></pre></td></tr></table></figure><p>2.使用x86调试</p><p><code>rustup default stable-x86_64-apple</code></p><p><code>contral+shift+p</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lddb: use alternate backend</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;lldb</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> rust </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rust </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>杂谈</title>
      <link href="2021/03/03/%E6%9D%82%E8%B0%88/"/>
      <url>2021/03/03/%E6%9D%82%E8%B0%88/</url>
      
        <content type="html"><![CDATA[<h2 id="数据结构与算法"><a href="#数据结构与算法" class="headerlink" title="数据结构与算法"></a>数据结构与算法</h2><p>1.数据抽象的能力,把现实中的问题抽象出来<br>2.算法本质上就是通过数据结构解决问题的方法,就像学习一样,先学习了数字加减乘除,方程,微积分等等,才具备解决更加复杂的问题的能力.好的数据结构+好的算法=高效的问题解决</p>]]></content>
      
      
      <categories>
          
          <category> others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> others </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>从零实现nosql数据库</title>
      <link href="2021/03/03/%E4%BB%8E%E9%9B%B6%E5%AE%9E%E7%8E%B0nosql%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
      <url>2021/03/03/%E4%BB%8E%E9%9B%B6%E5%AE%9E%E7%8E%B0nosql%E6%95%B0%E6%8D%AE%E5%BA%93/</url>
      
        <content type="html"><![CDATA[<p>资料:<br>如何从零写一个kv数据库？ - cholerae的回答 - 知乎<br><a href="https://www.zhihu.com/question/59469744/answer/165590616">https://www.zhihu.com/question/59469744/answer/165590616</a><br><a href="https://codecapsule.com/2012/11/07/ikvs-implementing-a-key-value-store-table-of-contents/">https://codecapsule.com/2012/11/07/ikvs-implementing-a-key-value-store-table-of-contents/</a><br><a href="https://blog.csdn.net/UnSkyToo/article/details/46574209">https://blog.csdn.net/UnSkyToo/article/details/46574209</a><br><a href="https://www.lanqiao.cn/courses/1341">https://www.lanqiao.cn/courses/1341</a><br><a href="https://segmentfault.com/a/1190000004359057">https://segmentfault.com/a/1190000004359057</a><br><a href="http://www.jos.org.cn/html/2019/9/5776.htm">http://www.jos.org.cn/html/2019/9/5776.htm</a><br><a href="https://zh.wikipedia.org/wiki/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6">https://zh.wikipedia.org/wiki/计算机科学</a></p>]]></content>
      
      
      <categories>
          
          <category> rust </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rust </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ubuntu管理员账号添加</title>
      <link href="2021/03/03/ubuntu%E7%AE%A1%E7%90%86%E5%91%98%E8%B4%A6%E5%8F%B7%E6%B7%BB%E5%8A%A0/"/>
      <url>2021/03/03/ubuntu%E7%AE%A1%E7%90%86%E5%91%98%E8%B4%A6%E5%8F%B7%E6%B7%BB%E5%8A%A0/</url>
      
        <content type="html"><![CDATA[<p>ubuntu管理员账号添加,百度搜出来的结果很多总是不好用,这里记录一下<br><strong>root用户下操作</strong></p><h2 id="1-添加账户"><a href="#1-添加账户" class="headerlink" title="1.添加账户"></a>1.添加账户</h2><p><code>adduser username</code></p><h2 id="2-添加sudo权限"><a href="#2-添加sudo权限" class="headerlink" title="2.添加sudo权限"></a>2.添加<code>sudo</code>权限</h2><p><code>adduser username sudo</code><br>OR<br><code>usermod -aG sudo vivek</code></p><p>OR<br><code>sudo usermod -aG sudo vivek</code></p><p>OR<br><code>sudo adduser vivek sudo</code></p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>new_mac</title>
      <link href="2021/02/26/new-mac/"/>
      <url>2021/02/26/new-mac/</url>
      
        <content type="html"><![CDATA[<h2 id="git等命令安装"><a href="#git等命令安装" class="headerlink" title="git等命令安装"></a>git等命令安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">xcode-select --install</span><br><span class="line">sudo xcodebuild -license accept</span><br><span class="line">sudo spctl --master-disable <span class="comment">#开启任意来源app安装</span></span><br><span class="line">sudo xattr -rd com.apple.quarantine /Applications/LockedApp.app <span class="comment">#另一种开启任意来源app安装</span></span><br></pre></td></tr></table></figure><h2 id="iterm2美化"><a href="#iterm2美化" class="headerlink" title="iterm2美化"></a>iterm2美化</h2><p><a href="https://github.com/ryanoasis/nerd-fonts#option-4-homebrew-fonts">hack nerd font</a></p><h2 id="hexo安装"><a href="#hexo安装" class="headerlink" title="hexo安装"></a>hexo安装</h2><h2 id="ohmyzsh安装设置"><a href="#ohmyzsh安装设置" class="headerlink" title="ohmyzsh安装设置"></a>ohmyzsh安装设置</h2><p>启用插件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plugins&#x3D;(git zsh-autosuggestions zsh-syntax-highlighting autojump)</span><br></pre></td></tr></table></figure><h2 id="shell工具"><a href="#shell工具" class="headerlink" title="shell工具"></a>shell工具</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install fzf autojump</span><br></pre></td></tr></table></figure><h2 id="github-ssh-key配置"><a href="#github-ssh-key配置" class="headerlink" title="github ssh key配置"></a>github ssh key配置</h2><p>生产public key</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C <span class="string">&quot;i505125461@live.com&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> rust </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rust </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ios-c环境安装</title>
      <link href="2021/02/05/ios-c%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85/"/>
      <url>2021/02/05/ios-c%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85/</url>
      
        <content type="html"><![CDATA[<p>相关链接:<br><a href="https://stackoverflow.com/questions/28085052/compile-ios-program-from-linux-commandline">Compile IOS program from linux commandline</a><br><a href="https://code.google.com/archive/p/ios-toolchain-based-on-clang-for-linux/wikis/iphoneos_sdk_en.wiki">ios-toolchain-based-on-clang-for-linux - iphoneos_sdk_en.wiki</a><br><a href="https://github.com/ming1016/study/wiki/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90-iOS-%E7%BC%96%E8%AF%91-Clang---LLVM">深入剖析 iOS 编译 Clang LLVM</a><br><a href="https://github.com/okanon/iPhoneOS.sdk">https://github.com/okanon/iPhoneOS.sdk</a><br><a href="https://www.reddit.com/r/jailbreak/comments/axz229/helphow_can_i_fix_the_clang_stdioh_not_found/">how can I fix the clang ‘stdio.h’ not found error? On iOS 12.1 with unc0ver jailbroken</a></p><p>安装<br><code>llvmclang</code><br><code>iostoolchain</code><br><code>libclang</code><br><code>llvmclang</code><br>等</p><p><code>hello.c</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;hello\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>编译: <code>clang hello.c</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hello.c:1:10: fatal error: &#39;stdio.h&#39; file not found</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">         ^~~~~~~~~</span><br><span class="line">1 error generated.</span><br></pre></td></tr></table></figure><p>加入 -isysroot参数:<br><code>clang -isysroot iPhoneOS13.2.sdk hello.c</code><br>成功编译运行.</p><p>编译<code>c++</code> 暂未解决<br><code>clang -isystem iPhoneOS13.2.sdk hello.cpp</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>rust包导入</title>
      <link href="2021/02/03/rust%E5%8C%85%E5%AF%BC%E5%85%A5/"/>
      <url>2021/02/03/rust%E5%8C%85%E5%AF%BC%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<p>rust 新版本导入包使用,可以不用先<code>extern crate</code>只需在cargo.toml声明,然后可直接用<code>use</code></p><p>我们创建个项目<code>codec_test</code></p><p>当rust中同时存在<code>lib.rs</code>,<code>main.rs</code>时无法使用,<code>use crate::types::*</code><br>错误提示:<br><code>help: a similar path exists: codec_test::types</code>,这是因为在<code>lib.rs</code>中对于<code>lib.rs</code>来说<code>crate::</code>代表了<code>codec_test</code>crate本身,而对于<code>main.rs</code>来说则相当于是<code>mian.rs</code>导入了名为<code>codec_test</code>的外部<code>crate</code></p><p>代码验证:<br><code>tree</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">├── Cargo.toml</span><br><span class="line">├── src</span><br><span class="line">│   ├── lib.rs</span><br><span class="line">│   ├── main.rs</span><br><span class="line">│   └── types.rs</span><br></pre></td></tr></table></figure><p><code>lib.rs</code></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> types;</span><br></pre></td></tr></table></figure><p><code>cargo.toml</code></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[package]</span><br><span class="line">name = &quot;codec_test&quot;</span><br><span class="line">version = &quot;0.1.0&quot;</span><br><span class="line">authors = [&quot;k &lt;worileqing@163.com&gt;&quot;]</span><br><span class="line">edition = &quot;2018&quot;</span><br><span class="line"></span><br><span class="line"># See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html</span><br><span class="line"></span><br><span class="line">[dependencies]</span><br></pre></td></tr></table></figure><p><code>main.rs</code></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::convert::<span class="built_in">From</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// use crate::types::Sink;</span></span><br><span class="line"><span class="keyword">use</span> codec_test::types::Sink;</span><br><span class="line"></span><br><span class="line"><span class="comment">// use codec_test::types::Sink1;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">type</span> <span class="title">U256</span></span> = [<span class="built_in">u8</span>; <span class="number">32</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Debug)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">Sink1</span></span>&#123;</span><br><span class="line">    <span class="keyword">pub</span> capacity:<span class="built_in">usize</span>,</span><br><span class="line">    <span class="keyword">pub</span> preamble:<span class="built_in">Vec</span>&lt;<span class="built_in">u8</span>&gt;,</span><br><span class="line">    <span class="keyword">pub</span> heap:<span class="built_in">Vec</span>&lt;<span class="built_in">u8</span>&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">from</span></span>(num:<span class="built_in">u32</span>) -&gt; U256&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> slice = [<span class="number">0u8</span>;<span class="number">32</span>];</span><br><span class="line">    slice[<span class="number">28</span>] = (num&gt;&gt;<span class="number">24</span>) <span class="keyword">as</span> <span class="built_in">u8</span>;</span><br><span class="line">    slice[<span class="number">29</span>] = (num&gt;&gt;<span class="number">16</span>) <span class="keyword">as</span> <span class="built_in">u8</span>;</span><br><span class="line">    slice[<span class="number">30</span>] = (num&gt;&gt;<span class="number">8</span>) <span class="keyword">as</span> <span class="built_in">u8</span>;</span><br><span class="line">    slice[<span class="number">31</span>] = num <span class="keyword">as</span> <span class="built_in">u8</span>;</span><br><span class="line">    slice</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="built_in">From</span>&lt;<span class="built_in">u32</span>&gt; <span class="keyword">for</span> Sink1 &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">from</span></span>(num: <span class="built_in">u32</span>) -&gt; <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> slice = [<span class="number">0u8</span>;<span class="number">32</span>];</span><br><span class="line">        slice[<span class="number">28</span>] = (num&gt;&gt;<span class="number">24</span>) <span class="keyword">as</span> <span class="built_in">u8</span>;</span><br><span class="line">        slice[<span class="number">29</span>] = (num&gt;&gt;<span class="number">16</span>) <span class="keyword">as</span> <span class="built_in">u8</span>;</span><br><span class="line">        slice[<span class="number">30</span>] = (num&gt;&gt;<span class="number">8</span>) <span class="keyword">as</span> <span class="built_in">u8</span>;</span><br><span class="line">        slice[<span class="number">31</span>] = num <span class="keyword">as</span> <span class="built_in">u8</span>;</span><br><span class="line">        Sink1&#123;</span><br><span class="line">            capacity:<span class="number">1</span> <span class="keyword">as</span> <span class="built_in">usize</span>,</span><br><span class="line">            preamble:slice.into(),</span><br><span class="line">            heap:<span class="built_in">Vec</span>::new(),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">Codec</span></span>:<span class="built_in">Sized</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">encode</span></span>(<span class="keyword">self</span>,sink: &amp;<span class="keyword">mut</span> Sink);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span> Codec <span class="keyword">for</span> <span class="built_in">u32</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">encode</span></span>(<span class="keyword">self</span>,sink: &amp;<span class="keyword">mut</span> Sink)&#123;</span><br><span class="line">        <span class="keyword">let</span> tar = from(<span class="keyword">self</span>);</span><br><span class="line">        sink.preamble.extend_from_slice(&amp;tar);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> a:<span class="built_in">u32</span> = <span class="number">8</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> sink = Sink&#123;</span><br><span class="line">        capacity:<span class="number">1</span>,</span><br><span class="line">        preamble:<span class="built_in">Vec</span>::new(),</span><br><span class="line">        heap:<span class="built_in">Vec</span>::new(),</span><br><span class="line">    &#125;;</span><br><span class="line">    a.encode(&amp;<span class="keyword">mut</span> sink);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>,sink);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> sink1 = Sink1::from(<span class="number">3</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>,sink1);</span><br><span class="line">    <span class="keyword">let</span> sink2:Sink1 = <span class="number">4</span>.into();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;sink2 &#123;:?&#125;&quot;</span>,sink2); </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>types.rs</code></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[derive(Debug)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">Sink</span></span>&#123;</span><br><span class="line">    <span class="keyword">pub</span> capacity:<span class="built_in">usize</span>,</span><br><span class="line">    <span class="keyword">pub</span> preamble:<span class="built_in">Vec</span>&lt;<span class="built_in">u8</span>&gt;,</span><br><span class="line">    <span class="keyword">pub</span> heap:<span class="built_in">Vec</span>&lt;<span class="built_in">u8</span>&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>删除<code>main.rs</code>,将代码放入<code>lib.rs</code>使用<code>cargo test -- --nocapture test</code>验证</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">├── Cargo.toml</span><br><span class="line">├── src</span><br><span class="line">│   ├── lib.rs</span><br><span class="line">│   └── types.rs</span><br></pre></td></tr></table></figure><p><code>lib.rs</code></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> types;</span><br><span class="line"><span class="keyword">use</span> std::convert::<span class="built_in">From</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> crate::types::Sink;</span><br><span class="line"></span><br><span class="line"><span class="comment">// use wasm2ct::types::Sink1;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">type</span> <span class="title">U256</span></span> = [<span class="built_in">u8</span>; <span class="number">32</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Debug)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">Sink1</span></span>&#123;</span><br><span class="line">    <span class="keyword">pub</span> capacity:<span class="built_in">usize</span>,</span><br><span class="line">    <span class="keyword">pub</span> preamble:<span class="built_in">Vec</span>&lt;<span class="built_in">u8</span>&gt;,</span><br><span class="line">    <span class="keyword">pub</span> heap:<span class="built_in">Vec</span>&lt;<span class="built_in">u8</span>&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">from</span></span>(num:<span class="built_in">u32</span>) -&gt; U256&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> slice = [<span class="number">0u8</span>;<span class="number">32</span>];</span><br><span class="line">    slice[<span class="number">28</span>] = (num&gt;&gt;<span class="number">24</span>) <span class="keyword">as</span> <span class="built_in">u8</span>;</span><br><span class="line">    slice[<span class="number">29</span>] = (num&gt;&gt;<span class="number">16</span>) <span class="keyword">as</span> <span class="built_in">u8</span>;</span><br><span class="line">    slice[<span class="number">30</span>] = (num&gt;&gt;<span class="number">8</span>) <span class="keyword">as</span> <span class="built_in">u8</span>;</span><br><span class="line">    slice[<span class="number">31</span>] = num <span class="keyword">as</span> <span class="built_in">u8</span>;</span><br><span class="line">    slice</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="built_in">From</span>&lt;<span class="built_in">u32</span>&gt; <span class="keyword">for</span> Sink1 &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">from</span></span>(num: <span class="built_in">u32</span>) -&gt; <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> slice = [<span class="number">0u8</span>;<span class="number">32</span>];</span><br><span class="line">        slice[<span class="number">28</span>] = (num&gt;&gt;<span class="number">24</span>) <span class="keyword">as</span> <span class="built_in">u8</span>;</span><br><span class="line">        slice[<span class="number">29</span>] = (num&gt;&gt;<span class="number">16</span>) <span class="keyword">as</span> <span class="built_in">u8</span>;</span><br><span class="line">        slice[<span class="number">30</span>] = (num&gt;&gt;<span class="number">8</span>) <span class="keyword">as</span> <span class="built_in">u8</span>;</span><br><span class="line">        slice[<span class="number">31</span>] = num <span class="keyword">as</span> <span class="built_in">u8</span>;</span><br><span class="line">        Sink1&#123;</span><br><span class="line">            capacity:<span class="number">1</span> <span class="keyword">as</span> <span class="built_in">usize</span>,</span><br><span class="line">            preamble:slice.into(),</span><br><span class="line">            heap:<span class="built_in">Vec</span>::new(),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">Codec</span></span>:<span class="built_in">Sized</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">encode</span></span>(<span class="keyword">self</span>,sink: &amp;<span class="keyword">mut</span> Sink);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span> Codec <span class="keyword">for</span> <span class="built_in">u32</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">encode</span></span>(<span class="keyword">self</span>,sink: &amp;<span class="keyword">mut</span> Sink)&#123;</span><br><span class="line">        <span class="keyword">let</span> tar = from(<span class="keyword">self</span>);</span><br><span class="line">        sink.preamble.extend_from_slice(&amp;tar);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[test]</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">test</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> a:<span class="built_in">u32</span> = <span class="number">8</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> sink = Sink&#123;</span><br><span class="line">        capacity:<span class="number">1</span>,</span><br><span class="line">        preamble:<span class="built_in">Vec</span>::new(),</span><br><span class="line">        heap:<span class="built_in">Vec</span>::new(),</span><br><span class="line">    &#125;;</span><br><span class="line">    a.encode(&amp;<span class="keyword">mut</span> sink);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>,sink);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> sink1 = Sink1::from(<span class="number">3</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>,sink1);</span><br><span class="line">    <span class="keyword">let</span> sink2:Sink1 = <span class="number">4</span>.into();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;sink2 &#123;:?&#125;&quot;</span>,sink2); </span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> rust </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rust </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>高性能web服务与并发测试</title>
      <link href="2021/01/22/%E9%AB%98%E6%80%A7%E8%83%BDweb%E6%9C%8D%E5%8A%A1%E4%B8%8E%E5%B9%B6%E5%8F%91%E6%B5%8B%E8%AF%95/"/>
      <url>2021/01/22/%E9%AB%98%E6%80%A7%E8%83%BDweb%E6%9C%8D%E5%8A%A1%E4%B8%8E%E5%B9%B6%E5%8F%91%E6%B5%8B%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<h1 id="并发测试工具"><a href="#并发测试工具" class="headerlink" title="并发测试工具"></a>并发测试工具</h1><p>1.<a href="http://httpd.apache.org/docs/2.2/programs/ab.html">Apache ab</a><br>2.<a href="https://locust.io/">Python locust</a><br>3.<a href="https://www.npmjs.com/package/loadtest">nodejs loadtest</a><br>4.<a href="https://redmine.lighttpd.net/projects/weighttp/wiki">weighttp</a><br>5.<a href="https://jmeter.apache.org/">Apache JMeter</a><br>6.<a href="https://github.com/wg/wrk">wrk</a></p><h1 id="并发Web开发"><a href="#并发Web开发" class="headerlink" title="并发Web开发"></a>并发Web开发</h1><p>1.Python的并发服务:<a href="https://cpp.la/439.html?utm_source=wechat_session&utm_medium=social&utm_oi=542263647259381760">Flask gevent 多进程WSGI（非gunicorn）</a>,这篇博客已经对并发进行分析测试了,为了防止失联,把代码搬运了:</p><h2 id="server-py"><a href="#server-py" class="headerlink" title="server.py"></a>server.py</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"><span class="comment"># code by https://cpp.la, 2020-04-20</span></span><br><span class="line"><span class="comment"># flask + gevent + multiprocess + wsgi</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">from</span> gevent <span class="keyword">import</span> monkey</span><br><span class="line"><span class="keyword">from</span> gevent.pywsgi <span class="keyword">import</span> WSGIServer</span><br><span class="line">monkey.patch_all()</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> cpu_count, Process</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, jsonify</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">app = Flask(__name__)</span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">function_benchmark</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">MULTI_PROCESS</span>):</span></span><br><span class="line">    <span class="keyword">if</span> MULTI_PROCESS == <span class="literal">False</span>:</span><br><span class="line">        WSGIServer((<span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">8080</span>), app).serve_forever()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        mulserver = WSGIServer((<span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">8080</span>), app)</span><br><span class="line">        mulserver.start()</span><br><span class="line"> </span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">server_forever</span>():</span></span><br><span class="line">            mulserver.start_accepting()</span><br><span class="line">            mulserver._stop_event.wait()</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(cpu_count()):</span><br><span class="line">            p = Process(target=server_forever)</span><br><span class="line">            p.start()</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># 单进程 + 协程</span></span><br><span class="line">    run(<span class="literal">False</span>)</span><br><span class="line">    <span class="comment"># 多进程 + 协程</span></span><br><span class="line">    <span class="comment"># run(True)</span></span><br></pre></td></tr></table></figure><p>2.RUST并发服务<br><code>rust actix</code></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> actix_web::&#123;get, web, App, HttpServer, Responder&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[get(<span class="meta-string">&quot;/&quot;</span>)]</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">fn</span> <span class="title">index</span></span>(web::Path((id, name)): web::Path&lt;(<span class="built_in">u32</span>, <span class="built_in">String</span>)&gt;) -&gt; <span class="keyword">impl</span> Responder &#123;</span><br><span class="line">    <span class="built_in">format!</span>(<span class="string">&quot;Hello &#123;&#125;! id:&#123;&#125;&quot;</span>, name, id)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[actix_web::main]</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() -&gt; std::io::<span class="built_in">Result</span>&lt;()&gt; &#123;</span><br><span class="line">    HttpServer::new(|| App::new().service(index))</span><br><span class="line">        .bind(<span class="string">&quot;127.0.0.1:8080&quot;</span>)?</span><br><span class="line">        .run()</span><br><span class="line">        .<span class="keyword">await</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>actix 测试结果:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">wrk -c100 -t16 -d5s http://127.0.0.1:8080</span><br><span class="line">Running 5s <span class="built_in">test</span> @ http://127.0.0.1:8080</span><br><span class="line">  16 threads and 100 connections</span><br><span class="line">  Thread Stats   Avg      Stdev     Max   +/- Stdev</span><br><span class="line">    Latency   692.92us  671.89us  27.97ms   98.85%</span><br><span class="line">    Req/Sec     9.29k   829.44    20.49k    97.03%</span><br><span class="line">  746546 requests <span class="keyword">in</span> 5.10s, 58.38MB <span class="built_in">read</span></span><br><span class="line">  Non-2xx or 3xx responses: 746546</span><br><span class="line">Requests/sec: 146385.73</span><br><span class="line">Transfer/sec:     11.45MB</span><br><span class="line">./wrk -c1000 -t16 -d5s http://127.0.0.1:8080</span><br><span class="line">Running 5s <span class="built_in">test</span> @ http://127.0.0.1:8080</span><br><span class="line">  16 threads and 1000 connections</span><br><span class="line">  Thread Stats   Avg      Stdev     Max   +/- Stdev</span><br><span class="line">    Latency     6.37ms    1.98ms  78.58ms   93.94%</span><br><span class="line">    Req/Sec     9.54k     3.48k   86.90k    92.16%</span><br><span class="line">  763414 requests <span class="keyword">in</span> 5.10s, 59.70MB <span class="built_in">read</span></span><br><span class="line">  Non-2xx or 3xx responses: 763414</span><br><span class="line">Requests/sec: 149702.90</span><br><span class="line">Transfer/sec:     11.71MB</span><br></pre></td></tr></table></figure><p>测试机器为8核16线程的服务器,可以看到actix的性能还是相当强大的.另外突然想到了一个问题<br><a href="https://www.zhihu.com/question/43590414">Linux中本机和本机Socket通信会走网卡吗？</a></p><h1 id="并发测试"><a href="#并发测试" class="headerlink" title="并发测试"></a>并发测试</h1><p>起先用了<code>loadtest</code>测试,关于<code>Apache ab</code>,<code>weighttp</code>的性能<code>loadtest</code>中有提到,感觉并不理想,后来使用wrk发现性能更强,故使用<code>wrk</code>测试.<code>wrk</code>支持<code>lua</code>脚本的嵌入调用,支持<code>post</code>,<code>get</code>,等调用,亦可使用<code>lua</code>脚本同时对多个接口进行测试.</p><h2 id="mul-lua多接口测试脚本"><a href="#mul-lua多接口测试脚本" class="headerlink" title="mul.lua多接口测试脚本"></a><code>mul.lua</code>多接口测试脚本</h2><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Resource: http://czerasz.com/2015/07/19/wrk-http-benchmarking-tool-example/</span></span><br><span class="line"><span class="comment">-- Module instantiation</span></span><br><span class="line"><span class="keyword">local</span> cjson = <span class="built_in">require</span> <span class="string">&quot;cjson&quot;</span></span><br><span class="line"><span class="keyword">local</span> cjson2 = cjson.new()</span><br><span class="line"><span class="keyword">local</span> cjson_safe = <span class="built_in">require</span> <span class="string">&quot;cjson.safe&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- Initialize the pseudo random number generator</span></span><br><span class="line"><span class="comment">-- Resource: http://lua-users.org/wiki/MathLibraryTutorial</span></span><br><span class="line"><span class="built_in">math</span>.<span class="built_in">randomseed</span>(<span class="built_in">os</span>.<span class="built_in">time</span>())</span><br><span class="line"><span class="built_in">math</span>.<span class="built_in">random</span>(); <span class="built_in">math</span>.<span class="built_in">random</span>(); <span class="built_in">math</span>.<span class="built_in">random</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Shuffle array</span></span><br><span class="line"><span class="comment">-- Returns a randomly shuffled array</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">shuffle</span><span class="params">(paths)</span></span></span><br><span class="line">  <span class="keyword">local</span> j, k</span><br><span class="line">  <span class="keyword">local</span> n = #paths</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> i = <span class="number">1</span>, n <span class="keyword">do</span></span><br><span class="line">    j, k = <span class="built_in">math</span>.<span class="built_in">random</span>(n), <span class="built_in">math</span>.<span class="built_in">random</span>(n)</span><br><span class="line">    paths[j], paths[k] = paths[k], paths[j]</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> paths</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- Load URL paths from the file</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">load_request_objects_from_file</span><span class="params">(file)</span></span></span><br><span class="line">  <span class="keyword">local</span> data = &#123;&#125;</span><br><span class="line">  <span class="keyword">local</span> content</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- Check if the file exists</span></span><br><span class="line">  <span class="comment">-- Resource: http://stackoverflow.com/a/4991602/325852</span></span><br><span class="line">  <span class="keyword">local</span> f=<span class="built_in">io</span>.<span class="built_in">open</span>(file,<span class="string">&quot;r&quot;</span>)</span><br><span class="line">  <span class="keyword">if</span> f~=<span class="literal">nil</span> <span class="keyword">then</span></span><br><span class="line">    content = f:<span class="built_in">read</span>(<span class="string">&quot;*all&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">io</span>.<span class="built_in">close</span>(f)</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="comment">-- Return the empty array</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">lines</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">-- Translate Lua value to/from JSON</span></span><br><span class="line">  data = cjson.decode(content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> shuffle(data)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- Load URL requests from file</span></span><br><span class="line">requests = load_request_objects_from_file(<span class="string">&quot;./data/requests.json&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Check if at least one path was found in the file</span></span><br><span class="line"><span class="keyword">if</span> #requests &lt;= <span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&quot;multiplerequests: No requests found.&quot;</span>)</span><br><span class="line">  <span class="built_in">os</span>.<span class="built_in">exit</span>()</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;multiplerequests: Found &quot;</span> .. #requests .. <span class="string">&quot; requests&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Initialize the requests array iterator</span></span><br><span class="line">counter = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">request = <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">  <span class="comment">-- Get the next requests array element</span></span><br><span class="line">  <span class="keyword">local</span> request_object = requests[counter]</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- Increment the counter</span></span><br><span class="line">  counter = counter + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">-- If the counter is longer than the requests array length then reset it</span></span><br><span class="line">  <span class="keyword">if</span> counter &gt; #requests <span class="keyword">then</span></span><br><span class="line">    counter = <span class="number">1</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">-- Return the request object with the current URL path</span></span><br><span class="line">  <span class="keyword">return</span> wrk.<span class="built_in">format</span>(request_object.method, request_object.<span class="built_in">path</span>, request_object.headers, request_object.body)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>上面脚本依赖<code>lua</code>的<code>cjson</code>包,其目的是解析<code>/data/requests.json</code>构造对应的<code>request</code>请求.</p><h2 id="data-requests-json"><a href="#data-requests-json" class="headerlink" title="/data/requests.json"></a><code>/data/requests.json</code></h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;path&quot;</span>: <span class="string">&quot;/path-1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;body&quot;</span>: <span class="string">&quot;&#123;\&quot;quote\&quot;: \&quot;\&quot;&#125;&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;method&quot;</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;headers&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// path 为web服务的url路径</span></span><br><span class="line">    <span class="attr">&quot;path&quot;</span>: <span class="string">&quot;/path-2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;body&quot;</span>: <span class="string">&quot;&#123;\&quot;quote\&quot;: \&quot;\&quot;&#125;&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;method&quot;</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;headers&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h2 id="测试命令"><a href="#测试命令" class="headerlink" title="测试命令"></a>测试命令</h2><p><code>./wrk -c100 -t16 -d5s -s ./mul.lua http://127.0.0.1:5000</code></p><p><code>-c</code>:(concurrent)并发数</p><p><code>-t</code>:(threads)线程数</p><p><code>-d</code>:(duration)持续时间</p><p>其它具体使用方法可去看文档及示例: <a href="https://github.com/wg/wrk">https://github.com/wg/wrk</a></p><h3 id="疑问-测试actix时-cpu-内存-网络占用-都特别低-cpu使用百分之一不到-说明程序还远未达到硬件的性能瓶颈"><a href="#疑问-测试actix时-cpu-内存-网络占用-都特别低-cpu使用百分之一不到-说明程序还远未达到硬件的性能瓶颈" class="headerlink" title="疑问 测试actix时,cpu,内存,网络占用,都特别低,cpu使用百分之一不到,说明程序还远未达到硬件的性能瓶颈"></a>疑问 测试actix时,cpu,内存,网络占用,都特别低,cpu使用百分之一不到,说明程序还远未达到硬件的性能瓶颈</h3><p>Linux的性能测试工具 <a href="http://www.brendangregg.com/perf.html">Perf</a></p>]]></content>
      
      
      <categories>
          
          <category> rust </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rust </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>rust类属性宏</title>
      <link href="2021/01/08/rust%E7%B1%BB%E5%B1%9E%E6%80%A7%E5%AE%8F/"/>
      <url>2021/01/08/rust%E7%B1%BB%E5%B1%9E%E6%80%A7%E5%AE%8F/</url>
      
        <content type="html"><![CDATA[<p>1.创建macro_test项目<br><code>cargo new macro_test</code><br>2.创建<code>macro_test_derive</code>项目实现宏的代码逻辑<br><code>cargo new macro_test_derive --lib</code><br>在<code>macro_test_derive</code>的Cargo.toml中声明lib标识<code>proc-macro</code></p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[lib]</span></span><br><span class="line"><span class="attr">crate-type</span> = [<span class="string">&quot;proc-macro&quot;</span>]</span><br></pre></td></tr></table></figure><p>也可用</p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[lib]</span></span><br><span class="line"><span class="attr">proc-macro</span> = <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>3.宏逻辑代码</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> proc_macro::TokenStream;</span><br><span class="line"><span class="keyword">use</span> quote::quote;</span><br><span class="line"><span class="keyword">use</span> cfg_if::cfg_if;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[proc_macro_attribute]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">macro_test_derive</span></span>(attr: TokenStream, input: TokenStream) -&gt; TokenStream &#123;</span><br><span class="line">    cfg_if!&#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="meta">#[cfg(feature = <span class="meta-string">&quot;test&quot;</span>)]</span>&#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;the attr is11 &#123;:?&#125;&quot;</span>,attr.to_string());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    (quote! &#123;</span><br><span class="line">        <span class="function"><span class="keyword">fn</span> <span class="title">hello1</span></span>()&#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;it&#x27;s hello1&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).into()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4.<code>main.rs</code>调用宏测试</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> macro_test_derive::macro_test_derive;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[macro_test_derive(K)]</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">hello</span></span>()&#123;</span><br><span class="line">    <span class="built_in">unimplemented!</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>()&#123;</span><br><span class="line">    hello1()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>项目地址:<a href="https://github.com/60ke/rust_code_test/tree/main/macro_test">https://github.com/60ke/rust_code_test/tree/main/macro_test</a></p>]]></content>
      
      
      <categories>
          
          <category> rust </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rust </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>智能合约sdk开发</title>
      <link href="2020/12/16/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6sdk%E5%BC%80%E5%8F%91/"/>
      <url>2020/12/16/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6sdk%E5%BC%80%E5%8F%91/</url>
      
        <content type="html"><![CDATA[<p>架构:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+----------------------------------+</span><br><span class="line">|         standard library         |----------------&gt; |合约标准库如 U256 Address等</span><br><span class="line">+----------------------------------+</span><br><span class="line">|         rs contract file         |----------------&gt; |rust 合约初始文件</span><br><span class="line">+----------------------------------+</span><br><span class="line">|             rust sdk             |----------------&gt; |包装合约初始文件(为其添加deploy,call方法)</span><br><span class="line">+----------------------------------+</span><br><span class="line">|      contract middle layer       |----------------&gt; |外部导入虚拟机存储读写接口</span><br><span class="line">+----------------------------------+</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> rust </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rust </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>rust num</title>
      <link href="2020/12/11/rust-num/"/>
      <url>2020/12/11/rust-num/</url>
      
        <content type="html"><![CDATA[<p>开发<code>wasm2ct</code>时遇到了这行代码</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">construct_uint! &#123;</span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">U256</span></span>(<span class="number">4</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>宏展开之后为:</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">IntellijRustDollarCrate::construct_uint! &#123; @ construct  <span class="keyword">pub</span>  <span class="class"><span class="keyword">struct</span> <span class="title">U256</span></span> ( <span class="number">4</span> ) ; &#125;</span><br><span class="line"><span class="keyword">impl</span> ::uint::core_::convert::<span class="built_in">From</span>&lt;<span class="built_in">u128</span>&gt; <span class="keyword">for</span> U256 &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">from</span></span>(value: <span class="built_in">u128</span>) -&gt; U256 &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> ret = [<span class="number">0</span>; <span class="number">4</span>];</span><br><span class="line">        ret[<span class="number">0</span>] = value <span class="keyword">as</span> <span class="built_in">u64</span>;</span><br><span class="line">        ret[<span class="number">1</span>] = (value &gt;&gt; <span class="number">64</span>) <span class="keyword">as</span> <span class="built_in">u64</span>;</span><br><span class="line">        U256(ret)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span> ::uint::core_::convert::<span class="built_in">From</span>&lt;<span class="built_in">i128</span>&gt; <span class="keyword">for</span> U256 &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">from</span></span>(value: <span class="built_in">i128</span>) -&gt; U256 &#123;</span><br><span class="line">        <span class="keyword">match</span> value &gt;= <span class="number">0</span> &#123;</span><br><span class="line">            <span class="literal">true</span> =&gt; <span class="built_in">From</span>::from(value <span class="keyword">as</span> <span class="built_in">u128</span>),</span><br><span class="line">            <span class="literal">false</span> =&gt; &#123; <span class="built_in">panic!</span>(<span class="string">&quot;Unsigned integer can&#x27;t be created from negative value&quot;</span>); &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span> U256 &#123;</span><br><span class="line">    <span class="comment">/// Low 2 words (u128) </span></span><br><span class="line">    <span class="meta">#[inline]</span></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">const</span> <span class="function"><span class="keyword">fn</span> <span class="title">low_u128</span></span>(&amp;<span class="keyword">self</span>) -&gt; <span class="built_in">u128</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> &amp;U256(<span class="keyword">ref</span> arr) = <span class="keyword">self</span>;</span><br><span class="line">        ((arr[<span class="number">1</span>] <span class="keyword">as</span> <span class="built_in">u128</span>) &lt;&lt; <span class="number">64</span>) + arr[<span class="number">0</span>] <span class="keyword">as</span> <span class="built_in">u128</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Conversion to u128 with overflow checking</span></span><br><span class="line">   <span class="comment">///</span></span><br><span class="line">   <span class="comment">/// # Panics</span></span><br><span class="line">   <span class="comment">///</span></span><br><span class="line">   <span class="comment">/// Panics if the number is larger than 2^128. </span></span><br><span class="line">    <span class="meta">#[inline]</span></span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">as_u128</span></span>(&amp;<span class="keyword">self</span>) -&gt; <span class="built_in">u128</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> &amp;U256(<span class="keyword">ref</span> arr) = <span class="keyword">self</span>;</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">2</span>..<span class="number">4</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> arr[i] != <span class="number">0</span> &#123;</span><br><span class="line">                <span class="built_in">panic!</span>(<span class="string">&quot;Integer overflow when casting to u128&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">self</span>.low_u128()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span> ::uint::core_::convert::TryFrom&lt;U256&gt; <span class="keyword">for</span> <span class="built_in">u128</span> &#123;</span><br><span class="line">    <span class="class"><span class="keyword">type</span> <span class="title">Error</span></span> = &amp;<span class="symbol">&#x27;static</span> <span class="built_in">str</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[inline]</span></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">try_from</span></span>(u: U256) -&gt; ::uint::core_::result::<span class="built_in">Result</span>&lt;<span class="built_in">u128</span>, &amp;<span class="symbol">&#x27;static</span> <span class="built_in">str</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">let</span> U256(arr) = u;</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">2</span>..<span class="number">4</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> arr[i] != <span class="number">0</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">Err</span>(<span class="string">&quot;integer overflow when casting to u128&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="literal">Ok</span>(((arr[<span class="number">1</span>] <span class="keyword">as</span> <span class="built_in">u128</span>) &lt;&lt; <span class="number">64</span>) + arr[<span class="number">0</span>] <span class="keyword">as</span> <span class="built_in">u128</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span> ::uint::core_::convert::TryFrom&lt;U256&gt; <span class="keyword">for</span> <span class="built_in">i128</span> &#123;</span><br><span class="line">    <span class="class"><span class="keyword">type</span> <span class="title">Error</span></span> = &amp;<span class="symbol">&#x27;static</span> <span class="built_in">str</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[inline]</span></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">try_from</span></span>(u: U256) -&gt; ::uint::core_::result::<span class="built_in">Result</span>&lt;<span class="built_in">i128</span>, &amp;<span class="symbol">&#x27;static</span> <span class="built_in">str</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">let</span> err_str = <span class="string">&quot;integer overflow when casting to i128&quot;</span>;</span><br><span class="line">        <span class="keyword">let</span> i = <span class="built_in">u128</span>::try_from(u).map_err(|_| err_str)?;</span><br><span class="line">        <span class="keyword">if</span> i &gt; <span class="built_in">i128</span>::max_value() <span class="keyword">as</span> <span class="built_in">u128</span> &#123;</span><br><span class="line">            <span class="literal">Err</span>(err_str)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="literal">Ok</span>(i <span class="keyword">as</span> <span class="built_in">i128</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里注意到在代码</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> ::uint::core_::convert::<span class="built_in">From</span>&lt;<span class="built_in">u128</span>&gt; <span class="keyword">for</span> U256 &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">from</span></span>(value: <span class="built_in">u128</span>) -&gt; U256 &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> ret = [<span class="number">0</span>; <span class="number">4</span>];</span><br><span class="line">        ret[<span class="number">0</span>] = value <span class="keyword">as</span> <span class="built_in">u64</span>;</span><br><span class="line">        ret[<span class="number">1</span>] = (value &gt;&gt; <span class="number">64</span>) <span class="keyword">as</span> <span class="built_in">u64</span>;</span><br><span class="line">        U256(ret)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>中转化<code>u128</code>为<code>u64</code>分为三步:</p><ol><li>设置数组<code>[u64;4]</code>存储<code>U256</code>,将<code>u128</code>存到数组前两个位置</li><li>存储低位到<code>数组[0]</code>,即<code>u128 as u256</code></li><li>存储高位到<code>数组[1]</code>,即<code>value &gt;&gt; 64</code><br>rust 标准库中已经包含了<code>u128</code>的数据类型<a href="https://doc.rust-lang.org/std/u128/index.html">U128</a>,rust中当大数转小数,例如u128转u64,u64转u32时,使用<code>as</code>关键字,且当大位数超出小位数时,均以最后长度的数字赋值.(额外的关于<code>as</code>的实现与重载(<a href="https://github.com/rust-lang/rust/issues/6016)).%E4%BB%A3%E7%A0%81%E9%AA%8C%E8%AF%81">https://github.com/rust-lang/rust/issues/6016)).代码验证</a></li></ol><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> a = <span class="built_in">u128</span>::MAX / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">let</span> b = <span class="built_in">u64</span>::MAX;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,a);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;u64 max &#123;&#125;&quot;</span>,b);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;u64 max as u32 &#123;&#125;&quot;</span>,(b-<span class="number">1</span>) <span class="keyword">as</span> <span class="built_in">u32</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;u32 max &#123;&#125;&quot;</span>,<span class="built_in">u32</span>::MAX);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Hello, world! &#123;&#125;&quot;</span>,a <span class="keyword">as</span> <span class="built_in">u64</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;2 &gt;&gt; 1 is &#123;&#125;&quot;</span>,<span class="number">2</span>&gt;&gt;<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;2 &gt;&gt; 2 is &#123;&#125;&quot;</span>,<span class="number">2</span>&gt;&gt;<span class="number">2</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;3 &gt;&gt; 1 is &#123;&#125;&quot;</span>,<span class="number">3</span>&gt;&gt;<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;5 &gt;&gt; 1 is &#123;&#125;&quot;</span>,<span class="number">5</span>&gt;&gt;<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;5 &gt;&gt; 2 is &#123;&#125;&quot;</span>,<span class="number">5</span>&gt;&gt;<span class="number">2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> rust </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rust </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>rust macro</title>
      <link href="2020/12/02/rust-macro/"/>
      <url>2020/12/02/rust-macro/</url>
      
        <content type="html"><![CDATA[<p>先放代码</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">macro_rules!</span> say_hello &#123;</span><br><span class="line">    ($arg:expr) =&gt; &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, $arg);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">macro_rules!</span> re_hello &#123;</span><br><span class="line">    ($arg:expr) =&gt; &#123;</span><br><span class="line">        say_hello!($arg);</span><br><span class="line">        say_hello!($arg)</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">macro_rules!</span> many_greetings &#123;</span><br><span class="line">    ($times:expr) =&gt; &#123;&#123;</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span>..$times &#123;</span><br><span class="line">            re_hello!(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> a = <span class="string">&quot;111&quot;</span>;</span><br><span class="line">    re_hello!(a);</span><br><span class="line">    many_greetings!(<span class="number">4</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> rust </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rust </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>rust From&lt;T&gt;</title>
      <link href="2020/11/17/rust-From-T/"/>
      <url>2020/11/17/rust-From-T/</url>
      
        <content type="html"><![CDATA[<p>在对wasm2contract的开发中遇到了这样的代码：</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">trait</span> <span class="title">TokenInterface</span></span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">constructor</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, _total_supply: <span class="built_in">u8</span>);</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">totalsupply</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) -&gt; <span class="built_in">u8</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#[derive(Debug)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">TokenEndpoint</span></span>&lt;T: TokenInterface&gt; &#123;</span><br><span class="line">    <span class="keyword">pub</span> inner: T,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span>&lt;T: TokenInterface&gt; <span class="built_in">From</span>&lt;T&gt; <span class="keyword">for</span> TokenEndpoint&lt;T&gt; &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">from</span></span>(inner: T) -&gt; TokenEndpoint&lt;T&gt; &#123;</span><br><span class="line">        TokenEndpoint &#123; inner: inner &#125;</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span>&lt;T: TokenInterface&gt; TokenEndpoint&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">new</span></span>(inner: T) -&gt; <span class="keyword">Self</span> &#123;</span><br><span class="line">        TokenEndpoint &#123; inner: inner &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// pub fn from(inner: T) -&gt; Self &#123;</span></span><br><span class="line">    <span class="comment">//     TokenEndpoint &#123; inner: inner &#125;</span></span><br><span class="line">    <span class="comment">// &#125;    </span></span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">instance</span></span>(&amp;<span class="keyword">self</span>) -&gt; &amp;T &#123;</span><br><span class="line">        &amp;<span class="keyword">self</span>.inner</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Debug)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">TokenContract</span></span>&#123;</span><br><span class="line">    x:<span class="built_in">u8</span>,</span><br><span class="line">    y:<span class="built_in">u8</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span> TokenInterface <span class="keyword">for</span> TokenContract &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">constructor</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, total_supply: <span class="built_in">u8</span>) &#123;</span><br><span class="line">       <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,total_supply)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">totalsupply</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) -&gt; <span class="built_in">u8</span> &#123;</span><br><span class="line">        <span class="number">32</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> endpoint = TokenEndpoint::from(TokenContract&#123;x:<span class="number">3</span>,y:<span class="number">4</span>&#125;);</span><br><span class="line">    <span class="keyword">let</span> endpoint2 = TokenEndpoint::new(TokenContract&#123;x:<span class="number">3</span>,y:<span class="number">4</span>&#125;);</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> test = TokenContract&#123;x:<span class="number">1</span>,y:<span class="number">2</span>&#125;;</span><br><span class="line">    test.constructor(<span class="number">3</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:#?&#125; \n &#123;:#?&#125; &quot;</span>,endpoint.instance(),endpoint2.instance())</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>其中</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">from</span></span>(inner: T) -&gt; <span class="keyword">Self</span> &#123;</span><br><span class="line">    TokenEndpoint &#123; inner: inner &#125;</span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure><p>与</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span>&lt;T: TokenInterface&gt; <span class="built_in">From</span>&lt;T&gt; <span class="keyword">for</span> TokenEndpoint&lt;T&gt; &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">from</span></span>(inner: T) -&gt; TokenEndpoint&lt;T&gt; &#123;</span><br><span class="line">        TokenEndpoint &#123; inner: inner &#125;</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在main函数中最终实现的效果一样。<br>继续探究<code>From&lt;T&gt;</code><br>From和Into是定义于std：：convert模块中的两个trait。它们定义了from和into两个方法，这两个方法互为反操作。From和Into的内部实现:</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">trait</span> <span class="title">From</span></span>&lt;T&gt;&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">from</span></span>(T) -&gt; <span class="keyword">Self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">trait</span> <span class="title">Into</span></span>&lt;T&gt;&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">into</span></span>(<span class="keyword">self</span>) -&gt; T;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>()&#123;</span><br><span class="line">    <span class="keyword">let</span> string1 = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">    <span class="keyword">let</span> string2 = <span class="built_in">String</span>::from(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> string3:<span class="built_in">String</span> = string1.into();</span><br><span class="line">    <span class="built_in">assert_eq!</span>(string1,string2);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(string3,string2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>对于类型T，如果它实现了From＜U＞，则可以通过T：：from（u）来生成T类型的实例，此处u为U的类型实例。</p><p>对于类型T，如果它实现了Into＜U＞，则可以通过into方法来消耗自身转换为类型U的新实例。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ewasm虚拟机开发</title>
      <link href="2020/09/22/ewasm%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%BC%80%E5%8F%91/"/>
      <url>2020/09/22/ewasm%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%BC%80%E5%8F%91/</url>
      
        <content type="html"><![CDATA[<h1 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h1><h2 id="解析wasm字节码"><a href="#解析wasm字节码" class="headerlink" title="解析wasm字节码"></a>解析wasm字节码</h2><p><a href="https://webassembly.github.io/spec/core/intro/overview.html">wasm概览</a><br><a href="https://webassembly.github.io/spec/core/binary/instructions.html#">wasm指令集</a><br><a href="https://webassembly.github.io/spec/core/binary/types.html">wasm类型</a><br><img src="http://ww1.sinaimg.cn/large/6cf740f6ly1gizds6acxgj20f50hr0tf.jpg" alt="wasm格式"></p><span id="more"></span><p>wasm包含12种section:<br><img src="http://ww1.sinaimg.cn/large/6cf740f6ly1gizdyr165zj20a308ywek.jpg" alt="undefined"><br>每个section包括:</p><ul><li>section id(大小1字节)</li><li>section size(格式为u32记录section大小)</li><li>data(section中保存的内容，格式取决于section id)</li></ul><p>每个 section 都是可选的, 如果某个 wasm 模块省略了某个 section, 则等同于存在一个内容为空的 section.</p><p><a href="https://wasdk.github.io/WasmFiddle/?%E8%BF%99%E4%B8%AA%E7%BD%91%E7%AB%99%E5%8F%AF%E4%BB%A5%E7%BC%96%E8%AF%91c/c++%E4%B8%BAwasm%E6%A0%BC%E5%BC%8F%E3%80%82">https://wasdk.github.io/WasmFiddle/?这个网站可以编译c/c++为wasm格式。</a><br>用一个简单的例子来说明对wasm二进制的解析:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123; </span><br><span class="line">  <span class="keyword">return</span> <span class="number">42</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>对应的wast格式:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(module</span><br><span class="line"> (table 0 anyfunc)</span><br><span class="line"> (memory $0 1)</span><br><span class="line"> (export &quot;memory&quot; (memory $0))</span><br><span class="line"> (export &quot;main&quot; (func $main))</span><br><span class="line"> (func $main (; 0 ;) (result i32)</span><br><span class="line">  (i32.const 42)</span><br><span class="line"> )</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>对应的二进制:<br><img src="http://ww1.sinaimg.cn/large/6cf740f6ly1gizf1xbp18j21120640ub.jpg" alt="411600756416_.pic.jpg"></p><p>二进制码:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&#x27;<span class="number">0x0</span>&#x27;, &#x27;<span class="number">0x61</span>&#x27;, &#x27;<span class="number">0x73</span>&#x27;, &#x27;<span class="number">0x6d</span>&#x27;, &#x27;<span class="number">0x1</span>&#x27;, &#x27;<span class="number">0x0</span>&#x27;, &#x27;<span class="number">0x0</span>&#x27;, &#x27;<span class="number">0x0</span>&#x27;, &#x27;<span class="number">0x1</span>&#x27;, &#x27;<span class="number">0x85</span>&#x27;, &#x27;<span class="number">0x80</span>&#x27;, &#x27;<span class="number">0x80</span>&#x27;, &#x27;<span class="number">0x80</span>&#x27;, &#x27;<span class="number">0x0</span>&#x27;, &#x27;<span class="number">0x1</span>&#x27;, &#x27;<span class="number">0x60</span>&#x27;, &#x27;<span class="number">0x0</span>&#x27;, &#x27;<span class="number">0x1</span>&#x27;, &#x27;<span class="number">0x7f</span>&#x27;, &#x27;<span class="number">0x3</span>&#x27;, &#x27;<span class="number">0x82</span>&#x27;, &#x27;<span class="number">0x80</span>&#x27;, &#x27;<span class="number">0x80</span>&#x27;, &#x27;<span class="number">0x80</span>&#x27;, &#x27;<span class="number">0x0</span>&#x27;, &#x27;<span class="number">0x1</span>&#x27;, &#x27;<span class="number">0x0</span>&#x27;, &#x27;<span class="number">0x4</span>&#x27;, &#x27;<span class="number">0x84</span>&#x27;, &#x27;<span class="number">0x80</span>&#x27;, &#x27;<span class="number">0x80</span>&#x27;, &#x27;<span class="number">0x80</span>&#x27;, &#x27;<span class="number">0x0</span>&#x27;, &#x27;<span class="number">0x1</span>&#x27;, &#x27;<span class="number">0x70</span>&#x27;, &#x27;<span class="number">0x0</span>&#x27;, &#x27;<span class="number">0x0</span>&#x27;, &#x27;<span class="number">0x5</span>&#x27;, &#x27;<span class="number">0x83</span>&#x27;, &#x27;<span class="number">0x80</span>&#x27;, &#x27;<span class="number">0x80</span>&#x27;, &#x27;<span class="number">0x80</span>&#x27;, &#x27;<span class="number">0x0</span>&#x27;, &#x27;<span class="number">0x1</span>&#x27;, &#x27;<span class="number">0x0</span>&#x27;, &#x27;<span class="number">0x1</span>&#x27;, &#x27;<span class="number">0x6</span>&#x27;, &#x27;<span class="number">0x81</span>&#x27;, &#x27;<span class="number">0x80</span>&#x27;, &#x27;<span class="number">0x80</span>&#x27;, &#x27;<span class="number">0x80</span>&#x27;, &#x27;<span class="number">0x0</span>&#x27;, &#x27;<span class="number">0x0</span>&#x27;, &#x27;<span class="number">0x7</span>&#x27;, &#x27;<span class="number">0x91</span>&#x27;, &#x27;<span class="number">0x80</span>&#x27;, &#x27;<span class="number">0x80</span>&#x27;, &#x27;<span class="number">0x80</span>&#x27;, &#x27;<span class="number">0x0</span>&#x27;, &#x27;<span class="number">0x2</span>&#x27;, &#x27;<span class="number">0x6</span>&#x27;, &#x27;<span class="number">0x6d</span>&#x27;, &#x27;<span class="number">0x65</span>&#x27;, &#x27;<span class="number">0x6d</span>&#x27;, &#x27;<span class="number">0x6f</span>&#x27;, &#x27;<span class="number">0x72</span>&#x27;, &#x27;<span class="number">0x79</span>&#x27;, &#x27;<span class="number">0x2</span>&#x27;, &#x27;<span class="number">0x0</span>&#x27;, &#x27;<span class="number">0x4</span>&#x27;, &#x27;<span class="number">0x6d</span>&#x27;, &#x27;<span class="number">0x61</span>&#x27;, &#x27;<span class="number">0x69</span>&#x27;, &#x27;<span class="number">0x6e</span>&#x27;, &#x27;<span class="number">0x0</span>&#x27;, &#x27;<span class="number">0x0</span>&#x27;, &#x27;<span class="number">0xa</span>&#x27;, &#x27;<span class="number">0x8a</span>&#x27;, &#x27;<span class="number">0x80</span>&#x27;, &#x27;<span class="number">0x80</span>&#x27;, &#x27;<span class="number">0x80</span>&#x27;, &#x27;<span class="number">0x0</span>&#x27;, &#x27;<span class="number">0x1</span>&#x27;, &#x27;<span class="number">0x84</span>&#x27;, &#x27;<span class="number">0x80</span>&#x27;, &#x27;<span class="number">0x80</span>&#x27;, &#x27;<span class="number">0x80</span>&#x27;, &#x27;<span class="number">0x0</span>&#x27;, &#x27;<span class="number">0x0</span>&#x27;, &#x27;<span class="number">0x41</span>&#x27;, &#x27;<span class="number">0x2a</span>&#x27;, &#x27;<span class="number">0xb</span>&#x27;]</span><br></pre></td></tr></table></figure><p>一步步分析:<br>前八个字节表示的东西是固定的。<code>&#39;0x0&#39;, &#39;0x61&#39;, &#39;0x73&#39;, &#39;0x6d&#39;</code>前四个字节表示<code>\0asm</code>.<code>&#39;0x1&#39;, &#39;0x0&#39;, &#39;0x0&#39;, &#39;0x0&#39;</code>表示为1的版本号。</p><p>wasm采用LEB128编码:<br>谷歌为了省点空间，在安卓中用了这个压缩标准，其原理就是一个4字节32位的数字，一般很少占满，比如数字1，2等，它其实用几位就可以表示。下面看看它的工作原理：<br>1）忽略高字节的正负代表位。<br>2）每七位组成一组，待编码。<br>3）有符号和无符号的分成不同的情况来处理。<br>4）无符号，最高位为0表示结束，1表示还有后续字节。待编码的七位为数据。<br>5）有符号的处理，同上，但需要处理高位为0的不同情况。<br>6）有符号的处理，同上，需要处理高位为1的不同情况。<br>从上面可以看出无符号比较简单，有符号还需要处理几种情况，这里举一个无符号的例子，简单理解一下，更多请查阅相关资料：<br>编码：<br>十六进制数字：0x238 ========&gt; 二进制 0000 0010 0011 1000<br>分成两个七位的组：0000100(高位)， 0111000（低位）<br>0000100后面没数据了，所以前面加一个0；0111000后面还有一个字节，所以高为为1，则变为：<br>00000100(即：0x04),10111000(0x70)</p><p>则小端存放的数据为：0x70,0x04<br>解码：<br>正好相反，把数据拆开，按编码逆向过程即可。</p><p>对于rust，我们可以直接用现有的crate:<a href="https://github.com/paritytech/parity-wasm">parity-wasm</a>对wasm进行解析。</p><h2 id="wasm解析器"><a href="#wasm解析器" class="headerlink" title="wasm解析器"></a>wasm解析器</h2><p><a href="https://github.com/paritytech/wasmi">wasmi</a></p><h2 id="可运行wasm的虚拟机"><a href="#可运行wasm的虚拟机" class="headerlink" title="可运行wasm的虚拟机"></a>可运行wasm的虚拟机</h2><p><a href="https://github.com/openethereum/openethereum/tree/master/ethcore/wasm">vm</a></p><h2 id="生成可被wasmi执行的合约"><a href="#生成可被wasmi执行的合约" class="headerlink" title="生成可被wasmi执行的合约"></a>生成可被wasmi执行的合约</h2><h3 id="pwasm-abi"><a href="#pwasm-abi" class="headerlink" title="pwasm-abi"></a><a href="https://github.com/openethereum/pwasm-abi">pwasm-abi</a></h3><p>使用过程宏生成类型solidity合约代码结构的rust合约,并最终编译为wasm-unkonwn-unkonwn(wasm).</p><p>最终生成的合约:</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#![no_std]</span></span><br><span class="line"><span class="meta">#![allow(non_snake_case)]</span></span><br><span class="line"><span class="meta">#![feature(proc_macro_hygiene)]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">crate</span> pwasm_std;</span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">crate</span> pwasm_ethereum;</span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">crate</span> pwasm_abi;</span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">crate</span> pwasm_abi_derive;</span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">crate</span> alloc;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> array &#123;</span><br><span class="line">    <span class="keyword">use</span> pwasm_ethereum;</span><br><span class="line">    <span class="keyword">use</span> pwasm_abi::types::*;</span><br><span class="line">    <span class="keyword">use</span> pwasm_abi_derive::eth_abi;</span><br><span class="line">    <span class="keyword">use</span> alloc::collections::BTreeMap;</span><br><span class="line">    <span class="keyword">use</span> alloc::format;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">#[eth_abi(TokenEndpoint, TokenClient)]</span></span><br><span class="line">    <span class="keyword">pub</span> <span class="class"><span class="keyword">trait</span> <span class="title">ArrayInterface</span></span> &#123;</span><br><span class="line">        <span class="function"><span class="keyword">fn</span> <span class="title">constructor</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>);</span><br><span class="line">        <span class="function"><span class="keyword">fn</span> <span class="title">double_array</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>,x:U256,y:U256)-&gt; U256;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">ArrayContract</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">impl</span> ArrayInterface <span class="keyword">for</span> ArrayContract&#123;</span><br><span class="line">        <span class="function"><span class="keyword">fn</span> <span class="title">double_array</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>,x:U256,y:U256) -&gt; U256&#123;</span><br><span class="line">            U256::from(x) + U256::from(x)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">fn</span> <span class="title">constructor</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        </span><br><span class="line">        &#125;        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> pwasm_abi::eth::EndpointInterface;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[no_mangle]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">call</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> endpoint = array::TokenEndpoint::new(array::ArrayContract&#123;&#125;);</span><br><span class="line">    <span class="comment">// Read http://solidity.readthedocs.io/en/develop/abi-spec.html#formal-specification-of-the-encoding for details</span></span><br><span class="line">    pwasm_ethereum::ret(&amp;endpoint.dispatch(&amp;pwasm_ethereum::input()));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[no_mangle]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">deploy</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> endpoint = array::TokenEndpoint::new(array::ArrayContract&#123;&#125;);</span><br><span class="line">    endpoint.dispatch_ctor(&amp;pwasm_ethereum::input());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面的合约通过<code>eth_abi</code>这个过程宏生成了wasm合约.<br>宏展开的部分代码如下:</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">dispatch</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, payload: &amp;[<span class="built_in">u8</span>]) -&gt; <span class="built_in">Vec</span>&lt;<span class="built_in">u8</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> inner = &amp;<span class="keyword">mut</span> <span class="keyword">self</span>.inner;</span><br><span class="line">    <span class="keyword">if</span> payload.len() &lt; <span class="number">4</span> &#123;</span><br><span class="line">        ::core::panicking::panic(<span class="string">&quot;Invalid abi invoke&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> method_id = ((payload[<span class="number">0</span>] <span class="keyword">as</span> <span class="built_in">u32</span>) &lt;&lt; <span class="number">24</span>)</span><br><span class="line">        + ((payload[<span class="number">1</span>] <span class="keyword">as</span> <span class="built_in">u32</span>) &lt;&lt; <span class="number">16</span>)</span><br><span class="line">        + ((payload[<span class="number">2</span>] <span class="keyword">as</span> <span class="built_in">u32</span>) &lt;&lt; <span class="number">8</span>)</span><br><span class="line">        + (payload[<span class="number">3</span>] <span class="keyword">as</span> <span class="built_in">u32</span>);</span><br><span class="line">    <span class="keyword">let</span> method_payload = &amp;payload[<span class="number">4</span>..];</span><br><span class="line">    <span class="keyword">match</span> method_id &#123;</span><br><span class="line">        <span class="number">870935635u32</span> =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> pwasm_ethereum::value() &gt; <span class="number">0</span>.into() &#123;</span><br><span class="line">                ::core::panicking::panic(</span><br><span class="line">                    <span class="string">&quot;Unable to accept value in non-payable constructor call&quot;</span>,</span><br><span class="line">                );</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">let</span> <span class="keyword">mut</span> stream = pwasm_abi::eth::Stream::new(method_payload);</span><br><span class="line">            <span class="keyword">let</span> result = inner.double_array(</span><br><span class="line">                stream.pop::&lt;U256&gt;().expect(<span class="string">&quot;argument decoding failed&quot;</span>),</span><br><span class="line">                stream.pop::&lt;U256&gt;().expect(<span class="string">&quot;argument decoding failed&quot;</span>),</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">let</span> <span class="keyword">mut</span> sink = pwasm_abi::eth::Sink::new(<span class="number">1usize</span>);</span><br><span class="line">            sink.push(result);</span><br><span class="line">            sink.finalize_panicking()</span><br><span class="line">        &#125;</span><br><span class="line">        _ =&gt; ::core::panicking::panic(<span class="string">&quot;Invalid method signature&quot;</span>),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">double_array</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, x: U256, y: U256) -&gt; U256 &#123;</span><br><span class="line">    <span class="meta">#![allow(unused_mut)]</span></span><br><span class="line">    <span class="meta">#![allow(unused_variables)]</span></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> payload = <span class="built_in">Vec</span>::with_capacity(<span class="number">4</span> + <span class="number">2usize</span> * <span class="number">32</span>);</span><br><span class="line">    payload.push((<span class="number">870935635u32</span> &gt;&gt; <span class="number">24</span>) <span class="keyword">as</span> <span class="built_in">u8</span>);</span><br><span class="line">    payload.push((<span class="number">870935635u32</span> &gt;&gt; <span class="number">16</span>) <span class="keyword">as</span> <span class="built_in">u8</span>);</span><br><span class="line">    payload.push((<span class="number">870935635u32</span> &gt;&gt; <span class="number">8</span>) <span class="keyword">as</span> <span class="built_in">u8</span>);</span><br><span class="line">    payload.push(<span class="number">870935635u32</span> <span class="keyword">as</span> <span class="built_in">u8</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> sink = pwasm_abi::eth::Sink::new(<span class="number">2usize</span>);</span><br><span class="line">    sink.push(x);</span><br><span class="line">    sink.push(y);</span><br><span class="line">    sink.drain_to(&amp;<span class="keyword">mut</span> payload);</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> result = [<span class="number">0u8</span>; <span class="number">32</span>];</span><br><span class="line">    pwasm_ethereum::call(</span><br><span class="line">        <span class="keyword">self</span>.gas.unwrap_or(<span class="number">200000</span>),</span><br><span class="line">        &amp;<span class="keyword">self</span>.address,</span><br><span class="line">        <span class="keyword">self</span>.value.clone().unwrap_or(U256::zero()),</span><br><span class="line">        &amp;payload,</span><br><span class="line">        &amp;<span class="keyword">mut</span> result[..],</span><br><span class="line">    )</span><br><span class="line">    .expect(<span class="string">&quot;Call failed; todo: allow handling inside contracts&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> stream = pwasm_abi::eth::Stream::new(&amp;result);</span><br><span class="line">    stream.pop().expect(<span class="string">&quot;failed decode call output&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在合约编译的内部实现中通过需要通过<code>eth_abi</code>接口将函数重命名.<br>这样我们在调用合约时,通过<code>eth_abi</code>编码的数据才能被合约识别运行.</p><p><a href="https://web3js.readthedocs.io/en/v1.3.0/web3-eth-abi.html#">web3eth_abi编码</a></p><h3 id="wasm-build"><a href="#wasm-build" class="headerlink" title="wasm-build"></a><a href="https://github.com/paritytech/wasm-utils/tree/master/cli/build">wasm-build</a></h3><p>已生成的wasm合约不能直接被vm运行,wasm-build将由pwasm写的合约再次处理转化为可被vm执行的wasm合约文件.</p><p>wasm-build的工作:<br>1.解析wasm module提取以下section:</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="keyword">let</span> <span class="literal">Some</span>(section) = sections.pop() &#123;</span><br><span class="line">  <span class="keyword">match</span> section &#123;</span><br><span class="line">    elements::Section::Type(sect) =&gt; &#123; types = <span class="literal">Some</span>(sect); &#125;</span><br><span class="line">    elements::Section::Import(sect) =&gt; &#123; import = <span class="literal">Some</span>(sect); &#125;</span><br><span class="line">    elements::Section::Function(sect) =&gt; &#123; funcs = <span class="literal">Some</span>(sect); &#125;</span><br><span class="line">    elements::Section::Table(sect) =&gt; &#123; table = <span class="literal">Some</span>(sect); &#125;</span><br><span class="line">    elements::Section::Memory(sect) =&gt; &#123; memory = <span class="literal">Some</span>(sect); &#125;</span><br><span class="line">    elements::Section::Global(sect) =&gt; &#123; global = <span class="literal">Some</span>(sect); &#125;</span><br><span class="line">    elements::Section::Export(sect) =&gt; &#123; export = <span class="literal">Some</span>(sect); &#125;</span><br><span class="line">    elements::Section::Start(index) =&gt; &#123; start = <span class="literal">Some</span>(index); &#125;</span><br><span class="line">    elements::Section::Element(sect) =&gt; &#123; element = <span class="literal">Some</span>(sect); &#125;</span><br><span class="line">    elements::Section::Code(sect) =&gt; &#123; code = <span class="literal">Some</span>(sect); &#125;</span><br><span class="line">    elements::Section::Data(sect) =&gt; &#123; data = <span class="literal">Some</span>(sect); &#125;</span><br><span class="line">    _ =&gt; &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>将wasm的module优化为:</p><ul><li>Type</li><li>Import</li><li>Function</li><li>Table</li><li>Memory</li><li>Global</li><li>Export</li><li>Start</li><li>Code</li><li>Data</li><li>other</li></ul><p>2.优化函数名及构造函数deploy,call,end等模块.</p>]]></content>
      
      
      <categories>
          
          <category> wasm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rust </tag>
            
            <tag> wasm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexo更改post模板</title>
      <link href="2020/09/22/hexo%E6%9B%B4%E6%94%B9post%E6%A8%A1%E6%9D%BF/"/>
      <url>2020/09/22/hexo%E6%9B%B4%E6%94%B9post%E6%A8%A1%E6%9D%BF/</url>
      
        <content type="html"><![CDATA[<p>运行<code>hexo new post</code>时，现在的模板是</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: &#123;&#123; title &#125;&#125;</span><br><span class="line">date: &#123;&#123; date &#125;&#125;</span><br><span class="line">tags:</span><br><span class="line">---</span><br></pre></td></tr></table></figure><p>默认无分类<br>在<code>scaffolds</code>更改<code>post.md</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: &#123;&#123; title &#125;&#125;</span><br><span class="line">date: &#123;&#123; date &#125;&#125;</span><br><span class="line">tags:</span><br><span class="line">categories:</span><br><span class="line">---</span><br></pre></td></tr></table></figure><p>就好了</p>]]></content>
      
      
      <categories>
          
          <category> hexo </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>vscode奇技淫巧</title>
      <link href="2020/09/18/vscode%E5%A5%87%E6%B7%AB%E6%8A%80%E5%B7%A7/"/>
      <url>2020/09/18/vscode%E5%A5%87%E6%B7%AB%E6%8A%80%E5%B7%A7/</url>
      
        <content type="html"><![CDATA[<h2 id="用户代码片段"><a href="#用户代码片段" class="headerlink" title="用户代码片段"></a>用户代码片段</h2><p>之前在sublime上常用tmpl插件来新建python文件，文件默认包含头文件模板。vscode可以直接添加与文件相关的代码片段。<br>python用户代码片段:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;HEADER&quot;</span>:&#123;</span><br><span class="line">        <span class="attr">&quot;prefix&quot;</span>: <span class="string">&quot;header&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;body&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;#!/usr/bin/env python&quot;</span>,</span><br><span class="line">        <span class="string">&quot;# -*- encoding: utf-8 -*-&quot;</span>,</span><br><span class="line">        <span class="string">&quot;&#x27;&#x27;&#x27;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;@File    :   $TM_FILENAME&quot;</span>,</span><br><span class="line">        <span class="string">&quot;@Time    :   $CURRENT_YEAR/$CURRENT_MONTH/$CURRENT_DATE $CURRENT_HOUR:$CURRENT_MINUTE:$CURRENT_SECOND&quot;</span>,</span><br><span class="line">        <span class="string">&quot;@Author  :   worileqing&quot;</span>,</span><br><span class="line">        <span class="string">&quot;@Version :   1.0&quot;</span>,</span><br><span class="line">        <span class="string">&quot;@Contact :   worileqing@163.com&quot;</span>,</span><br><span class="line">        <span class="string">&quot;@Desc    :   None&quot;</span>,</span><br><span class="line">        </span><br><span class="line">        <span class="string">&quot;&#x27;&#x27;&#x27;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;# here put the import lib&quot;</span>,</span><br><span class="line">        <span class="string">&quot;$0&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>markdown用户代码片段:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;HEADER&quot;</span>:&#123;</span><br><span class="line">        <span class="attr">&quot;prefix&quot;</span>: <span class="string">&quot;date&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;body&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;date : $CURRENT_YEAR-$CURRENT_MONTH-$CURRENT_DATE $CURRENT_HOUR:$CURRENT_MINUTE:$CURRENT_SECOND&quot;</span>,</span><br><span class="line">    ],</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;HEADER&quot;</span>:&#123;</span><br><span class="line">        <span class="attr">&quot;prefix&quot;</span>: <span class="string">&quot;code is&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;body&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;code is cheap,show code:&quot;</span>,</span><br><span class="line">    ],</span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>但是创建完成配置未能在markdown中生效，解决办法:<br>在setting.json中添加:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&quot;[markdown]&quot;: &#123;</span><br><span class="line">    &quot;editor.quickSuggestions&quot;: &#123;</span><br><span class="line">        &quot;other&quot;: true,</span><br><span class="line">        &quot;comments&quot;: false,</span><br><span class="line">        &quot;strings&quot;: true</span><br><span class="line">    &#125;,</span><br><span class="line">    &#125;, </span><br></pre></td></tr></table></figure><h2 id="coder-runner"><a href="#coder-runner" class="headerlink" title="coder runner"></a>coder runner</h2><p>可以在任意类型的文件里面选中代码 <code>code run by some language</code></p>]]></content>
      
      
      
        <tags>
            
            <tag> vscode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>rust闭包</title>
      <link href="2020/09/18/rust%E9%97%AD%E5%8C%85/"/>
      <url>2020/09/18/rust%E9%97%AD%E5%8C%85/</url>
      
        <content type="html"><![CDATA[<h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p>“闭包（closure）是一种匿名函数，具有“捕获”外部变量的能力。闭包有时候也被称作lambda表达式。它有两个特点：（1）可以像函数一样被调用；（2）可以捕获当前环境中的变量。”</p><p>摘录来自: 范长春. “深入浅出Rust。”<br>闭包与函数的显著区别是闭包可以补货变量。</p><p>code is cheap,show code:</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">add_2</span></span>(a:<span class="built_in">i32</span>)-&gt;<span class="built_in">i32</span>&#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;run func add_2&quot;</span>);</span><br><span class="line">    a + <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>()&#123;</span><br><span class="line">    <span class="keyword">let</span> a = |x|x+<span class="number">2</span>;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;3 + 2 is &#123;&#125;&quot;</span>,a(<span class="number">3</span>));</span><br><span class="line">    <span class="keyword">let</span> b = add_2(<span class="number">3</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;b is &#123;&#125;&quot;</span>,b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="进阶"><a href="#进阶" class="headerlink" title="进阶"></a>进阶</h2><p>闭包的类型:<br>添加一个返回类型为闭包的函数：</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">test_return</span></span>(a:<span class="built_in">i32</span>)-&gt;<span class="built_in">Box</span>&lt; <span class="built_in">Fn</span>(<span class="built_in">i32</span>)-&gt;<span class="built_in">i32</span>&gt;&#123;</span><br><span class="line">    <span class="built_in">print!</span>(<span class="string">&quot;a is &#123;&#125; but unused\n&quot;</span>,a);</span><br><span class="line">    <span class="keyword">let</span> b = <span class="built_in">Box</span>::new(|x|x+<span class="number">2</span>);</span><br><span class="line">    b</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> c = test_return(<span class="number">3</span>);</span><br><span class="line">    <span class="keyword">let</span> d = c(<span class="number">5</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;d is &#123;&#125;&quot;</span>,d);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>cargo run</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">   Compiling just_test v0.1.0 (/Users/ke/Desktop/rust_test/just_test)</span><br><span class="line">warning: trait objects without an explicit `dyn` are deprecated</span><br><span class="line"> --&gt; src/main.rs:2:29</span><br><span class="line">  |</span><br><span class="line">2 | fn test_return(a:i32)-&gt;Box&lt; Fn(i32)-&gt;i32&gt;&#123;</span><br><span class="line">  |                             ^^^^^^^^^^^^ <span class="built_in">help</span>: use `dyn`: `dyn Fn(i32)-&gt;i32`</span><br><span class="line">  |</span><br><span class="line">  = note: `<span class="comment">#[warn(bare_trait_objects)]` on by default</span></span><br><span class="line"></span><br><span class="line">warning: 1 warning emitted</span><br><span class="line"></span><br><span class="line">    Finished dev [unoptimized + debuginfo] target(s) <span class="keyword">in</span> 0.36s</span><br><span class="line">     Running `target/debug/just_test`</span><br><span class="line">a is 3 but unused</span><br><span class="line">d is 7</span><br></pre></td></tr></table></figure><p>上面的代码有两个需要注意的地方:</p><ul><li>返回类型里面的box：<br>rust的闭包又叫unboxed closure 本质是一个unboxed trait,当我们仅返回闭包时编译器会报错<code>return type cannot have an unboxed trait object</code>。因为匿名函数是编译器生成的匿名类型，根本不存在具体对象一说，这意味着它无法有一个明确的 size，所以只能被放置于 堆内存 之中，并取得一个 胖指针 （即除了原始指针以外还包括对指针、指针指向内存的额外描述信息等的 “指针”。故我们需要将closure boxed。</li><li>dyn warning:<br>这个问题可以参考:<br><a href="https://www.insp.top/article/lets-understand-new-keywords-those-impl-and-dyn-of-rust-2018-edition">理解 Rust 2018 edition 的两个新关键字 —— impl 和 dyn</a><br><a href="https://rustwiki.org/zh-CN/edition-guide/rust-2018/trait-system/impl-trait-for-returning-complex-types-with-ease.html">3.4.1. impl Trait 轻松返回复杂的类型</a><br>dyn 修饰trait是为了消除与impl trait的歧义，所以我们在了解dyn之前我们需要知道impl Trait:<br>将下面的函数用impl trait重写：<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">test_return</span></span>(a:<span class="built_in">i32</span>)-&gt;<span class="built_in">Box</span>&lt; <span class="built_in">Fn</span>(<span class="built_in">i32</span>)-&gt;<span class="built_in">i32</span>&gt;&#123;</span><br><span class="line">    <span class="built_in">print!</span>(<span class="string">&quot;a is &#123;&#125; but unused\n&quot;</span>,a);</span><br><span class="line">    <span class="keyword">let</span> b = <span class="built_in">Box</span>::new(|x|x+<span class="number">2</span>);</span><br><span class="line">    b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>重写:<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">test_return</span></span>(a:<span class="built_in">i32</span>)-&gt; <span class="keyword">impl</span> <span class="built_in">Fn</span>(<span class="built_in">i32</span>)-&gt;<span class="built_in">i32</span>&#123;</span><br><span class="line">    <span class="built_in">print!</span>(<span class="string">&quot;a is &#123;&#125; but unused\n&quot;</span>,a);</span><br><span class="line">    <span class="keyword">let</span> b = <span class="built_in">Box</span>::new(|x|x+<span class="number">2</span>);</span><br><span class="line">    b    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>测试可以正常运行。<br>impl Trait 是指定实现特定特征的未命名但有具体类型的新方法。重点在于有具体类型。因为有具体类型，匿名函数对于编译器来说是不确定trait，故需要进行box包装来返回，而impl trait由于已经约束了具体类型，所以可以直接作为函数返回类型。</li></ul><p>dyn是dynamic(动态的缩写),有了impl trait后使用dyn trait可以更好的与其对应以及消除类型歧义:</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">Trait</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> Trait <span class="keyword">for</span> <span class="built_in">i32</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// old</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">function1</span></span>() -&gt; <span class="built_in">Box</span>&lt;Trait&gt; &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// new</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">function2</span></span>() -&gt; <span class="built_in">Box</span>&lt;<span class="keyword">dyn</span> Trait&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="额外的"><a href="#额外的" class="headerlink" title="额外的"></a>额外的</h2><p>用泛型重写上面的代码:</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">calc_by</span></span>&lt;F&gt;(var: &amp;<span class="built_in">i32</span>, f: F) -&gt; <span class="built_in">i32</span></span><br><span class="line">    <span class="keyword">where</span> F: <span class="built_in">Fn</span>(&amp;<span class="built_in">i32</span>) -&gt; <span class="built_in">i32</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">let</span> local = *var;</span><br><span class="line">    f(&amp;local)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> local = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">let</span> result = calc_by(&amp;local, |i| i*<span class="number">2</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> rust </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>rust笔记</title>
      <link href="2020/09/18/rust%E7%AC%94%E8%AE%B0/"/>
      <url>2020/09/18/rust%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<ul><li>10进制转换为16进制并输出</li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">assert_eq!</span>(<span class="built_in">format!</span>(<span class="string">&quot;&#123;:x&#125;&quot;</span>, <span class="number">42</span>), <span class="string">&quot;2a&quot;</span>);</span><br></pre></td></tr></table></figure><ul><li>根据value从列表中获取对应的index （How do I find the index of an element in an array, vector or slice?）</li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> test = <span class="built_in">vec!</span>[<span class="string">&quot;one&quot;</span>, <span class="string">&quot;two&quot;</span>, <span class="string">&quot;three&quot;</span>];</span><br><span class="line">    <span class="keyword">let</span> index = test.iter().position(|&amp;r| r == <span class="string">&quot;two&quot;</span>).unwrap();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, index);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>rust int与string的转换</li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> my_string = <span class="string">&quot;27&quot;</span>.to_string();  <span class="comment">// `parse()` works with `&amp;str` and `String`!</span></span><br><span class="line"><span class="keyword">let</span> my_int = my_string.parse::&lt;<span class="built_in">i32</span>&gt;().unwrap();</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> my_int: <span class="built_in">i32</span> = my_string.parse().unwrap();</span><br></pre></td></tr></table></figure><ul><li>rust 合并list实例</li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="keyword">crate</span> hex;</span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">crate</span> serde;</span><br><span class="line"><span class="keyword">use</span> std::collections::HashMap;</span><br><span class="line"><span class="keyword">use</span> serde::ser::&#123;Serialize, Serializer, SerializeSeq, SerializeMap, SerializeStruct&#125;;</span><br><span class="line"><span class="meta">#[macro_use]</span></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">crate</span> serde_derive;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">type</span> <span class="title">Dictionary</span></span> = HashMap&lt;<span class="built_in">String</span>, <span class="built_in">String</span>&gt;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Debug,Serialize, Deserialize,Clone)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">Account</span></span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> address: <span class="built_in">String</span>,</span><br><span class="line">    <span class="keyword">pub</span> balance: <span class="built_in">usize</span>,</span><br><span class="line">    <span class="keyword">pub</span> code: <span class="built_in">String</span>,</span><br><span class="line">    <span class="keyword">pub</span> storage: Dictionary,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Debug,Serialize, Deserialize,Clone)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">WriteSet</span></span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> accounts: <span class="built_in">Vec</span>&lt;Account&gt;,</span><br><span class="line">    <span class="keyword">pub</span> gas: <span class="built_in">usize</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="built_in">Default</span> <span class="keyword">for</span> WriteSet &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">default</span></span>() -&gt; WriteSet &#123;</span><br><span class="line">        WriteSet&#123;</span><br><span class="line">            accounts: <span class="built_in">Vec</span>::new(),</span><br><span class="line">            gas: <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> Account&#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">address</span></span>(&amp;<span class="keyword">self</span>) -&gt; <span class="built_in">String</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.address.clone()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">get_write_addrlist</span></span>(writeset : &amp; WriteSet) -&gt; <span class="built_in">Vec</span>&lt;<span class="built_in">String</span>&gt;&#123;</span><br><span class="line">    <span class="comment">// let mut v = Vec::new();</span></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> vec: <span class="built_in">Vec</span>&lt;<span class="built_in">String</span>&gt; = <span class="built_in">Vec</span>::new();</span><br><span class="line">    <span class="keyword">for</span> account <span class="keyword">in</span> &amp;writeset.accounts&#123;</span><br><span class="line">        vec.push(account.address())</span><br><span class="line">    &#125;</span><br><span class="line">    vec.dedup();</span><br><span class="line">    vec</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">push_write_account</span></span>(<span class="keyword">mut</span> writeset : WriteSet,accounts:<span class="built_in">Vec</span>&lt;Account&gt;) -&gt; WriteSet&#123;</span><br><span class="line"><span class="keyword">for</span> account <span class="keyword">in</span> accounts&#123;    </span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> writeset_copy = writeset.clone();</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> writeset_accs = get_write_addrlist(&amp;writeset);</span><br><span class="line">    <span class="keyword">if</span> ! writeset_accs.contains(&amp;account.address())&#123;</span><br><span class="line">        writeset.accounts.push(account);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">// let index = writeset.accounts.iter();</span></span><br><span class="line">        <span class="keyword">let</span> index = writeset.accounts.iter().position(|r| r.address == account.address()).unwrap();</span><br><span class="line">        <span class="keyword">for</span> (k,v) <span class="keyword">in</span> account.storage&#123;</span><br><span class="line">            writeset.accounts[index].storage.insert(k, v);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// writeset.accounts[index] = account;</span></span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;index &#123;:?&#125;&quot;</span>, writeset.accounts[index]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">return</span> writeset</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> code = <span class="string">&quot;6080604052600436106049576000357c0100000000000000000000000000000\</span></span><br><span class="line"><span class="string">                000000000000000000000000000900463ffffffff16806360fe47b114604e57\</span></span><br><span class="line"><span class="string">                80636d4ce63c146078575b600080fd5b348015605957600080fd5b506076600\</span></span><br><span class="line"><span class="string">                4803603810190808035906020019092919050505060a0565b005b3480156083\</span></span><br><span class="line"><span class="string">                57600080fd5b50608a60aa565b6040518082815260200191505060405180910\</span></span><br><span class="line"><span class="string">                390f35b8060008190555050565b600080549050905600a165627a7a72305820\</span></span><br><span class="line"><span class="string">                99c66a25d59f0aa78f7ebc40748fa1d1fbc335d8d780f284841b30e0365acd9\</span></span><br><span class="line"><span class="string">                60029&quot;</span>;</span><br><span class="line">    <span class="keyword">let</span> tar = hex::decode(code).unwrap();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;hexo code test &#123;:?&#125;&quot;</span>,tar);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> struct_tar = WriteSet::default();</span><br><span class="line">    </span><br><span class="line">    struct_tar.accounts.push(</span><br><span class="line">        Account&#123;</span><br><span class="line">            address: <span class="string">&quot;&quot;</span>.to_string(),</span><br><span class="line">            balance: <span class="number">20</span>,</span><br><span class="line">            code: <span class="string">&quot;&quot;</span>.to_string(),</span><br><span class="line">            storage: HashMap::new(),</span><br><span class="line">        &#125;        </span><br><span class="line">    );</span><br><span class="line">    struct_tar.accounts.push(</span><br><span class="line">        Account&#123;</span><br><span class="line">            address: <span class="string">&quot;0102&quot;</span>.to_string(),</span><br><span class="line">            balance: <span class="number">20</span>,</span><br><span class="line">            code: <span class="string">&quot;&quot;</span>.to_string(),</span><br><span class="line">            storage: HashMap::new(),</span><br><span class="line">        &#125;        </span><br><span class="line">    );    </span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> to_insert = HashMap::new();</span><br><span class="line">    to_insert.insert(<span class="string">&quot;0&quot;</span>.to_string(),<span class="string">&quot;0&quot;</span>.to_string());</span><br><span class="line">    struct_tar.accounts.push(</span><br><span class="line">        Account&#123;</span><br><span class="line">            address: <span class="string">&quot;0101&quot;</span>.to_string(),</span><br><span class="line">            balance: <span class="number">20</span>,</span><br><span class="line">            code: <span class="string">&quot;&quot;</span>.to_string(),</span><br><span class="line">            storage: to_insert.clone(),</span><br><span class="line">        &#125;        </span><br><span class="line">    );      </span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;struct_tar &#123;:#?&#125;&quot;</span>,struct_tar);</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> addrlist = get_write_addrlist(&amp;struct_tar);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;addrlist &#123;:#?&#125;&quot;</span>, addrlist);</span><br><span class="line">    <span class="keyword">if</span> ! addrlist.contains(&amp;<span class="string">&quot;11&quot;</span>.to_string())&#123;</span><br><span class="line">        addrlist.push(<span class="string">&quot;11&quot;</span>.to_string())</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;addrlist &#123;:#?&#125;&quot;</span>, addrlist);</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> to_insert1 = HashMap::new();</span><br><span class="line">    to_insert1.insert(<span class="string">&quot;0&quot;</span>.to_string(),<span class="string">&quot;1010&quot;</span>.to_string());</span><br><span class="line">    to_insert1.insert(<span class="string">&quot;1&quot;</span>.to_string(),<span class="string">&quot;1010&quot;</span>.to_string());</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> to_insert2 = HashMap::new();</span><br><span class="line">    to_insert2.insert(<span class="string">&quot;0&quot;</span>.to_string(),<span class="string">&quot;1010&quot;</span>.to_string());</span><br><span class="line">    to_insert2.insert(<span class="string">&quot;1&quot;</span>.to_string(),<span class="string">&quot;1010&quot;</span>.to_string());    </span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> to_push = <span class="built_in">Vec</span>::new();</span><br><span class="line">    to_push.push(Account&#123;</span><br><span class="line">            address: <span class="string">&quot;0101&quot;</span>.to_string(),</span><br><span class="line">            balance: <span class="number">20</span>,</span><br><span class="line">            code: <span class="string">&quot;&quot;</span>.to_string(),</span><br><span class="line">            storage: to_insert1,</span><br><span class="line">        &#125;);</span><br><span class="line">    to_push.push(Account&#123;</span><br><span class="line">            address: <span class="string">&quot;0102&quot;</span>.to_string(),</span><br><span class="line">            balance: <span class="number">20</span>,</span><br><span class="line">            code: <span class="string">&quot;&quot;</span>.to_string(),</span><br><span class="line">            storage: to_insert2,</span><br><span class="line">        &#125;);        </span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> res = push_write_account(struct_tar, to_push);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:#?&#125;&quot;</span>, res);</span><br><span class="line">    <span class="keyword">let</span> aa = <span class="built_in">format!</span>(<span class="string">&quot;&#123;:x&#125;&quot;</span>, <span class="number">42</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,<span class="string">&quot;0x&quot;</span>.to_string() + &amp;aa);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, <span class="string">&quot;4322065350&quot;</span>.to_string().parse::&lt;<span class="built_in">u128</span>&gt;().unwrap());</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> rust </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>大牛博客</title>
      <link href="2020/09/09/%E5%A4%A7%E7%89%9B%E5%8D%9A%E5%AE%A2/"/>
      <url>2020/09/09/%E5%A4%A7%E7%89%9B%E5%8D%9A%E5%AE%A2/</url>
      
        <content type="html"><![CDATA[<p>感觉这个不适合放备忘录，博客地址评论区更新吧！</p>]]></content>
      
      
      
        <tags>
            
            <tag> 笔记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>杂记</title>
      <link href="2020/09/09/%E6%9D%82%E8%AE%B0/"/>
      <url>2020/09/09/%E6%9D%82%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="hexo-deploay-error"><a href="#hexo-deploay-error" class="headerlink" title="hexo deploay error"></a>hexo deploay error</h2><p>运行<code>hexo d</code>时出现type erro的错误:<br>解决办法:<br>放弃使用nodejs 14，转而使用nodejs 12<br>mac 多版本node共存:<br>参考自: <a href="https://www.cnblogs.com/hanxiaobei/p/13122144.html">https://www.cnblogs.com/hanxiaobei/p/13122144.html</a><br>    1、首先安装n模块</p><pre><code>npm install -g n2、升级node.js到最新稳定版sudo n stable3、切换使用版本（如果本地没有会自动获取并进行安装）sudo n 8.17.04、切换使用版本可进行自助选择目前本地安装的版本sudo n 5、删除指定版本sudo n rm 0.0.0</code></pre><h2 id="git-pull解决冲突"><a href="#git-pull解决冲突" class="headerlink" title="git pull解决冲突"></a>git pull解决冲突</h2><p>从其它<code>git clone</code>了一个项目，本地又对其进行了修改，这时运行<code>git pull</code>时将不会成功拉取更新</p><h3 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h3><p>可以先执行<code>git stash</code> 将本地修改保存起来。 这样本地就干净了。<br>然后 <code>git pull</code><br>然后应用stash。 执行 <code>git stash apply 0</code>。<br>解决本地的冲突就好了。</p><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><pre><code>git stash 命令是储藏命令。1. 可以用来储藏工作的中间状态，2. 也可以将储藏好的中间状态应用到现有的工作中。主要的命令有1. git stash当本地有修改的时候，只要运行git stash 就可以将本地的更改储藏起来。2. git stash list可以用来查看储藏起来的状态。如下stash@&#123;0&#125;: WIP on master: ece766d package struct3. git stash apply可以用来应用储藏的状态。比如 git stash apply 0 就会应用储藏id为0 的中间状态。</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> other </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>rust测试</title>
      <link href="2020/09/09/rust%E6%B5%8B%E8%AF%95/"/>
      <url>2020/09/09/rust%E6%B5%8B%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<h2 id="println-in-rust-test"><a href="#println-in-rust-test" class="headerlink" title="println! in rust test"></a>println! in rust test</h2><p>参考：<a href="https://stackoverflow.com/questions/25106554/why-doesnt-println-work-in-rust-unit-tests">Why doesn’t println! work in Rust unit tests?</a></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fs::File;</span><br><span class="line"><span class="keyword">use</span> std::path::Path;</span><br><span class="line"><span class="keyword">use</span> std::io::prelude::*;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">read_file</span></span>(path: &amp;Path) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> file = File::open(path).unwrap();</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> contents = <span class="built_in">String</span>::new();</span><br><span class="line">    file.read_to_string(&amp;<span class="keyword">mut</span> contents).unwrap();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, contents);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[test]</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">test_read_file</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> path = &amp;Path::new(<span class="string">&quot;/etc/hosts&quot;</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, path);</span><br><span class="line">    read_file(path);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rustc --test main.rs; .&#x2F;main</span><br><span class="line">.&#x2F;main --nocapture</span><br><span class="line">cargo test -- --nocapture</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> rust </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>获取ipa、脱壳</title>
      <link href="2020/03/20/%E8%8E%B7%E5%8F%96%E8%84%B1%E5%A3%B3ipa/"/>
      <url>2020/03/20/%E8%8E%B7%E5%8F%96%E8%84%B1%E5%A3%B3ipa/</url>
      
        <content type="html"><![CDATA[<h2 id="获取ipa"><a href="#获取ipa" class="headerlink" title="获取ipa"></a>获取ipa</h2><h3 id="1-抓包获取"><a href="#1-抓包获取" class="headerlink" title="1.抓包获取"></a>1.抓包获取</h3><p>1.手机上有thos可以实现全局抓包获取<br>特别注意的是，手机的全局代理在运行商店的时候，网络可能会出现问题。比较稳妥的操作是连2.4G的wifi(5Gwifi商店没网了但是其它APP正常，不知道是不是thos版本的问题)，提前购买了APP(这样可以避免下载的时候的账号验证)<br>2.电脑上可以使用Charles或者其他抓包工具<br>抓包可以获取到App Store的ipa链接，可以直接http下载。但是下载下来的ipa文件无法解压。</p><h3 id="2-使用appleconfigurator-2"><a href="#2-使用appleconfigurator-2" class="headerlink" title="2.使用appleconfigurator 2"></a>2.使用appleconfigurator 2</h3><p>使用苹果自己的软件，登录账户，在操作菜单中点击添加找到自己想获取的app，提示app已存在时，不做任何操作，打开finder command+shift+g 到<code>~/Library/Group Containers/K36BKF7T3D.group.com.apple.configurator/Library/Caches/Assets/TemporaryItems/MobileApps/</code>就能看到ipa文件了，值得注意的是这里的ipa可解压。不过有加壳。<br>先看解压的文件结构：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">tree</span><br><span class="line"></span><br><span class="line">├── META-INF</span><br><span class="line">│   ├── com.apple.FixedZipMetadata.bin</span><br><span class="line">│   └── com.apple.ZipMetadata.plist</span><br><span class="line">├── Payload</span><br><span class="line">│   └── caiyunInterpreter.app</span><br><span class="line">├── iTunesArtwork</span><br><span class="line">└── iTunesMetadata.plist</span><br></pre></td></tr></table></figure><p>显示caiyunInterpreter.app的包内容，可以按文件大小排序可以看到最大的二进制文件<code>caiyunInterpreter</code>。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">otool -l caiyunInterpreter |grep crypt</span><br><span class="line">     cryptoff 16384</span><br><span class="line">    cryptsize 8273920</span><br><span class="line">      cryptid 1</span><br><span class="line">     cryptoff 16384</span><br><span class="line">    cryptsize 8945664</span><br><span class="line">      cryptid 1</span><br></pre></td></tr></table></figure><p>使用otool命令，查看cyptid。其值为1表示加壳，0表示未加壳。</p><h2 id="脱壳"><a href="#脱壳" class="headerlink" title="脱壳"></a>脱壳</h2><h3 id="1-Clutch"><a href="#1-Clutch" class="headerlink" title="1.Clutch"></a>1.Clutch</h3><p>脱壳工具Clush可在github上看到源代码。下载其编译好后的二进制，scp到手机的<code>/usr/bin</code>目录。使用<code>Clutch -i</code>查看已安装的软件列表</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Installed apps:</span><br><span class="line">1:   QQ邮箱 &lt;com.tencent.qqmail&gt;</span><br><span class="line">2:   微信 &lt;com.tencent.xin&gt;</span><br><span class="line">3:   优酷视频-刘老根3精彩呈现 &lt;com.youku.YouKu&gt;</span><br><span class="line">4:   米家-精品商城 智能生活 &lt;com.xiaomi.mihome&gt;</span><br><span class="line">5:   YouTube &lt;com.google.ios.youtube&gt;</span><br><span class="line">6:   当当-9.9元超值购物秒杀 &lt;com.dangdang.iphone&gt;</span><br><span class="line">7:   有道云笔记 - 扫描王版 &lt;com.youdao.note.iphone&gt;</span><br><span class="line">8:   拉勾招聘-互联网求职找工作必备 &lt;com.lagou.lagouhr&gt;</span><br><span class="line">9:   支付宝 - 让生活更简单 &lt;com.alipay.iphoneclient&gt;</span><br></pre></td></tr></table></figure><p>对微信进行脱壳：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Clutch -d com.tencent.xin</span><br></pre></td></tr></table></figure><p>当然了并不能成功。</p><h3 id="2-dumpdecrypted"><a href="#2-dumpdecrypted" class="headerlink" title="2.dumpdecrypted"></a>2.dumpdecrypted</h3><p>dumpdecrypted也是在github上有源代码，但是需要自己编译。下载源码运行<code>make</code>的时候报错了，错误信息大致如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">xcrun: error: SDK <span class="string">&quot;iphoneos&quot;</span>cannot be located</span><br><span class="line"></span><br><span class="line">xcrun: error: unableto lookup item <span class="string">&#x27;Path&#x27;</span>inSDK <span class="string">&#x27;iphoneos&#x27;</span></span><br><span class="line"></span><br><span class="line">clang: warning: nosuch sysroot directory: <span class="string">&#x27;-F/System/Library/Frameworks&#x27;</span> [-Wmissing-sysroot]</span><br><span class="line"></span><br><span class="line">dumpdecrypted.c:27:10:fatal error: <span class="string">&#x27;stdio.h&#x27;</span> file not found</span><br></pre></td></tr></table></figure><p>无法找到对应的 SDK 和 stdio.h 文件, 这种问题大多数是 Xcode 路径造成的.</p><p>使用下面的命令看一下系统指向的 Xcode 路径:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">xcode-select -p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/Library/Developer/CommandLineTools</span><br></pre></td></tr></table></figure><p>显然不是 Xcode 的路径, 那只能重新切换一下其路径即指向正确的 Xcode 路径即可.</p><p>命令如下:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo xcode-select --switch /Applications/Xcode.app</span><br><span class="line">make</span><br><span class="line">tree</span><br><span class="line">.</span><br><span class="line">├── Makefile</span><br><span class="line">├── README</span><br><span class="line">├── dumpdecrypted.c</span><br><span class="line">├── dumpdecrypted.dylib</span><br><span class="line">└── dumpdecrypted.o</span><br></pre></td></tr></table></figure><p>编译 dumpdecrypted成功.然后需要对<code>dumpdecrypted.dylib</code>进行签名<br>两种方式：<br>1.ldid<br><code>ldid -S dumpdecrypted.dylib</code><br>2.codesign</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">codesign -f -s - ./dumpdecrypted.dylib</span><br></pre></td></tr></table></figure><p>scp到ios <code>/usr/bin</code><br>具体使用教程可百度</p><h3 id="3-binject"><a href="#3-binject" class="headerlink" title="3.binject"></a>3.binject</h3><p>以上的两个脱壳软件针对的是ios11之前了，binject可支持ios11–ios11.2。由于现在都是IOS13了直接跳过。</p><h3 id="4-crackerxi-ios11–ios13"><a href="#4-crackerxi-ios11–ios13" class="headerlink" title="4.crackerxi (ios11–ios13)"></a>4.crackerxi (ios11–ios13)</h3><p>cydia添加源<a href="http://cydia.iphonecake.com/,setting%E9%99%A4%E4%BA%86fakesign%E9%83%BD%E6%89%93%E9%92%A9%EF%BC%8C%E7%9B%B4%E6%8E%A5%E7%94%9F%E6%88%90%E8%84%B1%E5%A3%B3%E5%90%8E%E7%9A%84ipa%E4%B8%80%E6%AD%A5%E5%88%B0%E4%BD%8D%E3%80%82">http://cydia.iphonecake.com/,setting除了fakesign都打钩，直接生成脱壳后的ipa一步到位。</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> ios </tag>
            
            <tag> 逆向 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>homebrew的坑</title>
      <link href="2020/03/18/homebrew%E7%9A%84%E5%9D%91/"/>
      <url>2020/03/18/homebrew%E7%9A%84%E5%9D%91/</url>
      
        <content type="html"><![CDATA[<p>现在python最新版本是3.8，brew默认安装的python3是3.7。于是乎想给python升级，突然发现brew安装的文件夹<code>/usr/local/Cellar</code>下面有多个python3的文件夹，但是运行<code>brew list</code>的时候只显示一个python3，看起来用<code>brew</code>是没法卸载了。惨的是之前安装的openssl里面也有<code>1.0</code>,<code>1.1</code>两个文件夹。但是卸载1.0的时候也对应的是<code>1.1</code>，而且还没生效。</p><h2 id="1-卸载openssl-1-0"><a href="#1-卸载openssl-1-0" class="headerlink" title="1.卸载openssl 1.0"></a>1.卸载openssl 1.0</h2><p>1.删除brew 安装的文件夹 <code>/usr/local/Cellar/openssl</code><br>2.查看有没有软连接<code>ls -al /usr/local/bin/openssl</code>以及<code>ls -al /usr/local/opt/openssl</code>，有则删除</p><h2 id="2-启用openssl"><a href="#2-启用openssl" class="headerlink" title="2.启用openssl"></a>2.启用openssl</h2><p><code>brew link openssl</code></p><h2 id="3-清理无效的系统变量和软连接"><a href="#3-清理无效的系统变量和软连接" class="headerlink" title="3.清理无效的系统变量和软连接"></a>3.清理无效的系统变量和软连接</h2><p>1.先查看环境变量<code>echo $PATH</code>确定哪些无效<br>有时候可能一下子找不到，知道系统的环境变量的加载顺序可以用的上：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/etc/profile</span><br><span class="line">/etc/paths </span><br><span class="line">/etc/paths.d/</span><br><span class="line">~/.bash_profile </span><br><span class="line">~/.bash_login</span><br><span class="line">~/.profile</span><br><span class="line">~/.bashrc</span><br></pre></td></tr></table></figure><p>/etc/profile和/etc/paths， /etc/paths.d/是系统级别的，系统启动就会加载；<br>2.在系统环境变量里删除无效的软连接<br>可以用这个bash删除指定目录下的无效软连接：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#! /bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;enter scan path: &quot;</span></span><br><span class="line"><span class="built_in">read</span> path</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="variable">$path</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;please enter scan path&quot;</span></span><br><span class="line">    <span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> $(find <span class="variable">$path</span> -<span class="built_in">type</span> l)</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> [ ! -e <span class="variable">$file</span> ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;rm <span class="variable">$file</span>&quot;</span></span><br><span class="line">        rm -f <span class="variable">$file</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h2 id="4-安装python-3-8"><a href="#4-安装python-3-8" class="headerlink" title="4.安装python 3.8"></a>4.安装python 3.8</h2><p>1.运行brew 安装<br><code>brew install python@3.8</code>，特别的运行<code>pip3 install packages</code>时如果提示权限问题，可以加<code>--user</code>参数。<br>2.调整系统变量使<code>python3</code>生效<br>像python3这样的一般brew安装完，会直接调用<code>brew link python3</code>使系统的环境变量生效，如果没有可以手动运行一遍，按照提示继续操作。</p>]]></content>
      
      
      
        <tags>
            
            <tag> mac </tag>
            
            <tag> homebrew </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python多线程没变快？</title>
      <link href="2020/03/18/python%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%B2%A1%E5%8F%98%E5%BF%AB?/"/>
      <url>2020/03/18/python%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%B2%A1%E5%8F%98%E5%BF%AB?/</url>
      
        <content type="html"><![CDATA[<p>先看代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime,time</span><br><span class="line">start_time = datetime.datetime.now()</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000</span>):</span><br><span class="line">    <span class="comment"># time.sleep(0.01)</span></span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">str</span>(datetime.datetime.now() - start_time))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> multiprocessing.dummy <span class="keyword">import</span> Pool <span class="keyword">as</span> ThreadPool</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="comment"># time.sleep(0.01)</span></span><br><span class="line">    <span class="built_in">print</span>(x)</span><br><span class="line"></span><br><span class="line">start_time = datetime.datetime.now()</span><br><span class="line">l = [x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000</span>)]</span><br><span class="line">pool = ThreadPool(<span class="number">1000</span>)</span><br><span class="line">pool.<span class="built_in">map</span>(main, l)</span><br><span class="line">pool.close()</span><br><span class="line">pool.join()</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">str</span>(datetime.datetime.now() - start_time))</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>当将time的那段代码注释时，多线程没有单线程跑得快，当取消注释时，多线程跑的快。说明带代码单一的暂停，阻塞时多线程快，当代码没有阻塞时，将一个任务拆分为多线程时，反而会将代码运行的速度变慢。</p>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>openvpn</title>
      <link href="2020/03/06/openvpn%E6%96%87%E4%BB%B6%E5%90%88%E5%B9%B6/"/>
      <url>2020/03/06/openvpn%E6%96%87%E4%BB%B6%E5%90%88%E5%B9%B6/</url>
      
        <content type="html"><![CDATA[<h2 id="mac运行openvpn"><a href="#mac运行openvpn" class="headerlink" title="mac运行openvpn"></a>mac运行openvpn</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">brew install openvpn</span><br><span class="line">sudo brew services start openvpn</span><br><span class="line">ln -s /usr/<span class="built_in">local</span>/opt/openvpn/sbin/openvpn /usr/<span class="built_in">local</span>/bin/openvpn</span><br><span class="line"></span><br><span class="line">命令行运行：</span><br><span class="line">sudo openvpn --config  (confpath)/siccs.conf</span><br><span class="line"><span class="comment">#sudo openvpn --config ~/siccs_v1.ovpn</span></span><br><span class="line">后台运行：</span><br><span class="line">sudo openvpn --config  (confpath)/siccs.conf —daemon</span><br></pre></td></tr></table></figure><h2 id="openvpn文件合并"><a href="#openvpn文件合并" class="headerlink" title="openvpn文件合并"></a>openvpn文件合并</h2><p>把ca.crt证书放入client.ovpn配置文件</p><p>如果你有好几个网站的openvpn配置你可以在config目录下为每一个网站建一个文件夹，也可以都放在config目录下，不过是不是有很多.crt和.key文件很烦人呀，其实你可以把它们都删除了，只需要把他们放入client.ovpn配置文件。</p><p>用写字板打开各个client.ovpn文件在最后面添加</p><ca></ca><cert></cert><key></key><p>key-direction 1<br><tls-auth></p></tls-auth><p>用记事本打开ca.crt把文件内容复制到<ca>和</ca>的中间，</p><p>用记事本打开client.crt把文件内容复制到<cert>和</cert>的中间，</p><p>用记事本打开client.key把文件内容复制到<key>和</key>的中间，</p><p>用记事本打开ta.key把文件内容复制到<tls-auth>和</tls-auth>的中间，</p><p>（ca.crt、client.crt、client.key、ta.key这些文件不一定全都与，有那些就修改那些；这些文件的名字不一定都是这样，可以在.ovpn配置文件里搜索ca、cert、key、tls-auth看他们所对应的文件名）</p><p>修改完成后删除类似</p><p>tls-auth ta.key 1<br>ca ca.crt<br>cert client.crt<br>key client.key</p><p>的那几行，然后保.ovpn文件即可删除那些.crt和.key文件而正常使用了（你可以把密码都保存在一个文件夹下，修改如下：把：auth-user-pass 改成： auth-user-pass pwd/mypass.txt 并在client.ovpn所在目录建立pwd文件夹并在此文件夹下建mypass.txt文件…）。</p><p>以上内容Copy自<a href="http://www.360doc.com/content/16/0114/15/4171006_527867246.shtml%EF%BC%8C">http://www.360doc.com/content/16/0114/15/4171006_527867246.shtml，</a><br>注意的是key-direction 1必须得有。</p>]]></content>
      
      
      
        <tags>
            
            <tag> mac </tag>
            
            <tag> others </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mac安装LaTeX</title>
      <link href="2020/03/06/Mac%E5%AE%89%E8%A3%85LaTeX/"/>
      <url>2020/03/06/Mac%E5%AE%89%E8%A3%85LaTeX/</url>
      
        <content type="html"><![CDATA[<p>由于现在网上很多软件文档都是基于Sphinx写成的，例如：<a href="https://solidity-cn.readthedocs.io/zh/develop/%EF%BC%8C%E7%A6%BB%E7%BA%BF%E9%98%85%E8%AF%BB%E9%9A%BE%E5%85%8D%E4%B8%8D%E4%BE%BF%E5%A5%BD%E5%9C%A8%E5%80%9F%E5%8A%A9Sphinx%E7%9A%84rst%E6%96%87%E4%BB%B6%E5%8F%AF%E4%BB%A5%E7%94%9F%E6%88%90%E5%AF%B9%E5%BA%94%E7%9A%84pdf%EF%BC%8Cepub%EF%BC%8Chtml%E7%AD%89%E7%B1%BB%E5%9E%8B%E3%80%82">https://solidity-cn.readthedocs.io/zh/develop/，离线阅读难免不便好在借助Sphinx的rst文件可以生成对应的pdf，epub，html等类型。</a><br>这里以<a href="https://github.com/etherchina/solidity-doc-cn%E4%B8%BA%E4%BE%8B%EF%BC%9A">https://github.com/etherchina/solidity-doc-cn为例：</a></p><h2 id="安装环境"><a href="#安装环境" class="headerlink" title="安装环境"></a>安装环境</h2><p>mac下的LaTeX有两种：<br>1.mactex(这个安装包较大)<br><code>brew cask install mactex</code><br>2.BasicTeX<br><code>brew cask install basictex</code></p><p>在项目目录下使用命令<code>make --help</code>查看:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">Usage: make [options] [target] ...</span><br><span class="line">Options:</span><br><span class="line">  -b, -m                      Ignored <span class="keyword">for</span> compatibility.</span><br><span class="line">  -B, --always-make           Unconditionally make all targets.</span><br><span class="line">  -C DIRECTORY, --directory=DIRECTORY</span><br><span class="line">                              Change to DIRECTORY before doing anything.</span><br><span class="line">  -d                          Print lots of debugging information.</span><br><span class="line">  --debug[=FLAGS]             Print various types of debugging information.</span><br><span class="line">  -e, --environment-overrides</span><br><span class="line">                              Environment variables override makefiles.</span><br><span class="line">  -f FILE, --file=FILE, --makefile=FILE</span><br><span class="line">                              Read FILE as a makefile.</span><br><span class="line">  -h, --<span class="built_in">help</span>                  Print this message and <span class="built_in">exit</span>.</span><br><span class="line">  -i, --ignore-errors         Ignore errors from commands.</span><br><span class="line">  -I DIRECTORY, --include-dir=DIRECTORY</span><br><span class="line">                              Search DIRECTORY <span class="keyword">for</span> included makefiles.</span><br><span class="line">  -j [N], --<span class="built_in">jobs</span>[=N]          Allow N <span class="built_in">jobs</span> at once; infinite <span class="built_in">jobs</span> with no arg.</span><br><span class="line">  -k, --keep-going            Keep going when some targets can<span class="string">&#x27;t be made.</span></span><br><span class="line"><span class="string">  -l [N], --load-average[=N], --max-load[=N]</span></span><br><span class="line"><span class="string">                              Don&#x27;</span>t start multiple <span class="built_in">jobs</span> unless load is below N.</span><br><span class="line">  -L, --check-symlink-times   Use the latest mtime between symlinks and target.</span><br><span class="line">  -n, --just-print, --dry-run, --recon</span><br><span class="line">                              Don<span class="string">&#x27;t actually run any commands; just print them.</span></span><br><span class="line"><span class="string">  -o FILE, --old-file=FILE, --assume-old=FILE</span></span><br><span class="line"><span class="string">                              Consider FILE to be very old and don&#x27;</span>t remake it.</span><br><span class="line">  -p, --print-data-base       Print make<span class="string">&#x27;s internal database.</span></span><br><span class="line"><span class="string">  -q, --question              Run no commands; exit status says if up to date.</span></span><br><span class="line"><span class="string">  -r, --no-builtin-rules      Disable the built-in implicit rules.</span></span><br><span class="line"><span class="string">  -R, --no-builtin-variables  Disable the built-in variable settings.</span></span><br><span class="line"><span class="string">  -s, --silent, --quiet       Don&#x27;</span>t <span class="built_in">echo</span> commands.</span><br><span class="line">  -S, --no-keep-going, --stop</span><br><span class="line">                              Turns off -k.</span><br><span class="line">  -t, --touch                 Touch targets instead of remaking them.</span><br><span class="line">  -v, --version               Print the version number of make and <span class="built_in">exit</span>.</span><br><span class="line">  -w, --print-directory       Print the current directory.</span><br><span class="line">  --no-print-directory        Turn off -w, even <span class="keyword">if</span> it was turned on implicitly.</span><br><span class="line">  -W FILE, --what-if=FILE, --new-file=FILE, --assume-new=FILE</span><br><span class="line">                              Consider FILE to be infinitely new.</span><br><span class="line">  --warn-undefined-variables  Warn when an undefined variable is referenced.</span><br></pre></td></tr></table></figure><p>通过help可以看出我们可以编译pdf、epub等类型文件（make过程可能造成编码错误）。</p>]]></content>
      
      
      
        <tags>
            
            <tag> mac </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Enclave开发</title>
      <link href="2020/01/17/Enclave%E5%BC%80%E5%8F%91/"/>
      <url>2020/01/17/Enclave%E5%BC%80%E5%8F%91/</url>
      
        <content type="html"><![CDATA[<h1 id="Enclave开发包括以下几个步骤："><a href="#Enclave开发包括以下几个步骤：" class="headerlink" title="Enclave开发包括以下几个步骤："></a>Enclave开发包括以下几个步骤：</h1><ol><li>使用EDL文件定义不可信app和encalve(飞地)之间的接口(由ecall和ocall来实现)</li><li>实现app和encalve函数。</li><li>编译app和enclave。编译中，Edger8r生成可信和不可信的代理/桥函数，enclave签名工具生成enclave的metadata和签名。<a href="https://github.com/Jianbo-Gao/RegChain/tree/master/TrustNode#%E7%94%9F%E6%88%90enclave_privatepem">需生成Enclave_private.pem</a></li><li>在模拟和硬件模式下运行和调试app，详细看看调试飞地的内容。</li><li>准备发布app和飞地。</li></ol><h2 id="名词解释"><a href="#名词解释" class="headerlink" title="名词解释"></a>名词解释</h2><ul><li><p>EDL 即 Enclave Defination Language. 因为 Enclave 不同于共享的资源, 其与外部不可信内容的交互需要特定的规则进行限定. Intel SGX 给出了一种语言来抽象地描述 Enclave 内部函数的调用权限和数据的出入方式, 并通过 <a href="https://github.com/intel/linux-sgx/blob/master/common/inc/sgx_edger8r.h">sgx_edger8r</a> 翻译成一系列可编译的代码.<br>EDL 提出了一种“边规则”(edge routine) 的概念. 一个 edge routine 即是运行于 Enclave 内部或外部的函数和它们与 Enclave 外部或内部的调用关系的总称.</p></li><li><p>ecall（Enclave Call） 是 Enclave 内部程序的接口函数.</p></li><li><p>ocall （Out Call）是可由 Enclave 内部代码调用的外部函数接口.</p></li></ul><h2 id="具体开发实例"><a href="#具体开发实例" class="headerlink" title="具体开发实例"></a>具体开发实例</h2><p><a href="https://github.com/60ke/rust_sgx_test/tree/master/ocall_beta">https://github.com/60ke/rust_sgx_test/tree/master/ocall_beta</a></p><p>此实例是基于<a href="https://github.com/apache/incubator-teaclave-sgx-sdk">incubator-teaclave-sgx-sdk</a> 即baidu rust sdk开发</p><p>开发流程：</p><ol><li>首先需要放置基础依赖<a href="https://github.com/60ke/rust_sgx_test/tree/master/ocall_beta/common/inc">common/inc</a>（c的头文件）和 <a href="https://github.com/60ke/rust_sgx_test/tree/master/ocall_beta/edl">edl</a> </li><li>使用<code>rust</code>编写 app 和 encalve</li><li>编写Makefile文件(可参考<a href="https://github.com/apache/incubator-teaclave-sgx-sdk/blob/master/samplecode/hello-rust/Makefile">Makefile</a>)</li></ol><p>1 和 3 的开发相对简单，不再具体描述。下面介绍使用<code>rust</code>编写 app 和 encalve</p><p>代码结构：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">├── .vscode-------------------------- vscode配置文件，用于debug</span><br><span class="line">├── Cargo.toml--------------------------   定义workspace用于debug</span><br><span class="line">├── Makefile--------------------------   项目编译</span><br><span class="line">├── app</span><br><span class="line">│   ├── Cargo.toml-------------------------- app的cargo配置</span><br><span class="line">│   ├── build.rs-------------------------- app的build文件</span><br><span class="line">│   └── src --------------------------  rust代码目录</span><br><span class="line">│       └── main.rs-------------------------- app主函数文件</span><br><span class="line">├── bin-------------------------- 存放编译后的二进制文件夹</span><br><span class="line">├── common-------------------------- 引用自[common&#x2F;inc](https:&#x2F;&#x2F;github.com&#x2F;mesalock-linux&#x2F;adler32-rs-sgx&#x2F;tree&#x2F;master&#x2F;sgx&#x2F;adler32-rs-sgx-test&#x2F;common&#x2F;inc)</span><br><span class="line">├── edl-------------------------- 引用自[edl](https:&#x2F;&#x2F;github.com&#x2F;mesalock-linux&#x2F;adler32-rs-sgx&#x2F;tree&#x2F;master&#x2F;sgx&#x2F;adler32-rs-sgx-test&#x2F;edl)</span><br><span class="line">├── enclave</span><br><span class="line">│   ├── Cargo.toml-------------------------- enclave的cargo配置</span><br><span class="line">│   ├── Enclave.config.xml--------------定义 Enclave 的内存布局等高级特性</span><br><span class="line">│   ├── Enclave.edl--------------Edl文件</span><br><span class="line">│   ├── Enclave.lds--------------encalve链接脚本</span><br><span class="line">│   ├── Enclave_private.pem------------用户生成的私匙供 sgxsdk 签名使用</span><br><span class="line">│   ├── Makefile --------------------------                           Encalve编译</span><br><span class="line">│   └── src --------------------------  rust代码目录</span><br><span class="line">│       └── lib.rs-------------------------- enclave的lib文件</span><br></pre></td></tr></table></figure><p>首先在encalve的<a href="https://github.com/60ke/rust_sgx_test/blob/master/ocall_beta/enclave/Enclave.edl">Enclave.edl</a>中定义ecall和ocall函数</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">enclave &#123;</span><br><span class="line">  <span class="comment">//导入引用</span></span><br><span class="line">    from <span class="string">&quot;sgx_tstd.edl&quot;</span> <span class="keyword">import</span> *;</span><br><span class="line">    from <span class="string">&quot;sgx_stdio.edl&quot;</span> <span class="keyword">import</span> *;</span><br><span class="line">    from <span class="string">&quot;sgx_backtrace.edl&quot;</span> <span class="keyword">import</span> *;</span><br><span class="line">    from <span class="string">&quot;sgx_tstdc.edl&quot;</span> <span class="keyword">import</span> *;</span><br><span class="line"></span><br><span class="line">    include <span class="string">&quot;sgx_quote.h&quot;</span></span><br><span class="line">  </span><br><span class="line">    trusted &#123;</span><br><span class="line">  <span class="comment">//定义ecall</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">sgx_status_t</span> <span class="title">say_something</span><span class="params">([in, size=len] <span class="keyword">const</span> <span class="keyword">uint8_t</span>* some_string, <span class="keyword">size_t</span> len)</span></span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    untrusted &#123;</span><br><span class="line">    <span class="comment">//定义ocall</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">ocall_get_quote</span><span class="params">([in, size = key_len] <span class="keyword">uint8_t</span> * key,<span class="keyword">uint32_t</span> key_len,[out,size = <span class="number">1000</span>] <span class="keyword">uint8_t</span>* value,[out] <span class="keyword">uint8_t</span>* value_len)</span></span>;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ecall的入口在app部分，函数的具体实现在enclave中。先看ecall的edl函数定义：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">sgx_status_t</span> <span class="title">say_something</span><span class="params">([in, size=len] <span class="keyword">const</span> <span class="keyword">uint8_t</span>* some_string, <span class="keyword">size_t</span> len)</span></span>;</span><br></pre></td></tr></table></figure><p>这里ecall的调用传入的是一个c语言的常量字符串，为了便于c与rust的交互我们将char list(常量字符串)转换为ASCII码以指针的形式传递。这里的ecall直接使用<a href="https://github.com/apache/incubator-teaclave-sgx-sdk">incubator-teaclave-sgx-sdk</a>中的<a href="https://github.com/apache/incubator-teaclave-sgx-sdk/blob/master/samplecode/hello-rust/enclave/Enclave.edl">Enclave.edl</a> 首先声明public，返回的数据类型为<code>sgx_status_t</code> 函数名为<code>say_something</code>.ecall传入enclave需要用<code>[in]</code>修饰。由于我们传入的为常量需要加上size的参数<code>size=len</code> Edl的语法和C语言语法比较接近<code>uint8_t*</code>和<code>size_t</code>为数据类型，<code>some_string</code> 和为变量名<code>len</code>.</p><p>enclave的<code>say_something</code>实现：<a href="https://github.com/60ke/rust_sgx_test/blob/master/ocall_beta/enclave/src/lib.rs">lib.rs</a>，然后在app中引入：</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">say_something</span></span>(eid: sgx_enclave_id_t, retval: *<span class="keyword">mut</span> sgx_status_t,</span><br><span class="line">                     some_string: *<span class="keyword">const</span> <span class="built_in">u8</span>, len: <span class="built_in">usize</span>) -&gt; sgx_status_t;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后在<a href="https://github.com/60ke/rust_sgx_test/blob/master/ocall_beta/app/src/main.rs">main.rs</a>中的main函数对其调用。</p><p>ocall的入口在enclave中，函数在app中实现。其Edl部分为：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ocall_get_quote</span><span class="params">([in, size = key_len] <span class="keyword">uint8_t</span> * key,<span class="keyword">uint32_t</span> key_len,[out,size = <span class="number">1000</span>] <span class="keyword">uint8_t</span>* value,[out] <span class="keyword">uint8_t</span>* value_len)</span></span>;</span><br></pre></td></tr></table></figure><p>ocall的实现的功能为由enclave传出一个<code>key</code>到app，然后app生成一个对应的<code>value</code>再传入enclave。整体流程与ecall类似。需要注意的是，由于value的长度不固定，不能单纯定义为一个常量的类型。我们这里先定义了一个足够大的list（1000），然后再传递一个变量<code>value_len</code>来表示value的长度。然后在<code>enclave</code>对其进行截取来实现value由app到enclave的返回。</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://blog.lao-yuan.com/2019/02/20/Linux-SGX-Demo.html#edl">https://blog.lao-yuan.com/2019/02/20/Linux-SGX-Demo.html#edl</a><br><a href="https://zhuanlan.zhihu.com/p/39914622">https://zhuanlan.zhihu.com/p/39914622</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> rust </tag>
            
            <tag> sgx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sgx开发</title>
      <link href="2020/01/17/sgx/"/>
      <url>2020/01/17/sgx/</url>
      
        <content type="html"><![CDATA[<h1 id="sgx-开发"><a href="#sgx-开发" class="headerlink" title="sgx 开发"></a>sgx 开发</h1><h2 id="当前项目依赖："><a href="#当前项目依赖：" class="headerlink" title="当前项目依赖："></a>当前项目依赖：</h2><p><a href="https://github.com/apache/incubator-teaclave-sgx-sdk">incubator-teaclave-sgx-sdk</a> 1.0.9(原baidu rust sgx sdk)</p><p>Rust nightly-2019-08-01</p><p><a href="https://github.com/enigmampc/enigma-core">https://github.com/enigmampc/enigma-core</a> 的一些crate(后续开发剔除)</p><p>适用于rust sgx的crate：</p><p><a href="https://github.com/dingelish/sgx-world">https://github.com/dingelish/sgx-world</a></p><h2 id="项目开发遇到的问题"><a href="#项目开发遇到的问题" class="headerlink" title="项目开发遇到的问题"></a>项目开发遇到的问题</h2><h3 id="evm读写集的记录："><a href="#evm读写集的记录：" class="headerlink" title="evm读写集的记录："></a>evm读写集的记录：</h3><p>在sputnikvm的返回结果上添加读写集。可对比 <a href="https://github.com/60ke/sputnikvm">https://github.com/60ke/sputnikvm</a> 与 <a href="https://github.com/enigmampc/sputnikvm/tree/enigma-next">https://github.com/enigmampc/sputnikvm/tree/enigma-next</a> 的区别</p><h3 id="ocall："><a href="#ocall：" class="headerlink" title="ocall："></a>ocall：</h3><p>传入address和storage的key来获取storage的value的edl部分的代码：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ocall_get_storage</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">[in, size = addr_len] <span class="keyword">uint8_t</span> * addr,<span class="keyword">uint8_t</span> addr_len,</span></span></span><br><span class="line"><span class="function"><span class="params">[in, size = index_len] <span class="keyword">uint8_t</span> * index,<span class="keyword">uint8_t</span> index_len,</span></span></span><br><span class="line"><span class="function"><span class="params">[out,size = <span class="number">1000</span>] <span class="keyword">uint8_t</span>* value,[out] <span class="keyword">uint8_t</span>* value_len</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br></pre></td></tr></table></figure><h3 id="enclave与外界的数据类型交互："><a href="#enclave与外界的数据类型交互：" class="headerlink" title="enclave与外界的数据类型交互："></a>enclave与外界的数据类型交互：</h3><p>由edl生成c函数，通过指针的方法进行进行交互</p><h3 id="solidity测试合约"><a href="#solidity测试合约" class="headerlink" title="solidity测试合约"></a>solidity测试合约</h3><p>regchain wiki中的合约：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.24;</span><br><span class="line">contract sample &#123;</span><br><span class="line">    uint256 a &#x3D; 0;</span><br><span class="line">    function add() payable public returns (uint256) &#123;</span><br><span class="line">        a &#x3D; a + msg.value;</span><br><span class="line">        return a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>需要操作storage的合约：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.24;</span><br><span class="line">contract MyContract &#123;</span><br><span class="line">  uint[] array &#x3D; [1,2,3,4,5];</span><br><span class="line"></span><br><span class="line">  function removeAtIndex(uint index) returns (uint[]) &#123;</span><br><span class="line">    if (index &gt;&#x3D; array.length) return;</span><br><span class="line"></span><br><span class="line">    for (uint i &#x3D; index; i &lt; array.length-1; i++) &#123;</span><br><span class="line">      array[i] &#x3D; array[i+1];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    delete array[array.length-1];</span><br><span class="line">    array.length--;</span><br><span class="line"></span><br><span class="line">    return array;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="利用vscode和sgx-gdb进行调试"><a href="#利用vscode和sgx-gdb进行调试" class="headerlink" title="利用vscode和sgx-gdb进行调试"></a>利用vscode和sgx-gdb进行调试</h3><p>教程：</p><p><a href="https://github.com/apache/incubator-teaclave-sgx-sdk/wiki/Setup-gdb-7.11-on-Ubuntu-18.04-for-VSCode---sgx-gdb-remote-debugging">Setup gdb 7.11 on Ubuntu 18.04 for VSCode sgx gdb remote debugging</a></p><p>对应代码实例：</p><p><a href="https://github.com/apache/incubator-teaclave-sgx-sdk/tree/master/samplecode/hello-rust-vscode-debug">hello-rust-vscode-debug</a></p><h3 id="intel远程证实"><a href="#intel远程证实" class="headerlink" title="intel远程证实"></a>intel远程证实</h3><ul><li><h4 id="英特尔官方远程证实"><a href="#英特尔官方远程证实" class="headerlink" title="英特尔官方远程证实"></a>英特尔官方远程证实</h4><p>注册英特尔开发者账号获取spid和key:</p><p><a href="https://software.intel.com/registration/?lang=zh-cn">https://software.intel.com/registration/?lang=zh-cn</a></p><p>intel官方实例：<a href="https://software.intel.com/zh-cn/articles/code-sample-intel-software-guard-extensions-remote-attestation-end-to-end-example">https://software.intel.com/zh-cn/articles/code-sample-intel-software-guard-extensions-remote-attestation-end-to-end-example</a></p><p>Rust sgx相关代码实例：</p><p><a href="https://github.com/apache/incubator-teaclave-sgx-sdk/tree/master/samplecode/mutual-ra">mutual-ra</a></p><p><a href="https://github.com/apache/incubator-teaclave-sgx-sdk/tree/master/samplecode/ue-ra">ue-ra</a></p></li><li><h4 id="第三方远程证实（dcap）"><a href="#第三方远程证实（dcap）" class="headerlink" title="第三方远程证实（dcap）"></a>第三方远程证实（dcap）</h4><p>  <a href="https://github.com/intel/SGXDataCenterAttestationPrimitives">https://github.com/intel/SGXDataCenterAttestationPrimitives</a></p><p>  <a href="https://github.com/Jianbo-Gao/RegChain/wiki/Sgx%E7%AC%AC%E4%B8%89%E6%96%B9%E8%BF%9C%E7%A8%8B%E8%AF%81%E5%AE%9E%E7%A1%AC%E4%BB%B6%E8%AF%B4%E6%98%8E">Sgx第三方远程证实硬件说明</a></p></li></ul><h3 id="ARM-TrustZone"><a href="#ARM-TrustZone" class="headerlink" title="ARM TrustZone:"></a>ARM TrustZone:</h3><p><a href="https://github.com/OP-TEE/optee_os">OP-TEE / optee_os</a></p><p><a href="https://github.com/ARMmbed/meta-mbl">ARMmbed / meta-mbl</a></p><p><a href="https://blog.csdn.net/shuaifengyun/article/details/73716352">https://blog.csdn.net/shuaifengyun/article/details/73716352</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> rust </tag>
            
            <tag> sgx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CA证书</title>
      <link href="2019/12/19/CA%E8%AF%81%E4%B9%A6/"/>
      <url>2019/12/19/CA%E8%AF%81%E4%B9%A6/</url>
      
        <content type="html"><![CDATA[<p>之前没接触过证书加密的话,对证书相关的这些概念真是感觉挺棘手的,因为一下子来了一大堆新名词,看起来像是另一个领域的东西,而不是我们所熟悉的编程领域的那些东西,起码我个人感觉如此,且很长时间都没怎么搞懂.写这篇文章的目的就是为了理理清这些概念,搞清楚它们的含义及关联,还有一些基本操作.</p><h2 id="SSL"><a href="#SSL" class="headerlink" title="SSL"></a>SSL</h2><p>SSL - Secure Sockets Layer,现在应该叫”TLS”,但由于习惯问题,我们还是叫”SSL”比较多.http协议默认情况下是不加密内容的,这样就很可能在内容传播的时候被别人监听到,对于安全性要求较高的场合,必须要加密,https就是带加密的http协议,而https的加密是基于SSL的,它执行的是一个比较下层的加密,也就是说,在加密前,你的服务器程序在干嘛,加密后也一样在干嘛,不用动,这个加密对用户和开发者来说都是透明的</p><p><strong>OpenSSL</strong> - 简单地说,OpenSSL是SSL的一个实现,SSL只是一种规范.理论上来说,SSL这种规范是安全的,目前的技术水平很难破解,但SSL的实现就可能有些漏洞,如著名的”心脏出血”.OpenSSL还提供了一大堆强大的工具软件,强大到90%我们都用不到.</p><h3 id="证书标准"><a href="#证书标准" class="headerlink" title="证书标准"></a>证书标准</h3><p><strong>X.509</strong> - 这是一种证书标准,主要定义了证书中应该包含哪些内容.其详情可以参考RFC5280,SSL使用的就是这种证书标准.</p><h2 id="编码格式"><a href="#编码格式" class="headerlink" title="编码格式"></a>编码格式</h2><p>同样的X.509证书,可能有不同的编码格式,目前有以下两种编码格式.</p><p><strong>PEM</strong> - Privacy Enhanced Mail,打开看文本格式,以”—–BEGIN…”开头, “—–END…”结尾,内容是BASE64编码.<br>查看PEM格式证书的信息:openssl x509 -in certificate.pem -text -noout<br>Apache和*NIX服务器偏向于使用这种编码格式.</p><p><strong>DER</strong> - Distinguished Encoding Rules,打开看是二进制格式,不可读.<br>查看DER格式证书的信息:openssl x509 -in certificate.der -inform der -text -noout<br>Java和Windows服务器偏向于使用这种编码格式.</p><h2 id="相关的文件扩展名"><a href="#相关的文件扩展名" class="headerlink" title="相关的文件扩展名"></a>相关的文件扩展名</h2><p>这是比较误导人的地方,虽然我们已经知道有PEM和DER这两种编码格式,但文件扩展名并不一定就叫”PEM”或者”DER”,常见的扩展名除了PEM和DER还有以下这些,它们除了编码格式可能不同之外,内容也有差别,但大多数都能相互转换编码格式.</p><p><strong>CRT</strong> - CRT应该是certificate的三个字母,其实还是证书的意思,常见于*NIX系统,有可能是PEM编码,也有可能是DER编码,大多数应该是PEM编码,相信你已经知道怎么辨别.</p><p><strong>CER</strong> - 还是certificate,还是证书,常见于Windows系统,同样的,可能是PEM编码,也可能是DER编码,大多数应该是DER编码.</p><p><strong>KEY</strong> - 通常用来存放一个公钥或者私钥,并非X.509证书,编码同样的,可能是PEM,也可能是DER.<br>查看KEY的办法:openssl rsa -in mykey.key -text -noout<br>如果是DER格式的话,同理应该这样了:openssl rsa -in mykey.key -text -noout -inform der</p><p><strong>CSR</strong> - Certificate Signing Request,即证书签名请求,这个并不是证书,而是向权威证书颁发机构获得签名证书的申请,其核心内容是一个公钥(当然还附带了一些别的信息),在生成这个申请的时候,同时也会生成一个私钥,私钥要自己保管好.做过iOS APP的朋友都应该知道是怎么向苹果申请开发者证书的吧.<br>查看的办法:openssl req -noout -text -in my.csr (如果是DER格式的话照旧加上-inform der,这里不写了)</p><p><strong>PFX/P12</strong> - predecessor of PKCS#12,对*nix服务器来说,一般CRT和KEY是分开存放在不同文件中的,但Windows的IIS则将它们存在一个PFX文件中,(因此这个文件包含了证书及私钥)这样会不会不安全？应该不会,PFX通常会有一个”提取密码”,你想把里面的东西读取出来的话,它就要求你提供提取密码,PFX使用的时DER编码,如何把PFX转换为PEM编码？<br>openssl pkcs12 -in for-iis.pfx -out for-iis.pem -nodes<br>这个时候会提示你输入提取代码. for-iis.pem就是可读的文本.<br>生成pfx的命令类似这样:openssl pkcs12 -export -in certificate.crt -inkey privateKey.key -out certificate.pfx -certfile CACert.crt</p><p>其中CACert.crt是CA(权威证书颁发机构)的根证书,有的话也通过-certfile参数一起带进去.这么看来,PFX其实是个证书密钥库.</p><p><strong>JKS</strong> - 即Java Key Storage,这是Java的专利,跟OpenSSL关系不大,利用Java的一个叫”keytool”的工具,可以将PFX转为JKS,当然了,keytool也能直接生成JKS,不过在此就不多表了.</p><h2 id="证书编码的转换"><a href="#证书编码的转换" class="headerlink" title="证书编码的转换"></a>证书编码的转换</h2><p>PEM转为DER openssl x509 -in cert.crt -outform der -out cert.der</p><p>DER转为PEM openssl x509 -in cert.crt -inform der -outform pem -out cert.pem</p><p>(提示:要转换KEY文件也类似,只不过把x509换成rsa,要转CSR的话,把x509换成req…)</p><h2 id="获得证书"><a href="#获得证书" class="headerlink" title="获得证书"></a>获得证书</h2><h3 id="向权威证书颁发机构申请证书"><a href="#向权威证书颁发机构申请证书" class="headerlink" title="向权威证书颁发机构申请证书"></a>向权威证书颁发机构申请证书</h3><p>用这命令生成一个csr: openssl req -newkey rsa:2048 -new -nodes -keyout my.key -out my.csr<br>把csr交给权威证书颁发机构,权威证书颁发机构对此进行签名,完成.保留好csr,当权威证书颁发机构颁发的证书过期的时候,你还可以用同样的csr来申请新的证书,key保持不变.</p><h3 id="或者生成自签名的证书"><a href="#或者生成自签名的证书" class="headerlink" title="或者生成自签名的证书"></a>或者生成自签名的证书</h3><p>openssl req -newkey rsa:2048 -new -nodes -x509 -days 3650 -keyout key.pem -out cert.pem<br>在生成证书的过程中会要你填一堆的东西,其实真正要填的只有Common Name,通常填写你服务器的域名,如”yourcompany.com”,或者你服务器的IP地址,其它都可以留空的.<br>生产环境中还是不要使用自签的证书,否则浏览器会不认,或者如果你是企业应用的话能够强制让用户的浏览器接受你的自签证书也行.向权威机构要证书通常是要钱的,但现在也有免费的,仅仅需要一个简单的域名验证即可.有兴趣的话查查”沃通数字证书”.</p><p>源自 <a href="https://www.cnblogs.com/guogangj/p/4118605.html">https://www.cnblogs.com/guogangj/p/4118605.html</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> others </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>flask自建证书及测试</title>
      <link href="2019/12/19/flask%E8%87%AA%E5%BB%BA%E8%AF%81%E4%B9%A6%E5%8F%8A%E6%B5%8B%E8%AF%95/"/>
      <url>2019/12/19/flask%E8%87%AA%E5%BB%BA%E8%AF%81%E4%B9%A6%E5%8F%8A%E6%B5%8B%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<p>生成密钥、证书<br>第一步，为服务器端和客户端准备公钥、私钥</p><h1 id="生成服务器端私钥"><a href="#生成服务器端私钥" class="headerlink" title="生成服务器端私钥"></a>生成服务器端私钥</h1><p>openssl genrsa -out server.key 1024</p><h1 id="生成服务器端公钥"><a href="#生成服务器端公钥" class="headerlink" title="生成服务器端公钥"></a>生成服务器端公钥</h1><p>openssl rsa -in server.key -pubout -out server.pem</p><h1 id="生成客户端私钥"><a href="#生成客户端私钥" class="headerlink" title="生成客户端私钥"></a>生成客户端私钥</h1><p>openssl genrsa -out client.key 1024</p><h1 id="生成客户端公钥"><a href="#生成客户端公钥" class="headerlink" title="生成客户端公钥"></a>生成客户端公钥</h1><p>openssl rsa -in client.key -pubout -out client.pem<br>第二步，生成 CA 证书</p><h1 id="生成-CA-私钥"><a href="#生成-CA-私钥" class="headerlink" title="生成 CA 私钥"></a>生成 CA 私钥</h1><p>openssl genrsa -out ca.key 1024</p><h1 id="X-509-Certificate-Signing-Request-CSR-Management"><a href="#X-509-Certificate-Signing-Request-CSR-Management" class="headerlink" title="X.509 Certificate Signing Request (CSR) Management."></a>X.509 Certificate Signing Request (CSR) Management.</h1><p>openssl req -new -key ca.key -out ca.csr</p><h1 id="X-509-Certificate-Data-Management"><a href="#X-509-Certificate-Data-Management" class="headerlink" title="X.509 Certificate Data Management."></a>X.509 Certificate Data Management.</h1><p>openssl x509 -req -in ca.csr -signkey ca.key -out ca.crt<br>在执行第二步时会出现：</p><p>➜ keys openssl req -new -key ca.key -out ca.csr<br>You are about to be asked to enter information that will be incorporated<br>into your certificate request.<br>What you are about to enter is what is called a Distinguished Name or a DN.<br>There are quite a few fields but you can leave some blank<br>For some fields there will be a default value,<br>If you enter ‘.’, the field will be left blank.</p><hr><p>Country Name (2 letter code) [AU]:CN<br>State or Province Name (full name) [Some-State]:Zhejiang<br>Locality Name (eg, city) []:Hangzhou<br>Organization Name (eg, company) [Internet Widgits Pty Ltd]:My CA<br>Organizational Unit Name (eg, section) []:<br>Common Name (e.g. server FQDN or YOUR name) []:localhost<br>Email Address []:<br>注意，这里的 Organization Name (eg, company) [Internet Widgits Pty Ltd]: 后面生成客户端和服务器端证书的时候也需要填写，不要写成一样的！！！可以随意写如：My CA, My Server, My Client。</p><p>然后 Common Name (e.g. server FQDN or YOUR name) []: 这一项，是最后可以访问的域名，我这里为了方便测试，写成 localhost，如果是为了给我的网站生成证书，需要写成 barretlee.com。</p><p>第三步，生成服务器端证书和客户端证书</p><h1 id="服务器端需要向-CA-机构申请签名证书，在申请签名证书之前依然是创建自己的-CSR-文件"><a href="#服务器端需要向-CA-机构申请签名证书，在申请签名证书之前依然是创建自己的-CSR-文件" class="headerlink" title="服务器端需要向 CA 机构申请签名证书，在申请签名证书之前依然是创建自己的 CSR 文件"></a>服务器端需要向 CA 机构申请签名证书，在申请签名证书之前依然是创建自己的 CSR 文件</h1><p>openssl req -new -key server.key -out server.csr</p><h1 id="向自己的-CA-机构申请证书，签名过程需要-CA-的证书和私钥参与，最终颁发一个带有-CA-签名的证书"><a href="#向自己的-CA-机构申请证书，签名过程需要-CA-的证书和私钥参与，最终颁发一个带有-CA-签名的证书" class="headerlink" title="向自己的 CA 机构申请证书，签名过程需要 CA 的证书和私钥参与，最终颁发一个带有 CA 签名的证书"></a>向自己的 CA 机构申请证书，签名过程需要 CA 的证书和私钥参与，最终颁发一个带有 CA 签名的证书</h1><p>openssl x509 -req -CA ca.crt -CAkey ca.key -CAcreateserial -in server.csr -out server.crt</p><h1 id="client-端"><a href="#client-端" class="headerlink" title="client 端"></a>client 端</h1><p>openssl req -new -key client.key -out client.csr</p><h1 id="client-端到-CA-签名"><a href="#client-端到-CA-签名" class="headerlink" title="client 端到 CA 签名"></a>client 端到 CA 签名</h1><p>openssl x509 -req -CA ca.crt -CAkey ca.key -CAcreateserial -in client.csr -out client.crt<br>此时，我们的 keys 文件夹下已经有如下内容了：</p><p>.<br>├── https-client.js<br>├── https-server.js<br>└── keys<br>├── ca.crt<br>├── ca.csr<br>├── ca.key<br>├── ca.pem<br>├── ca.srl<br>├── client.crt<br>├── client.csr<br>├── client.key<br>├── client.pem<br>├── server.crt<br>├── server.csr<br>├── server.key<br>└── server.pem<br>看到上面两个 js 文件了么，我们来跑几个demo。</p><p>HTTPS本地测试<br>服务器代码：</p><p>// file http-server.js<br>var https = require(‘https’);<br>var fs = require(‘fs’);</p><p>var options = {<br>key: fs.readFileSync(‘./keys/server.key’),<br>cert: fs.readFileSync(‘./keys/server.crt’)<br>};</p><p>https.createServer(options, function(req, res) {<br>res.writeHead(200);<br>res.end(‘hello world’);<br>}).listen(8000);<br>短短几行代码就构建了一个简单的 https 服务器，options 将私钥和证书带上。然后利用 curl 测试：</p><p>➜ https curl //localhost:8000<br>curl: (60) SSL certificate problem: Invalid certificate chain<br>More details here: <a href="http://curl.haxx.se/docs/sslcerts.html">http://curl.haxx.se/docs/sslcerts.html</a></p><p>curl performs SSL certificate verification by default, using a “bundle”<br>of Certificate Authority (CA) public keys (CA certs). If the default<br>bundle file isn’t adequate, you can specify an alternate file<br>using the –cacert option.<br>If this HTTPS server uses a certificate signed by a CA represented in<br>the bundle, the certificate verification probably failed due to a<br>problem with the certificate (it might be expired, or the name might<br>not match the domain name in the URL).<br>If you’d like to turn off curl’s verification of the certificate, use<br>the -k (or –insecure) option.<br>当我们直接访问时，curl //localhost:8000 一堆提示，原因是没有经过 CA 认证，添加 -k 参数能够解决这个问题：</p><p>➜ https curl -k //localhost:8000<br>hello world%<br>这样的方式是不安全的，存在我们上面提到的中间人攻击问题。可以搞一个客户端带上 CA 证书试试：</p><p>// file http-client.js<br>var https = require(‘https’);<br>var fs = require(‘fs’);</p><p>var options = {<br>hostname: “localhost”,<br>port: 8000,<br>path: ‘/‘,<br>methed: ‘GET’,<br>key: fs.readFileSync(‘./keys/client.key’),<br>cert: fs.readFileSync(‘./keys/client.crt’),<br>ca: [fs.readFileSync(‘./keys/ca.crt’)]<br>};</p><p>options.agent = new https.Agent(options);</p><p>var req = https.request(options, function(res) {<br>res.setEncoding(‘utf-8’);<br>res.on(‘data’, function(d) {<br>console.log(d);<br>});<br>});<br>req.end();</p><p>req.on(‘error’, function(e) {<br>console.log(e);<br>});<br>先打开服务器 node http-server.js，然后执行</p><p>➜ https node https-client.js<br>hello world<br>如果你的代码没有输出 hello world，说明证书生成的时候存在问题。也可以通过浏览器访问：</p><p>https证书问题</p><p>提示错误：</p><p>此服务器无法证明它是localhost；您计算机的操作系统不信任其安全证书。出现此问题的原因可能是配置有误或您的连接被拦截了。</p><p>原因是浏览器没有 CA 证书，只有 CA 证书，服务器才能够确定，这个用户就是真实的来自 localhost 的访问请求（比如不是代理过来的）。</p><p>你可以点击 继续前往localhost（不安全） 这个链接，相当于执行 curl -k //localhost:8000。如果我们的证书不是自己颁发，而是去靠谱的机构去申请的，那就不会出现这样的问题，因为靠谱机构的证书会放到浏览器中，浏览器会帮我们做很多事情。初次尝试的同学可以去 startssl.com 申请一个免费的证书。</p><p>Nginx 部署<br>ssh 到你的服务器，对 Nginx 做如下配置：</p><p>server_names barretlee.com *.barretlee.com<br>ssl on;<br>ssl_certificate /etc/nginx/ssl/barretlee.com.crt;<br>ssl_certificate_key /etc/nginx/ssl/barretlee.com.key;<br>ssl_protocols TLSv1 TLSv1.1 TLSv1.2;<br>ssl_ciphers “EECDH+ECDSA+AESGCM EECDH+aRSA+AESGCM EECDH+ECDSA+SHA384EECDH+ECDSA+SHA256 EECDH+aRSA+SHA384 EECDH+aRSA+SHA256 EECDH+aRSA+RC4EECDH EDH+aRSA RC4 !aNULL !eNULL !LOW !3DES !MD5 !EXP !PSK !SRP !DSS !MEDIUM”;</p><h1 id="Add-perfect-forward-secrecy"><a href="#Add-perfect-forward-secrecy" class="headerlink" title="Add perfect forward secrecy"></a>Add perfect forward secrecy</h1><p>ssl_prefer_server_ciphers on;<br>add_header Strict-Transport-Security “max-age=31536000; includeSubdomains”;<br>会发现，网页 URL 地址框左边已经多出了一个小绿锁。当然，部署好了之后可以去这个网站看看测评分数，如果分数是 A+，说明你的 HTTPS 的各项配置都还不错，速度也很快。</p><h2 id="使用CA签名过的证书和私钥导出P12格式个人证书"><a href="#使用CA签名过的证书和私钥导出P12格式个人证书" class="headerlink" title="使用CA签名过的证书和私钥导出P12格式个人证书"></a>使用CA签名过的证书和私钥导出P12格式个人证书</h2><p><code>openssl pkcs12 -export -inkey clientkey.pem -in client.crt -out client.p12</code></p><h1 id="启动flask"><a href="#启动flask" class="headerlink" title="启动flask"></a>启动flask</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>,<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;hello world&#x27;</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment">#app.run(host=&#x27;0.0.0.0&#x27;,ssl_context=&#x27;adhoc&#x27;)</span></span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, ssl_context=(</span><br><span class="line">        <span class="string">&quot;server.crt&quot;</span>, <span class="string">&quot;server.key&quot;</span>))</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="requests测试"><a href="#requests测试" class="headerlink" title="requests测试"></a>requests测试</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">rep = requests.get(<span class="string">&#x27;https://127.0.0.1:5000/&#x27;</span>,</span><br><span class="line">                   cert=(<span class="string">&#x27;/Users/k/Desktop/scp/flask/client/client-cert.pem&#x27;</span>, <span class="string">&#x27;/Users/k/Desktop/scp/flask/client/client-key.pem&#x27;</span>), verify=<span class="literal">False</span>)</span><br><span class="line"><span class="built_in">print</span>(rep.text)</span><br><span class="line"><span class="comment"># rep = requests.get(&#x27;https://127.0.0.1:5000/&#x27;,verify=False)</span></span><br><span class="line"><span class="comment"># print(rep.text)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>源自：<br><a href="https://www.cnblogs.com/liyulong1982/p/6106129.html">https://www.cnblogs.com/liyulong1982/p/6106129.html</a><br><a href="https://blog.csdn.net/yannanxiu/article/details/70670225">https://blog.csdn.net/yannanxiu/article/details/70670225</a><br><a href="https://www.jianshu.com/p/5ea147e03255">https://www.jianshu.com/p/5ea147e03255</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> others </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>rust宏展开</title>
      <link href="2019/10/10/rust%E5%AE%8F%E5%B1%95%E5%BC%80/"/>
      <url>2019/10/10/rust%E5%AE%8F%E5%B1%95%E5%BC%80/</url>
      
        <content type="html"><![CDATA[<p>2019年10月10日11:22:15</p><p><code>cargo-expand</code>包可对rust进行宏展开，但是这个特性是基于rust的nightly版本的，所以我们首先需要安装nightly版本的rust：<br><code>Run rustup install nightly</code><br>安装<code>cargo-expand</code>:<br><code>cargo install cargo-expand</code><br>运行：<br><code>rustup run nightly cargo rustc -- -Z unstable-options --pretty=expanded</code></p><p>对指定rust文件进行展开：<br><code>RUSTFMT=./sputnikvm/src/eval/run/flow.rs cargo expand </code></p>]]></content>
      
      
      
        <tags>
            
            <tag> rust </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>openwrt</title>
      <link href="2019/07/18/openwrt/"/>
      <url>2019/07/18/openwrt/</url>
      
        <content type="html"><![CDATA[<ol><li><p>先刷第三方的不死boot，这个相当于手机刷机的”recovery”</p><p><a href="https://www.right.com.cn/forum/thread-161906-1-1.html">https://www.right.com.cn/forum/thread-161906-1-1.html</a></p><p><a href="https://www.right.com.cn/forum/thread-341079-1-1.html">https://www.right.com.cn/forum/thread-341079-1-1.html</a></p></li><li><p>路由断电按reset重启进入uboot，刷入openwrt</p><p><a href="https://openwrt.org/">https://openwrt.org/</a></p><p><a href="https://1drv.ms/u/s!AhImrxG7B6tnj8QYFIHchi1oBphWdg">newifi的openwrt（带支持订阅的ss）</a></p><p>也可以自己编译<a href="https://github.com/coolsnowwolf/lede">https://github.com/coolsnowwolf/lede</a></p></li><li><p>上面的那个openwrt的软件源使用的是国内镜像现在不能用了，更改软件源为官方的（虽然速度慢但是不会挂）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">src/gz openwrt_core http://downloads.openwrt.org/releases/18.06.1/targets/ramips/mt7620/packages</span><br><span class="line">src/gz openwrt_kmods http://downloads.openwrt.org/releases/18.06.1/targets/ramips/mt7620/kmods/4.14.131-1-f908844d5e5aab0a4b27f7d4c77655d0</span><br><span class="line">src/gz openwrt_base http://downloads.openwrt.org/releases/18.06.1/packages/mipsel_24kc/base</span><br><span class="line">src/gz openwrt_luci http://downloads.openwrt.org/releases/18.06.1/packages/mipsel_24kc/luci</span><br><span class="line">src/gz openwrt_packages http://downloads.openwrt.org/releases/18.06.1/packages/mipsel_24kc/packages</span><br><span class="line">src/gz openwrt_routing http://downloads.openwrt.org/releases/18.06.1/packages/mipsel_24kc/routing</span><br><span class="line">src/gz openwrt_telephony http://downloads.openwrt.org/releases/18.06.1/packages/mipsel_24kc/telephony</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> 路由器 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL</title>
      <link href="2019/07/10/MySQL/"/>
      <url>2019/07/10/MySQL/</url>
      
        <content type="html"><![CDATA[<p>MySQL5.7.22数据库安装完后更改密码；</p><p><code>ALTER USER USER() IDENTIFIED BY &#39;12345678&#39;;</code></p>]]></content>
      
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>rust学习02</title>
      <link href="2019/06/19/rust%E5%AD%A6%E4%B9%A002/"/>
      <url>2019/06/19/rust%E5%AD%A6%E4%B9%A002/</url>
      
        <content type="html"><![CDATA[<p><code>cargo</code> 安装指定版本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo install --version 2.0.13 racer</span><br></pre></td></tr></table></figure><h3 id="新建-vector"><a href="#新建-vector" class="headerlink" title="新建 vector"></a>新建 vector</h3><p>为了创建一个新的空 vector，可以调用 <code>Vec::new</code> 函数，如示例 8-1 所示：</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> v: <span class="built_in">Vec</span>&lt;<span class="built_in">i32</span>&gt; = <span class="built_in">Vec</span>::new();</span><br></pre></td></tr></table></figure><p>示例 8-1：新建一个空的 vector 来储存 <code>i32</code> 类型的值</p><p>注意这里我们增加了一个类型注解。因为没有向这个 vector 中插入任何值，Rust 并不知道我们想要储存什么类型的元素。这是一个非常重要的点。vector 是用泛型实现的，第十章会涉及到如何对你自己的类型使用它们。现在，所有你需要知道的就是 <strong><code>Vec</code> 是一个由标准库提供的类型，它可以存放任何类型，而当 <code>Vec</code> 存放某个特定类型时，那个类型位于尖括号中。</strong>在示例 8-1 中，我们告诉 Rust <code>v</code> 这个 <code>Vec</code> 将存放 <code>i32</code> 类型的元素。</p><p>Rust通过impl关键字在struct、enum或者trait对象上实现方法调用语法 (method call syntax)。 关联函数 (associated function) 的第一个参数通常为self参数，有3种变体</p><ul><li>self，允许实现者移动和修改对象，对应的闭包特性为FnOnce。</li><li>&amp;self，既不允许实现者移动对象也不允许修改，对应的闭包特性为Fn。</li><li>&amp;mut self，允许实现者修改对象但不允许移动，对应的闭包特性为FnMut。</li></ul><p>三个在 Rust 程序中被广泛使用的集合：</p><ul><li><em>vector</em> 允许我们一个挨着一个地储存一系列数量可变的值</li><li><strong>字符串</strong>（<em>string</em>）是一个字符的集合。我们之前见过 <code>String</code> 类型，不过在本章我们将深入了解。</li><li><strong>哈希 map</strong>（<em>hash map</em>）允许我们将值与一个特定的键（key）相关联。这是一个叫做 <em>map</em> 的更通用的数据结构的特定实现。</li></ul><p>新的空 vector:</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> v: <span class="built_in">Vec</span>&lt;<span class="built_in">i32</span>&gt; = <span class="built_in">Vec</span>::new();</span><br></pre></td></tr></table></figure><p>使用rust宏vec!来创建一个新的Vec，vec宏能够根据插入的值来推断要存放的类型。</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> v = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br></pre></td></tr></table></figure><p>为了参数化要定义的函数的签名中的类型，我们需要像给函数的值参数起名那样为这类型参数起一个名字。<strong>任何标识符都可以作为类型参数名</strong>。不过选择 <code>T</code> 是因为 Rust 的习惯是让变量名尽量短，通常就只有一个字母，同时 Rust 类型命名规范是骆驼命名法（CamelCase）。<code>T</code> 作为 “type” 的缩写是大部分 Rust 程序员的首选。</p><p>当需要在函数体中使用一个参数时，必须在函数签名中声明这个参数以便编译器能知道函数体中这个名称的意义。同理，当在函数签名中使用一个类型参数时，必须在使用它之前就声明它。，<strong>类型参数声明位于函数名称与参数列表中间的尖括号 <code>&lt;&gt;</code></strong> 。</p><p>rust 关键字 <a href="https://doc.rust-lang.org/book/appendix-01-keywords.html">https://doc.rust-lang.org/book/appendix-01-keywords.html</a></p><p>个人觉得rust里面的单引号<code>：</code>有解释进一步说明的意思，跟随在变量后面。</p><p>名字以叹号结尾， 并且可以像函数一样被调用的语句， 在 Rust中叫作宏。</p><p>“Rust里面的下划线是一个特殊的标识符，在编译器内部它是被特殊处理的。”</p>]]></content>
      
      
      
        <tags>
            
            <tag> rust </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>rust学习01</title>
      <link href="2019/06/06/rust%E5%AD%A6%E4%B9%A001/"/>
      <url>2019/06/06/rust%E5%AD%A6%E4%B9%A001/</url>
      
        <content type="html"><![CDATA[<p>rust在线中文教程：<a href="https://kaisery.github.io/trpl-zh-cn">https://kaisery.github.io/trpl-zh-cn</a></p><p>rust猜数字游戏：</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::io;</span><br><span class="line"><span class="keyword">use</span> std::cmp::Ordering;</span><br><span class="line"><span class="keyword">use</span> rand::Rng;</span><br><span class="line"><span class="keyword">use</span> std::time::Duration;</span><br><span class="line"><span class="keyword">use</span> std::thread::sleep;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>()&#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Guess the number!&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> secret_number = rand::thread_rng().gen_range(<span class="number">1</span>,<span class="number">101</span>);</span><br><span class="line">    <span class="comment">// println!(&quot;The secret number is :&#123;&#125;&quot;,secret_number);</span></span><br><span class="line">    <span class="keyword">loop</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Please input your guess&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> guess = <span class="built_in">String</span>::new();</span><br><span class="line">    io::stdin().read_line(&amp;<span class="keyword">mut</span> guess).expect(<span class="string">&quot;Failed to read line&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> guess: <span class="built_in">u32</span> = <span class="keyword">match</span>  guess.trim().parse()&#123;</span><br><span class="line">        <span class="literal">Ok</span>(num) =&gt; num,</span><br><span class="line">        <span class="literal">Err</span>(_) =&gt; &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;Please input a number!&quot;</span>);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;  </span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;You guessed: &#123;&#125;&quot;</span>,guess);</span><br><span class="line">    <span class="keyword">match</span> guess.cmp(&amp;secret_number)&#123;</span><br><span class="line">        Ordering::Less =&gt; <span class="built_in">println!</span>(<span class="string">&quot;Too small&quot;</span>),</span><br><span class="line">        Ordering::Greater =&gt; <span class="built_in">println!</span>(<span class="string">&quot;Too big&quot;</span>),</span><br><span class="line">        Ordering::Equal =&gt; &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;You win!&quot;</span>);</span><br><span class="line">            sleep(Duration::from_secs(<span class="number">4</span>));<span class="comment">//为了展示效果，防止Windows下运行完程序直接退出</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意：</p><p>1.。在 Rust 中，函数的返回值等同于函数体最后一个表达式的值。使用 <code>return</code> 关键字和指定值，可从函数中提前返回；但大部分函数隐式的返回最后的表达式。</p>]]></content>
      
      
      
        <tags>
            
            <tag> rust </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>从typecho迁移到hexo</title>
      <link href="2019/05/31/%E4%BB%8Etypecho%E8%BF%81%E7%A7%BB%E5%88%B0hexo/"/>
      <url>2019/05/31/%E4%BB%8Etypecho%E8%BF%81%E7%A7%BB%E5%88%B0hexo/</url>
      
        <content type="html"><![CDATA[<p>vps翻墙用的也不多而且延迟比较高，以前总是因为typecho上的博客所以一直断断续续的在用，现在把typecho的博客在mysql中的文章导出为markdown格式从而迁移到hexo。</p><p>下面是代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> codecs</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> torndb</span><br><span class="line"><span class="keyword">import</span> arrow</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_data</span>(<span class="params">db</span>):</span></span><br><span class="line">    <span class="comment"># 创建分类和标签</span></span><br><span class="line">    categories = db.query(<span class="string">&quot;select type, slug, name from typecho_metas&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> cate <span class="keyword">in</span> categories:</span><br><span class="line">        path = <span class="string">&#x27;data/%s&#x27;</span> % cate.slug</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(path):</span><br><span class="line">            os.makedirs(path)</span><br><span class="line">        f = codecs.<span class="built_in">open</span>(<span class="string">&#x27;%s/index.md&#x27;</span> % path, <span class="string">&#x27;w&#x27;</span>, <span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">        f.write(<span class="string">&quot;title: %s\n&quot;</span> % cate.slug)</span><br><span class="line">        f.write(<span class="string">&quot;date: %s\n&quot;</span> % arrow.now().<span class="built_in">format</span>(<span class="string">&#x27;YYYY-MM-DD HH:mm:ss&#x27;</span>))</span><br><span class="line">        <span class="comment"># 区分分类和标签</span></span><br><span class="line">        <span class="keyword">if</span> cate.<span class="built_in">type</span> == <span class="string">&#x27;category&#x27;</span>:</span><br><span class="line">            f.write(<span class="string">&#x27;type: &quot;categories&quot;\n&#x27;</span>)</span><br><span class="line">        <span class="keyword">elif</span> cate.<span class="built_in">type</span> == <span class="string">&#x27;tags&#x27;</span>:</span><br><span class="line">            f.write(<span class="string">&#x27;type: &quot;tags&quot;\n&#x27;</span>)</span><br><span class="line">        <span class="comment"># 禁止评论</span></span><br><span class="line">        f.write(<span class="string">&quot;comments: true\n&quot;</span>)</span><br><span class="line">        f.write(<span class="string">&quot;---\n&quot;</span>)</span><br><span class="line">        f.close()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建文章</span></span><br><span class="line">    entries = db.query(<span class="string">&quot;select cid, title, slug, text, created from typecho_contents where type=&#x27;post&#x27;&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> e <span class="keyword">in</span> entries:</span><br><span class="line">        title = e.title</span><br><span class="line">        urlname = e.slug</span><br><span class="line">        <span class="built_in">print</span>(title)</span><br><span class="line">        content = <span class="built_in">str</span>(e.text).replace(<span class="string">&#x27;&lt;!--markdown--&gt;&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        tags = []</span><br><span class="line">        category = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="comment"># 找出文章的tag及category</span></span><br><span class="line">        metas = db.query(</span><br><span class="line">            <span class="string">&quot;select type, name, slug from `typecho_relationships` ts, typecho_metas tm where tm.mid = ts.mid and ts.cid = %s&quot;</span>,</span><br><span class="line">            e.cid)</span><br><span class="line">        <span class="keyword">for</span> m <span class="keyword">in</span> metas:</span><br><span class="line">            <span class="keyword">if</span> m.<span class="built_in">type</span> == <span class="string">&#x27;tag&#x27;</span>:</span><br><span class="line">                tags.append(m.name)</span><br><span class="line">            <span class="keyword">if</span> m.<span class="built_in">type</span> == <span class="string">&#x27;category&#x27;</span>:</span><br><span class="line">                category = m.slug</span><br><span class="line">        path = <span class="string">&#x27;data/_posts/&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(path):</span><br><span class="line">            os.makedirs(path)</span><br><span class="line">        f = codecs.<span class="built_in">open</span>(<span class="string">r&quot;%s%s.md&quot;</span> % (path,title), <span class="string">&#x27;w+&#x27;</span>, <span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">        f.write(<span class="string">&quot;---\n&quot;</span>)</span><br><span class="line">        f.write(<span class="string">&quot;title: %s\n&quot;</span> % title)</span><br><span class="line">        f.write(<span class="string">&quot;date: %s\n&quot;</span> % arrow.get(e.created).<span class="built_in">format</span>(<span class="string">&#x27;YYYY-MM-DD HH:mm:ss&#x27;</span>))</span><br><span class="line">        f.write(<span class="string">&quot;categories: %s\n&quot;</span> % category)</span><br><span class="line">        f.write(<span class="string">&quot;tags: [%s]\n&quot;</span> % <span class="string">&#x27;,&#x27;</span>.join(tags))</span><br><span class="line">        f.write(<span class="string">&quot;urlname: %s\n&quot;</span> % urlname)</span><br><span class="line">        f.write(<span class="string">&quot;---\n&quot;</span>)</span><br><span class="line">        <span class="comment">#:import pdb; pdb.set_trace()</span></span><br><span class="line">        f.write(content)</span><br><span class="line">        f.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    <span class="comment"># 把数据库连接信息</span></span><br><span class="line">    db = torndb.Connection(host=<span class="string">&quot;&quot;</span>, database=<span class="string">&quot;typecho&quot;</span>, user=<span class="string">&quot;root&quot;</span>, password=<span class="string">&quot;&quot;</span>)</span><br><span class="line">    create_data(db)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> MySQL </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>时光机备忘</title>
      <link href="2019/05/31/%E6%97%B6%E5%85%89%E6%9C%BA%E5%A4%87%E5%BF%98/"/>
      <url>2019/05/31/%E6%97%B6%E5%85%89%E6%9C%BA%E5%A4%87%E5%BF%98/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="6691d7c94e01a71a361156ab9738fe6d999791d9a0a563718c478794d4f28cbd">13be4343faa627d29f41a5a766ab3a15878c3f7034f2941c485606085b160a8ef7899d97ae5bc2d8c827b7bda8e9acfbc5db6e888f7d7ec5f47b7ee2d559c5b2f835e13fa89ee3d091505f6d5bd3a8a147b95a2b38308b330f37084e6a7d1a27f65d02b5d87a42ab5d6a4008d47a967681295835d1baee1779150848a8d68dc75efae2fadf7a23a8d2337d4ba2971f50675f1cd48bc0ef9f404aa86a3349fed058ee8ee24efd51b969dc5b4a87a310d354bfd271ac6d9004e450121929892115206cb44b7818ba1d0a65935179aee21c904a45ab29bc2655f693c42d5f0801929abca59b8421d93af8a1bb5dc64fc72efca7e97f03a5da3220d12a8c248e9393764271d89549aaa228d7cf2b542c95a3b7522a391f38c822dbffe960606a7677c8547b928d55b708a47bc54a9f5345d3601028ae6362ae85b837b5f131b10401ea7bbdd038f0b51675eddbdbc3226a4111846f7aa6f0690de59667ea69257b02ea8b4614a296195685628eedf8eca7984d99945e3ab392f5f8bc53534f2e08519d63f3586d789b22bcd8e710e7b48540263bdc8042bba8873c926049b352b79dde659675cdefa7f17e78922025efabfec44244564048b7188d6d4472b22ac0beb1f7076511858cdf825c77f3ab58beffa5e5770c7f221bb8c0d785cc1e70a9e0ff7a028d95cc22c3e52bfa74ebd1346cd5818f7c7ebad16e36a78341aefc731ac5bc654c032bf3b811632691773d9e02c403f1710e4128ca08cd297d9e25b24c5eeca8af203a8823272acd13ada90eefcb512c642379c62b28424776ed7c00a532d5433cac2bb0dc635cdbfb6f7084487ba22f914aa4bfe9d06c7fcde0436410c61d25c1a5c380cef2ed9c4e7d481c63c83371aa13405e39a40358a8d8a9b5a22c15177968a6acd3f097d9afa456167faacb6a24f42f1d4739b57d83051d877a7f555c66dc481b8820490464cbfc3a9257f4226381e0e45017e0c67a5ebe668b9dff69f2a7d53386b82f984b220a222ed524b5e7068745e7720337b6572817cdb18b9a1425918e396b47057851b6a53cc2019c1d63fd5de24b2295503dc52ad3cd7a7cf79c64928b368222c2a6b3a1f49007ba433f64f15fad4bacb6be40315f6077b5092652ecc86cf12bcde94fb1fde5344541756a7a8a26e17c4ca53ef98226712cfc3c6f15a1fa521ef65deebc967086e8dc38c175a70d49a2409d5e6094a0de3632fd5e599ad22e6d31547c5239ab7510c8079a10e5457aa85cce825a562361c663c19dc509c1b9b0e0827e5985ac3dd163d6c974728c092aa49cf83f09836764e37051c61329bab26e49ff4524a60530b1a92e986f386c3f5e9654e9fd16ded412aae1af47f904991edc664aae0a37dfb8698bf97e72cdf054254ef3b3ed46505bfabdde420c2ebeceed50128c84df0816cc784914064ee8cf34a9c4a35b5bf2702f22297f5aa7b33fd4799296b40cd25af575786d1fd74bac4052b9c0a2a53b9c3a9f88ae87607a7b5043ffa53902889804f684f0ca023c67f72f2bd005a629dce96da2689981b5a762824034554cfa1d8847979a556bfa0a863df21452011d4565af8b808a21e6ef052dfd2cda8530a4967c654d6e05b079cb8327b52de2a657a74e9258fc37597ddd4358d8c666385000b20dde6d48ca4f1768155a5dc452cc28d5a6107325d8ea7c3b137bfbec7f4e24465d22ec1ae297f07549868e1ba658068d4ae0531d9f3b6228f23640e8a2a13186f022c667167395fd69f74a4d263d9f809ce1c697dfd2b13bc6960b88fc86e2aedbeb751002fc881ae53d063f7c8bdf5786a647caf5d83a65a6fbb6675ff768b6b5e60425ec74645356fa2d6a2ed2f84b6fea7d6ee5ea3c019f061f158b809bd94d62cc06a9542b146c33662e710279c9cee158dd424e8fe3a87589f46025520f1a46d741060c6702e10177d51a6e9f589e74351934cc3bfdae5e6c3dabfd19b85627b7797f7ab13f2b1a9dd50608d26bf8f44c943b333c193f8f3933930b565fd11ea1a5488289cd0180532c1b48668bd0da606d9498a8acbe363748a9b76d5fcc737080dd068ec97e1d1a9623e391830c1aa421e9d56e0b9314ca2c40fb6707d64e86f3bbf0322e2659b137de9dbd2a3f51c02f8d8c21a7b06ae71a46844470a6a12e94742e181125b8c753565f36fa6e816a9f4177af00d57cd42e9e20416b5b7a6e27a1d0e9bc3813afa045a0b31a6013434d5110042a285ef83c6926e9228032ec14137f7bddd80691bb00a05446b6c246440f625b7901774925e82a1f1b91329b7bda9d8548bbb7698eb15a2ff7ca7d0c12c8073ca84e2dd98c69823eda4e09eec74017f23344b76251f0dcc6bb1fba5bc1432f8e22e742d40aabd3d486a25c06522b18ddf7ee11ea32999cf5e2d73ea86b938e3e5997dec048400ae265bc06e2592aaaa62d8d90318b694f3f37d1b490f79bf1fb51432249217203531ea42181cea3dcdca8a3fc559ff215e863b7835cb602bd5d1d7abee2b61b8e57cd91624025ace170bc6c791675aeff0f70569612f8ccce775dde1616c7bd08d0a10b829fc63980b97b993f6c6e33832468e64fe6a381683f08c13d6429458b5dbd1c7f8d0a3395b278c0db58694e2745536f5eaea204cba383b6cd48a0089494c95e455863b72f7a75df97a0fe6249ed078b0efb62ac56ce9b05734e20cfa35097fbd223ecd4b5689cf5bf3a20420e89b795c2ecca503a8169faa48792106358bf632e37bd35c955a7390e62e5965fcc396c5b66bfb7f337da5b5e0f7b876ce8fbffaa936013d1f543672d09d30ba05ca5380f60cf531f33fcc71de300de1f903bcc4e8c386f941cde049a92d0cde981b31ded576706a3fba192ecbc57166428b07af570b33ac6537203bbf3e53989f74a66fb36435509fe098539e3d05df5271da7ca1bb0785ddc35a273406a863e650a23a6a38c896e3d69d2e24180ff60240b89843b70d1190a2bd9f56c57148f790b4de3b07fce5c33e806de61f0b4bd1347ecf16e6c5350d2675d6238209b61530f1fc5a1ffc9e9d31d44e9e830421239f0c66a43294706e0fd06cfa7cb901c9b0a2de5b36e8676d8fb6972cf8aa232ee6dde49d54a0a8d5842a3833081a113009b3107f7b3712c49b68523c05584304d07ecc999c0b6c991eb0441d025646c86d6086980edf4f1bfb1be71acb6f294b15799b54a99c0fe336f4b8c8212e3be97e1911582a1fd536323a74af2ef5ba1d3f544035b6fd2f15b5dd5295b462b4eb390ad4282348d309f0203f95a4aa3be5cd279e0236e2c6e1c361ff1570f722a35c317c348f6b070c5e5ef980ee1709ed9f8445f8c95173a838ada95a1b8f708cfa21af161bfe7ed43d7391909f55fc121dbaf6b46d6425d60ff432957259c73c3afc06042eb95e7cbd75f3a8cb7706e4b3c1e91fde46d93c1143691ada551e2710171d9a5058e10b5936d1d519821050c657a2b1f8f9c5d7444e9c55577bd09df5346cf69d291bea441b93569022242d85f55284d0f159e41fd70cf675f30145ed9505b0df31822751752b5083be3975c3d0148ca129b5e705c25dc</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Hey, password is required here.</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      
        <tags>
            
            <tag> maomaomao </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mac下的Python2的mysql模块</title>
      <link href="2019/05/30/mac%E4%B8%8B%E7%9A%84Python2%E7%9A%84mysql%E6%A8%A1%E5%9D%97/"/>
      <url>2019/05/30/mac%E4%B8%8B%E7%9A%84Python2%E7%9A%84mysql%E6%A8%A1%E5%9D%97/</url>
      
        <content type="html"><![CDATA[<h1 id="mac下的Python2的mysql模块"><a href="#mac下的Python2的mysql模块" class="headerlink" title="mac下的Python2的mysql模块"></a>mac下的Python2的mysql模块</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">brew install mysql</span><br><span class="line">brew unlink mysql</span><br><span class="line">brew install mysql-connector-c</span><br><span class="line">sed -i -e <span class="string">&#x27;s/libs=&quot;$libs -l &quot;/libs=&quot;$libs -lmysqlclient -lssl -lcrypto&quot;/g&#x27;</span> /usr/local/<span class="built_in">bin</span>/mysql_config</span><br><span class="line">pip install MySQL-python</span><br><span class="line">brew unlink mysql-connector-c</span><br><span class="line">brew link --overwrite mysql</span><br></pre></td></tr></table></figure><ol><li><p><code>brew unlink mysql # only if installed, causes the next step to fail</code></p></li><li><p><code>brew install mysql-connector-c</code></p></li><li><p>locate <code>mysql_config</code> file with <code>which (mysql_config)</code></p></li><li><p>edit the <code>mysql_config</code> file, under <code># Create options</code> change this:</p><p> <code>libs=&quot;$libs -l &quot;</code></p><p> to this:</p><p> <code>libs=&quot;$libs -lmysqlclient -lssl -lcrypto&quot;</code></p><p> if using vim, <code>:wq!</code> to save the read-only file</p></li><li><p>Now the install should run successfully</p><p> <code>pip install mysqlclient</code></p></li><li><p>Adding this separately, as it’s similar but not directly related to the initial question</p><p> <code>pip install MySQL-python</code></p></li><li><p>Fix <code>mysql</code> brew formula, if it was unlinked in the first step.</p><p> <code>brew unlink mysql-connector-c</code></p><p> <code>brew link mysql</code></p></li></ol>]]></content>
      
      
      <categories>
          
          <category> mac </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> mac </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>homebrew 安装mysql</title>
      <link href="2019/05/30/homebrew%20%E5%AE%89%E8%A3%85mysql/"/>
      <url>2019/05/30/homebrew%20%E5%AE%89%E8%A3%85mysql/</url>
      
        <content type="html"><![CDATA[<h1 id="homebrew-安装mysql"><a href="#homebrew-安装mysql" class="headerlink" title="homebrew 安装mysql"></a>homebrew 安装mysql</h1><ol><li><p>安装mysql</p><p> <code>brew install mysql</code></p></li><li><p>启动mysql服务</p><p> <code>mysql.server start</code></p></li><li><p>设置mysql(密码等)</p><p> <code>mysql_secure_installation</code></p></li></ol>]]></content>
      
      
      <categories>
          
          <category> mac </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mac </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>paramiko 执行sudo</title>
      <link href="2019/05/28/paramiko-%E6%89%A7%E8%A1%8Csudo/"/>
      <url>2019/05/28/paramiko-%E6%89%A7%E8%A1%8Csudo/</url>
      
        <content type="html"><![CDATA[<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> paramiko</span><br><span class="line">ssh = paramiko.SSHClient()</span><br><span class="line">    ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())</span><br><span class="line">host_ips = <span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line">username = <span class="string">&quot;admin&quot;</span></span><br><span class="line">password = <span class="string">&quot;admin&quot;</span></span><br><span class="line">port = <span class="number">22</span></span><br><span class="line">ssh.connect(host_ip,port,username,password)</span><br><span class="line">stdin, stdout, stderr = ssh.exec_command(<span class="string">&quot;sudo -S -p &#x27;&#x27; service redis restart;&quot;</span>)</span><br><span class="line"><span class="comment">#stdout.read()可以获取输出内容</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>注意执行带有 <code>sudo</code>的 <code>ssh.exec_command()</code>时需要在命令前加 <code>sudo -S -p &#39;&#39; </code> </p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>小可爱学Python01</title>
      <link href="2019/05/27/%E5%B0%8F%E5%8F%AF%E7%88%B1%E5%AD%A6Python01/"/>
      <url>2019/05/27/%E5%B0%8F%E5%8F%AF%E7%88%B1%E5%AD%A6Python01/</url>
      
        <content type="html"><![CDATA[<p>关于Python这门语言网上很多啰啰嗦嗦的一大堆。虽然小可爱你对它还不太了解，不过我并不打算跟你扯这些。（😀）编程能做的事情很多，我找了一个简单对你还算有趣的来作为示例，你可能不是很理解，但是带着兴趣和疑问才会有继续下去的想法。<br>这篇文章作为小可爱入门Python的第一篇，一共分为两大部分。</p><ol><li>安装Python</li><li>使用Python获取表情包</li></ol><h2 id="安装Python"><a href="#安装Python" class="headerlink" title="安装Python"></a>安装Python</h2><p>下载最新版本的Python安装包<br><a href="https://www.python.org/ftp/python/3.7.3/python-3.7.3-amd64.exe">https://www.python.org/ftp/python/3.7.3/python-3.7.3-amd64.exe</a></p><p>然后像安装软件一样正常安装就行了，但是特别注意有个地方需要打钩（默认是不打勾的）<br><img src="http://ww1.sinaimg.cn/large/6cf740f6ly1g3g00uphe4j20ho0akmxt.jpg"></p><p>你看到的应该是Python3.7。</p><p>安装完成之后此时你的电脑就能用Python了。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>你好呀，小可爱！</title>
      <link href="2019/04/02/%E4%BD%A0%E5%A5%BD%E5%91%80%EF%BC%8C%E5%B0%8F%E5%8F%AF%E7%88%B1%EF%BC%81/"/>
      <url>2019/04/02/%E4%BD%A0%E5%A5%BD%E5%91%80%EF%BC%8C%E5%B0%8F%E5%8F%AF%E7%88%B1%EF%BC%81/</url>
      
        <content type="html"><![CDATA[<h1 id="你好呀，小可爱！"><a href="#你好呀，小可爱！" class="headerlink" title="你好呀，小可爱！"></a><strong>你好呀，小可爱！</strong></h1><span id="more"></span><p><img src="http://ww1.sinaimg.cn/large/6cf740f6gy1g1oe3u1558j20i210iju8.jpg"></p>]]></content>
      
      
      <categories>
          
          <category> 她 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>python中文文档阅读笔记</title>
      <link href="2019/04/02/python%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/"/>
      <url>2019/04/02/python%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<p>当在序列中循环时，用 enumerate() 函数可以将索引位置和其对应的值同时取出</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> i, v <span class="keyword">in</span> <span class="built_in">enumerate</span>([<span class="string">&#x27;tic&#x27;</span>, <span class="string">&#x27;tac&#x27;</span>, <span class="string">&#x27;toe&#x27;</span>]):</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(i, v)</span><br><span class="line">...</span><br><span class="line"><span class="number">0</span> tic</span><br><span class="line"><span class="number">1</span> tac</span><br><span class="line"><span class="number">2</span> toe</span><br></pre></td></tr></table></figure><p>5.1.2. 列表作为队列使用¶<br>列表也可以用作队列，其中先添加的元素被最先取出 (“先进先出”)；然而列表用作这个目的相当低效。因为在列表的末尾添加和弹出元素非常快，但是在列表的开头插入或弹出元素却很慢 (因为所有的其他元素都必须移动一位)。</p><p>若要实现一个队列， collections.deque 被设计用于快速地从两端操作。例如</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>queue = deque([<span class="string">&quot;Eric&quot;</span>, <span class="string">&quot;John&quot;</span>, <span class="string">&quot;Michael&quot;</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>queue.append(<span class="string">&quot;Terry&quot;</span>)           <span class="comment"># Terry arrives</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>queue.append(<span class="string">&quot;Graham&quot;</span>)          <span class="comment"># Graham arrives</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>queue.popleft()                 <span class="comment"># The first to arrive now leaves</span></span><br><span class="line"><span class="string">&#x27;Eric&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>queue.popleft()                 <span class="comment"># The second to arrive now leaves</span></span><br><span class="line"><span class="string">&#x27;John&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>queue                           <span class="comment"># Remaining queue in order of arrival</span></span><br><span class="line">deque([<span class="string">&#x27;Michael&#x27;</span>, <span class="string">&#x27;Terry&#x27;</span>, <span class="string">&#x27;Graham&#x27;</span>])</span><br></pre></td></tr></table></figure><p>比较操作可以传递。例如 a &lt; b == c 会校验是否 a 小于 b 并且 b 等于 c。</p><p>花括号或 set() 函数可以用来创建集合。注意：要创建一个空集合你只能用 set() 而不能用 {}，因为后者是创建一个空字典，这种数据结构我们会在下一节进行讨论。</p><p>以下是一些简单的示例：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>basket = &#123;<span class="string">&#x27;apple&#x27;</span>, <span class="string">&#x27;orange&#x27;</span>, <span class="string">&#x27;apple&#x27;</span>, <span class="string">&#x27;pear&#x27;</span>, <span class="string">&#x27;orange&#x27;</span>, <span class="string">&#x27;banana&#x27;</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(basket)                      <span class="comment"># show that duplicates have been removed</span></span><br><span class="line">&#123;<span class="string">&#x27;orange&#x27;</span>, <span class="string">&#x27;banana&#x27;</span>, <span class="string">&#x27;pear&#x27;</span>, <span class="string">&#x27;apple&#x27;</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;orange&#x27;</span> <span class="keyword">in</span> basket                 <span class="comment"># fast membership testing</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;crabgrass&#x27;</span> <span class="keyword">in</span> basket</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Demonstrate set operations on unique letters from two words</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = <span class="built_in">set</span>(<span class="string">&#x27;abracadabra&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = <span class="built_in">set</span>(<span class="string">&#x27;alacazam&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a                                  <span class="comment"># unique letters in a</span></span><br><span class="line">&#123;<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a - b                              <span class="comment"># letters in a but not in b</span></span><br><span class="line">&#123;<span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;b&#x27;</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a | b                              <span class="comment"># letters in a or b or both</span></span><br><span class="line">&#123;<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;z&#x27;</span>, <span class="string">&#x27;l&#x27;</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a &amp; b                              <span class="comment"># letters in both a and b</span></span><br><span class="line">&#123;<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a ^ b                              <span class="comment"># letters in a or b but not both</span></span><br><span class="line">&#123;<span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;z&#x27;</span>, <span class="string">&#x27;l&#x27;</span>&#125;</span><br><span class="line">类似于 列表推导式，集合也支持推导式形式</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = &#123;x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="string">&#x27;abracadabra&#x27;</span> <span class="keyword">if</span> x <span class="keyword">not</span> <span class="keyword">in</span> <span class="string">&#x27;abc&#x27;</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a</span><br><span class="line">&#123;<span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;d&#x27;</span>&#125;</span><br></pre></td></tr></table></figure><p>布尔运算符 and 和 or 也被成为 短路 运算符：它们的参数从左至右解析，一旦可以确定结果解析就会停止。例如，如果 A 和 C 为真而 B 为假，那么 A and B and C 不会解析 C。当作用于普通值而非布尔值时，短路操作符的返回值通常是最后一个变量。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>string1, string2, string3 = <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;Trondheim&#x27;</span>, <span class="string">&#x27;Hammer Dance&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>string1 <span class="keyword">or</span> string2</span><br><span class="line"><span class="string">&#x27;Trondheim&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>string3 <span class="keyword">or</span> string2</span><br><span class="line"><span class="string">&#x27;Hammer Dance&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>string2 <span class="keyword">or</span> string3</span><br><span class="line"><span class="string">&#x27;Trondheim&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>string1 <span class="keyword">or</span> string2 <span class="keyword">or</span> string3</span><br><span class="line"><span class="string">&#x27;Trondheim&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br></pre></td></tr></table></figure><p>格式化字符串字面值 （常简称为 f-字符串）能让你在字符串前加上 f 和 F 并将表达式写成 {expression} 来在字符串中包含 Python 表达式的值。</p><p>可选的格式说明符可以跟在表达式后面。这样可以更好地控制值的格式化方式。以下示例将pi舍入到小数点后三位:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> math</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="string">f&#x27;The value of pi is approximately <span class="subst">&#123;math.pi:<span class="number">.3</span>f&#125;</span>.&#x27;</span>)</span><br><span class="line">The value of pi <span class="keyword">is</span> approximately <span class="number">3.142</span>.</span><br></pre></td></tr></table></figure><p>在 ‘:’ 后传递一个整数可以让该字段成为最小字符宽度。这在使列对齐时很有用。:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>table = &#123;<span class="string">&#x27;Sjoerd&#x27;</span>: <span class="number">4127</span>, <span class="string">&#x27;Jack&#x27;</span>: <span class="number">4098</span>, <span class="string">&#x27;Dcab&#x27;</span>: <span class="number">7678</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> name, phone <span class="keyword">in</span> table.items():</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;name:<span class="number">10</span>&#125;</span> ==&gt; <span class="subst">&#123;phone:10d&#125;</span>&#x27;</span>)</span><br><span class="line">...</span><br><span class="line">Sjoerd     ==&gt;       4127</span><br><span class="line">Jack       ==&gt;       4098</span><br><span class="line">Dcab       ==&gt;       7678</span><br></pre></td></tr></table></figure><p>其他的修饰符可用于在格式化之前转化值。 ‘!a’ 应用 ascii() ，’!s’ 应用 str()，还有 ‘!r’ 应用 repr():</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>animals = <span class="string">&#x27;eels&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="string">f&#x27;My hovercraft is full of <span class="subst">&#123;animals&#125;</span>.&#x27;</span>)</span><br><span class="line">My hovercraft <span class="keyword">is</span> full of eels.</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="string">f&#x27;My hovercraft is full of <span class="subst">&#123;animals!r&#125;</span>.&#x27;</span>)</span><br><span class="line">My hovercraft <span class="keyword">is</span> full of <span class="string">&#x27;eels&#x27;</span>.</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> default </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>iterm2</title>
      <link href="2018/12/13/iterm2/"/>
      <url>2018/12/13/iterm2/</url>
      
        <content type="html"><![CDATA[<h1 id="iterm2的美化"><a href="#iterm2的美化" class="headerlink" title="iterm2的美化"></a>iterm2的美化</h1><blockquote><p><a href="https://www.cnblogs.com/soyxiaobi/p/9695931.html">https://www.cnblogs.com/soyxiaobi/p/9695931.html</a></p></blockquote><h1 id="iterm2实现上传下载"><a href="#iterm2实现上传下载" class="headerlink" title="iterm2实现上传下载"></a>iterm2实现上传下载</h1><h2 id="安装lrzsz"><a href="#安装lrzsz" class="headerlink" title="安装lrzsz"></a>安装lrzsz</h2><p><code>brew install lrzsz</code></p><h2 id="下载zmoden脚本"><a href="#下载zmoden脚本" class="headerlink" title="下载zmoden脚本"></a>下载zmoden脚本</h2><p>在<a href="https://github.com/mmastrac/iterm2-zmodem%E4%B8%8A%E5%B0%86iterm2-send-zmodem.sh">https://github.com/mmastrac/iterm2-zmodem上将iterm2-send-zmodem.sh</a> 和 iterm2-recv-zmodem.sh脚本下载下来并放到/usr/local/bin/目录下，注意赋予脚本执行的权限</p><h2 id="配置iterm2-Trigger"><a href="#配置iterm2-Trigger" class="headerlink" title="配置iterm2 Trigger"></a>配置iterm2 Trigger</h2><p>打开iterm2 ——  同时按 command和,键 —–》 Profiles ——》  Default —–》 Advanced —–》 Triggers的Edit按钮，在弹出的界面配置以下参数</p><pre><code>Regular expression:\*\*B0100Action: Run Silent CoprocessParameters: /usr/local/bin/iterm2-send-zmodem.shRegular expression:\*\*B00000000000000Action: Run Silent CoprocessParameters: /usr/local/bin/iterm2-recv-zmodem.sh</code></pre>]]></content>
      
      
      <categories>
          
          <category> Mac </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>homebrew的安装与卸载</title>
      <link href="2018/12/13/homebrew%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E5%8D%B8%E8%BD%BD/"/>
      <url>2018/12/13/homebrew%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E5%8D%B8%E8%BD%BD/</url>
      
        <content type="html"><![CDATA[<h1 id="brew的安装"><a href="#brew的安装" class="headerlink" title="brew的安装"></a>brew的安装</h1><pre><code>/usr/bin/ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;</code></pre><h1 id="brew的卸载"><a href="#brew的卸载" class="headerlink" title="brew的卸载"></a>brew的卸载</h1><pre><code>/usr/bin/ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/uninstall)&quot;</code></pre><h2 id="homebrew-cask的安装"><a href="#homebrew-cask的安装" class="headerlink" title="homebrew cask的安装"></a>homebrew cask的安装</h2><pre><code>brew tap phinze/homebrew-caskbrew install brew-cask</code></pre><h2 id="homebrew-cask的卸载"><a href="#homebrew-cask的卸载" class="headerlink" title="homebrew cask的卸载"></a>homebrew cask的卸载</h2><p><code>brew install brew-cask</code></p><h2 id="可视化homebrew安装工具"><a href="#可视化homebrew安装工具" class="headerlink" title="可视化homebrew安装工具"></a>可视化homebrew安装工具</h2><p><code>brew cask install cakebrew</code></p><h2 id="图形化管理Homebrew安装的服务软件"><a href="#图形化管理Homebrew安装的服务软件" class="headerlink" title="图形化管理Homebrew安装的服务软件"></a>图形化管理Homebrew安装的服务软件</h2><p><code>brew tap jimbojsb/launchrocket</code><br><code>brew cask install launchrocket</code></p><h2 id="终端工具"><a href="#终端工具" class="headerlink" title="终端工具"></a>终端工具</h2><p><code>brew cask install iterm2</code><br><code>//配色https://github.com/mbadolato/iTerm2-Color-Schemes</code></p><h2 id="shadowsocks客户端"><a href="#shadowsocks客户端" class="headerlink" title="shadowsocks客户端"></a>shadowsocks客户端</h2><p><code>brew cask install shadowsocksx-ng</code></p><h2 id="perl升级"><a href="#perl升级" class="headerlink" title="perl升级"></a>perl升级</h2><p><code>sudo perl -MCPAN -e &#39;CPAN::Shell-&gt;notest(install =&gt; CPAN::Shell-&gt;r)&#39;</code></p>]]></content>
      
      
      <categories>
          
          <category> Mac </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>努力，觉醒，奋起</title>
      <link href="2018/11/23/%E5%8A%AA%E5%8A%9B%EF%BC%8C%E8%A7%89%E9%86%92%EF%BC%8C%E5%A5%8B%E8%B5%B7/"/>
      <url>2018/11/23/%E5%8A%AA%E5%8A%9B%EF%BC%8C%E8%A7%89%E9%86%92%EF%BC%8C%E5%A5%8B%E8%B5%B7/</url>
      
        <content type="html"><![CDATA[<p>失联了半年的张君，今天一大早给我发来微信。扎眼的两句话：</p><p>克仔，你宽裕吗，想借你一点，过年的时候给你。哎。</p><p>不方便就算了</p><p>微信的上一条消息是十一月三号的时候我发给他的，问我这位老朋友在干啥呢？没回。看到借钱的消息，我又想起两三年前他借我几百块钱（好像是两百我记不清了）。也一直没还，我也没指望他还。因为我知道他没钱，是的他一向没钱。印象中他中间提起过一次还钱的事情。那时候他和女朋友关系不融洽怕是要吹了，他可怜巴巴的跟我说：世克，我俩真的分手了我就有钱了，到时候我就可以还你钱了。这几百块钱对我来说没什么影响，我也没指望他还，但是讲道理，我还是挺希望他分的。</p><p>张君是从高中开始谈恋爱的，也就是现在的女朋友。姑且称她为小S吧。我和她女朋友,除了来自张君的”杰作” ——12306的火车站联系人，——淘宝的收件人地址，再没什么交集。但是大学室友三年还是知道些关于他们的事情。他们之间的感情细节我知道的十分有限，现在想起来脑海中第一个浮出来的大概就是张君的电话了。张君女友在长沙，而我们在郑州，刚入大学那会，学校的校园网都包给了联通，那时候办一张联通电话卡送100小时的时长，之后每消费一块钱送几个小时(好像是4个，我记不大清了)。我刚入大学就意识到网络的刚需，喊上他我俩每人办了一张。后来没过多久，尽管彼时我手上已经有了比三星i9100配置还高的泛泰a800s。但是为了用200块，得到那部刷机小王子——中兴n880e(自身安卓，但是可以刷windowsphone7，7.5，7.8，现在再说起来还是两眼放光。)签了一个电信的合约，自此宿舍上网的重担就都落到了张君的电话卡之上。张君也不负众望，每月打一百多的电话费，使得我们每月的上网时长超出了30*24小时。当然偶尔他也有没钱打电话的时候，此时我们宿舍也会为了上网对钱给他充话费。张君每个月那漫长的电话和小S说了什么我无从得知,除了他焦躁不安的时候。张君的女朋友经常闹分手，继而将其电话，短信，QQ拉黑（那时候还不怎么玩微信）。每次张君都是一个打不死的小强，不厌其烦的打他女友的电话，或是找他女友的闺蜜。这种事情发生的实在是太多了，我终究忍不住问他：这样一次次的，你都能受得了吗？张君神色黯然：”可能下一次我就受不了了吧，我也到了极限了”。可是我知道下次还有下次。张君在我上铺，早几年我因为失恋的而在他面前眼眶湿润的时候，当他面问他：以前夜深人静的时候，他是不是在床上隐隐啜泣。他没有说话。难以想象一个笑起来像个2b的人也会这样。所以我在基本上对其女友一无所知的情况下，依然留下了不好的印象。</p><p>后来又听到张君说起过他和女友之间的故事。一开始张君追的小S，但是小S心里一直有另外一个男生。（是的现实就是这么扯淡）后来张君更是从小S发出的漂流瓶里看到字里行间满满的对那个已经有了女友的男生的情意，和不甘。后来男生结婚，小S哭的痛哭流涕。男生结婚的时候，张君和小S应该已经好了两三年了吧。听到张君说起这个，我愤而问道：这你他妈的都能忍，谈着还有啥劲。张君说道，我一开始也很绝望，可是后来我看到小S的日记。张君和我说了日记的内容，我已经忘记了细节，不过我记得那是小S写的一篇篇关于他的日记。张君觉得小S心里有他。</p><p>张君家境当时在我们宿舍应该是最好的了吧，但是小S家境比他好。平日攒钱送礼物都是常事，除了买东西的钱，还得攒去长沙的路费。而他自己的消费，除了电话打得比我们奢侈以外，恐怕吃穿上面他是最省的一个了，即使这样，他依然常年没钱。宿舍除了我还有W君借他的钱他也一直没还。</p><p>小S毕业留在了长沙，张君去年毕业也去了长沙。看到微信，我第一时间没回他。一来是我不愿意借钱给借钱不还的人，二来我气他之前没理我，现在借钱想起我来了。</p><p>接着我问了W君，果然他也向W借钱了。后来到了中午，张君再次给我打电话，我还是没理他。但是思绪不由的往他身上想。她女朋友家境比他要好，消费水平比他高，他经济肯定有压力。但是我心中认为，他借钱也还不了，除非是遇到什么人命关天的事情，否则我不能再借给他。本想下班再跟他说，可是下午张君又在微信给我发消息，我没忍住，直接把心里想的告诉了他。我说完，他上来就道歉，说自己最近一年出了事，白天上班晚上兼职。还说我发信息的时候是ig夺冠那天(这我倒是没注意),他那时候下班都到十二点了，不知道说啥。后来说晚上再打电话就是和我说说话。我说好。但是心里更加杂乱了。我想不明白他为什么需要兼职，一个没结婚的人，压力这么大。我觉得肯定是他们感情出了问题。</p><p>晚上张君跟我打了电话，说起他的最近经历。码农的工作因为经常出差辞职了，找工作找了大半年，中间和他女友一块玩（费用应该是AA）的时候借了网贷（1500，7天之后还2000的那种），后来网贷越滚越多，他又以贷还贷。最多的时候竟然欠了五六万，后来告诉了家里的一部分状况，家里帮他还了，但是他没敢说完。我说你是糊涂啊，网贷利息那么高你也借。打电话的时候他还在兼职，唉。我内心是怒其不争，哀其不幸。当时电话里我没借给他，我说知道他借了也没法还，只要他不是到了万不得已的情况我不借他。</p><p>可是挂完电话，我还是放心不下，我同情他，可怜他。同时他也是我的好朋友，到现在我想起当初因为失恋，心若死灰的时候，半夜爬到上铺非要拉着他说话，还是心里一暖。我在想他真实的情况会不会比电话里还要糟糕，我在想他半年都没开口，到现在开口应该就是实在没办法了吧。我又想他会不会想不开，会不会陷入绝望，他怀着希望找我、、、</p><p>我想了很多，内心不知道如何是好。后来我把问题交给了他。我跟他微信说道：我也不知道你现在的状况你是否给我说完了，你自己决定吧。我可以借给你。我觉得，是你真到万不得已的时候再说，但是。是不是这情况你自己看吧。你要是真的非常非常非常需要的话。我把钱给你打过去 。</p><p>张君收到信息又是开始道歉，说了很多。话里有这么一句：这几天看着那网上的给我打电话，同学给我要钱，父母觉得我没事了，女朋友的冷战，路过大桥，想跳下去是不是就什么事都没有了。我骂他傻逼，多大的事。后来又聊了许久，他说要先坚持着熬过去，把钱还了。我说他真到了想不开的时候，可以找我。他又是抱歉又是感谢的，我说不用，毕竟我也曾爬床烦过他好多次</p><p>但是现在想想，这怕是他人生最无助的时候了吧，我很庆幸自己挂完电话又发了微信，我甚至在想自己如果是富二代就好了，我就可以直接把钱给他还上。我再次觉得自己力量渺小，现在是遇到的是朋友，以后可能会是家人，我不想遇到这些事情只是劝他们有个好心态，我想直接把问题给他们解决了。自己一直觉得要做一个有趣的人，一直觉得一个人不能只为别人活着，一直希望父母可以自私一点为他们自己多着想一点。现在想想自己的想法不负责任而又自私，我想变得更强，成为朋友亲人的依靠仰仗，我想这样的人生，为别人的人生要比一个单一的有趣的人更有趣，更有意义。我深知自己是个缺乏毅力的人，写下来希望可以提醒自己。</p><p>努力努力再努力！！！</p>]]></content>
      
      
      <categories>
          
          <category> 杂绪 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>mac彻底删除launchpad中的图标</title>
      <link href="2018/09/14/mac%E5%BD%BB%E5%BA%95%E5%88%A0%E9%99%A4launchpad%E4%B8%AD%E7%9A%84%E5%9B%BE%E6%A0%87/"/>
      <url>2018/09/14/mac%E5%BD%BB%E5%BA%95%E5%88%A0%E9%99%A4launchpad%E4%B8%AD%E7%9A%84%E5%9B%BE%E6%A0%87/</url>
      
        <content type="html"><![CDATA[<p>之前因为wifi的问题装了许多从网络上面下载的dmg软件，之后发现有些软件在卸载之后图标依然存在于启动台，下面是解决办法。</p><h3 id="第一步：找到com-apple-dock-launchpad文件夹："><a href="#第一步：找到com-apple-dock-launchpad文件夹：" class="headerlink" title="第一步：找到com.apple.dock.launchpad文件夹："></a>第一步：找到com.apple.dock.launchpad文件夹：</h3><p>打开一个folder，按<code>command+shift+G</code>，在前往当中输入地址/private/var/folders，然后在里边自己尝试找到com.apple.dock.launchpad这个文件夹，我的路径是，省略号处应该大家都不一样，所以慢慢找，总之最后找到名为com.apple.dock.launchpad的文件夹。</p><h3 id="第二步：找到数据库，获取其路径："><a href="#第二步：找到数据库，获取其路径：" class="headerlink" title="第二步：找到数据库，获取其路径："></a>第二步：找到数据库，获取其路径：</h3><p>打开com.apple.dock.launchpad 文件夹</p><p>之后有一个db文件夹，再点进去有一个文件叫db,它就是我们要找的数据库。</p><h3 id="第三步：开始对数据库进行操作"><a href="#第三步：开始对数据库进行操作" class="headerlink" title="第三步：开始对数据库进行操作"></a>第三步：开始对数据库进行操作</h3><p>打开终端：cd到刚才拷贝的路径<br>然后输入：<br><code>sqlite3 db &quot;delete from apps where title=&#39;应用名称&#39;;&quot;&amp;&amp;killall Dock</code></p><p>注意要将应用名称处替换成你要删除的图标的名称，然后回车即可</p>]]></content>
      
      
      <categories>
          
          <category> others </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>requests中遇到的一些问题</title>
      <link href="2018/08/01/requests%E4%B8%AD%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98/"/>
      <url>2018/08/01/requests%E4%B8%AD%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<p>今天使用Python的requests模拟posts时总是，无法获取到正确的结果，后来使用postman的时候，在发送请求的时候在body中奖数据类型由默认的Text改为json可以成功，但是使用postman生成的python代码，并加入了正确的cookie还是不能获得正常的返回结果。检查代码，在headers中已经添加了<code>&#39;content-type&#39;: &quot;application/json&quot;</code>，但是根据代码返回的异常判断还是发送的数据有问题，最后的解决办法是，在post数据的时候，直接<code>data=json.dumps(data)</code>,之后代码正常，这样可以判断出，服务端直接接受的json在python中其实为形如dict的字符串。<br>最后放上代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests,json</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://172.31.1.31/api/realtime_news&quot;</span></span><br><span class="line">data = json.dumps(&#123;<span class="string">&quot;begin&quot;</span>:<span class="string">&quot;2017-01-01 00:00:00&quot;</span>,<span class="string">&quot;end&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;size&quot;</span>:<span class="string">&quot;10&quot;</span>,<span class="string">&quot;offset&quot;</span>:<span class="string">&quot;0&quot;</span>,<span class="string">&quot;data&quot;</span>:&#123;<span class="string">&quot;keyword&quot;</span>:[],<span class="string">&quot;keyword_any&quot;</span>:[],<span class="string">&quot;keyword_not&quot;</span>:[],<span class="string">&quot;emotion&quot;</span>:[<span class="string">&quot;负面&quot;</span>],<span class="string">&quot;media_type&quot;</span>:[<span class="string">&quot;print_media&quot;</span>],<span class="string">&quot;location&quot;</span>:[]&#125;&#125;)</span><br><span class="line">cookies = &#123;<span class="string">&quot;token&quot;</span>:<span class="string">&quot;dcd709fe-956e-11e8-9eda-001a4a16015c&quot;</span>,<span class="string">&quot;user_id&quot;</span>:<span class="string">&quot;12&quot;</span>,<span class="string">&quot;username1&quot;</span>:<span class="string">&quot;liushike&quot;</span>&#125;</span><br><span class="line">headers = &#123;<span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;application/json, text/javascript, */*; q=0.01&quot;</span>,<span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>,<span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;keep-alive&quot;</span>,&#125;</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(data))</span><br><span class="line"><span class="built_in">print</span>(json.loads(requests.post(url,headers=headers,data=data,cookies=cookies).text))</span><br></pre></td></tr></table></figure><h3 id="requests的params参数构造"><a href="#requests的params参数构造" class="headerlink" title="requests的params参数构造"></a><code>requests</code>的params参数构造</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">params = (</span><br><span class="line">    (<span class="string">&#x27;devid&#x27;</span>, <span class="string">&#x27;99000939663350&#x27;</span>),</span><br><span class="line">)</span><br><span class="line">response = requests.post(<span class="string">&#x27;https://r.cnews.qq.com/getSubNewsChlidInterest&#x27;</span>, headers=headers, params=params, data=data)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">等同于：</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlencode</span><br><span class="line">params = (</span><br><span class="line">    (<span class="string">&#x27;devid&#x27;</span>, <span class="string">&#x27;99000939663350&#x27;</span>),</span><br><span class="line">)</span><br><span class="line">tar = urlencode(params)</span><br><span class="line"><span class="built_in">print</span>(tar)</span><br><span class="line"><span class="string">&#x27;devid=99000939663350&#x27;</span></span><br><span class="line"><span class="comment">#进而构造出 https://r.cnews.qq.com/getSubNewsChlidInterest?devid=99000939663350</span></span><br><span class="line">requests.post(<span class="string">&#x27;https://r.cnews.qq.com/getSubNewsChlidInterest?devid=99000939663350&#x27;</span>, headers=headers, data=data)</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> python爬虫 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>deepin 使用</title>
      <link href="2018/07/18/deepin%20%E4%BD%BF%E7%94%A8/"/>
      <url>2018/07/18/deepin%20%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>Ubuntu下的文件管理器为 nautilus<br>deepin的是 dde-file-manager</p>]]></content>
      
      
      <categories>
          
          <category> default </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>python fromat保留｛｝</title>
      <link href="2018/07/13/python%20fromat%E4%BF%9D%E7%95%99%EF%BD%9B%EF%BD%9D/"/>
      <url>2018/07/13/python%20fromat%E4%BF%9D%E7%95%99%EF%BD%9B%EF%BD%9D/</url>
      
        <content type="html"><![CDATA[<p>今天写程序执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cmd = <span class="string">&quot;ps -ef|grep &#123;&#125;|awk \&#x27;&#123;print <span class="variable">$2</span>&#125;\&#x27;|xargs kill -9&quot;</span></span><br><span class="line">cmd.format(11)</span><br></pre></td></tr></table></figure><p>结果报错：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line 1, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">KeyError: <span class="string">&#x27;print $2&#x27;</span></span><br></pre></td></tr></table></figure><p>正确的写法：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cmd = <span class="string">&quot;ps -ef|grep &#123;&#125;|awk \&#x27;&#123;&#123;print <span class="variable">$2</span>&#125;&#125;\&#x27;|xargs kill -9&quot;</span></span><br><span class="line">cmd.format(11)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> default </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>test</title>
      <link href="2018/07/06/test/"/>
      <url>2018/07/06/test/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">st&#x3D;&gt;start: 用户登陆</span><br><span class="line">op&#x3D;&gt;operation: 登陆操作</span><br><span class="line">cond&#x3D;&gt;condition: 登陆成功 Yes or No?</span><br><span class="line">e&#x3D;&gt;end: 进入后台</span><br><span class="line"></span><br><span class="line">st-&gt;op-&gt;cond</span><br><span class="line">cond(yes)-&gt;e</span><br><span class="line">cond(no)-&gt;op</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> others </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>centos安装python3</title>
      <link href="2018/07/06/centos%E5%AE%89%E8%A3%85python3/"/>
      <url>2018/07/06/centos%E5%AE%89%E8%A3%85python3/</url>
      
        <content type="html"><![CDATA[<h2 id="每次虚拟机的centos装python3的时候都百度，打算自己记一下了"><a href="#每次虚拟机的centos装python3的时候都百度，打算自己记一下了" class="headerlink" title="每次虚拟机的centos装python3的时候都百度，打算自己记一下了"></a>每次虚拟机的centos装python3的时候都百度，打算自己记一下了</h2><p>centos官方的yum源里面有个<code>python34</code>可以使用<code>sudo yum install python34</code>来进行安装，但是我最近在清华源下载的最小版本的centos<a href="https://mirrors.tuna.tsinghua.edu.cn/centos/7.5.1804/isos/x86_64/CentOS-7-x86_64-Minimal-1804.iso"><strong>镜像包href</strong></a>没有<code>python34</code>，<code>python2-pip</code>,运行<code>yum provides ifconfig</code>的命令也不好使。。。，这个暂时也没心思细究了，自己动手丰衣足食,还是编译安装吧！</p><ul><li>下载编译安装包</li></ul><blockquote><p><a href="https://www.python.org/ftp/python">https://www.python.org/ftp/python</a> python官网的ftp这里你可以找各种版本，当前时间<code>2018-07-06 18:00:51</code>官网最新版本为python3.7，然后下载编译出错了，错误代码<code>No module named &#39;_ctypes&#39;</code><br>然后查了一下，发现有说曾经别的版本出现过这个问题，然后官方修复之类的。。。,算了我还是稳妥的下了个<a href="https://www.python.org/ftp/python/3.5.5/Python-3.5.5rc1.tar.xz">python3.5</a>，官网提供的压缩包有<code>tgz</code>，<code>tgz.xz</code>的，tgz.xz压缩率更高更小。</p></blockquote><pre><code>wget https://www.python.org/ftp/python/3.5.5/Python-3.5.5.tgz.xztar -xvJf Python-3.5.5.tgzcd Python-3.5.5</code></pre><p>安装编译python3所需要的依赖</p><pre><code>yum install openssl-devel bzip2-devel expat-devel gdbm-devel readline-devel sqlite-devel</code></pre><p><em><strong>话说输入<code>history</code>查看历史命令的时候发现没有记录，然后<br>    <code>cat /etc/profile|grep HIS</code><br>看到设置的size为1000（玛德难受）</strong></em><br>继续python3安装</p><pre><code>makemake install./configure --prefix=/usr/local/python3ln -s /usr/local/python3/bin/python3 /usr/bin/pythonln -s /usr/local/python3/bin/pip3 /usr/bin/pip3</code></pre><p>python3的安装完成了，这时候也已经有pip3的命令了。然后pip命令，手动安装一下<br>下载这个：</p><pre><code>wget https://bootstrap.pypa.io/get-pip.pypython(python3) get-pip.py</code></pre><p>好了。。。</p>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>gitlab与github共存</title>
      <link href="2018/07/05/gitlab%E4%B8%8Egithub%E5%85%B1%E5%AD%98/"/>
      <url>2018/07/05/gitlab%E4%B8%8Egithub%E5%85%B1%E5%AD%98/</url>
      
        <content type="html"><![CDATA[<h2 id="gitlab与github共存"><a href="#gitlab与github共存" class="headerlink" title="gitlab与github共存"></a>gitlab与github共存</h2><ol><li><p>生成公私匙</p><p><code>ssh-keygen -t rsa -C &quot;邮箱地址&quot;</code><br>因为生成的时候有个默认的名字，所以注意修改名字使其共存</p></li><li><p>添加公匙<br>登录gitlab或者github，添加公匙</p></li><li><p>在.ssh文件下配置config（重点！！！）<br><code>vim config</code></p><p>Host git.goldeneye.org.cn<br> HostName git.goldeneye.org.cn<br> User git<br> IdentityFile /c/Users/i5051/.ssh/gitlab</p><p>Host github.com<br> HostName github.com<br> User git<br> IdentityFile /c/Users/i5051/.ssh/github</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> default </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>微博搜索爬虫</title>
      <link href="2018/07/05/%E5%BE%AE%E5%8D%9A%E6%90%9C%E7%B4%A2%E7%88%AC%E8%99%AB/"/>
      <url>2018/07/05/%E5%BE%AE%E5%8D%9A%E6%90%9C%E7%B4%A2%E7%88%AC%E8%99%AB/</url>
      
        <content type="html"><![CDATA[<p>爬虫包括了登录，验证码验证模块<br>代码放到github上了<a href="https://github.com/60ke/WeiboSearch">微博搜索爬虫</a></p>]]></content>
      
      
      <categories>
          
          <category> python爬虫 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>解决lnmp上的typecho的404</title>
      <link href="2018/07/04/%E8%A7%A3%E5%86%B3lnmp%E4%B8%8A%E7%9A%84typecho%E7%9A%84404/"/>
      <url>2018/07/04/%E8%A7%A3%E5%86%B3lnmp%E4%B8%8A%E7%9A%84typecho%E7%9A%84404/</url>
      
        <content type="html"><![CDATA[<p>进入nginx配置<code>/usr/local/nginx/conf/vhost</code><br>将<code>include enable-php.conf</code>替换为<code>include enable-php-pathinfo.conf</code></p>]]></content>
      
      
      <categories>
          
          <category> others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blog </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python操作word</title>
      <link href="2018/02/26/python%E6%93%8D%E4%BD%9Cword/"/>
      <url>2018/02/26/python%E6%93%8D%E4%BD%9Cword/</url>
      
        <content type="html"><![CDATA[<h2 id="使用python-docx生成Word文档"><a href="#使用python-docx生成Word文档" class="headerlink" title="使用python-docx生成Word文档"></a>使用python-docx生成Word文档</h2><p>首先安装python-docx：</p><p><code>pip  install python-docx</code></p><p>例子：</p><pre><code>from  docx import  Documentfrom  docx.shared import  Ptfrom  docx.oxml.ns import  qnfrom docx.shared import Inches#打开文档document = Document()#加入不同等级的标题document.add_heading(&#39;Document Title&#39;,0)document.add_heading(u&#39;二级标题&#39;,1)document.add_heading(u&#39;二级标题&#39;,2)#添加文本paragraph = document.add_paragraph(u&#39;添加了文本&#39;)#设置字号run = paragraph.add_run(u&#39;设置字号&#39;)run.font.size=Pt(24)#设置字体run = paragraph.add_run(&#39;Set Font,&#39;)run.font.name=&#39;Consolas&#39;#设置中文字体run = paragraph.add_run(u&#39;设置中文字体，&#39;)run.font.name=u&#39;宋体&#39;r = run._elementr.rPr.rFonts.set(qn(&#39;w:eastAsia&#39;), u&#39;宋体&#39;)#设置斜体run = paragraph.add_run(u&#39;斜体、&#39;)run.italic = True#设置粗体run = paragraph.add_run(u&#39;粗体&#39;).bold = True#增加引用document.add_paragraph(&#39;Intense quote&#39;, style=&#39;Intense Quote&#39;)#增加有序列表document.add_paragraph(    u&#39;有序列表元素1&#39;,style=&#39;List Number&#39;)document.add_paragraph(    u&#39;有序列别元素2&#39;,style=&#39;List Number&#39;)#增加无序列表document.add_paragraph(    u&#39;无序列表元素1&#39;,style=&#39;List Bullet&#39;)document.add_paragraph(    u&#39;无序列表元素2&#39;,style=&#39;List Bullet&#39;)#增加图片（此处使用相对位置）document.add_picture(&#39;jdb.jpg&#39;,width=Inches(1.25))#增加表格table = document.add_table(rows=3,cols=3)hdr_cells=table.rows[0].cellshdr_cells[0].text=&quot;第一列&quot;hdr_cells[1].text=&quot;第二列&quot;hdr_cells[2].text=&quot;第三列&quot;hdr_cells = table.rows[1].cellshdr_cells[0].text = &#39;2&#39;hdr_cells[1].text = &#39;aerszvfdgx&#39;hdr_cells[2].text = &#39;abdzfgxfdf&#39;hdr_cells = table.rows[2].cellshdr_cells[0].text = &#39;3&#39;hdr_cells[1].text = &#39;cafdwvaef&#39;hdr_cells[2].text = &#39;aabs zfgf&#39;#增加分页document.add_page_break()#保存文件document.save(&#39;demo.docx&#39;)</code></pre><p>效果：</p><p><img src="http://ww1.sinaimg.cn/large/006Gd5nOly1fotytxlec8j30jm0fg3z2.jpg"><br>打开及保存文件：</p><pre><code>from docx import Document  document = Document(&#39;test.docx&#39;)  document.save(&#39;test.docx&#39;) </code></pre><p>添加文本：</p><pre><code>document.add_paragraph(&#39;test text&#39;)</code></pre><p>调整文本位置格式为居中：</p><pre><code>from docx import Document  from docx.enum.text import WD_ALIGN_PARAGRAPH  document = Document(&#39;test.docx&#39;)  paragraph = document.add_paragraph(&#39;123&#39;)    paragraph.paragraph_format.alignment = WD_ALIGN_PARAGRAPH.CENTER  document.save(&#39;test.docx&#39;)  </code></pre><p>调整左缩进0.3英寸：</p><pre><code>document = Document(&#39;test.docx&#39;)  paragraph = document.add_paragraph(&#39;this is test for left_indent with inches&#39;)  paragraph_format = paragraph.paragraph_format  paragraph_format.left_indent = Inches(0.3)  document.save(&#39;test.docx&#39;)  </code></pre><p>首行缩进：</p><pre><code>paragraph_format.first_line_indent = Inches(0.3) </code></pre><p>上行间距：</p><pre><code>paragraph_format.space_before = Pt(18)  </code></pre><p>下行间距：</p><pre><code>paragraph_format.space_after = Pt(12) </code></pre><p>行距：</p><pre><code>paragraph_format.line_spacing = Pt(18)  </code></pre><p>分页格式：<br>紧跟上段：</p><pre><code>paragraph_format.keep_together </code></pre><p>若本页无法完全显示，另起一页：</p><pre><code>paragraph_format.keep_with_next  </code></pre><p>强制另起一页：<br>    paragraph_format.page_break_before  </p><p>字体格式：</p><pre><code>&lt;pre name=&quot;code&quot; class=&quot;python&quot;&gt;p = document.add_paragraph()  run = p.add_run(&#39;test typeface&#39;)  #加粗  run.font.bold = True  #斜体  run.font.italic = True  #下划线  run.font.underline = True  WD_UNDERLINE 中有所有下划线格式</code></pre><p>调用样例：</p><pre><code>run.underline = WD_UNDERLINE.DOT_DASH  </code></pre><p>字体颜色：</p><pre><code>from docx.shared import RGBColor  test = document.add_paragraph().add_run(&#39;color&#39;)  font = test.font  font.color.rgb = RGBColor(0x42, 0x24 , 0xE9)  </code></pre><p>调用预设颜色：</p><pre><code>from docx.enum.dml import MSO_THEME_COLOR  font.color.theme_color = MSO_THEME_COLOR.ACCENT_1  </code></pre><p>参考连接：<br><a href="http://blog.csdn.net/u011932355/article/details/51769803">http://blog.csdn.net/u011932355/article/details/51769803</a><br><a href="https://www.jianshu.com/p/1f60cdd9655a">https://www.jianshu.com/p/1f60cdd9655a</a></p>]]></content>
      
      
      <categories>
          
          <category> default </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>scrapy之FormRequest模拟post请求</title>
      <link href="2018/01/02/scrapy%E4%B9%8BFormRequest%E6%A8%A1%E6%8B%9Fpost%E8%AF%B7%E6%B1%82/"/>
      <url>2018/01/02/scrapy%E4%B9%8BFormRequest%E6%A8%A1%E6%8B%9Fpost%E8%AF%B7%E6%B1%82/</url>
      
        <content type="html"><![CDATA[<p>先放代码吧，以后闲了再完善</p><hr><pre><code>def start_requests(self):    url = &quot;http://www.hebzx.gov.cn/specialnews.aspx?meetingtype=009001&quot;    yield scrapy.Request(url,callback=self.parse0)def parse0(self,response):    formdata = &#123;&quot;__EVENTTARGET&quot;:&quot;AspNetPager1&quot;,&quot;__EVENTARGUMENT&quot;:&quot;2&quot;&#125;    return scrapy.FormRequest.from_response(                response,                formdata=formdata,                callback=self.parse1            )       def parse1(self,response):    print(&quot;1111111111111&quot;)    print(response.text)</code></pre>]]></content>
      
      
      <categories>
          
          <category> python爬虫 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>sublime sftp 插件安装及破解</title>
      <link href="2017/11/29/sublime%20sftp%20%E6%8F%92%E4%BB%B6%E5%AE%89%E8%A3%85%E5%8F%8A%E7%A0%B4%E8%A7%A3/"/>
      <url>2017/11/29/sublime%20sftp%20%E6%8F%92%E4%BB%B6%E5%AE%89%E8%A3%85%E5%8F%8A%E7%A0%B4%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<p>每次装完系统都需要重新安装配置sublime+python的环境，这次写个文章记一下。</p><h2 id="1-python配置"><a href="#1-python配置" class="headerlink" title="1.python配置"></a>1.python配置</h2><p>在![](<a href="http://ww1.sinaimg.cn/large/6cf740f6ly1flyr6qgoj1j211y0lcjv9.jpg%E8%BF%99%E9%87%8C%E5%8F%AF%E4%BB%A5%E5%88%9B%E5%BB%BA%E6%96%B0%E7%9A%84%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE">http://ww1.sinaimg.cn/large/6cf740f6ly1flyr6qgoj1j211y0lcjv9.jpg这里可以创建新的环境配置</a></p><ul><li>linux(ubuntu)：</li></ul><p>python3.sublime-build配置：</p><pre><code>&#123; &quot;cmd&quot;: [&quot;/usr/bin/python3&quot;, &quot;-u&quot;, &quot;$file&quot;], &quot;file_regex&quot;: &quot;^[ ]*File \&quot;(...*?)\&quot;, line ([0-9]*)&quot;, &quot;selector&quot;: &quot;source.python&quot;  &#125;</code></pre><ul><li>windows：</li></ul><p>保存的目录在<code>C:\Users\i5051\AppData\Roaming\Sublime Text 3\Packages\User</code>里面<br>python3.sublime-build配置：</p><pre><code>&#123;    &quot;cmd&quot;: [&quot;XXXXXXXXXX&quot;,&quot;-u&quot;,&quot;$file&quot;],    &quot;file_regex&quot;: &quot;^[ ]*File \&quot;(...*?)\&quot;, line ([0-9]*)&quot;,    &quot;selector&quot;: &quot;source.python&quot;,&#125;</code></pre><p>“””<br>“XXXXXXXXXX”用python.exe的全路径代替<br>“””</p><ul><li>mac：</li></ul><p>路径：<code>/Users/ke/Library/Application Support/Sublime Text 3/Packages</code><br>python3.sublime-build配置：</p><pre><code>&#123;    &quot;cmd&quot;: [&quot;/usr/local/bin/python3&quot;, &quot;-u&quot;, &quot;$file&quot;],    &quot;file_regex&quot;: &quot;^[ ]*File \&quot;(...*?)\&quot;, line ([0-9]*)&quot;,    &quot;selector&quot;: &quot;source.python&quot;&#125;</code></pre><h2 id="2-必备插件"><a href="#2-必备插件" class="headerlink" title="2.必备插件"></a>2.必备插件</h2><ul><li>SublimeTmpl：可以自定义新建文件模板</li></ul><p>python模板配置，在setting-user中设置：</p><pre><code>&#123;  &quot;attr&quot;: &#123;    &quot;author&quot;: &quot;60ke&quot;,    &quot;email&quot;: &quot;worileqing@163.com&quot;,    &quot;link&quot;: &quot;http://www.worileqing.top&quot;,    &quot;version&quot;: &quot;python3&quot;  &#125;,  &quot;date_format&quot;: &quot;%Y-%m-%d %H:%M:%S&quot;&#125;</code></pre><p>快捷键设置，在key—bingding中设置：</p><pre><code>[       &#123;          &quot;caption&quot;: &quot;Tmpl: Create python&quot;, &quot;command&quot;: &quot;sublime_tmpl&quot;,          &quot;keys&quot;: [&quot;ctrl+alt+p&quot;], &quot;args&quot;: &#123;&quot;type&quot;: &quot;python&quot;&#125;      &#125;,  ]  </code></pre><ul><li>Sftp：ssh编辑远程文件必备</li></ul><p>部分配置：<br>用sublime打开文件夹，右键文件夹，在sftp的editing remote mapping中编辑设置：</p><pre><code>&quot;type&quot;: &quot;sftp&quot;,&quot;save_before_upload&quot;: true,&quot;upload_on_save&quot;: true,&quot;sync_down_on_open&quot;: false,&quot;sync_skip_deletes&quot;: false,&quot;sync_same_age&quot;: true,&quot;confirm_downloads&quot;: false,&quot;confirm_sync&quot;: true,&quot;confirm_overwrite_newer&quot;: false,&quot;host&quot;: &quot;10.0.2.30&quot;,&quot;user&quot;: &quot;root&quot;,&quot;password&quot;: &quot;111111&quot;,&quot;port&quot;: &quot;22&quot;,</code></pre><ul><li>PrettyJson:格式化Json的插件</li></ul><h2 id="3-sublime的sftp的插件破解"><a href="#3-sublime的sftp的插件破解" class="headerlink" title="3.sublime的sftp的插件破解"></a>3.sublime的sftp的插件破解</h2><p>必备插件sftp：<br>1，Package Control可以用来install其他package<br>2，sftp远程编辑文件：安装：install-&gt;sftp具体配置</p><p>sftp工具破解<br>    1，下载python字节码反编译工具uncompyle2  (pyc 2 py) <a href="https://github.com/wibiti/uncompyle2">https://github.com/wibiti/uncompyle2</a><br>    2，安装uncompyle2<br>    3，工具安装后的位置 E:\Python27\Scripts\uncompyle2<br>    4，反编译文件commands.pyc<br>          python uncompyle2 -o  commands.py commands.pyc<br>   5，注释掉函数即可 sublime.set_timeout(reg, 1)</p><p>PS:sublime的go环境开发可以使用gosublime的插件</p>]]></content>
      
      
      <categories>
          
          <category> default </category>
          
      </categories>
      
      
        <tags>
            
            <tag> sublime </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>bash问题解决</title>
      <link href="2017/11/26/bash%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/"/>
      <url>2017/11/26/bash%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/</url>
      
        <content type="html"><![CDATA[<h2 id="解决-执行中-http-sysdeps-posix-getaddrinfo-c-2603：getaddrinfo-假设-‘IN6-IS-ADDR-V4MAPPED-sin6-gt-sin6-addr-s6-addr32-’-失败的问题"><a href="#解决-执行中-http-sysdeps-posix-getaddrinfo-c-2603：getaddrinfo-假设-‘IN6-IS-ADDR-V4MAPPED-sin6-gt-sin6-addr-s6-addr32-’-失败的问题" class="headerlink" title="解决 [执行中]http: ../sysdeps/posix/getaddrinfo.c:2603：getaddrinfo: 假设 ‘IN6_IS_ADDR_V4MAPPED (sin6-&gt;sin6_addr.s6_addr32)’ 失败的问题"></a>解决 [执行中]http: ../sysdeps/posix/getaddrinfo.c:2603：getaddrinfo: 假设 ‘IN6_IS_ADDR_V4MAPPED (sin6-&gt;sin6_addr.s6_addr32)’ 失败的问题</h2><p>Important Note: Existing Ubuntu 14.04 instances are NOT automatically upgraded to 16.04: You must manually upgrade your instance to Ubuntu 16.04 in one of two ways:</p><p>Remove &amp; Replace (recommended)<br>Upgrade In-Place<br>Remove &amp; replace<br>If you’re currently running an Ubuntu 14.04 instance, we recommend removing and replacing your existing instance with a fresh new Ubuntu 16.04 instance.</p><p>WARNING: The instructions below will delete your existing distro and any of the files you’ve stored in the Linux filesystem. Therefore, be sure to copy/move any Linux files you want to keep, for example, to a Windows folder (e.g. /mnt/c/temp/wslbackup/…) BEFORE removing and replacing your instance!</p><p>To remove and re-install your Ubuntu instance, run the following commands from a Cmd/PowerShell Console.</p><p>C:&gt; lxrun /uninstall /full /y<br>…<br>C:&gt; lxrun /install<br>The lxrun /install command above will then download and install a fresh new copy of Ubuntu 16.04 onto your machine.</p><p>Upgrade In-Place<br>If your Ubuntu instance is particularly complex to configure, you can opt to upgrade it in-place, though this may not result in an optimal instance.</p><p>If you opt to upgrade your instance in-place, use Ubuntu’s instructions for upgrading an existing instance:</p><p>$ sudo do-release-upgrade</p><p>具体可参考：<a href="https://blogs.msdn.microsoft.com/commandline/2017/04/11/windows-10-creators-update-whats-new-in-bashwsl-windows-console/">https://blogs.msdn.microsoft.com/commandline/2017/04/11/windows-10-creators-update-whats-new-in-bashwsl-windows-console/</a></p>]]></content>
      
      
      <categories>
          
          <category> others </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>python模块之difflib字符串，相似度差异比较</title>
      <link href="2017/11/23/python%E6%A8%A1%E5%9D%97%E4%B9%8Bdifflib%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%8C%E7%9B%B8%E4%BC%BC%E5%BA%A6%E5%B7%AE%E5%BC%82%E6%AF%94%E8%BE%83/"/>
      <url>2017/11/23/python%E6%A8%A1%E5%9D%97%E4%B9%8Bdifflib%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%8C%E7%9B%B8%E4%BC%BC%E5%BA%A6%E5%B7%AE%E5%BC%82%E6%AF%94%E8%BE%83/</url>
      
        <content type="html"><![CDATA[<p>最近要做redhat的版本比较，本来以为和ubuntu没差多少，之后才发现，redhat的yum源里面只放了一个当前的版本号，比如如果你安装的是vim7，之后vim升级到vim8，那么yum源里面只有一个vim8之前的vim7不能够通过yum源来获取了 这样一来，如果补丁包的版本不是最新的话，是无法通过yum源来直接获得软件的信息的，我们只能通过<code>yum list installed|grep (相关的包名的一部分字符串)</code>来查询。。。<br>说了这么多有点扯远了。开始说正事：<br>difflib模块：<br>介绍：This module provides classes and functions for comparing sequences. It can be used for example, for comparing files, and can produce difference information in various formats, including HTML and context and unified diffs. For comparing directories and files, see also, the filecmp module.</p><p>具体用法可以看这里：<br><a href="https://docs.python.org/3/library/difflib.html?highlight=ndiff">https://docs.python.org/3/library/difflib.html?highlight=ndiff</a><br>今天只说字符串的相似度用法.</p><pre><code>difflib.get_close_matches(word, possibilities, n=3, cutoff=0.6)Return a list of the best “good enough” matches. word is a sequence for which close matches are desired (typically a string), and possibilities is a list of sequences against which to match word (typically a list of strings).Optional argument n (default 3) is the maximum number of close matches to return; n must be greater than 0.Optional argument cutoff (default 0.6) is a float in the range [0, 1]. Possibilities that don’t score at least that similar to word are ignored.The best (no more than n) matches among the possibilities are returned in a list, sorted by similarity score, most similar first.&gt;&gt;&gt;&gt;&gt;&gt; get_close_matches(&#39;appel&#39;, [&#39;ape&#39;, &#39;apple&#39;, &#39;peach&#39;, &#39;puppy&#39;])[&#39;apple&#39;, &#39;ape&#39;]&gt;&gt;&gt; import keyword&gt;&gt;&gt; get_close_matches(&#39;wheel&#39;, keyword.kwlist)[&#39;while&#39;]&gt;&gt;&gt; get_close_matches(&#39;pineapple&#39;, keyword.kwlist)[]&gt;&gt;&gt; get_close_matches(&#39;accept&#39;, keyword.kwlist)[&#39;except&#39;]</code></pre><p>get_close_matches()函数，括号里面的参数依次是：目标字符串，要匹配的列表，匹配结果的个数限制，匹配相似度（0-1）。如果未满足要求则返回空列表。</p>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>关于”科学“！！！</title>
      <link href="2017/11/20/%E5%85%B3%E4%BA%8E%E2%80%9D%E7%A7%91%E5%AD%A6%E2%80%9C%EF%BC%81%EF%BC%81%EF%BC%81/"/>
      <url>2017/11/20/%E5%85%B3%E4%BA%8E%E2%80%9D%E7%A7%91%E5%AD%A6%E2%80%9C%EF%BC%81%EF%BC%81%EF%BC%81/</url>
      
        <content type="html"><![CDATA[<pre><code>之所以把&quot;科学&quot;二字加上引号,从内心觉得科学还是很严谨很高大上的，但是所说内容也是与科学相关的，所以加上了引号，不扯淡了，话说这次好久没写文章了。</code></pre><p>  一般情况下，我们认为一切事物没有上限（也可能只是我认为。。。），不过也不全是例如：光速是最大的速度，绝对零度是最低的温度。但是本着尽信书不如无书的怀疑一切的态度，我觉得存在比光速还快的速度，比绝对零度还低的温度。这样的怀疑虽然现阶段没有一点理论支撑，但也不是谬论。至少从”认知”（我实在不知道用啥词了）上来讲，比如说这个：</p><pre><code>我们人类的“近亲”猿过着平淡无奇的灰色生活。田鼠、家鼠、黄鼠、花鼠、松鼠、草原犬等也不能分辨颜色。长颈鹿能分辨黄色、绿色和橘黄色。鹿对灰色的识别力最强。有趣的是，斑马虽然是色盲，它却能利用色彩来保护自己。斑马和其它动物混在一起吃草，黑白条纹可以引起注意，因此在出现危险时，只要领头马一动，所有斑马会迅速逃走。当斑马奔跑时，黑白两色条纹的晃动使得捕食动物难以快速测定距离，斑马便可安全逃脱。</code></pre><p>很多动物是看不到多彩的世界的，那么我们呢，超过快光速，处于绝对零度以下，必然都是超自然的现象，这种现象超出了我们的认知，我们检测不到，所以认为便是“极限”了，当然这种说法也可以分分钟被反驳，因为即使我们无法直观的去检测可以通过其它的不寻常的现象来推断某种东西的存在的，但是这样的发现太难太少，所以即使这种侧面的反馈，也不能用没有发现来直接反驳，就像“神”一样，无法证明，无法否定。当然“神”我倾向无神，但是这种“极限”，我倾向“不存在”。就像紫外线，红外线是不可见光，其实是对于人类“不可见”，以及“超声波”，“低声波”，我们都可以从侧面来确认存在，但是“超光速”，“低绝对零度”，如果存在，远比“声波”，“光”，厉害的多。。。就这样字吧。。。</p>]]></content>
      
      
      <categories>
          
          <category> 杂绪 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>python2之django前端中文乱码中文</title>
      <link href="2017/09/25/python2%E4%B9%8Bdjango%E5%89%8D%E7%AB%AF%E4%B8%AD%E6%96%87%E4%B9%B1%E7%A0%81%E4%B8%AD%E6%96%87/"/>
      <url>2017/09/25/python2%E4%B9%8Bdjango%E5%89%8D%E7%AB%AF%E4%B8%AD%E6%96%87%E4%B9%B1%E7%A0%81%E4%B8%AD%E6%96%87/</url>
      
        <content type="html"><![CDATA[<h2 id="把爬取到的数据用于前端展示的时候，结果发现之前的前端存在中文乱码的情况，于是开始了2，3天的debug之旅。。。。"><a href="#把爬取到的数据用于前端展示的时候，结果发现之前的前端存在中文乱码的情况，于是开始了2，3天的debug之旅。。。。" class="headerlink" title="把爬取到的数据用于前端展示的时候，结果发现之前的前端存在中文乱码的情况，于是开始了2，3天的debug之旅。。。。"></a>把爬取到的数据用于前端展示的时候，结果发现之前的前端存在中文乱码的情况，于是开始了2，3天的debug之旅。。。。</h2><p>现象：<br>前端echarts展示的数据，英文，数字正常显示，中文乱码。<br>排查：<br>先查看了网页源码中乱码的不部分，之后进一步确定目录<code> templates</code>下的<code>carousel.html</code>中script的<code>data</code>字典的值”</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; tag_cwe | safe &#125;</span><br></pre></td></tr></table></figure><p>“乱码，之后得知”</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; tag_cwe | safe &#125;</span><br></pre></td></tr></table></figure><p>“在视图<code>views.py</code>中运行<code>django</code>的shell调试输出结合网页源码确定bug的原因：</p><p>django从数据库获取的数据为中文，而python2中文是以bytes形式存储的。例如</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="string">&quot;我&quot;</span></span><br><span class="line">a</span><br><span class="line"><span class="string">&#x27;\xce\xd2&#x27;</span></span><br></pre></td></tr></table></figure><p>而前端无法解析<code>\xce\xd2</code>故而乱码<br>尝试解决：<br>1.将数据转换为<code>utf-8</code>编码之后传至前端<br>​结果：失败。原因：python2对于str类型的数据加有前缀<code>u&#39;</code>，导致前端无法解析<br>2.将数据以base64编码，再有前端解码<br>​结果：成功</p><h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>现在描述起来只有一二百字，但是解决的过程还是相当的扯淡，需要去了解django的架构，以及部分前端，然后！去，踩python2的坑。。。</p>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>pymysql</title>
      <link href="2017/09/15/pymysql/"/>
      <url>2017/09/15/pymysql/</url>
      
        <content type="html"><![CDATA[<pre><code>import osimport jsonimport codecsimport pymysqlimport rejsondir = os.getcwd() + &quot;/all&quot;# print(os.walk(jsondir))jsonnames = []for dirs in os.walk(jsondir):    jsonnames = dirs[2]conn = pymysql.connect(user = &#39;root&#39;,password = &#39;529966&#39;,host = &#39;localhost&#39;,port = 3306,database = &#39;ceve&#39;,use_unicode=True,charset = &#39;utf8&#39;)cursor = conn.cursor()for jsonname in jsonnames:    f = codecs.open(jsondir+&#39;/&#39;+jsonname,&#39;r&#39;,encoding=&#39;utf-8&#39;)    data = json.load(f,encoding=&quot;utf-8&quot;)    # print(data)    # import pdb    # pdb.set_trace()    ceve_id = data[&#39;vid&#39;]    name = data[&#39;vid&#39;]    try:        pub_date = data[&#39;published-datetime&#39;]        pub_date = re.findall(&quot;(.+?)T&quot;,pub_date)[0]    except:        pub_date = &quot;null&quot;    try:        description =data[&#39;description&#39;]        description = cursor.connection.escape(description)    except:        description = &quot;null&quot;    # print(type(data[&#39;vuln_cvss&#39;]))    try:        cvss_score = data[&#39;vuln_cvss&#39;][&#39;cvss_score&#39;]        cvss_score = cursor.connection.escape(cvss_score)    except:        cvss_score = &quot;null&quot;        try:        cvss_confidentiality_impact = data[&#39;vuln_cvss&#39;][&quot;cvss_confidentiality-impact&quot;]        cvss_confidentiality_impact = cursor.connection.escape(cvss_confidentiality_impact)    except:        cvss_confidentiality_impact = &quot;null&quot;        try:        cvss_integrity_impact = data[&#39;vuln_cvss&#39;][&quot;cvss_integrity-impact&quot;]        cvss_integrity_impact = cursor.connection.escape(cvss_integrity_impact)    except:        cvss_integrity_impact = &quot;null&quot;        try:        cvss_availability_impact = data[&#39;vuln_cvss&#39;][&quot;cvss_availability-impact&quot;]        cvss_availability_impact = cursor.connection.escape(cvss_availability_impact)    except:        cvss_availability_impact = &quot;null&quot;        try:        cvss_access_complexity = data[&#39;vuln_cvss&#39;][&quot;cvss_access-complexity&quot;]        cvss_access_complexity = cursor.connection.escape(cvss_access_complexity)    except:        cvss_access_complexity = &quot;null&quot;        try:        cvss_access_vector = data[&#39;vuln_cvss&#39;][&quot;cvss_access-vector&quot;]        cvss_access_vector = cursor.connection.escape(cvss_access_vector)    except:        cvss_access_vector = &quot;null&quot;        try:        cvss_authentication = data[&#39;vuln_cvss&#39;][&#39;cvss_authentication&#39;]        cvss_authentication = cursor.connection.escape(cvss_authentication)    except:        cvss_authentication =&quot;null&quot;        # import pdb    # pdb.set_trace()    # except:    #     print(jsonname)        # ,`published-datetime`,`last-modified-datetime`,`vuln_cvss`,`vuln_cwe`,`vuln_references`,`summary`,`vulnerable-software-list`    # cursor.execute(&quot;INSERT INTO vuler_ceve(`ceve_id`,`name`,`pub_date`,`description`,`cvss_score`,`cvss_confidentiality_impact`,`cvss_integrity_impact`,`cvss_availability_impact`,`cvss_access_complexity`,`cvss_access_vector`,`cvss_authentication`) VALUES(ceve_id,name,pub_date,description,cvss_score,cvss_confidentiality_impact,cvss_integrity_impact,cvss_availability_impact,cvss_access_complexity,cvss_access_vector,cvss_authentication)&quot;)    try:        cursor.execute(&quot;INSERT INTO vuler_ceve(`ceve_id`,`name`,`pub_date`,`description`,`cvss_score`,`cvss_confidentiality_impact`,`cvss_integrity_impact`,`cvss_availability_impact`,`cvss_access_complexity`,`cvss_access_vector`,`cvss_authentication`) VALUES(&#39;%s&#39;,&#39;%s&#39;,&#39;%s&#39;,%s,%s,%s,%s,%s,%s,%s,%s)&quot;%(ceve_id,name,pub_date,description,cvss_score,cvss_confidentiality_impact,cvss_integrity_impact,cvss_availability_impact,cvss_access_complexity,cvss_access_vector,cvss_authentication))        conn.commit()    except Exception as e:        print(jsonname)        print(e)    # import pdb    # pdb.set_trace()    f.close()cursor.close()</code></pre>]]></content>
      
      
      <categories>
          
          <category> default </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>未来</title>
      <link href="2017/09/13/%E6%9C%AA%E6%9D%A5/"/>
      <url>2017/09/13/%E6%9C%AA%E6%9D%A5/</url>
      
        <content type="html"><![CDATA[<p>最近想了一些东西，关于人生，关于自己，有些问题一直没有答案，但是我丝毫没有停止自己的思考与完善</p><p>1、真实的我是什么样的<br>2、未来我要成为什么样子的<br>3、真实的世界是什么样的<br>4、未来的世界将会是什么样的<br>其实未来，对于没有发生的事情谁都说不准，但是我们又总想拿一些人，拿一些事情来做类比，然后推算。所以又必然会产生另外两个问题：<br>5、过去的我是什么样子的<br>6、过去的世界是什么样子的</p><p>后面两个虽然已经发生了，客观的事实已经存在了，但是评判必然是也只能是主观所产生的，所以主观上的这个答案又不停的更新，而且永远也不会达到完全的与主观相同。</p><pre><code>以前我总说，如果先去知道了不同大学之间的差别，先去感受一下好的大学的魅力,我肯定会更有动力去考更好的大学，肯定也会考上更好的大学，可是现在换个角度来看，不也是一样吗？刚入工作的我，未来找不到方向，找不到自我，在人生的大学上，是不是要去看看，“好的学校”，“差的学校”？去看看最穷的地方，最富的地方，环境最好的地方，环境最差的地方，看看最和善的地方，看看战乱的地方，感受最喧闹的，感受最平静的，感受最豪华的，感受最不堪的，最热的，最冷的。等等，等等，然后，然后我可能会清晰一点，也可能更迷茫了。。。但是一定要试一试！</code></pre>]]></content>
      
      
      <categories>
          
          <category> 杂绪 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>python遇到的问题</title>
      <link href="2017/09/13/python%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98/"/>
      <url>2017/09/13/python%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h2 id="此文章用来记录python使用过程中遇到的问题，文章长期更新，作用相当于印象笔记"><a href="#此文章用来记录python使用过程中遇到的问题，文章长期更新，作用相当于印象笔记" class="headerlink" title="此文章用来记录python使用过程中遇到的问题，文章长期更新，作用相当于印象笔记"></a>此文章用来记录python使用过程中遇到的问题，文章长期更新，作用相当于印象笔记</h2><p>1.<code>sys.argv</code><br>运行py文件是传入的参数<br>example：</p><pre><code>python 1.py aa</code></pre><p>则sys.argv[0]与sys.argv[1]分别表示 1.py aa</p>]]></content>
      
      
      <categories>
          
          <category> others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 笔记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>通过ssh实现mac远程桌面</title>
      <link href="2017/09/06/%E9%80%9A%E8%BF%87ssh%E5%AE%9E%E7%8E%B0mac%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2/"/>
      <url>2017/09/06/%E9%80%9A%E8%BF%87ssh%E5%AE%9E%E7%8E%B0mac%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2/</url>
      
        <content type="html"><![CDATA[<p>teamviewer因为电脑重启的原因，更改了远程登录的密码，但是我没有保存 所以连接不上了。。。</p><h1 id="下面是解决办法："><a href="#下面是解决办法：" class="headerlink" title="下面是解决办法："></a>下面是解决办法：</h1><hr><h3 id="必要条件：可以通过ssh连接！"><a href="#必要条件：可以通过ssh连接！" class="headerlink" title="必要条件：可以通过ssh连接！"></a><strong>必要条件：可以通过ssh连接！</strong></h3><ul><li><p>首先通过ssh登录mac</p></li><li><p>通过下面的命令安装teamviewer</p><p> <code>brew cask install  teamviewer</code></p></li><li><p>启动teamviewer</p><p> <code>open /Applications/TeamViewer.app</code></p></li><li><p>截图</p><p> <code>screencapture /Users/iMac/Desktop/1.png</code></p></li><li><p>查看图片获取密码登录即可</p></li></ul><h3 id="teamviewer已经登录被其它窗口挡到怎么办？"><a href="#teamviewer已经登录被其它窗口挡到怎么办？" class="headerlink" title="teamviewer已经登录被其它窗口挡到怎么办？"></a><strong>teamviewer已经登录被其它窗口挡到怎么办？</strong></h3><p>关闭再重新打开即可！</p><pre><code>killall TeamVieweropen /Applications/TeamViewer.app</code></pre>]]></content>
      
      
      <categories>
          
          <category> others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mac </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>caogao</title>
      <link href="2017/09/06/caogao/"/>
      <url>2017/09/06/caogao/</url>
      
        <content type="html"><![CDATA[<h1 id="python-爬虫"><a href="#python-爬虫" class="headerlink" title="python 爬虫"></a>python 爬虫</h1><h2 id="1-获取网页内容"><a href="#1-获取网页内容" class="headerlink" title="1.获取网页内容"></a><strong>1.获取网页内容</strong></h2><h3 id="1-1不包含js代码网页"><a href="#1-1不包含js代码网页" class="headerlink" title="1.1不包含js代码网页"></a><strong>1.1不包含js代码网页</strong></h3><p>对于静态网站，我们可以使用<code>urllib</code>,<code>urllib2</code>,<code>requests</code>，来获取网页的源代码；获取到的源代码，一般与我们在浏览器右键查看网页源代码看到的内容一致</p><h5 id="免登录，构造post的爬虫"><a href="#免登录，构造post的爬虫" class="headerlink" title="免登录，构造post的爬虫"></a>免登录，构造post的爬虫</h5><p><a href="file:///C:\Users\i5051\Desktop\python爬虫\crawl.py">CNVD</a></p><h3 id="1-2包含js代码网页"><a href="#1-2包含js代码网页" class="headerlink" title="1.2包含js代码网页"></a><strong>1.2包含js代码网页</strong></h3><p>通过前端的js代码生成get，post请求</p><h5 id="模拟新浪微博登录爬虫："><a href="#模拟新浪微博登录爬虫：" class="headerlink" title="模拟新浪微博登录爬虫："></a>模拟新浪微博登录爬虫：</h5><p><a href="file:///C:\Users\i5051\Desktop\python爬虫\login.py">微博</a></p><h2 id="2-对网页内容的解析"><a href="#2-对网页内容的解析" class="headerlink" title="2.对网页内容的解析"></a>2.<strong>对网页内容的解析</strong></h2><h3 id="常用第三方库"><a href="#常用第三方库" class="headerlink" title="常用第三方库"></a>常用第三方库</h3><p><code>BS4</code>     以dict的形式对网页进行解析</p><p><code>lxml</code>    xml树状形解析网页</p><p><code>requests</code>    强大的第三方库</p><h3 id="框架"><a href="#框架" class="headerlink" title="框架"></a><strong>框架</strong></h3><p><code>scrapy</code></p><p>爬虫<br><a href="file:///C:\Users\i5051\Desktop\python爬虫\VMware.py">vmware</a></p><h2 id="3-数据存储"><a href="#3-数据存储" class="headerlink" title="3.数据存储"></a><strong>3.数据存储</strong></h2><h3 id="3-1存储为指定格式：txt，json，csv等等"><a href="#3-1存储为指定格式：txt，json，csv等等" class="headerlink" title="3.1存储为指定格式：txt，json，csv等等"></a>3.1存储为指定格式：<code>txt</code>，<code>json</code>，<code>csv</code>等等</h3><h3 id="3-2存储到数据库：mysql，mongodb"><a href="#3-2存储到数据库：mysql，mongodb" class="headerlink" title="3.2存储到数据库：mysql，mongodb"></a>3.2存储到数据库：<code>mysql</code>，<code>mongodb</code></h3>]]></content>
      
      
      <categories>
          
          <category> default </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>python对字典进行划分</title>
      <link href="2017/09/01/python%E5%AF%B9%E5%AD%97%E5%85%B8%E8%BF%9B%E8%A1%8C%E5%88%92%E5%88%86/"/>
      <url>2017/09/01/python%E5%AF%B9%E5%AD%97%E5%85%B8%E8%BF%9B%E8%A1%8C%E5%88%92%E5%88%86/</url>
      
        <content type="html"><![CDATA[<p>code is cheap,show code:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Date    : 2017-09-01 15:38:11</span></span><br><span class="line"><span class="comment"># @Author  : 60ke (worileqing@163.com)</span></span><br><span class="line"><span class="comment"># @Link    : http://www.worileqing.top</span></span><br><span class="line"><span class="comment"># @Version : $Id$</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="built_in">list</span> = [<span class="string">&#x27;a1&#x27;</span>,<span class="string">&#x27;a2&#x27;</span>,<span class="string">&#x27;a3&#x27;</span>,<span class="string">&#x27;b1&#x27;</span>,<span class="string">&#x27;b2&#x27;</span>,<span class="string">&#x27;b3&#x27;</span>,<span class="string">&#x27;c1&#x27;</span>]</span><br><span class="line">num = <span class="built_in">len</span>(<span class="built_in">list</span>)</span><br><span class="line">data = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num):</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line"><span class="built_in">print</span>(data[<span class="string">&#x27;%s&#x27;</span>%<span class="built_in">list</span>[i][<span class="number">0</span>]])</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">data[<span class="string">&#x27;%s&#x27;</span>%<span class="built_in">list</span>[i][<span class="number">0</span>]]=[]</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">list</span>[i][<span class="number">0</span>] <span class="keyword">in</span> data:</span><br><span class="line">data[<span class="string">&#x27;%s&#x27;</span>%<span class="built_in">list</span>[i][<span class="number">0</span>]].append(<span class="built_in">list</span>[i])</span><br><span class="line"><span class="built_in">print</span>(data)</span><br></pre></td></tr></table></figure><p>result：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&#x27;a1&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;a1&#x27;</span>, <span class="string">&#x27;a2&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;b1&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;b1&#x27;</span>, <span class="string">&#x27;b2&#x27;</span>]</span><br><span class="line">&#123;<span class="string">&#x27;a&#x27;</span>: [<span class="string">&#x27;a1&#x27;</span>, <span class="string">&#x27;a2&#x27;</span>, <span class="string">&#x27;a3&#x27;</span>], <span class="string">&#x27;b&#x27;</span>: [<span class="string">&#x27;b1&#x27;</span>, <span class="string">&#x27;b2&#x27;</span>, <span class="string">&#x27;b3&#x27;</span>], <span class="string">&#x27;c&#x27;</span>: [<span class="string">&#x27;c1&#x27;</span>]&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python基础 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python对于词频的统计和排序</title>
      <link href="2017/08/29/python%E5%AF%B9%E4%BA%8E%E8%AF%8D%E9%A2%91%E7%9A%84%E7%BB%9F%E8%AE%A1%E5%92%8C%E6%8E%92%E5%BA%8F/"/>
      <url>2017/08/29/python%E5%AF%B9%E4%BA%8E%E8%AF%8D%E9%A2%91%E7%9A%84%E7%BB%9F%E8%AE%A1%E5%92%8C%E6%8E%92%E5%BA%8F/</url>
      
        <content type="html"><![CDATA[<h2 id="以文件名字为product-txt的文件为例："><a href="#以文件名字为product-txt的文件为例：" class="headerlink" title="以文件名字为product.txt的文件为例："></a>以文件名字为product.txt的文件为例：</h2><pre><code>#!/usr/bin/env python# -*- coding: utf-8 -*-# @Date    : 2017-08-29 10:48:30# @Author  : 60ke (worileqing@163.com)# @Link    : http://www.worileqing.top# @Version : $Id$import oswith open(&quot;product.txt&quot;,&quot;r&quot;) as f:    content = f.read().split(&#39;\n&#39;)d = dict()for s in content:    d[s]=d.get(s,0)+1print(d)print(len(content))print(len(d))print(sorted(d.items(),key=lambda item:item[1],reverse=True))#reverse=True将结果改为降序</code></pre><h2 id="PS-这个词频统计按行分开，对于小说类的成段文字可以参考下面的"><a href="#PS-这个词频统计按行分开，对于小说类的成段文字可以参考下面的" class="headerlink" title="PS:这个词频统计按行分开，对于小说类的成段文字可以参考下面的"></a>PS:这个词频统计按行分开，对于小说类的成段文字可以参考下面的</h2><p>1.代码来自：<a href="http://zwustudy.iteye.com/blog/2236094">http://zwustudy.iteye.com/blog/2236094</a></p><pre><code>#coding=utf-8  &#39;&#39;&#39;&#39;&#39; Created on 2015年8月15日 统计一篇英文文章各个单词出现的词频，并按单次的词频从大到小输出 @author: minmin &#39;&#39;&#39;  import re  import collections    &#39;&#39;&#39;&#39;&#39; 从文件中读取内容，统计词频 &#39;&#39;&#39;  def count_word(path):      result = &#123;&#125;      with open(path) as file_obj:          all_the_text = file_obj.read()          #大写转小写          all_the_text = all_the_text.lower()          #正则表达式替换特殊字符          all_the_text = re.sub(&quot;\&quot;|,|\.&quot;, &quot;&quot;, all_the_text)                    for word in all_the_text.split():              if word not in result:                  result[word] = 0              result[word] += 1                         return result          &#39;&#39;&#39;&#39;&#39; 以词频倒序 &#39;&#39;&#39;  def sort_by_count(d):      #字典排序      d = collections.OrderedDict(sorted(d.items(), key = lambda t: -t[1]))      return d    if __name__ == &#39;__main__&#39;:      file_name = &quot;..\my father.txt&quot;        dword = count_word(file_name)      dword = sort_by_count(dword)            for key,value in dword.items():          print key + &quot;:%d&quot; % value  </code></pre><p><img src="http://dl2.iteye.com/upload/attachment/0111/0365/737162f7-33ef-32a3-9077-1ba1e135300c.png" alt="输出结果"></p><p>2.代码来自<a href="http://blog.csdn.net/walkingalien/article/details/54292643">http://blog.csdn.net/walkingalien/article/details/54292643</a></p><pre><code># -*- coding: utf-8 -*-import sys,string,jsonreload(sys)sys.setdefaultencoding(&#39;utf8&#39;)fr=open(&#39;xyj.txt&#39;,&#39;r&#39;)characters=[]stat=&#123;&#125;for line in fr:    line=line.strip()    if len(line)==0:       continue    #print type(line)    line=unicode(line)    #print type(line)    for x in xrange(0,len(line)):        if line[x] in [&#39; &#39;,&#39;\t&#39;,&#39;\n&#39;,&#39;，&#39;,&#39;.&#39;,&#39;。&#39;,&#39;！&#39;,&#39;：&#39;,&#39;“&#39;,&#39;”&#39;,&#39;？&#39;]:            continue        if not line[x] in characters:            characters.append(line[x])        if not stat.has_key(line[x]):            stat[line[x]]=0        stat[line[x]]+=1fw=open(&#39;result.json&#39;,&#39;w&#39;)fw.write(json.dumps(stat))fw.close()stat=sorted(stat.iteritems(),key=lambda d:d[1],reverse=True )print type(characters[0])for x in xrange(0,20):    print characters[x]print &#39;********************************************&#39;print type(stat[0][0])for x in xrange(0,20):    print stat[x][0],stat[x][1]fw=open(&#39;result.csv&#39;,&#39;w&#39;)for item in stat:    fw.write(item[0]+&#39;:&#39;+str(item[1])+&#39;\n&#39;)fw.close()fr.close()  </code></pre><p>输出：</p><pre><code>&lt;type &#39;unicode&#39;&gt;﻿吴承恩著第一回灵根育孕源流出心性修持大********************************************&lt;type &#39;unicode&#39;&gt;道 10023不 7984了 7144一 7079那 6934我 6575是 5907行 5474来 5431他 5297个 5206你 5086的 4971者 4887有 3909大 3603得 3514这 3481去 3377上 3260[Finished in 19.7s]</code></pre>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>python字母与数字</title>
      <link href="2017/08/25/python%E5%AD%97%E6%AF%8D%E4%B8%8E%E6%95%B0%E5%AD%97/"/>
      <url>2017/08/25/python%E5%AD%97%E6%AF%8D%E4%B8%8E%E6%95%B0%E5%AD%97/</url>
      
        <content type="html"><![CDATA[<h2 id="code："><a href="#code：" class="headerlink" title="code："></a>code：</h2><p>   f = 5<br>    x=97<br>    for i in range(f):</p><pre><code>    print(chr(x),&quot;:&quot;,i+1)    x+=1</code></pre><h2 id="output"><a href="#output" class="headerlink" title="output"></a>output</h2><pre><code>a : 1b : 2c : 3d : 4e : 5</code></pre>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>scrapy保存数据为多个json</title>
      <link href="2017/08/23/scrapy%E4%BF%9D%E5%AD%98%E6%95%B0%E6%8D%AE%E4%B8%BA%E5%A4%9A%E4%B8%AAjson/"/>
      <url>2017/08/23/scrapy%E4%BF%9D%E5%AD%98%E6%95%B0%E6%8D%AE%E4%B8%BA%E5%A4%9A%E4%B8%AAjson/</url>
      
        <content type="html"><![CDATA[<h2 id="定义pipline："><a href="#定义pipline：" class="headerlink" title="定义pipline："></a>定义pipline：</h2><pre><code># -*- coding: utf-8 -*-# Define your item pipelines here## Don&#39;t forget to add your pipeline to the ITEM_PIPELINES setting# See: http://doc.scrapy.org/en/latest/topics/item-pipeline.html# class VmwarePipeline(object):#     def process_item(self, item, spider):#         return itemimport jsonimport codecsclass VmwarePipeline(object):    def process_item(self, item, spider):        self.file = codecs.open(&#39;%s.json&#39;%item[&#39;vid&#39;], &#39;w&#39;, encoding=&#39;utf-8&#39;)        line = json.dumps(dict(item), ensure_ascii=False) + &quot;\n&quot;        self.file.write(line)        return item    def spider_closed(self, spider):        self.file.close()</code></pre><h2 id="PS：scrapy中spiders的解析不能执行的问题"><a href="#PS：scrapy中spiders的解析不能执行的问题" class="headerlink" title="PS：scrapy中spiders的解析不能执行的问题"></a>PS：scrapy中spiders的解析不能执行的问题</h2><p>目前为止遇到的情况有两种</p><ol><li>解析函数本身存在问题，解析错误导致不能继续传递</li><li>解析的网址不在定义的<code>allowed_domains</code>中（这个比较坑，因为scrapy对于是否在<code>allowed_domains</code>的判断不够准确，没有必要的话最好不写这个<code>allowed_domains</code>）</li></ol>]]></content>
      
      
      <categories>
          
          <category> python爬虫 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> scrapy </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pycharm安装及主题更换</title>
      <link href="2017/08/22/pycharm%E5%AE%89%E8%A3%85%E5%8F%8A%E4%B8%BB%E9%A2%98%E6%9B%B4%E6%8D%A2/"/>
      <url>2017/08/22/pycharm%E5%AE%89%E8%A3%85%E5%8F%8A%E4%B8%BB%E9%A2%98%E6%9B%B4%E6%8D%A2/</url>
      
        <content type="html"><![CDATA[<p>进入官网下载pycharm专业版：<br><a href="https://download.jetbrains.8686c.com/python/pycharm-community-2017.2.1.exe">https://download.jetbrains.8686c.com/python/pycharm-community-2017.2.1.exe</a></p><p>到一下网站获取注册码：<br><a href="http://idea.lanyus.com/">http://idea.lanyus.com/</a></p><p>主题：<br><a href="https://github.com/d1ffuz0r/pycharm-themes">https://github.com/d1ffuz0r/pycharm-themes</a></p><p>windows下的主题安装：<br>将下载的icls文件拷贝到C:\Users***.PyCharm30\config\colors<br>在pycharm的file-&gt;Setting-&gt;Editor-&gt;Colors &amp; Fonts里就可以看到刚刚下载的颜色字体主题包</p>]]></content>
      
      
      <categories>
          
          <category> others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pycharm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>scrapy之获取ubuntu安全公告，并将cve存储为json</title>
      <link href="2017/08/22/scrapy%E4%B9%8B%E8%8E%B7%E5%8F%96ubuntu%E5%AE%89%E5%85%A8%E5%85%AC%E5%91%8A%EF%BC%8C%E5%B9%B6%E5%B0%86cve%E5%AD%98%E5%82%A8%E4%B8%BAjson/"/>
      <url>2017/08/22/scrapy%E4%B9%8B%E8%8E%B7%E5%8F%96ubuntu%E5%AE%89%E5%85%A8%E5%85%AC%E5%91%8A%EF%BC%8C%E5%B9%B6%E5%B0%86cve%E5%AD%98%E5%82%A8%E4%B8%BAjson/</url>
      
        <content type="html"><![CDATA[<h2 id="创建ubuntu项目"><a href="#创建ubuntu项目" class="headerlink" title="创建ubuntu项目"></a>创建ubuntu项目</h2><pre><code>scrapy startproject ubuntu</code></pre><h2 id="创建spider模板"><a href="#创建spider模板" class="headerlink" title="创建spider模板"></a>创建spider模板</h2><pre><code>cd ubuntuscrapy genspider Ubuntu https://usn.ubuntu.comcat ubuntu/ubuntu/spiders/Ubuntu.py# -*- coding: utf-8 -*-import scrapyclass UbuntuSpider(scrapy.Spider):    name = &#39;Ubuntu&#39;    allowed_domains = [&#39;https://usn.ubuntu.com&#39;]    start_urls = [&#39;http://https://usn.ubuntu.com/&#39;]    def parse(self, response):        pass~             </code></pre><h2 id="编写spider"><a href="#编写spider" class="headerlink" title="编写spider"></a>编写spider</h2><pre><code># -*- coding: utf-8 -*-import scrapyfrom bs4 import BeautifulSoupimport reimport requestsfrom ubuntu.items import UbuntuItemclass UbuntuSpider(scrapy.Spider):    name = &#39;Ubuntu&#39;    allowed_domains = [&#39;usn.ubuntu.com&#39;]    def start_requests(self):        url = &quot;https://usn.ubuntu.com/usn/&quot;        content = requests.get(url).text        soup = BeautifulSoup(content,&quot;html.parser&quot;)        page = soup.find(attrs=&#123;&quot;class&quot;:&quot;right&quot;&#125;).text.strip()        max_page = re.findall(&quot;Showing page 1 of (.+?) &quot;,page)[0]        start_urls = []        for page in range(int(max_page)):            page +=1            url = &#39;https://usn.ubuntu.com/usn/?page=%s&#39;%page            yield scrapy.Request(url,callback=self.parse0)                def parse0(self, response):        # 获取公告中usn的cve_url        cves = response.xpath(&quot;//@href&quot;).extract()        for cve in cves:            if cve.startswith(&quot;http://people.ubuntu.com/~ubuntu-security/cve/&quot;):                item = UbuntuItem()                item[&#39;cve&#39;] = cve                yield item</code></pre><p>需要注意的地方：</p><ol><li>通常需要重写start_requests()函数</li><li>导入模块语句<code>from ubuntu.items import UbuntuItem</code></li><li>定义item<code>item = UbuntuItem()</code>注意后面的括号</li></ol><h2 id="存储为json"><a href="#存储为json" class="headerlink" title="存储为json"></a>存储为json</h2><p>1.定义item</p><pre><code># -*- coding: utf-8 -*-# Define here the models for your scraped items## See documentation in:# http://doc.scrapy.org/en/latest/topics/items.htmlimport scrapyclass UbuntuItem(scrapy.Item):    # define the fields for your item here like:    # name = scrapy.Field()    cve = scrapy.Field()</code></pre><p>2.定义piplines</p><pre><code># -*- coding: utf-8 -*-# Define your item pipelines here## Don&#39;t forget to add your pipeline to the ITEM_PIPELINES setting# See: http://doc.scrapy.org/en/latest/topics/item-pipeline.htmlimport jsonimport codecs# class UbuntuPipeline(object):#     def process_item(self, item, spider):#         return itemclass UbuntuPipeline(object):    def __init__(self):        self.file = codecs.open(&#39;cve.json&#39;, &#39;w&#39;, encoding=&#39;utf-8&#39;)    def process_item(self, item, spider):        line = json.dumps(dict(item), ensure_ascii=False) + &quot;\n&quot;        self.file.write(line)        return item    def spider_closed(self, spider):        self.file.close()</code></pre><p>3.spider中保存item的语句（见上面）</p><p>4.settings设置</p><pre><code>ITEM_PIPELINES = &#123;   &#39;ubuntu.pipelines.UbuntuPipeline&#39;: 300,&#125;</code></pre><h1 id="ps-写包含代码的文章的时候，不要用ctrl-u-ctrl-o来创建列表，会造成ctrl-k的代码显示不正常"><a href="#ps-写包含代码的文章的时候，不要用ctrl-u-ctrl-o来创建列表，会造成ctrl-k的代码显示不正常" class="headerlink" title="ps:写包含代码的文章的时候，不要用ctrl+u,ctrl+o来创建列表，会造成ctrl+k的代码显示不正常"></a>ps:写包含代码的文章的时候，不要用<code>ctrl+u</code>,<code>ctrl+o</code>来创建列表，会造成<code>ctrl+k</code>的代码显示不正常</h1>]]></content>
      
      
      <categories>
          
          <category> python爬虫 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> scrapy </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>scrapy-xpath用法</title>
      <link href="2017/08/22/scrapy-xpath%E7%94%A8%E6%B3%95/"/>
      <url>2017/08/22/scrapy-xpath%E7%94%A8%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<p>转载自<a href="http://www.cnblogs.com/huhuuu/p/3701017.html">http://www.cnblogs.com/huhuuu/p/3701017.html</a>　　<br>Scrapy是基于python的开源爬虫框架，使用起来也比较方便。具体的官网档：<a href="http://doc.scrapy.org/en/latest/">http://doc.scrapy.org/en/latest/</a></p><p>　　之前以为了解python就可以直接爬网站了，原来还要了解HTML，XML的基本协议，在了解基础以后，在了解下xpath的基础上，再使用正则表达式(python下的re包提供支持)提取一定格式的信息（比如说url），就比较容易处理网页了。</p><p>　　xpath是Scrapy下快速提取特定信息（如title,head,href等）的一个接口。</p><span id="more"></span><p>　　</p><p>　　几个简单的例子：</p><p>　　/html/head/title: 选择HTML文档<head>元素下面的<title> 标签。<br>　　/html/head/title/text(): 选择前面提到的<title> 元素下面的文本内容<br>　　//td: 选择所有 <td> 元素<br>　　//div[@class=”mine”]: 选择所有包含 class=”mine” 属性的div 标签元素</p><p>　　基本的路径意义：</p><p>　　</p><p>表达式    描述<br>nodename    选取此节点的所有子节点。<br>/    从根节点选取。<br>//    从匹配选择的当前节点选择文档中的节点，而不考虑它们的位置。<br>.    选取当前节点。<br>..    选取当前节点的父节点。<br>@    选取属性。　　</p><p>　　具体的使用实例：</p><p>　　比如对<a href="http://www.dmoz.org/Computers/Programming/Languages/Python/Books/">http://www.dmoz.org/Computers/Programming/Languages/Python/Books/</a> 网站提取特定的信息</p><p>　　1）、先在第一层tutorial文件夹下，在cmd中输入： scrapy shell <a href="http://www.dmoz.org/Computers/Programming/Languages/Python/Books/">http://www.dmoz.org/Computers/Programming/Languages/Python/Books/</a>  </p><p>　　2）、现在比如我们需要抓取该网页的tittle，由于前面的shell命令已经实例化了一个selector的对象sel， 就输入 sel.xpath(‘//title’) 获取了网页的标题。</p><p>　　3）、比如我们想要知道该网页下的www.****.com形式的链接，可以使用xpath 结合正则表达式re提取信息，输入   sel.xpath(‘//@href’).re(“www.[0-9a-zA-Z]+.com”)</p>]]></content>
      
      
      <categories>
          
          <category> python爬虫 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> scrapy </tag>
            
            <tag> xpath </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ubuntu常用的一些设置</title>
      <link href="2017/08/18/ubuntu%E5%B8%B8%E7%94%A8%E7%9A%84%E4%B8%80%E4%BA%9B%E8%AE%BE%E7%BD%AE/"/>
      <url>2017/08/18/ubuntu%E5%B8%B8%E7%94%A8%E7%9A%84%E4%B8%80%E4%BA%9B%E8%AE%BE%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<p>运行程序时出现：unable to resolve host ke的解决办法：</p><span id="more"></span><pre><code>sudo vi /etc/hosts</code></pre><p>在hosts里面添加 127.0.0.1 localhost ke(hostname)</p><p>hostname可用</p><pre><code>hostname 用户名</code></pre><p>的方法更改hostname，<code>vi /etc/hostname</code>可用永久更改hostname</p><p>ubuntu设置默认python：</p><pre><code>sudo update-alternatives --install /usr/bin/python python /usr/bin/python2 100sudo update-alternatives --install /usr/bin/python python /usr/bin/python3 150</code></pre><p>切换：</p><pre><code>sudo update-alternatives --config python</code></pre>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>python爬虫之——网页解析</title>
      <link href="2017/08/17/python%E7%88%AC%E8%99%AB%E4%B9%8B%E2%80%94%E2%80%94%E7%BD%91%E9%A1%B5%E8%A7%A3%E6%9E%90/"/>
      <url>2017/08/17/python%E7%88%AC%E8%99%AB%E4%B9%8B%E2%80%94%E2%80%94%E7%BD%91%E9%A1%B5%E8%A7%A3%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h1 id="常用的正则"><a href="#常用的正则" class="headerlink" title="常用的正则"></a>常用的正则</h1><p>首先导入第三方包</p><pre><code>import re</code></pre><p>常用的正则函数：</p><h2 id="re-findall"><a href="#re-findall" class="headerlink" title="re.findall()"></a>re.findall()</h2><p>re.findall()这个函数之前用的已经比较多了，除了以前提到的re.findall(“”,target)在“”中放入（.+?）来匹配要查找到内容，还可以结合python中 r+“”的特性，来进行正则查找，同时还可以使用多个（）来查找多个，之后再加上“”.jion(list)来实现list转字符串，然后又可以利用str.replace(“”,””)来实现字符串的替换，talk is cheap，show you code</p><pre><code>import requestsimport reurl = &quot;http://        \&quot;www.baidu.com http://www.baidu.com http://www.baidu.com http://www.baidu.com http://www.baidu.com&quot;target_r = re.findall(r&quot;http:(.+?)        \&quot;&quot;,url)target = &quot;&quot;.join(re.findall(&quot;http:(.+?)        \&quot;&quot;,url)).replace(&quot;//&quot;,&quot;haha&quot;)print(target_r)print(target)</code></pre><p>输出的结果：<br>[‘//‘]<br>haha</p><h2 id="re-compile"><a href="#re-compile" class="headerlink" title="re.compile()"></a>re.compile()</h2><pre><code>import recveid = &quot;CVE-2015-3456&quot;pat = re.compile(&#39;CVE-(\d+)-\d+&#39;)m = pat.search(cveid)year = m.group(1)print(pat)print(m)print(year)</code></pre><p>输出结果：</p><pre><code>re.compile(&#39;CVE-(\\d+)-\\d+&#39;)&lt;_sre.SRE_Match object; span=(0, 13), match=&#39;CVE-2015-3456&#39;&gt;2015</code></pre><h2 id="beautifulsoup"><a href="#beautifulsoup" class="headerlink" title="beautifulsoup"></a>beautifulsoup</h2><p>beautifulsoup 以我最近写的代码为例</p><pre><code># -*- coding: utf-8 -*-import osimport reimport requestsfrom bs4 import BeautifulSoupimport jsonurl = &quot;http://www.huawei.com/cn/psirt/security-advisories/huawei-sa-20160706-01-openssl-cn&quot;page = requests.get(url=str(url)).texthtml = requests.get(url=str(url)).contentsoup = BeautifulSoup(page,&quot;html.parser&quot;)content = soup.find(attrs=&#123;&#39;class&#39;:&#39;col-sm-9 psiet-detail&#39;&#125;)published_datetime = content.find(attrs=&#123;&#39;id&#39;:&#39;indexmain_0_liInieialReleaseDate&#39;&#125;).texta = re.findall(r&#39;(\d+-\d+-\d+)&#39;,published_datetime)[0]last_modified_datetime = content.find(attrs=&#123;&#39;id&#39;:&#39;indexmain_0_liLastReleaseDate&#39;&#125;).textb = re.findall(r&#39;(\d+-\d+-\d+)&#39;,last_modified_datetime)[0]name = content.find(attrs=&#123;&#39;class&#39;:&#39;bor-btom&#39;&#125;).text.strip()cvss_score = content.find(attrs=&#123;&#39;class&#39;: &#39;psirt-list-out&#39;&#125;).find_all(attrs=&#123;&quot;class&quot;: &quot;psirt-set-out&quot;&#125;)[3].find(attrs=&#123;&quot;class&quot;:&quot;moreinfo&quot;&#125;).texttab = soup.findAll(&#39;table&#39;)[0]vulnerable_software_list = []for tr in tab.findAll(&#39;tr&#39;):      #print((tr.text))    vulnerable_software_list.append(tr.text)print(vulnerable_software_list)</code></pre><p>输出结果</p><pre><code>[&#39;\n\n产品名称\n\n\n版本号\n\n\n修复版本号\n\n&#39;, &#39;\n\n9032\n\n\nV100R001C00\n\n\nV100R001C00SPC101\n\n&#39;, &#39;\n\n\xa0Agile Controller-Campus\n\n\nV100R001C00\n\n\nUpgrade to V100R002C10SPC400\n\n&#39;, &#39;\n\nV100R002C00\n\n&#39;, &#39;\n\nV100R002C10\n\n\nV100R002C10SPC400\n\n&#39;, &#39;\n\nAnyOffice\n\n\nV200R002C20\n\n\nUpgrade to V200R006C00\n\n&#39;, &#39;\n\nV200R003C00\n\n&#39;, &#39;\n\nV200R005C00\n\n&#39;, &#39;\n\n\xa0AR510\n\n\nV200R005C30\n\n\nUpgrade to V200R008C20\n\n&#39;, &#39;\n\n\xa0BH620\n\n\nV100R001C00\n\n\nV100R001C00SPC106\xa0 \n\n&#39;, &#39;\n\n\xa0BH620 V2\n\n\nV100R002C00\n\n\nV100R002C00SPC301B010\n\n&#39;, &#39;\n\n\xa0CH221\n\n\nV100R001C00\n\n\nV100R001C00SPC266\n\n&#39;, &#39;\n\nCH225 V3\n\n\nV100R001C00\n\n\nV100R001C00SPC102\n\n&#39;, &#39;\n\nE5372s\n\n\nE5372s-32TCPU-V200R001B290D23SP00C00\n\n\nE5372s-32TCPU-V200R001B290D25SP00C00 \n\n&#39;, &#39;\n\nE5377Bs\n\n\nE5377Bs-605TCPU-V200R001B305D09SP00C00\n\n\nE5377Bs-605TCPU-V200R001B313D13SP00C00\n\n&#39;, &#39;\n\nE5786s\n\n\nE5786s-32aTCPU-V200R001B313D15SP00C00\n\n\nE5786s-32aTCPU-V200R001B313D17SP00C00\n\n&#39;, &#39;\n\nE5878s\n\n\nE5878s-32TCPU-V200R001B305D11SP00C00\n\n\nE5878s-32TCPU-V200R001B313D13SP00C00 \n\n&#39;, &#39;\n\nE6000 Chassis\n\n\nV100R001C00\n\n\nV100R001C00SPC501B010\n\n&#39;, &#39;\n\nE9000 Chassis\n\n\nV100R001C00\n\n\nV100R001C00SPC296\n\n&#39;, &#39;\n\nEEM\n\n\nV200R007C00\n\n\nUpgrade to V200R008C10\n\n&#39;, &#39;\n\nV200R007C10\n\n&#39;, &#39;\n\nV200R007C20\n\n&#39;, &#39;\n\nV200R008C00\n\n&#39;, &#39;\n\neLog\n\n\nV200R005C00\n\n\nV200R005C00SPC101\n\n&#39;, &#39;\n\neSDK Platform \n\n\nV100R005C30\n\n\nUpgrade to V100R005C60\n\n&#39;, &#39;\n\neSight Network\n\n\nV300R003C20\n\n\nV300R003C20SPC106\n\n&#39;, &#39;\n\nV300R005C00\n\n\nV300R005C00SPC302\n\n&#39;, &#39;\n\neSpace IVS\n\n\neSpace IVS V100R001C02SPC100\n\n\nUpgrade to eSpace VCN3000 V100R001C01SPC132\n\n&#39;, &#39;\n\nEudemon8000E-X8\n\n\nV300R001C01\n\n\nV300R001C01SPCA00\n\n&#39;, &#39;\n\nV500R001C00\n\n\nUpgrade to V500R002C00SPC100\n\n&#39;, &#39;\n\nFireHunter6000\n\n\nV100R001C20\n\n\nV100R001C20SPC101\n\n&#39;, &#39;\n\nFusionAccess\n\n\nV100R003C00\n\n\nUpgrade to V100R006C00\n\n&#39;, &#39;\n\nV100R005C10\n\n&#39;, &#39;\n\nV100R005C20\n\n&#39;, &#39;\n\nV100R005C30\n\n&#39;, &#39;\n\nFusionInsight HD\n\n\nV100R002C50\n\n\nUpgrade to V100R002C60SPC200\n\n&#39;, &#39;\n\nFusionInsight\n\n\nFusionInsight V100R002C30\n\n\nUpgrade to FusionInsight HD V100R002C60SPC200\n\n&#39;, &#39;\n\nFusionManager\n\n\nFusionManager V100R003C10\n\n\nUpgrade to FusionSphere OpenStack V100R006C00RC3B036\n\n&#39;, &#39;\n\nFusionManager V100R005C00\n\n&#39;, &#39;\n\nFusionManager V100R005C10SPC700\n\n&#39;, &#39;\n\nFusionManager V100R006C00\n\n&#39;, &#39;\n\nFusionStorage DSware\n\n\nFusionStorage DSware V100R003C02\n\n\nUpgrade to FusionStorage V100R003C30U1SPC001\n\n&#39;, &#39;\n\nFusionStorage DSware V100R003C30\n\n\nUpgrade to FusionStorage V100R003C30U1SPC001\n\n&#39;, &#39;\n\nFusionStorage\n\n\nV100R003C00\n\n\nUpgrade to V100R003C30U1SPC001\n\n&#39;, &#39;\n\nG710-C00\n\n\nV100R001C92B118\n\n\nV100R001C92B135\n\n&#39;, &#39;\n\nHG253s V2-20\n\n\nV100R001C205B027\n\n\nV100R001C205B052\n\n&#39;, &#39;\n\nHG255s-10\n\n\nV100R001C163B013\n\n\nV100R001C163B026\n\n&#39;, &#39;\n\xa0\n            HiSTBAndroid\n\n\nV600R001C00SPC060\n\n\xa0\n            V600R001C00CP0013\n\n&#39;, &#39;\n\niBMC\n\n\nV100R002C10\n\n\nUpgrade to \xa0V200R002C10\n\n&#39;, &#39;\n\nV100R002C30\n\n&#39;, &#39;\n\nIVS\n\n\nIVS V100R002C10\n\n\nUpgrade to eSpace VCN3000 V100R002C10SPC108\n\n&#39;, &#39;\n\nLogCenter\n\n\nV100R001C10\n\n\nUpgrade to V100R001C20SPC102\n\n&#39;, &#39;\n\nV100R001C20\n\n\nV100R001C20SPC102\n\n&#39;, &#39;\n\nMT992-10\n\n\nMV100R001C01B002\n\n\nV100R001C01B019\n\n&#39;, &#39;\n\nOceanStor 18500\n\n\nV100R001C10\n\n\nUpgrade to V100R001C30SPC201\n\n&#39;, &#39;\n\nOceanStor 18800 V3\n\n\nV300R003C00\n\n\nUpgrade to V300R003C10SPC100\n\n&#39;, &#39;\n\nOceanStor 2860 V3\n\n\nOceanStor 2860 V3 V300R001C00T\n\n\nUpgrade to OceanStor 2800 V300R003C20\n\n&#39;, &#39;\n\nOceanStor 5600 V3\n\n\nV300R001C00\n\n\nUpgrade to \xa0V300R003C10SPC100\n\n&#39;, &#39;\n\nOceanStor 5600 V3\n\n\nV300R003C00\n\n\nUpgrade to V300R003C10SPC100\n\n&#39;, &#39;\n\nOceanStor 5600 V3\n\n\nV300R003C10\n\n\nV300R003C10SPC100\n\n&#39;, &#39;\n\nOceanStor 5800 V3\n\n\nV300R002C00\n\n\nUpgrade to V300R003C10SPC100\n\n&#39;, &#39;\n\nOceanStor 9000\n\n\nO\xa0 V100R001C01\n\n\nUpgrade to V300R005C00SPC170\n\n&#39;, &#39;\n\nV100R001C30\n\n\nOV300R005C00SPC170\n\n&#39;, &#39;\n\nOceanStor 9000E\n\n\nOceanStor 9000E V100R001C01\n\n\nUpgrade to OceanStor 9000 V300R005C00SPC170\n\n&#39;, &#39;\n\nOceanStor 9000E V100R002C00\n\n&#39;, &#39;\n\nOceanStor 9000E V100R002C19\n\n&#39;, &#39;\n\nOceanStor Backup \xa0Software\n\n\nV100R002C00\n\n\nV100R002C00LHWS01SPC100\n\n&#39;, &#39;\n\nOceanStor BCManager\n\n\nV100R005C00\n\n\nUpgrade to V200R001C00\n\n&#39;, &#39;\n\nOceanStor CSE\n\n\nOceanStor CSE V100R002C00LSFM01B010\n\n\nUpgrade to OceanStor Onebox V100R002C00LSFM01SPC108\n\n&#39;, &#39;\n\nOceanStor HVS85T\n\n\nOceanStor HVS85T V100R001C30\n\n\nOceanStor 18500 V100R001C30SPC201\n\n&#39;, &#39;\n\nOceanStor HVS85T\n\n\nOceanStor HVS85T V100R001C30\n\n\nOceanStor 18500 V100R001C30SPC201\n\n&#39;, &#39;\n\nOceanStor N8500\n\n\nV200R001C09\n\n\nV200R001C09SPC506\n\n&#39;, &#39;\n\nV200R001C91\n\n\nV200R001C91SPC902\n\n&#39;, &#39;\n\nPolicy Center\n\n\nPolicy Center V100R003C00\n\n\nUpgrade to Agile Controller-Campus V100R002C10SPC400\xa0 \n\n&#39;, &#39;\n\nPolicy Center V100R003C10\n\n&#39;, &#39;\n\nPublic Cloud Solution\n\n\nPublic Cloud Solution OpsTools 1.0.3\n\n\nPublic Cloud Solution 1.0.9\n\n&#39;, &#39;\n\nPublic Cloud Solution V100R001C00\n\n&#39;, &#39;\n\nRH1288 V3\n\n\nV100R003C00SPC100\n\n\nV100R003C00SPC613\n\n&#39;, &#39;\n\nRH2285H V2\n\n\nV100R002C00\n\n\nV100R002C00SPC505\n\n&#39;, &#39;\n\nRH5885 V2\n\n\nV100R001C00\n\n\nUpgrade to V100R001C02SPC302\n\n&#39;, &#39;\n\nRH5885 V3\n\n\nV100R003C00\n\n\nUpgrade to V100R003C10SPC102\n\n&#39;, &#39;\n\nV100R003C01\n\n\nUpgrade to V100R003C10SPC102\n\n&#39;, &#39;\n\nRH8100 V3\n\n\nV100R003C00\n\n\nV100R003C00SPC207\n\n&#39;, &#39;\n\nSoftVCN\n\n\nV100R002C20\n\n\nV100R002C20SPC100\n\n&#39;, &#39;\n\npeedport Hybrid\n\n\nV100R001C01B021\n\n\nUpgrade to V100R001C03B012\n\n&#39;, &#39;\n\nUSG9560\n\n\nUSG9560 V300R001C20\n\n\nUpgrade to USG9500 V500R001C30\n\n&#39;, &#39;\n\nUSG9560 V300R002C00\n\n\nUpgrade to USG9500 V500R001C30\xa0 \n\n&#39;, &#39;\n\nVCM\n\n\nV100R001C10\n\n\nV100R001C10SPC006\n\n&#39;, &#39;\n\nVCM5010\n\n\nVCM5010 V100R002C20\n\n\nUpgrade to VCM5020 V100R002C20\n\n&#39;, &#39;\n\nXH320\n\n\nXH320 V100R001C00\n\n\nUpgrade to Tecal X6000 V100R001C02\n\n&#39;, &#39;\n\nXH620\n\n\nXH620 V100R001C00\n\n\nUpgrade to XH620 V3 V100R003C00\n\n&#39;]</code></pre><h2 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h2><p>以前用BeautifulSoup一直用的”html.parser”的解析器，今天补充一下其他的<br><a href="http://bbs.csdn.net/topics/392161042?list=lz">http://bbs.csdn.net/topics/392161042?list=lz</a></p>]]></content>
      
      
      <categories>
          
          <category> python爬虫 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>爬虫入门到进阶-1--保存一张图片</title>
      <link href="2017/06/26/%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8%E5%88%B0%E8%BF%9B%E9%98%B6-1--%E4%BF%9D%E5%AD%98%E4%B8%80%E5%BC%A0%E5%9B%BE%E7%89%87/"/>
      <url>2017/06/26/%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8%E5%88%B0%E8%BF%9B%E9%98%B6-1--%E4%BF%9D%E5%AD%98%E4%B8%80%E5%BC%A0%E5%9B%BE%E7%89%87/</url>
      
        <content type="html"><![CDATA[<span id="more"></span><pre><code># -*- coding: utf-8 -*-  //可以避免一些编码问题import urllib.request    //python3自带的模块，用来做网页的解析url = &quot;http://gaopin-preview.bj.bcebos.com/133208713368.jpg&quot; //定义要爬取的网址response = urllib.request.urlopen(url)  //用urllib.request.urlopen打开网页并将其传递给responsewith open(&#39;1.jpg&#39;,&#39;wb&#39;) as f:         //以二进制方式打开一个名为1.jpg的文件，并将其作为f变量（对象）    f.write(response.read())          //读取response并将其写入到f中  </code></pre>]]></content>
      
      
      <categories>
          
          <category> python爬虫 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ubuntu中安装R和Rstudio</title>
      <link href="2017/06/12/ubuntu%E4%B8%AD%E5%AE%89%E8%A3%85R%E5%92%8CRstudio/"/>
      <url>2017/06/12/ubuntu%E4%B8%AD%E5%AE%89%E8%A3%85R%E5%92%8CRstudio/</url>
      
        <content type="html"><![CDATA[<p>转载自 作者：会心一击<br>出处：<a href="http://www.cnblogs.com/lijingchn/">http://www.cnblogs.com/lijingchn/</a></p><ol><li>安装R</li></ol><p>1.1 首先添加镜像源</p><p>sudo gedit /etc/apt/sources.list<br>加入新镜像源：<br>deb <a href="http://cran.rstudio.com/bin/linux/ubuntu">http://cran.rstudio.com/bin/linux/ubuntu</a> trusty/<br>1.2 运行命令下载公钥</p><p>sudo apt-key adv –keyserver keyserver.ubuntu.com –recv-keys 51716619E084DAB9<br>然后更新一下<br>sudo apt-get update<br>1.3 安装R</p><p>sudo apt-get install r-base<br>然后验证是否安装成功：在终端输入R，出现R的信息则安装成功。</p><ol start="2"><li>安装Rstudio</li></ol><p>2.1 安装</p><p>首先，去下载对应自己系统的安装文件: <a href="http://www.rstudio.com/products/rstudio/download/%EF%BC%8C%E7%84%B6%E5%90%8E%E6%89%A7%E8%A1%8C%E4%B8%80%E4%B8%8B%E6%AD%A5%E9%AA%A4%E3%80%82">http://www.rstudio.com/products/rstudio/download/，然后执行一下步骤。</a></p><p>　　</p><p>sudo apt-get install gdebi-core<br>sudo apt-get install libapparmor1  # Required only for Ubuntu, not Debian</p><p>sudo gdebi 下载的Rstudio的deb安装包<br>2.2 在Rstudio里安装ggplot2</p><p>安装ggplot2包之前需要先安装其它的依赖包：’ plyr ‘ , ‘ digest ‘ , ‘ gtable ‘ , ‘ reshape2 ‘ , ‘ scales ‘ , ‘ proto ‘ , 在Rstudio的命令窗口分别执行以下命令。 </p><p>　　</p><p>复制代码<br>install.packages(‘plyr’)<br>install.packages(‘digest’)<br>install.packages(‘gtable’)<br>install.packages(‘reshape2’)<br>install.packages(‘scales’)<br>install.packages(‘proto’)<br>复制代码<br>然后，安装 ‘ ggplot2 ‘ 包 , 安装成功后就可以使用了。</p><p>install.packages(‘ggplot2’)</p>]]></content>
      
      
      <categories>
          
          <category> others </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>解决Ubuntu下Sublime Text 2无法输入中文</title>
      <link href="2017/06/11/%E8%A7%A3%E5%86%B3Ubuntu%E4%B8%8BSublime%20Text%202%E6%97%A0%E6%B3%95%E8%BE%93%E5%85%A5%E4%B8%AD%E6%96%87/"/>
      <url>2017/06/11/%E8%A7%A3%E5%86%B3Ubuntu%E4%B8%8BSublime%20Text%202%E6%97%A0%E6%B3%95%E8%BE%93%E5%85%A5%E4%B8%AD%E6%96%87/</url>
      
        <content type="html"><![CDATA[<p>ubuntu16.04下sublime text 2无法输入中文的问题</p><span id="more"></span><ul><li><p>保存下面的代码到文件sublime_imfix.c(位于~目录，即主文件夹目录)</p><p> #include &lt;gtk/gtkimcontext.h&gt;<br> void gtk_im_context_set_client_window (GtkIMContext *context,</p><pre><code>      GdkWindow    *window)</code></pre><p> {<br>  GtkIMContextClass *klass;<br>  g_return_if_fail (GTK_IS_IM_CONTEXT (context));<br>  klass = GTK_IM_CONTEXT_GET_CLASS (context);<br>  if (klass-&gt;set_client_window)</p><pre><code>klass-&gt;set_client_window (context, window);</code></pre><p>  g_object_set_data(G_OBJECT(context),”window”,window);<br>  if(!GDK_IS_WINDOW (window))</p><pre><code>return;</code></pre><p>  int width = gdk_window_get_width(window);<br>  int height = gdk_window_get_height(window);<br>  if(width != 0 &amp;&amp; height !=0)</p><pre><code>gtk_im_context_focus_in(context);</code></pre><p> }</p></li><li><p>将上一步的代码编译成共享库libsublime-imfix.so<br>然后将libsublime-imfix.so拷贝到sublime_text所在文件夹,修改文件/usr/bin/subl的内容</p><p> cd ~<br> gcc -shared -o libsublime-imfix.so sublime_imfix.c  <code>pkg-config --libs --cflags gtk+-2.0</code> -fPIC<br> sudo mv libsublime-imfix.so /opt/sublime_text_2/<br>将</p><p> #!/bin/sh<br> /opt/sublime_text_2/sublime_text “$@”</p></li></ul><p>修改为</p><pre><code>#!/bin/shLD_PRELOAD=/opt/sublime_text_2/libsublime-imfix.so exec /opt/sublime_text_2/sublime_text &quot;$@&quot;</code></pre>]]></content>
      
      
      <categories>
          
          <category> others </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Anaconda使用说明</title>
      <link href="2017/04/26/Anaconda%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E/"/>
      <url>2017/04/26/Anaconda%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E/</url>
      
        <content type="html"><![CDATA[<h2 id="Anaconda常用的命令："><a href="#Anaconda常用的命令：" class="headerlink" title="Anaconda常用的命令："></a>Anaconda常用的命令：</h2><ul><li>-conda list 查看安装了哪些包。</li><li>conda env list 或 conda info -e 查看当前存在哪些虚拟环境</li><li>conda update conda 检查更新当前conda</li><li>conda -V 查看conda版本</li></ul><span id="more"></span><h2 id="创建使用Python虚拟环境："><a href="#创建使用Python虚拟环境：" class="headerlink" title="创建使用Python虚拟环境："></a>创建使用Python虚拟环境：</h2><pre><code>conda create -n your_env_name python=X.X（2.7、3.6等）</code></pre><p>打开命令行输入<code>python --version</code>可以检查当前python的版本。</p><p>使用如下命令即可 激活你的虚拟环境(即将python的版本改变)。</p><pre><code>Linux:  source activate your_env_name(虚拟环境名称)Windows: activate your_env_name(虚拟环境名称)</code></pre><h2 id="对虚拟环境中安装额外的包："><a href="#对虚拟环境中安装额外的包：" class="headerlink" title="对虚拟环境中安装额外的包："></a>对虚拟环境中安装额外的包：</h2><pre><code>使用命令`conda install -n your_env_name [package]`即可安装package到your_env_name中</code></pre><h2 id="关闭虚拟环境-即从当前环境退出返回使用PATH环境中的默认python版本-："><a href="#关闭虚拟环境-即从当前环境退出返回使用PATH环境中的默认python版本-：" class="headerlink" title="关闭虚拟环境(即从当前环境退出返回使用PATH环境中的默认python版本)："></a>关闭虚拟环境(即从当前环境退出返回使用PATH环境中的默认python版本)：</h2><p>   使用如下命令即可。</p><pre><code>  Linux: source deactivate   Windows: deactivate</code></pre><h2 id="删除虚拟环境："><a href="#删除虚拟环境：" class="headerlink" title="删除虚拟环境："></a>删除虚拟环境：</h2><p>   使用命令<code>conda remove -n your_env_name(虚拟环境名称) --all</code>， 即可删除。</p><h2 id="删除环境中的某个包："><a href="#删除环境中的某个包：" class="headerlink" title="删除环境中的某个包："></a>删除环境中的某个包：</h2><p>   使用命令<code>conda remove --name $your_env_name  $package_name</code> 即可。</p>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>win10开启UbuntuBash并实现xshell登录</title>
      <link href="2017/04/26/win10%E5%BC%80%E5%90%AFUbuntuBash%E5%B9%B6%E5%AE%9E%E7%8E%B0xshell%E7%99%BB%E5%BD%95/"/>
      <url>2017/04/26/win10%E5%BC%80%E5%90%AFUbuntuBash%E5%B9%B6%E5%AE%9E%E7%8E%B0xshell%E7%99%BB%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<p>看到win10内置ubuntubash没忍住，又把系统换成了win10</p><span id="more"></span><h2 id="一，开启Bash"><a href="#一，开启Bash" class="headerlink" title="一，开启Bash"></a>一，开启Bash</h2><ol><li>把系统设置改为开发人员模式<br><img src="http://ww1.sinaimg.cn/large/6cf740f6gy1ff06qeqmyqj20m10hijry.jpg"></li><li>经控制面板进入程序开启Ubuntu子系统<br><img src="http://ww1.sinaimg.cn/large/6cf740f6gy1ff06tnov4wj20md0fpq3y.jpg"></li><li>打开cmd输入bash开始下载Ps:不翻墙，正常情况下是无法下载的下面是解决下载的办法<br>1.更改系统设置的区域为香港特别行政区<br>2.更改本地dns为微软的dns：4.2.2.1; 4.2.2.2<br>等待下载完成就好：<br><img src="http://ww1.sinaimg.cn/large/6cf740f6gy1ff070e3hgxj20k50e1whq.jpg"></li></ol><h2 id="二，开启ssh"><a href="#二，开启ssh" class="headerlink" title="二，开启ssh"></a>二，开启ssh</h2><ol><li><p>设置root密码：<br>打开bash默认root登陆，用一下命令设置root密码：</p><p>passwd root</p></li><li><p>开启ssh</p><p>service ssh start</p></li><li><p>设置sshd</p><p> vi etc/ssh/sshd_config</p></li></ol><p>将PasswordAuthentication改为yes，PermitRootLogin改为yes<br>PS：如果（密匙登陆的情况）出现could not load host key的错误可以用dpkg-reconfigure openssh-server 生成</p>]]></content>
      
      
      <categories>
          
          <category> others </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>转载-Python 爬虫：把廖雪峰的教程转换成 PDF 电子书</title>
      <link href="2017/04/22/%E8%BD%AC%E8%BD%BD-Python%20%E7%88%AC%E8%99%AB%EF%BC%9A%E6%8A%8A%E5%BB%96%E9%9B%AA%E5%B3%B0%E7%9A%84%E6%95%99%E7%A8%8B%E8%BD%AC%E6%8D%A2%E6%88%90%20PDF%20%E7%94%B5%E5%AD%90%E4%B9%A6/"/>
      <url>2017/04/22/%E8%BD%AC%E8%BD%BD-Python%20%E7%88%AC%E8%99%AB%EF%BC%9A%E6%8A%8A%E5%BB%96%E9%9B%AA%E5%B3%B0%E7%9A%84%E6%95%99%E7%A8%8B%E8%BD%AC%E6%8D%A2%E6%88%90%20PDF%20%E7%94%B5%E5%AD%90%E4%B9%A6/</url>
      
        <content type="html"><![CDATA[<p>来源：<a href="https://github.com/lzjun567/crawler_html2pdf/blob/master/pdf/crawler.py">https://github.com/lzjun567/crawler_html2pdf/blob/master/pdf/crawler.py</a></p><span id="more"></span><pre><code># coding=utf-8from __future__ import unicode_literalsimport loggingimport osimport reimport timetry:    from urllib.parse import urlparse  # py3except:    from urlparse import urlparse  # py2import pdfkitimport requestsfrom bs4 import BeautifulSouphtml_template = &quot;&quot;&quot;&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt;    &lt;meta charset=&quot;UTF-8&quot;&gt;&lt;/head&gt;&lt;body&gt;&#123;content&#125;&lt;/body&gt;&lt;/html&gt;&quot;&quot;&quot;class Crawler(object):    &quot;&quot;&quot;    爬虫基类，所有爬虫都应该继承此类    &quot;&quot;&quot;    name = None    def __init__(self, name, start_url):        &quot;&quot;&quot;        初始化        :param name: 保存问的PDF文件名,不需要后缀名        :param start_url: 爬虫入口URL        &quot;&quot;&quot;        self.name = name        self.start_url = start_url        self.domain = &#39;&#123;uri.scheme&#125;://&#123;uri.netloc&#125;&#39;.format(uri=urlparse(self.start_url))    def crawl(self, url):        &quot;&quot;&quot;        pass        :return:        &quot;&quot;&quot;        print(url)        response = requests.get(url)        return response    def parse_menu(self, response):        &quot;&quot;&quot;        解析目录结构,获取所有URL目录列表:由子类实现        :param response 爬虫返回的response对象        :return: url 可迭代对象(iterable) 列表,生成器,元组都可以        &quot;&quot;&quot;        raise NotImplementedError    def parse_body(self, response):        &quot;&quot;&quot;        解析正文,由子类实现        :param response: 爬虫返回的response对象        :return: 返回经过处理的html文本        &quot;&quot;&quot;        raise NotImplementedError    def run(self):        start = time.time()        options = &#123;            &#39;page-size&#39;: &#39;Letter&#39;,            &#39;margin-top&#39;: &#39;0.75in&#39;,            &#39;margin-right&#39;: &#39;0.75in&#39;,            &#39;margin-bottom&#39;: &#39;0.75in&#39;,            &#39;margin-left&#39;: &#39;0.75in&#39;,            &#39;encoding&#39;: &quot;UTF-8&quot;,            &#39;custom-header&#39;: [                (&#39;Accept-Encoding&#39;, &#39;gzip&#39;)            ],            &#39;cookie&#39;: [                (&#39;cookie-name1&#39;, &#39;cookie-value1&#39;),                (&#39;cookie-name2&#39;, &#39;cookie-value2&#39;),            ],            &#39;outline-depth&#39;: 10,        &#125;        htmls = []        for index, url in enumerate(self.parse_menu(self.crawl(self.start_url))):            html = self.parse_body(self.crawl(url))            f_name = &quot;.&quot;.join([str(index), &quot;html&quot;])            with open(f_name, &#39;wb&#39;) as f:                f.write(html)            htmls.append(f_name)        pdfkit.from_file(htmls, self.name + &quot;.pdf&quot;, options=options)        for html in htmls:            os.remove(html)        total_time = time.time() - start        print(u&quot;总共耗时：%f 秒&quot; % total_time)class LiaoxuefengPythonCrawler(Crawler):    &quot;&quot;&quot;    廖雪峰Python3教程    &quot;&quot;&quot;    def parse_menu(self, response):        &quot;&quot;&quot;        解析目录结构,获取所有URL目录列表        :param response 爬虫返回的response对象        :return: url生成器        &quot;&quot;&quot;        soup = BeautifulSoup(response.content, &quot;html.parser&quot;)        menu_tag = soup.find_all(class_=&quot;uk-nav uk-nav-side&quot;)[1]        for li in menu_tag.find_all(&quot;li&quot;):            url = li.a.get(&quot;href&quot;)            if not url.startswith(&quot;http&quot;):                url = &quot;&quot;.join([self.domain, url])  # 补全为全路径            yield url    def parse_body(self, response):        &quot;&quot;&quot;        解析正文        :param response: 爬虫返回的response对象        :return: 返回处理后的html文本        &quot;&quot;&quot;        try:            soup = BeautifulSoup(response.content, &#39;html.parser&#39;)            body = soup.find_all(class_=&quot;x-wiki-content&quot;)[0]            # 加入标题, 居中显示            title = soup.find(&#39;h4&#39;).get_text()            center_tag = soup.new_tag(&quot;center&quot;)            title_tag = soup.new_tag(&#39;h1&#39;)            title_tag.string = title            center_tag.insert(1, title_tag)            body.insert(1, center_tag)            html = str(body)            # body中的img标签的src相对路径的改成绝对路径            pattern = &quot;(&lt;img .*?src=\&quot;)(.*?)(\&quot;)&quot;            def func(m):                if not m.group(3).startswith(&quot;http&quot;):                    rtn = &quot;&quot;.join([m.group(1), self.domain, m.group(2), m.group(3)])                    return rtn                else:                    return &quot;&quot;.join([m.group(1), m.group(2), m.group(3)])            html = re.compile(pattern).sub(func, html)            html = html_template.format(content=html)            html = html.encode(&quot;utf-8&quot;)            return html        except Exception as e:            logging.error(&quot;解析错误&quot;, exc_info=True)if __name__ == &#39;__main__&#39;:    start_url = &quot;http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000&quot;    crawler = LiaoxuefengPythonCrawler(&quot;廖雪峰Git&quot;, start_url)    crawler.run()</code></pre>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> 爬虫 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python代码中func(*args, **kwargs)</title>
      <link href="2017/04/22/Python%E4%BB%A3%E7%A0%81%E4%B8%ADfunc(*args,%20**kwargs)/"/>
      <url>2017/04/22/Python%E4%BB%A3%E7%A0%81%E4%B8%ADfunc(*args,%20**kwargs)/</url>
      
        <content type="html"><![CDATA[<p>这个args其实是程序员对arguments的缩写，这种缩写可以说已经成为了一种传统（各种编程语言都这么做）；而argument的中文含义即为参数</p><span id="more"></span><p>这是Python函数可变参数 args及kwargs</p><p>*args表示任何多个无名参数，它是一个tuple</p><p>**kwargs表示关键字参数，它是一个dict</p><p>测试代码如下：</p><pre><code>def foo(*args,**kwargs):print &#39;args=&#39;,argsprint &#39;kwargs=&#39;,kwargsprint &#39;**********************&#39;if __name__==&#39;__main__&#39;:foo(1,2,3)foo(a=1,b=2,c=3)foo(1,2,3,a=1,b=2,c=3)foo(1,&#39;b&#39;,&#39;c&#39;,a=1,b=&#39;b&#39;,c=&#39;c&#39;)</code></pre><p>执行结果如下：</p><pre><code>args= (1, 2, 3)kwargs= &#123;&#125;**********************args= ()kwargs= &#123;&#39;a&#39;: 1, &#39;c&#39;: 3, &#39;b&#39;: 2&#125;**********************args= (1, 2, 3)kwargs= &#123;&#39;a&#39;: 1, &#39;c&#39;: 3, &#39;b&#39;: 2&#125;**********************args= (1, &#39;b&#39;, &#39;c&#39;)kwargs= &#123;&#39;a&#39;: 1, &#39;c&#39;: &#39;c&#39;, &#39;b&#39;: &#39;b&#39;&#125;**********************</code></pre>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>美股。。。</title>
      <link href="2017/04/21/%E7%BE%8E%E8%82%A1%E3%80%82%E3%80%82%E3%80%82/"/>
      <url>2017/04/21/%E7%BE%8E%E8%82%A1%E3%80%82%E3%80%82%E3%80%82/</url>
      
        <content type="html"><![CDATA[<pre><code>炒股几个月了，当时开始入手美股是看好京东，那时京东股票的价格在25-27之间吧，今天已经涨到34了，我入股的501美元外加送的100RMB和推荐老黄的200RMB本金大概在542$,然而现在看了本金在518，困于AMD，当时放了京东是觉得短期更挣钱，但是现在看来不如预想。</code></pre><h2 id="两次亏损"><a href="#两次亏损" class="headerlink" title="两次亏损"></a>两次亏损</h2><pre><code>一次是微博当时夜间看着微博疯长，因为看好微博的地位垄断，以及马上就要出财报，感觉会超出预期，所以以59$的价格买入，然而财报虽然超出华尔街预期，但是在财报出来的半月股价已经被炒到58多，利好已经被炒空，财报虽然超出华尔街预期，但是其实低于近半月股价期望，所以股价不升反降，而我以59的价格买入超出历史最高价格，上头的成分很大，因为本来看好，实时关注的时候看着股价疯长怕越来越高，没忍住冲动。。。后来想想很是后悔和不该，刚入股票一再告诫自己买涨不买跌，微博最近狂涨，再买风险较大，当然最主要的教训还是## 超出华尔街预期的财报未必会涨！！！ ##第二次亏损，也就是现在这次AMD的，amd也是近一年狂涨的股价，但是因为最近产品（处理器）比较给力，外加相对于它的竞争对手Intel，NVIDIA来说它的价格过于便宜（性价比太高），当然更是因为我亲眼见过，当天AMD开盘降了10%之后一天之内扭跌为涨，让我觉得有部分强力资金在支撑，所以觉得比较稳当，当时时以13.7多买的目标价格15（接近历史最高，因为觉得AMD还是处于增长的，所以超越历史股价不是问题），之后不到一周的时间赚了20$左右，但是在14.2徘徊了一两天，因为学习原因没过多思考，然而突然遭遇暴跌百分之10左右。原因是分析师下调了AMD的目标股价，这下甩不出来了，过来一星期的今天亏损百分之6,7.觉得这次的教训，主要在于，扯的不够快，14.2其实也可以了，但是觉得放着也没啥问题，结果。。。## 见好就收 ##</code></pre><h2 id="两次盈利"><a href="#两次盈利" class="headerlink" title="两次盈利"></a>两次盈利</h2><pre><code>最开始27买了京东，之后京东开始跌到25因为长期看好的缘故，没卖，后来经过了漫长的恢复27又给卖了，算上交易费4$左右略亏了几块人民币（其实这次交易在我现在看来也是没错的当时京东长期徘徊在27左右股价比较稳定一时半会确实转不来钱），后来看准时机在微博45.5入手，然而在入手之后又跌到了42左右当时坚持没卖，两个月后以49.27的价格出售。虽然赚的不少但是时间太长49的价格虽然不少最高，但是我个人也是满意的。（别老想着抄底，最高卖）不过期间时间过长第二次盈利，是在美国苹果状告高通导致高通股价大跌的时候，以52.82买入，目标价格57至少，后来看长期徘徊在56块多，以56.61的价格出售，期间经历20天。这次交易是最为满意的一次。没啥说的。当时炒股算了每月增长%7每年就可以达到每年2.25的增长，10年3325的增长，本来以为很容易带到（其实现在也这么觉得），虽然现在实时并非如此，嗯 怎么说呢加油吧</code></pre>]]></content>
      
      
      <categories>
          
          <category> others </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>煎蛋爬虫分析比较总结</title>
      <link href="2017/04/21/%E7%85%8E%E8%9B%8B%E7%88%AC%E8%99%AB%E5%88%86%E6%9E%90%E6%AF%94%E8%BE%83%E6%80%BB%E7%BB%93/"/>
      <url>2017/04/21/%E7%85%8E%E8%9B%8B%E7%88%AC%E8%99%AB%E5%88%86%E6%9E%90%E6%AF%94%E8%BE%83%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<p>小甲鱼的爬虫</p><ol><li>直接提取出用户正常访问页面的page<pre><code>![](https://ws1.sinaimg.cn/large/6cf740f6ly1feumgqfv6vj20a701qjra.jpg)</code></pre></li><li>模块化结构代码易读性更高</li><li>模块化的代码利用率更高，可重复利用</li></ol><p>目标：在精通Python之前每天坚持至少写一个爬虫，难度要越来越高</p>]]></content>
      
      
      <categories>
          
          <category> others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 总结 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>煎蛋模块化爬虫</title>
      <link href="2017/04/21/%E7%85%8E%E8%9B%8B%E6%A8%A1%E5%9D%97%E5%8C%96%E7%88%AC%E8%99%AB/"/>
      <url>2017/04/21/%E7%85%8E%E8%9B%8B%E6%A8%A1%E5%9D%97%E5%8C%96%E7%88%AC%E8%99%AB/</url>
      
        <content type="html"><![CDATA[<p>按照小甲鱼的Python课程打出来的，在find_imgs中添加了http:（未使用正则表达式）</p><span id="more"></span><h2 id="煎蛋模块化爬虫"><a href="#煎蛋模块化爬虫" class="headerlink" title="煎蛋模块化爬虫"></a>煎蛋模块化爬虫</h2><pre><code>import osimport urllib.requestdef url_open(url):    req = urllib.request.Request(url)    req.add_header(&#39;User-Agent&#39;, &#39;&#39;)    response = urllib.request.urlopen(url)    html = response.read()    return htmldef get_page(url):    html = url_open(url).decode(&#39;utf-8&#39;)    a = html.find(&#39;current-comment-page&#39;) + 23    b = html.find(&#39;]&#39;,a)    return html[a:b]    def find_imgs(url):    html = url_open(url).decode(&#39;utf-8&#39;)    img_addrs = []    a = html.find(&#39;img src=&#39;)    while a != -1:        b = html.find(&#39;.jpg&#39;, a, a+255)        if b != -1:            img_addrs.append(&#39;http:&#39;+html[a+9:b+4])        else:            b =a + 9                a = html.find(&#39;img src=&#39;, b)    return img_addrsdef save_imgs(folder, img_addrs):    for each in img_addrs:        filename = each.split(&#39;/&#39;)[-1]        with open(filename, &#39;wb&#39;) as f:            img = url_open(each)            f.write(img)def download_mm(folder= &#39;OOXX&#39;, pages=100):    os.mkdir(folder)    os.chdir(folder)    url = &#39;http://jandan.net/ooxx/&#39;    page_num = int(get_page(url))    for i in range(pages):        page_num -=i        page_url = url + &#39;page-&#39; +str(page_num)        img_addrs = find_imgs(page_url)        save_imgs(folder, img_addrs)download_mm()#//因为有默认参数所以（）可以为空，没有默认参数时不可以</code></pre><h2 id="find-用法："><a href="#find-用法：" class="headerlink" title="find()用法："></a>find()用法：</h2><p>#!/usr/bin/python</p><pre><code>str1 = &quot;this is string example....wow!!!&quot;str2 = &quot;exam&quot;print (str1.find(str2))print (str1.find(str2, 10))print (str1.find(str2, 10,12))print (str1.find(str2, 40))</code></pre><p>输出：<br>    15<br>    15<br>    -1<br>    -1</p>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> 爬虫 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>煎蛋网妹子图抓取</title>
      <link href="2017/04/21/%E7%85%8E%E8%9B%8B%E7%BD%91%E5%A6%B9%E5%AD%90%E5%9B%BE%E6%8A%93%E5%8F%96/"/>
      <url>2017/04/21/%E7%85%8E%E8%9B%8B%E7%BD%91%E5%A6%B9%E5%AD%90%E5%9B%BE%E6%8A%93%E5%8F%96/</url>
      
        <content type="html"><![CDATA[<p>代码写的很烂，不过目的总算达到了</p><span id="more"></span><pre><code>import requestsfrom bs4 import BeautifulSoupimport reimport osi = 1url = &#39;http://jandan.net/ooxx/page-&#39;+str(id)+&#39;#comments&#39;for id in range(200):    res = requests.get(&#39;http://jandan.net/ooxx/page-&#39;+str(id)+&#39;#comments&#39;)    #print(res)    target_text = BeautifulSoup(res.text, &#39;html.parser&#39;)    target_img = target_text.select(&#39;img&#39;)    for img in target_img:        img = str(img)        img = re.findall(r&#39;&lt;img src=&quot;//(.+?)&quot;/&gt;&#39;,img)        for picurl in img:            picurl = &#39;http://&#39;+picurl            print(&#39;正在下载第&#39;+i&#39;张图片&#39;)            pic= requests.get(picurl)            string = &#39;tupia\\&#39;+str(i) + &#39;.jpg&#39;##给要保存的文件命名（第一个&#39;\&#39;是用来转义后面的&#39;\&#39;，）            fp = open(string,&#39;wb&#39;)            fp.write(pic.content)            fp.close()            i += 1</code></pre><p>“战果”：<br>          <img src="https://ws1.sinaimg.cn/mw690/6cf740f6ly1feudw60cz1j20nb0fsam1.jpg"></p>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> 爬虫 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python 文件读写操作实例详解</title>
      <link href="2017/04/21/Python%20%E6%96%87%E4%BB%B6%E8%AF%BB%E5%86%99%E6%93%8D%E4%BD%9C%E5%AE%9E%E4%BE%8B%E8%AF%A6%E8%A7%A3/"/>
      <url>2017/04/21/Python%20%E6%96%87%E4%BB%B6%E8%AF%BB%E5%86%99%E6%93%8D%E4%BD%9C%E5%AE%9E%E4%BE%8B%E8%AF%A6%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<p>脚本之家网上搜出来的，转给自己看</p><span id="more"></span><h2 id="一、python中对文件、文件夹操作时经常用到的os模块和shutil模块常用方法。"><a href="#一、python中对文件、文件夹操作时经常用到的os模块和shutil模块常用方法。" class="headerlink" title="一、python中对文件、文件夹操作时经常用到的os模块和shutil模块常用方法。"></a>一、python中对文件、文件夹操作时经常用到的os模块和shutil模块常用方法。</h2><p>1.得到当前工作目录，即当前Python脚本工作的目录路径: os.getcwd()<br>2.返回指定目录下的所有文件和目录名:os.listdir()<br>3.函数用来删除一个文件:os.remove()<br>4.删除多个目录：os.removedirs(r”c：\python”)<br>5.检验给出的路径是否是一个文件：os.path.isfile()<br>6.检验给出的路径是否是一个目录：os.path.isdir()<br>7.判断是否是绝对路径：os.path.isabs()<br>8.检验给出的路径是否真地存:os.path.exists()<br>9.返回一个路径的目录名和文件名:os.path.split()<br>例子：</p><pre><code>os.path.split(&#39;/home/swaroop/byte/code/poem.txt&#39;) 结果：(&#39;/home/swaroop/byte/code&#39;, &#39;poem.txt&#39;)</code></pre><p>10.分离扩展名：os.path.splitext()<br>11.获取路径名：os.path.dirname()<br>12.获取文件名：os.path.basename()<br>13.运行shell命令: os.system()<br>14.读取和设置环境变量:os.getenv() 与os.putenv()<br>15.给出当前平台使用的行终止符:os.linesep    Windows使用’\r\n’，Linux使用’\n’而Mac使用’\r’<br>16.指示你正在使用的平台：os.name       对于Windows，它是’nt’，而对于Linux/Unix用户，它是’posix’<br>17.重命名：os.rename(old， new)<br>18.创建多级目录：os.makedirs(r”c：\python\test”)<br>19.创建单个目录：os.mkdir(“test”)<br>20.获取文件属性：os.stat(file)<br>21.修改文件权限与时间戳：os.chmod(file)<br>22.终止当前进程：os.exit()<br>23.获取文件大小：os.path.getsize(filename)</p><h2 id="二、文件操作方法大全"><a href="#二、文件操作方法大全" class="headerlink" title="二、文件操作方法大全"></a>二、文件操作方法大全</h2><p>1.os.mknod(“test.txt”)        创建空文件<br>2.fp = open(“test.txt”,w)     直接打开一个文件，如果文件不存在则创建文件<br>3.关于open 模式：</p><pre><code>w：以写方式打开，a：以追加模式打开 (从 EOF 开始, 必要时创建新文件)r+：以读写模式打开w+：以读写模式打开 (参见 w )a+：以读写模式打开 (参见 a )rb：以二进制读模式打开wb：以二进制写模式打开 (参见 w )ab：以二进制追加模式打开 (参见 a )rb+：以二进制读写模式打开 (参见 r+ )wb+：以二进制读写模式打开 (参见 w+ )ab+：以二进制读写模式打开 (参见 a+ )</code></pre><p>fp.read([size])                     #size为读取的长度，以byte为单位<br>fp.readline([size])                 #读一行，如果定义了size，有可能返回的只是一行的一部分<br>fp.readlines([size])                #把文件每一行作为一个list的一个成员，并返回这个list。其实它的内部是通过循环调用readline()来实现的。如果提供size参数，size是表示读取内容的总长，也就是说可能只读到文件的一部分。<br>fp.write(str)                       #把str写到文件中，write()并不会在str后加上一个换行符<br>fp.writelines(seq)                  #把seq的内容全部写到文件中(多行一次性写入)。这个函数也只是忠实地写入，不会在每行后面加上任何东西。<br>fp.close()                          #关闭文件。python会在一个文件不用后自动关闭文件，不过这一功能没有保证，最好还是养成自己关闭的习惯。  如果一个文件在关闭后还对其进行操作会产生ValueError<br>fp.flush()                          #把缓冲区的内容写入硬盘<br>fp.fileno()                         #返回一个长整型的”文件标签”<br>fp.isatty()                         #文件是否是一个终端设备文件（unix系统中的）<br>fp.tell()                           #返回文件操作标记的当前位置，以文件的开头为原点<br>fp.next()                           #返回下一行，并将文件操作标记位移到下一行。把一个file用于for … in file这样的语句时，就是调用next()函数来实现遍历的。<br>fp.seek(offset[,whence])            #将文件打操作标记移到offset的位置。这个offset一般是相对于文件的开头来计算的，一般为正数。但如果提供了whence参数就不一定了，whence可以为0表示从头开始计算，1表示以当前位置为原点计算。2表示以文件末尾为原点进行计算。需要注意，如果文件以a或a+的模式打开，每次进行写操作时，文件操作标记会自动返回到文件末尾。<br>fp.truncate([size])                 #把文件裁成规定的大小，默认的是裁到当前文件操作标记的位置。如果size比文件的大小还要大，依据系统的不同可能是不改变文件，也可能是用0把文件补到相应的大小，也可能是以一些随机的内容加上去。</p><h2 id="三、目录操作方法大全"><a href="#三、目录操作方法大全" class="headerlink" title="三、目录操作方法大全"></a>三、目录操作方法大全</h2><p>1.创建目录</p><pre><code>os.mkdir(&quot;file&quot;)                   </code></pre><p>2.复制文件：</p><pre><code>shutil.copyfile(&quot;oldfile&quot;,&quot;newfile&quot;)        #oldfile和newfile都只能是文件shutil.copy(&quot;oldfile&quot;,&quot;newfile&quot;)            #oldfile只能是文件夹，newfile可以是文件，也可以是目标目录</code></pre><p>3.复制文件夹：<br>4.<code>shutil.copytree(&quot;olddir&quot;,&quot;newdir&quot;)        #olddir和newdir都只能是目录，且newdir必须不存在</code><br>5.重命名文件（目录）</p><pre><code>os.rename(&quot;oldname&quot;,&quot;newname&quot;)              #文件或目录都是使用这条命令</code></pre><p>6.移动文件（目录）</p><pre><code>shutil.move(&quot;oldpos&quot;,&quot;newpos&quot;)   </code></pre><p>7.删除文件</p><pre><code>os.remove(&quot;file&quot;)</code></pre><p>8.删除目录</p><pre><code>os.rmdir(&quot;dir&quot;)                             #只能删除空目录shutil.rmtree(&quot;dir&quot;)                        #空目录、有内容的目录都可以删</code></pre><p>9.转换目录</p><pre><code>os.chdir(&quot;path&quot;)                            #换路径</code></pre><h2 id="四、文件综合操作实例"><a href="#四、文件综合操作实例" class="headerlink" title="四、文件综合操作实例"></a>四、文件综合操作实例</h2><p>将文件夹下所有图片名称加上’_fc’<br>python代码:</p><pre><code># -*- coding:utf-8 -*-import reimport osimport time#str.split(string)分割字符串#&#39;连接符&#39;.join(list) 将列表组成字符串def change_name(path):    global i    if not os.path.isdir(path) and not os.path.isfile(path):        return False    if os.path.isfile(path):        file_path = os.path.split(path) #分割出目录与文件        lists = file_path[1].split(&#39;.&#39;) #分割出文件与文件扩展名        file_ext = lists[-1] #取出后缀名(列表切片操作)        img_ext = [&#39;bmp&#39;,&#39;jpeg&#39;,&#39;gif&#39;,&#39;psd&#39;,&#39;png&#39;,&#39;jpg&#39;]        if file_ext in img_ext:            os.rename(path,file_path[0]+&#39;/&#39;+lists[0]+&#39;_fc.&#39;+file_ext)            i+=1 #注意这里的i是一个陷阱        #或者        #img_ext = &#39;bmp|jpeg|gif|psd|png|jpg&#39;        #if file_ext in img_ext:        #    print(&#39;ok---&#39;+file_ext)    elif os.path.isdir(path):        for x in os.listdir(path):            change_name(os.path.join(path,x)) #os.path.join()在路径处理上很有用img_dir = &#39;D:\\xx\\xx\\images&#39;img_dir = img_dir.replace(&#39;\\&#39;,&#39;/&#39;)start = time.time()i = 0change_name(img_dir)c = time.time() - startprint(&#39;程序运行耗时:%0.2f&#39;%(c))print(&#39;总共处理了 %s 张图片&#39;%(i))</code></pre><p>输出结果：</p><pre><code>程序运行耗时:0.11总共处理了 109 张图片</code></pre><h2 id="PS：输出指定文件夹下的所有文件名"><a href="#PS：输出指定文件夹下的所有文件名" class="headerlink" title="PS：输出指定文件夹下的所有文件名"></a>PS：输出指定文件夹下的所有文件名</h2><p>代码示例：</p><pre><code>import osdir = os.getcwd()+&quot;/data&quot;for i in os.walk(dir):    for name in i[2]:        print(name)</code></pre><h2 id="python集合求差"><a href="#python集合求差" class="headerlink" title="python集合求差"></a>python集合求差</h2><p>参考脚本之家<br><a href="http://www.jb51.net/article/56980.htm">http://www.jb51.net/article/56980.htm</a></p><ol><li><p>正常的方式<br>复制代码 代码如下:</p><p> ret = []<br> for i in a:</p><pre><code> if i not in b:     ret.append(i)</code></pre></li><li><p>浓缩版<br>复制代码 代码如下:</p><p> ret = [ i for i in a if i not in b ]</p></li><li><p>另一版<br>复制代码 代码如下:</p><p> ret = list(set(a) ^ set(b))</p></li></ol><p>二. 获取两个list 的并集</p><p>复制代码 代码如下:</p><pre><code>print list(set(a).union(set(b)))</code></pre><p>三. 获取两个 list 的差集<br>复制代码 代码如下:</p><pre><code>print list(set(b).difference(set(a))) # b中有而a中没有的</code></pre>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>爬取起点中文网月票榜前500名网络小说</title>
      <link href="2017/04/19/%E7%88%AC%E5%8F%96%E8%B5%B7%E7%82%B9%E4%B8%AD%E6%96%87%E7%BD%91%E6%9C%88%E7%A5%A8%E6%A6%9C%E5%89%8D500%E5%90%8D%E7%BD%91%E7%BB%9C%E5%B0%8F%E8%AF%B4/"/>
      <url>2017/04/19/%E7%88%AC%E5%8F%96%E8%B5%B7%E7%82%B9%E4%B8%AD%E6%96%87%E7%BD%91%E6%9C%88%E7%A5%A8%E6%A6%9C%E5%89%8D500%E5%90%8D%E7%BD%91%E7%BB%9C%E5%B0%8F%E8%AF%B4/</url>
      
        <content type="html"><![CDATA[<p>‘’’</p><h2 id="参考自知乎https-zhuanlan-zhihu-com-p-26255754"><a href="#参考自知乎https-zhuanlan-zhihu-com-p-26255754" class="headerlink" title="参考自知乎https://zhuanlan.zhihu.com/p/26255754"></a>参考自知乎<a href="https://zhuanlan.zhihu.com/p/26255754">https://zhuanlan.zhihu.com/p/26255754</a></h2><h2 id="Talk-is-cheap-，-show-your-code"><a href="#Talk-is-cheap-，-show-your-code" class="headerlink" title="Talk is cheap ， show your code"></a>Talk is cheap ， show your code</h2><p>所需模块： requests padndas BeautifulSoup</p><span id="more"></span><pre><code>import requestsfrom bs4 import BeautifulSoupimport pandasnewsary=[]for i in range(1,26):    res=requests.get(&#39;http://r.qidian.com/yuepiao?chn=-1&amp;page=&#39;+str(i))    soup=BeautifulSoup(res.text,&#39;html.parser&#39;)    for news in soup.select(&#39;.rank-view-list li&#39;):        newsary.append(&#123;&#39;title&#39;:news.select(&#39;a&#39;)[1].text,&#39;name&#39;:news.select(&#39;a&#39;)[2].text,&#39;style&#39;:news.select(&#39;a&#39;)[3].text,&#39;describe&#39;:news.select(&#39;p&#39;)[1].text,&#39;lastest&#39;:news.select(&#39;p&#39;)[2].text,&#39;url&#39;:news.select(&#39;a&#39;)[0][&#39;href&#39;]&#125;)newsdf=pandas.DataFrame(newsary)newsdf.to_excel(&#39;qidiantop500.xlsx&#39;)</code></pre><p>成果截图：</p><p><img src="https://ws1.sinaimg.cn/large/6cf740f6ly1fes77bwrknj20qy0g2dhg.jpg"></p>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> 爬虫 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python正则表达式及列表与字符串的转换</title>
      <link href="2017/04/19/Python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%8F%8A%E5%88%97%E8%A1%A8%E4%B8%8E%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E8%BD%AC%E6%8D%A2/"/>
      <url>2017/04/19/Python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%8F%8A%E5%88%97%E8%A1%A8%E4%B8%8E%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E8%BD%AC%E6%8D%A2/</url>
      
        <content type="html"><![CDATA[<h2 id="Talk-is-cheap-，-show-you-code"><a href="#Talk-is-cheap-，-show-you-code" class="headerlink" title="Talk is cheap ， show you code"></a>Talk is cheap ， show you code</h2><span id="more"></span><pre><code>import rehao = (&#39;&lt;h4&gt;&lt;a data-bid=&quot;1004608738&quot; data-eid=&quot;qd_C40&quot; href=&quot;//book.qidian.com/info/1004608738&quot; target=&quot;_blank&quot;&gt;圣墟&lt;/a&gt;&lt;/h4&gt;&#39;)target = re.findall(r&#39;target=&quot;_blank&quot;&gt;(.+?)&lt;/a&gt;&#39;, hao)print(target)print(type(target))print (&quot;&quot;.join(target))a = &#39;worileqing&#39;li = list(a)print(type(a))print(type(a))print(li)print(li[5])</code></pre><p>输出：</p><pre><code>[&#39;圣墟&#39;]&lt;class &#39;list&#39;&gt;圣墟&lt;class &#39;str&#39;&gt;&lt;class &#39;str&#39;&gt;[&#39;w&#39;, &#39;o&#39;, &#39;r&#39;, &#39;i&#39;, &#39;l&#39;, &#39;e&#39;, &#39;q&#39;, &#39;i&#39;, &#39;n&#39;, &#39;g&#39;]e</code></pre><p>参考：<br>    <img src="https://ws1.sinaimg.cn/large/6cf740f6ly1fes3zi3i4ij20hc0engnl.jpg"></p><h2 id="re-findall与re-compile"><a href="#re-findall与re-compile" class="headerlink" title="re.findall与re.compile"></a>re.findall与re.compile</h2><p>测试代码</p><h2 id="re-findall"><a href="#re-findall" class="headerlink" title="re.findall"></a>re.findall</h2><pre><code>import rea = &quot;wodiddjfkj&quot;b = re.findall(r&quot;d.+?k&quot;,a)c = re.findall(r&quot;d(.+?)k&quot;,a)print(b)print(c)</code></pre><p>输出：</p><pre><code>[&#39;diddjfk&#39;][&#39;iddjf&#39;]</code></pre><h2 id="re-compile"><a href="#re-compile" class="headerlink" title="re.compile"></a>re.compile</h2><pre><code>import rea = &quot;wodiddjfkj&quot;b = re.compile(r&quot;d.+?k&quot;)c = b.findall(a)print(b)print(c)</code></pre><p>输出：</p><pre><code>re.compile(&#39;d.+?k&#39;)[&#39;diddjfk&#39;]</code></pre><h2 id="url解码："><a href="#url解码：" class="headerlink" title="url解码："></a>url解码：</h2><p>测试代码：</p><pre><code>import urllib.parseprint(urllib.parse.unquote(&quot;%E6%B5%8B%E8%AF%95abc&quot;))</code></pre><p>输出：</p><pre><code>测试abc</code></pre><h2 id="url编码："><a href="#url编码：" class="headerlink" title="url编码："></a>url编码：</h2><p>测试代码：</p><pre><code>import urllib.parseprint(urllib.parse.quote(&quot;测试abc&quot;))</code></pre><p>输出：</p><pre><code>%E6%B5%8B%E8%AF%95abc</code></pre><h2 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h2><p>用(.+?)来匹配任意字符中“.”是不包含/n的所以。。。<br>解决办法：<br>用([\s\S]*)来表示</p><pre><code>bb = re.findall(&quot;2\.([\s\S]*)&quot;,aa))</code></pre><p>表示的是匹配aa中”2.”之后的所有内容</p>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> 正则 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python之有道翻译</title>
      <link href="2017/04/18/python%E4%B9%8B%E6%9C%89%E9%81%93%E7%BF%BB%E8%AF%91/"/>
      <url>2017/04/18/python%E4%B9%8B%E6%9C%89%E9%81%93%E7%BF%BB%E8%AF%91/</url>
      
        <content type="html"><![CDATA[<p>Talk is cheap ， show you code</p><span id="more"></span><pre><code>import urllib.requestimport urllib.parseimport jsonimport time&#39;&#39;&#39;head = &#123;&#125;head[&#39;User-Agent&#39;] = &#39;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36&#39;&#39;&#39;&#39;while True :    content = input(&#39;输入要翻译的内容(输入q!退出程序)：&#39;)    if content == &#39;q!&#39; :        break    url = &#39;http://fanyi.youdao.com/translate?smartresult=dict&amp;smartresult=rule&amp;smartresult=ugc&amp;sessionFrom=https://www.baidu.com/link&#39;    data = &#123;&#125;    data[&#39;type&#39;]= &#39;AUTO&#39;    data[&#39;i&#39;] = content    data[&#39;doctype&#39;] = &#39;json&#39;    data[&#39;xmlVersion&#39;] = &#39;1.8&#39;    data[&#39;keyfrom&#39;] = &#39;fanyi.web&#39;    data[&#39;ue&#39;] =&#39;UTF-8&#39;    data[&#39;action&#39;] =&#39;FY_BY_ENTER&#39;    data[&#39;typoResult&#39;] =&#39;true&#39;    data = urllib.parse.urlencode(data).encode(&#39;utf-8&#39;)    req = urllib.request.Request(url,data)    req.add_header(&#39;User-Agent&#39; , &#39;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36&#39;)    response = urllib.request.urlopen(req)    html = response.read().decode(&#39;utf-8&#39;)    target = json.loads(html)    print(&#39;翻译结果为：%s&#39; %target[&quot;translateResult&quot;][0][0][&quot;tgt&quot;])    time.sleep(1)</code></pre>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python基础之生成器，迭代器，高阶函数</title>
      <link href="2017/04/18/python%E5%9F%BA%E7%A1%80%E4%B9%8B%E7%94%9F%E6%88%90%E5%99%A8%EF%BC%8C%E8%BF%AD%E4%BB%A3%E5%99%A8%EF%BC%8C%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0/"/>
      <url>2017/04/18/python%E5%9F%BA%E7%A1%80%E4%B9%8B%E7%94%9F%E6%88%90%E5%99%A8%EF%BC%8C%E8%BF%AD%E4%BB%A3%E5%99%A8%EF%BC%8C%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<p>thumb,no</p><h2 id="高阶函数"><a href="#高阶函数" class="headerlink" title="高阶函数"></a>高阶函数</h2><pre><code>def add(x,y,f):    return f(x)+(y)add(3,(-4),abs)//    7</code></pre><span id="more"></span><h2 id="迭代器"><a href="#迭代器" class="headerlink" title="迭代器"></a>迭代器</h2><p>example:1<br>    for i in range(5)<br>        print(i)  </p><pre><code>    0    1    2        3    4</code></pre><p>example:2</p><pre><code>xinxi = &#123; &quot;name&quot; : &quot;60ke&quot;,          &quot;age&quot;  : &quot;23&quot;,          &quot;hobby&quot; : &quot;challenge&quot;        &#125;for each in xinxi:    print(each,xinxi[each])</code></pre><p>example:3</p><pre><code>string = &quot;I Love Hard&quot;it = iter(string)while True:    try:        each = next(it)    except StopIteration://notice Aa        break    print(each)        //for each in string</code></pre><h2 id="生成器"><a href="#生成器" class="headerlink" title="生成器"></a>生成器</h2><p>yield，相当于挂起的return</p><pre><code>def MYGEN():    print(&#39;生成器被执行！&#39;)    yield 1    yield 2mygen = MYGEN()</code></pre><p><img src="http://ww1.sinaimg.cn/mw690/6cf740f6ly1feqv95pwefj209m076748.jpg"></p><p>在yield1之前加入 return 0 测试</p><p><img src="https://ws1.sinaimg.cn/mw690/6cf740f6ly1feqvai03t0j20a706odft.jpg"></p><p>无限输出菲波那切数列：<br>    def fibs():<br>        a=0<br>        b=1<br>        while True:<br>            a,b=b,a+b<br>            yield a<br>    for each in fibs():<br>        print(each)</p><p>看图思考</p><p><img src="https://ws1.sinaimg.cn/large/6cf740f6ly1feqw323fr7j20nf0aw0t7.jpg"></p><pre><code>a = &#123;s:s%3==0 for s in range(10)&#125;print(a)&#123;0: True, 1: False, 2: False, 3: True, 4: False, 5: False, 6: True, 7: False, 8: False, 9: True&#125;</code></pre><h2 id="暴走的括号："><a href="#暴走的括号：" class="headerlink" title="暴走的括号："></a>暴走的括号：</h2><pre><code>b = &#123;i for i in [1,1,12,3,2,23,3]&#125;c = &#123;i for i in (1,1,12,3,2,23,3)&#125;d = &#123;i for i in &#123;1,1,12,3,2,23,3&#125;&#125;f = (i for i in &#123;1,1,12,3,2,23,3&#125;)g = (i for i in (1,1,12,3,2,23,3))h = (i for i in [1,1,12,3,2,23,3])j = [i for i in (1,1,12,3,2,23,3)]k = [i for i in &#123;1,1,12,3,2,23,3&#125;]n = [i for i in [1,1,12,3,2,23,3]]print(b,c,d,f,g,h,j,k,n)</code></pre><p>输出结果：</p><pre><code>&#123;1, 2, 3, 12, 23&#125; &#123;1, 2, 3, 12, 23&#125; &#123;1, 2, 3, 12, 23&#125; &lt;generator object &lt;genexpr&gt; at 0x0000000002BB3468&gt; &lt;generator object &lt;genexpr&gt; at 0x0000000002BB34C0&gt; &lt;generator object &lt;genexpr&gt; at 0x0000000002BB3518&gt; [1, 1, 12, 3, 2, 23, 3] [1, 2, 3, 12, 23] [1, 1, 12, 3, 2, 23, 3]&gt;&gt;&gt; &gt;&gt;&gt; f = (i for i in &#123;1,1,12,3,2,23,3&#125;)&gt;&gt;&gt; next(f)1&gt;&gt;&gt; next(f)2&gt;&gt;&gt; next(f)3&gt;&gt;&gt; next(f)12&gt;&gt;&gt; </code></pre><p>总结:小括号与逗号可以创建生成器</p><p>[IMG]<a href="https://ws1.sinaimg.cn/large/6cf740f6ly1feqwzla4h6j20b60g0gls.jpg[/IMG]">https://ws1.sinaimg.cn/large/6cf740f6ly1feqwzla4h6j20b60g0gls.jpg[/IMG]</a></p>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>django框架博客开发-3</title>
      <link href="2017/04/10/django%E6%A1%86%E6%9E%B6%E5%8D%9A%E5%AE%A2%E5%BC%80%E5%8F%91-3/"/>
      <url>2017/04/10/django%E6%A1%86%E6%9E%B6%E5%8D%9A%E5%AE%A2%E5%BC%80%E5%8F%91-3/</url>
      
        <content type="html"><![CDATA[<h2 id="创建应用"><a href="#创建应用" class="headerlink" title="创建应用"></a>创建应用</h2><ul><li>进入manage.py同级目录</li><li>命令行输入 python manage.py startapp blog</li><li>添加应用名到settings.py中的INATALLED_APPS里</li></ul><span id="more"></span><p><img src="http://ww1.sinaimg.cn/mw690/6cf740f6gy1feho7m3dahj209105x0sm.jpg"></p><ul><li>目录结构<br><img src="http://ww1.sinaimg.cn/mw690/6cf740f6ly1fehp6vi63tj207w0b074v.jpg"></li><li>migrations<br>数据移植（迁移）模块</li><li>admin.py<br>该应用的后台管理系统配置</li><li>apps.py<br>该应用的一些配置<br>Django—1.9以后自动生成</li><li>models.py</li></ul><p>数据模块<br>使用orm框架<br>类似于MVC结构中的Models</p><ul><li>test.py<br>自动化测试模块<br>Django提供了自动化测试功能<br>在这里编写测试脚本（语句）</li><li>views.py<br>执行响应的代码所在模块<br>代码逻辑处理的主要地点<br>项目中大部分代码均在这里编写</li></ul><h2 id="创建第一个页面（响应）"><a href="#创建第一个页面（响应）" class="headerlink" title="创建第一个页面（响应）"></a>创建第一个页面（响应）</h2><p>编辑blog.views添加以下代码</p><pre><code>    from django.http import HttpResponsedef index(reques):    return HttpResponse(&#39;Hello,World&#39;)</code></pre><ul><li>配置URL<br>打开myblog下的urls.py</li></ul><p><img src="http://ww1.sinaimg.cn/mw690/6cf740f6ly1fehp929yl0j209w05e3ye.jpg"></p><ul><li>打开sever，在浏览器输入网址打开页面<br><img src="http://ww1.sinaimg.cn/mw690/6cf740f6ly1fehpcmv9vaj20au03tt8n.jpg"></li></ul>]]></content>
      
      
      <categories>
          
          <category> default </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>django框架博客开发-2</title>
      <link href="2017/04/10/django%E6%A1%86%E6%9E%B6%E5%8D%9A%E5%AE%A2%E5%BC%80%E5%8F%91-2/"/>
      <url>2017/04/10/django%E6%A1%86%E6%9E%B6%E5%8D%9A%E5%AE%A2%E5%BC%80%E5%8F%91-2/</url>
      
        <content type="html"><![CDATA[<h2 id="django的简单介绍"><a href="#django的简单介绍" class="headerlink" title="django的简单介绍"></a>django的简单介绍</h2><ul><li><p>创建项目</p><p> django-admin startproject myblog//项目名称；</p></li></ul><span id="more"></span><ul><li><p>manage.py子命令</p><p> python manage.py<br><img src="http://ww1.sinaimg.cn/large/6cf740f6gy1fehmrbsqlfj20hu0hsmxh.jpg"></p></li><li><p>启动服务器</p><p> python manage.py runserver 8000//端口可以自定义</p><h2 id="myblog项目目录介绍"><a href="#myblog项目目录介绍" class="headerlink" title="myblog项目目录介绍"></a>myblog项目目录介绍</h2><p>myblog目录：<br><img src="http://ww1.sinaimg.cn/mw690/6cf740f6gy1fehmzctavej20ko08y74m.jpg"><br>项目的一个容器<br>包含项目的最基本的一些配置<br>目录名称不建议修改</p></li><li><p>wsgi.py</p></li></ul><p>WSGI(Python Web Server Gateway Interface)//Python服务网关接口<br>Python应用于web服务器之间的接口</p><ul><li>urls.py</li></ul><p>URL配置文件<br>django项目中所有页面都需要我们自己配置其URL</p><ul><li><p>settings.py<br>项目的总配置文件<br>里面包含了数据库，web应用，时间等各种配置</p><p> import os</p><h1 id="Build-paths-inside-the-project-like-this-os-path-join-BASE-DIR-…-项目根目录"><a href="#Build-paths-inside-the-project-like-this-os-path-join-BASE-DIR-…-项目根目录" class="headerlink" title="Build paths inside the project like this: os.path.join(BASE_DIR, …)//项目根目录"></a>Build paths inside the project like this: os.path.join(BASE_DIR, …)//项目根目录</h1><p> BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(<strong>file</strong>)))</p><h1 id="Quick-start-development-settings-unsuitable-for-production"><a href="#Quick-start-development-settings-unsuitable-for-production" class="headerlink" title="Quick-start development settings - unsuitable for production"></a>Quick-start development settings - unsuitable for production</h1><h1 id="See-https-docs-djangoproject-com-en-1-11-howto-deployment-checklist"><a href="#See-https-docs-djangoproject-com-en-1-11-howto-deployment-checklist" class="headerlink" title="See https://docs.djangoproject.com/en/1.11/howto/deployment/checklist/"></a>See <a href="https://docs.djangoproject.com/en/1.11/howto/deployment/checklist/">https://docs.djangoproject.com/en/1.11/howto/deployment/checklist/</a></h1><h1 id="SECURITY-WARNING-keep-the-secret-key-used-in-production-secret-django项目自动生产的安全码，项目启动必不可少"><a href="#SECURITY-WARNING-keep-the-secret-key-used-in-production-secret-django项目自动生产的安全码，项目启动必不可少" class="headerlink" title="SECURITY WARNING: keep the secret key used in production secret!//django项目自动生产的安全码，项目启动必不可少"></a>SECURITY WARNING: keep the secret key used in production secret!//django项目自动生产的安全码，项目启动必不可少</h1><p> SECRET_KEY = ‘1z*kh0w2bqn7kg)v#lv5xw4&amp;f2(19ckz-u=ci8)&amp;+(ow9i(6as’</p><h1 id="SECURITY-WARNING-don’t-run-with-debug-turned-on-in-production-debug实际应用需要关闭"><a href="#SECURITY-WARNING-don’t-run-with-debug-turned-on-in-production-debug实际应用需要关闭" class="headerlink" title="SECURITY WARNING: don’t run with debug turned on in production!//debug实际应用需要关闭"></a>SECURITY WARNING: don’t run with debug turned on in production!//debug实际应用需要关闭</h1><p> DEBUG = True</p><p> ALLOWED_HOSTS = []#允许访问网站的地址</p><h1 id="Application-definition"><a href="#Application-definition" class="headerlink" title="Application definition"></a>Application definition</h1><p> INSTALLED_APPS = [</p><pre><code> &#39;django.contrib.admin&#39;,#管理 &#39;django.contrib.auth&#39;,#认证 &#39;django.contrib.contenttypes&#39;,#内容类型 &#39;django.contrib.sessions&#39;,#session缓存 &#39;django.contrib.messages&#39;,#消息 &#39;django.contrib.staticfiles&#39;,#静态目录</code></pre><p> ]</p><p> MIDDLEWARE = [                    #中间键，django自带的工具集</p><pre><code> &#39;django.middleware.security.SecurityMiddleware&#39;, &#39;django.contrib.sessions.middleware.SessionMiddleware&#39;, &#39;django.middleware.common.CommonMiddleware&#39;, &#39;django.middleware.csrf.CsrfViewMiddleware&#39;, &#39;django.contrib.auth.middleware.AuthenticationMiddleware&#39;, &#39;django.contrib.messages.middleware.MessageMiddleware&#39;, &#39;django.middleware.clickjacking.XFrameOptionsMiddleware&#39;,</code></pre><p> ]</p><p> ROOT_URLCONF = ‘myblog.urls’    #URL的根配置文件</p><p> TEMPLATES = [                    #模版，在django里是一个个的html文件</p><pre><code> &#123;     &#39;BACKEND&#39;: &#39;django.template.backends.django.DjangoTemplates&#39;,     &#39;DIRS&#39;: [],     &#39;APP_DIRS&#39;: True,     &#39;OPTIONS&#39;: &#123;         &#39;context_processors&#39;: [             &#39;django.template.context_processors.debug&#39;,             &#39;django.template.context_processors.request&#39;,             &#39;django.contrib.auth.context_processors.auth&#39;,             &#39;django.contrib.messages.context_processors.messages&#39;,         ],     &#125;, &#125;,</code></pre><p> ]</p><p> WSGI_APPLICATION = ‘myblog.wsgi.application’</p><h1 id="Database"><a href="#Database" class="headerlink" title="Database"></a>Database</h1><h1 id="https-docs-djangoproject-com-en-1-11-ref-settings-databases"><a href="#https-docs-djangoproject-com-en-1-11-ref-settings-databases" class="headerlink" title="https://docs.djangoproject.com/en/1.11/ref/settings/#databases"></a><a href="https://docs.djangoproject.com/en/1.11/ref/settings/#databases">https://docs.djangoproject.com/en/1.11/ref/settings/#databases</a></h1><p> DATABASES = {                #数据库配置</p><pre><code> &#39;default&#39;: &#123;     &#39;ENGINE&#39;: &#39;django.db.backends.sqlite3&#39;,     &#39;NAME&#39;: os.path.join(BASE_DIR, &#39;db.sqlite3&#39;), &#125;</code></pre><p> }</p><h1 id="Password-validation"><a href="#Password-validation" class="headerlink" title="Password validation"></a>Password validation</h1><h1 id="https-docs-djangoproject-com-en-1-11-ref-settings-auth-password-validators"><a href="#https-docs-djangoproject-com-en-1-11-ref-settings-auth-password-validators" class="headerlink" title="https://docs.djangoproject.com/en/1.11/ref/settings/#auth-password-validators"></a><a href="https://docs.djangoproject.com/en/1.11/ref/settings/#auth-password-validators">https://docs.djangoproject.com/en/1.11/ref/settings/#auth-password-validators</a></h1><p> AUTH_PASSWORD_VALIDATORS = [        #密码认证</p><pre><code> &#123;     &#39;NAME&#39;: &#39;django.contrib.auth.password_validation.UserAttributeSimilarityValidator&#39;, &#125;, &#123;     &#39;NAME&#39;: &#39;django.contrib.auth.password_validation.MinimumLengthValidator&#39;, &#125;, &#123;     &#39;NAME&#39;: &#39;django.contrib.auth.password_validation.CommonPasswordValidator&#39;, &#125;, &#123;     &#39;NAME&#39;: &#39;django.contrib.auth.password_validation.NumericPasswordValidator&#39;, &#125;,</code></pre><p> ]</p><h1 id="Internationalization"><a href="#Internationalization" class="headerlink" title="Internationalization"></a>Internationalization</h1><h1 id="https-docs-djangoproject-com-en-1-11-topics-i18n"><a href="#https-docs-djangoproject-com-en-1-11-topics-i18n" class="headerlink" title="https://docs.djangoproject.com/en/1.11/topics/i18n/"></a><a href="https://docs.djangoproject.com/en/1.11/topics/i18n/">https://docs.djangoproject.com/en/1.11/topics/i18n/</a></h1><p> LANGUAGE_CODE = ‘en-us’</p><p> TIME_ZONE = ‘UTC’</p><p> USE_I18N = True</p><p> USE_L10N = True</p><p> USE_TZ = True</p><h1 id="Static-files-CSS-JavaScript-Images"><a href="#Static-files-CSS-JavaScript-Images" class="headerlink" title="Static files (CSS, JavaScript, Images)"></a>Static files (CSS, JavaScript, Images)</h1><h1 id="https-docs-djangoproject-com-en-1-11-howto-static-files"><a href="#https-docs-djangoproject-com-en-1-11-howto-static-files" class="headerlink" title="https://docs.djangoproject.com/en/1.11/howto/static-files/"></a><a href="https://docs.djangoproject.com/en/1.11/howto/static-files/">https://docs.djangoproject.com/en/1.11/howto/static-files/</a></h1><p> STATIC_URL = ‘/static/‘</p></li><li><p><em>init</em>.py<br>python中声明模块的文件<br>内容默认为空</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>django框架博客开发-1</title>
      <link href="2017/04/10/django%E6%A1%86%E6%9E%B6%E5%8D%9A%E5%AE%A2%E5%BC%80%E5%8F%91-1/"/>
      <url>2017/04/10/django%E6%A1%86%E6%9E%B6%E5%8D%9A%E5%AE%A2%E5%BC%80%E5%8F%91-1/</url>
      
        <content type="html"><![CDATA[<h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><h2 id="安装python"><a href="#安装python" class="headerlink" title="安装python"></a>安装python</h2><span id="more"></span><p>python官网：<a href="https://www.python.org/">https://www.python.org</a></p><pre><code>//实际环境python2.7.13</code></pre><h2 id="安装django"><a href="#安装django" class="headerlink" title="安装django"></a>安装django</h2><p>django官网：<a href="https://www.djangoproject.com/">https://www.djangoproject.com</a><br>安装命令</p><pre><code>pip install Django==1.11</code></pre>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>电子商务网站开发-1-需求分析</title>
      <link href="2017/04/09/%E7%94%B5%E5%AD%90%E5%95%86%E5%8A%A1%E7%BD%91%E7%AB%99%E5%BC%80%E5%8F%91-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90/"/>
      <url>2017/04/09/%E7%94%B5%E5%AD%90%E5%95%86%E5%8A%A1%E7%BD%91%E7%AB%99%E5%BC%80%E5%8F%91-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h2 id="功能分析"><a href="#功能分析" class="headerlink" title="功能分析"></a>功能分析</h2><span id="more"></span><h2 id="一丶前台"><a href="#一丶前台" class="headerlink" title="一丶前台"></a>一丶前台</h2><ol><li>用户登录：验证用户登录输入的用户名和密码</li><li>用户注册：要求提供用户的详细资料</li><li>商品浏览：用户对本站提供的商品进行浏览</li><li>商品详情：查看商品的详细信息</li></ol><h2 id="二丶后台"><a href="#二丶后台" class="headerlink" title="二丶后台"></a>二丶后台</h2><ol><li>管理员模块：添加管理员，管理员列表，编辑管理员信息，删除管理员</li><li>商品分类模块：添加分类，分类列表，编辑分类，删除分类</li><li>商品管理模块：添加商品，商品列表，编辑商品，删除商品</li><li>用户管理模块：添加用户，用户列表，编辑用户，删除用户</li><li>商品图片模块：添加文字水印，添加图片水印<br><img src="http://www.worileqing.top/usr/uploads/2017/04/803895375.png" alt="需求分析.png"></li></ol><h1 id="性能需求"><a href="#性能需求" class="headerlink" title="性能需求"></a>性能需求</h1><h2 id="数据精确度"><a href="#数据精确度" class="headerlink" title="数据精确度"></a>数据精确度</h2><ol><li>   在执行数据的增加、删除、修改操作时，不允许因为程序原因导致操作失败。</li><li>   在执行数据增加时，不允许发生多增加或重复增加数据的情况。</li><li>   在执行数据删除时，不允许发生多删除数据的情况。</li><li>   在执行数据删除时，对有关联的数据要求删除完全，如不能删除，请给予提示。</li><li>   在执行数据修改时，也要求保持对应的准确性。</li></ol><h2 id="时间特性"><a href="#时间特性" class="headerlink" title="时间特性"></a>时间特性</h2><ol><li>在管理员执行增加删除等操作时，数据库响应时间要求在2秒之内。</li><li>Web用户浏览时，页面响应时间要求在4秒之内。<h2 id="支持软件"><a href="#支持软件" class="headerlink" title="支持软件"></a>支持软件</h2></li></ol><p>客户端软件<br>    操作系统：Windows7、Liunx、UNIX.<br>    浏览器：IE、FireFox、Chrome等</p><p>服务器端软件<br>操作系统：Windows NT / 2000 Server 或更高版本、Liunx、UNIX.<br>Web服务器：Apache2.0以上版本。<br>数据库产品：MYSQL5.0 以上版本。<br>服务器脚本：PHP5.2以上版本</p>]]></content>
      
      
      <categories>
          
          <category> php </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>搭建一个简易的成绩管理系统的数据库</title>
      <link href="2017/04/08/%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AE%80%E6%98%93%E7%9A%84%E6%88%90%E7%BB%A9%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
      <url>2017/04/08/%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AE%80%E6%98%93%E7%9A%84%E6%88%90%E7%BB%A9%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93/</url>
      
        <content type="html"><![CDATA[<h2 id="搭建一个简易的成绩管理系统的数据库"><a href="#搭建一个简易的成绩管理系统的数据库" class="headerlink" title="搭建一个简易的成绩管理系统的数据库"></a>搭建一个简易的成绩管理系统的数据库</h2><span id="more"></span><p>介绍</p><p>现需要构建一个简易的成绩管理系统的数据库，来记录几门课程的学生成绩。数据库中有三张表分别用于记录学生信息、课程信息和成绩信息。</p><p>数据库表的数据如下：</p><p>学生表(student)：学生 id 、学生姓名和性别</p><p><img src="http://www.worileqing.top/usr/uploads/2017/04/720951952.png" alt="wm.png"></p><p>课程表：课程 id 和课程名</p><p><img src="http://www.worileqing.top/usr/uploads/2017/04/2016092415.png" alt="wm (1).png"></p><p>成绩表：成绩 id 、学生 id 、课程 id 和分数</p><p><img src="http://www.worileqing.top/usr/uploads/2017/04/2667079332.png" alt="wm (2).png"></p><p>服务器中的 MySQL 还没有启动，请注意 MySQL 的 root 账户默认密码为空。</p><p>目标</p><p>1.MySQL 服务处于运行状态</p><p>2.新建数据库的名称为 gradesystem</p><p>3.gradesystem 包含三个表：student、course、mark；</p><p>student 表包含3列：sid(主键)、sname、gender；<br>course 表包含2列：cid(主键)、cname；<br>mark 表包含4列：mid(主键)、sid、cid、score ，注意与其他两个表主键之间的关系。<br>4.将上述表中的数据分别插入到各个表中</p><h2 id="参考答案"><a href="#参考答案" class="headerlink" title="参考答案"></a>参考答案</h2><p><img src="http://www.worileqing.top/usr/uploads/2017/04/474272057.png" alt="1491024981007.png"></p><h2 id="1"><a href="#1" class="headerlink" title="1"></a>1</h2><p> CREATE DATABASE gradesystem;</p><p>use gradesystem;</p><p>CREATE TABLE student(sid INT(10) PRIMARY KEY, sname CHAR(20), gender ENUM(‘male’, ‘female’)); INSERT INTO student VALUES(1, ‘Tom’, ‘male’); INSERT INTO student VALUES(2, ‘Jack’, ‘male’); INSERT INTO student VALUES(3, ‘Rose’, ‘female’);</p><p>CREATE TABLE course(cid INT(10) PRIMARY KEY, cname CHAR(20)); INSERT INTO course VALUES(1, ‘math’); INSERT INTO course VALUES(2, ‘physics’); INSERT INTO course VALUES(3, ‘chemistry’);</p><p>CREATE TABLE mark( mid INT(10) PRIMARY KEY, sid INT(10), cid INT(10), CONSTRAINT sid_kf FOREIGN KEY (sid) REFERENCES student(sid), CONSTRAINT cid_kf FOREIGN KEY (cid) REFERENCES course(sid), score INT(10) ); INSERT INTO mark VALUES(1, 1, 1, 80); INSERT INTO mark VALUES(2, 2, 1, 85); INSERT INTO mark VALUES(3, 3, 1, 90); INSERT INTO mark VALUES(4, 1, 2, 60); INSERT INTO mark VALUES(5, 2, 2, 90); INSERT INTO mark VALUES(6, 3, 2, 75); INSERT INTO mark VALUES(7, 1, 3, 90); INSERT INTO mark VALUES(8, 2, 3, 75); INSERT INTO mark VALUES(9, 3, 3, 85);</p><h2 id="2"><a href="#2" class="headerlink" title="2"></a>2</h2><ol><li>sudo service mysql start</li><li>mysql -u root</li><li>show databases;</li><li>create database gradesystem;</li><li>use gradesystem;</li><li>show tables;</li><li>create table student<br>-&gt;( sid int (10)PRIMARY KEY,<br>-&gt;sname char(20),<br>-&gt;gender char(5));</li><li>alter table student<br>alter column gender char(10));</li><li>create table course<br>(<br>cid int(10)primary key,<br>cname char(20));</li><li>create table mark<br>(mid int(10)primary key,<br>sid int(10),<br>cid int(10),<br>score int(10),<br>constraint sid_fk foreign key(sid) references student(sid)<br>constraint cid_fk foreign key(cid) references course(cid));</li><li>insert into table student values(1,’tom’,’male’);<br>insert into table student values(2,’jack’,’male’);<br>insert into table student values(3,’rose’,’male’);</li><li>insert into course values(1,’math’)<br>insert into course values(2,’physics’);<br>insert into course values(3,’chemistry’);</li><li>insert into mark values(1,1,1,80);<br>insert into mark values(2,2,1,85);<br>insert into mark values(3,3,1,90);<br>insert into mark values(4,1,2,60);<br>insert into mark values(6,3,2,75);<br>insert into mark values(7,1,3,95);<br>insert into mark values(8,2,3,75);<br>insert into mark values(9,3,3,85);</li><li>select *from mark;</li></ol>]]></content>
      
      
      <categories>
          
          <category> MySQL </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>laravel学习-1</title>
      <link href="2017/04/06/laravel%E5%AD%A6%E4%B9%A0-1/"/>
      <url>2017/04/06/laravel%E5%AD%A6%E4%B9%A0-1/</url>
      
        <content type="html"><![CDATA[<p>laravel基础</p><span id="more"></span><?php/*|--------------------------------------------------------------------------| Routes File|--------------------------------------------------------------------------|| Here is where you will register all of the routes in an application.| It's a breeze. Simply tell Laravel the URIs it should respond to| and give it the controller to call when that URI is requested.|*/Route::get('/', function () {    return view('welcome');});//基础路由Route::get('basic1',function(){    return 'helloworld';});Route::post('basic2',function(){    return 'basic2';});//多请求路由Route::match(['get','post'],'multy1',function(){    return 'multy1';});Route::any('multy2',function (){    return 'multy2';});//路由参数/*Route::get('user/{ke?}',function($ke=null){    return $ke;});*//*Route::get('user/{id?}',function($id){    return $id;})->where('id','[A-Za-z]+');*///Route::get('user/{id?}/{name?}',function($id,$name ='ke'){//    return $name.$id;//})->where(['id' => '[0-9]+' ,'name' => '[A-Za-z]+']);//路由别名//Route::get('user/11center',['as'=> 'center' , function() {//    return route('center');//}]);//路由群组//Route::group(['prefix'=>'member'],function (){////    Route::get('user/center',['as'=>'center',function(){//        return route('center');//    }]);//    Route::any('multy2',function (){//        return 'member-multy2';//    });//});//路由视图Route::get('view',function (){    return view('welcome');});//Route::get('member/info','MemberController@info');//Route::match(['get'],'member/info',[//    'uses'=>'MemberController@info',//    'as'=>'memberinfo'//]);route::any('/member/{id}','MemberController@info')->where('id','[0-9]+');//注意ID是大括号/*|--------------------------------------------------------------------------| Application Routes|--------------------------------------------------------------------------|| This route group applies the "web" middleware group to every route| it contains. The "web" middleware group is defined in your HTTP| kernel and includes session state, CSRF protection, and more.|*/Route::group(['middleware' => ['web']], function () {    //});]]></content>
      
      
      <categories>
          
          <category> php </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>php面试题-1</title>
      <link href="2017/04/06/php%E9%9D%A2%E8%AF%95%E9%A2%98-1/"/>
      <url>2017/04/06/php%E9%9D%A2%E8%AF%95%E9%A2%98-1/</url>
      
        <content type="html"><![CDATA[<h2 id="Ⅰ谈谈你对http协议的理解"><a href="#Ⅰ谈谈你对http协议的理解" class="headerlink" title="Ⅰ谈谈你对http协议的理解"></a>Ⅰ谈谈你对http协议的理解</h2><span id="more"></span><p>1.首先http（超文本传输协议）其处于OSI7层模型中的应用层，OSI7层模型分别为应用层-》表示层-》会话层-》传输层-》网络层-》数据链路层-》物理层，对于这7层模型，我们应该大致的了解每一层是干嘛的，这个是必须的，在此就不一一说明。</p><p>2.http事物是指从客户端（IE）向服务器端发送http请求，再由服务器将响应的内容返发回给客户端的一个过程。</p><p>3.http链接是通过tcp链接，首先客户端会打开一条连向服务器端的链接，然后开始发送http请求，接着由服务器返发响应的内容，当客户端接受后就断开此链接，这样一次客户端与服务器端的通信就结束了。</p><p>4.http报文：由客户端向服务器端发送的http请求和从服务器端发送到客户端响应的内容都是http报文，其格式为：起始行、头部（HEAD）、主体(BODY<br>对于报文的理解，在这里向大家推荐一个工具叫：fiddler。通过它可以详细的看到http报文的组成结构和具体的内容。</p><p>5.http中的方法分为5种：增（PUT）、删(DELETE)、改(POST)、查(GET)、HEAD</p><p>6.MIME（多用途网络邮箱扩展）类型：对象类型/特定子类型，如:image/png，通过fiddler可在http请求的起始行中看到。</p><p>7.发送http请求的目的是为了请求某一资源，然后由服务器返回客户端需要的资源，客户端（IE）通过解析将其显示出来，这里的资源是如何标识的呢？其实是通过URI(Uniform Resource Identifier)统一资源标识符，其主要有2中形式：URL（统一资源定位符）和URN（统一资源名称），目前最常用的是URL。</p><h2 id="Ⅱ谈谈对ajax的理解"><a href="#Ⅱ谈谈对ajax的理解" class="headerlink" title="Ⅱ谈谈对ajax的理解"></a>Ⅱ谈谈对ajax的理解</h2><p>Ajax的全称是Asynchronous JavaScript and XML 中文名称定义为异步的JavaScript和XML。ajax是JavaScript、XML、CSS、DOM等多种已有技术的组合，它可以实现客户端的异步请求操作，这样可以实现在不需要刷新页面的情况下与服务器进行通信，从而减少用户的等待时间。</p><h2 id="Ⅲ谈谈对数据库事务的理解"><a href="#Ⅲ谈谈对数据库事务的理解" class="headerlink" title="Ⅲ谈谈对数据库事务的理解"></a>Ⅲ谈谈对数据库事务的理解</h2><p>数据库事务(Database Transaction) ，是指作为单个逻辑工作单元执行的一系列操作，要么完全地执行，要么完全地不执行。 事务处理可以确保除非事务性单元内的所有操作都成功完成，否则不会永久更新面向数据的资源。通过将一组相关操作组合为一个要么全部成功要么全部失败的单元，可以简化错误恢复并使应用程序更加可靠。一个逻辑工作单元要成为事务，必须满足所谓的ACID（原子性、一致性、隔离性和持久性）属性。事务是数据库运行中的逻辑工作单位，由DBMS中的事务管理子系统负责事务的处理。</p><h2 id="Ⅳ谈谈序列化的作用"><a href="#Ⅳ谈谈序列化的作用" class="headerlink" title="Ⅳ谈谈序列化的作用"></a>Ⅳ谈谈序列化的作用</h2><p>序列化 (Serialization)将对象的状态信息转换为可以存储或传输的形式的过程。在序列化期间，对象将其当前状态写入到临时或持久性存储区。以后，可以通过从存储区中读取或反序列化对象的状态，重新创建该对象。<br>序列化使其他代码可以查看或修改那些不序列化便无法访问的对象实例数据。确切地说，代码执行序列化需要特殊的权限：即指定了 SerializationFormatter 标志的 SecurityPermission。在默认策略下，通过 Internet 下载的代码或 Internet 代码不会授予该权限；只有本地计算机上的代码才被授予该权限。<br>通常，对象实例的所有字段都会被序列化，这意味着数据会被表示为实例的序列化数据。这样，能够解释该格式的代码有可能能够确定这些数据的值，而不依赖于该成员的可访问性。类似地，反序列化从序列化的表示形式中提取数据，并直接设置对象状态，这也与可访问性规则无关。<br>对于任何可能包含重要的安全性数据的对象，如果可能，应该使该对象不可序列化。如果它必须为可序列化的，请尝试生成特定字段来保存不可序列化的重要数据。如果无法实现这一点，则应注意该数据会被公开给任何拥有序列化权限的代码，并确保不让任何恶意代码获得该权限。</p><h2 id="Ⅴ写出你所知道的数据库的优化方法"><a href="#Ⅴ写出你所知道的数据库的优化方法" class="headerlink" title="Ⅴ写出你所知道的数据库的优化方法"></a>Ⅴ写出你所知道的数据库的优化方法</h2><p>1、创建索引<br>对于查询占主要的应用来说，索引显得尤为重要。很多时候性能问题很简单的就是因为我们忘了添加索引而造成的，或者说没有添加更为有效的索引导致。如果不加索引的话，那么查找任何哪怕只是一条特定的数据都会进行一次全表扫描，如果一张表的数据量很大而符合条件的结果又很少，那么不加索引会引起致命的性能下降。但是也不是什么情况都非得建索引不可，比如性别可能就只有两个值，建索引不仅没什么优势，还会影响到更新速度，这被称为过度索引。<br>2、复合索引<br>比如有一条语句是这样的：select * from users where area=’beijing’ and age=22;<br>如果我们是在area和age上分别创建单个索引的话，由于mysql查询每次只能使用一个索引，所以虽然这样已经相对不做索引时全表扫描提高了很多效率，但是如果在area、age两列上创建复合索引的话将带来更高的效率。如果我们创建了(area, age, salary)的复合索引，那么其实相当于创建了(area,age,salary)、(area,age)、(area)三个索引，这被称为最佳左前缀特性。因此我们在创建复合索引时应该将最常用作限制条件的列放在最左边，依次递减。<br>3、索引不会包含有NULL值的列<br>只要列中包含有NULL值都将不会被包含在索引中，复合索引中只要有一列含有NULL值，那么这一列对于此复合索引就是无效的。所以我们在数据库设计时不要让字段的默认值为NULL。<br>4、使用短索引<br>对串列进行索引，如果可能应该指定一个前缀长度。例如，如果有一个CHAR(255)的 列，如果在前10 个或20 个字符内，多数值是惟一的，那么就不要对整个列进行索引。短索引不仅可以提高查询速度而且可以节省磁盘空间和I/O操作。<br>5、排序的索引问题<br>mysql查询只使用一个索引，因此如果where子句中已经使用了索引的话，那么order by中的列是不会使用索引的。因此数据库默认排序可以符合要求的情况下不要使用排序操作；尽量不要包含多个列的排序，如果需要最好给这些列创建复合索引。<br>6、like语句操作<br>一般情况下不鼓励使用like操作，如果非使用不可，如何使用也是一个问题。like “%aaa%” 不会使用索引而like “aaa%”可以使用索引。<br>7、不要在列上进行运算<br>select * from users where YEAR(adddate)&lt;2007;<br>将在每个行上进行运算，这将导致索引失效而进行全表扫描，因此我们可以改成<br>select * from users where adddate&lt;‘2007-01-01’;<br>8、不使用NOT IN和&lt;&gt;操作<br>NOT IN和&lt;&gt;操作都不会使用索引将进行全表扫描。NOT IN可以NOT EXISTS代替，id&lt;&gt;3则可使用id&gt;3 or id&lt;3来代替。</p><h2 id="Ⅵ写出你所知道的排序方法并说出他们的时间复杂度空间复杂度以及稳定性"><a href="#Ⅵ写出你所知道的排序方法并说出他们的时间复杂度空间复杂度以及稳定性" class="headerlink" title="Ⅵ写出你所知道的排序方法并说出他们的时间复杂度空间复杂度以及稳定性"></a>Ⅵ写出你所知道的排序方法并说出他们的时间复杂度空间复杂度以及稳定性</h2><p><a href="http://blog.chinaunix.net/attachment/201201/18/21457204_1326898064RUxx.jpg">http://blog.chinaunix.net/attachment/201201/18/21457204_1326898064RUxx.jpg</a></p><h2 id="Ⅶ简述cookie和session"><a href="#Ⅶ简述cookie和session" class="headerlink" title="Ⅶ简述cookie和session"></a>Ⅶ简述cookie和session</h2><p>cookie是一种在客户浏览器端存储数据并以此来跟踪和识别用户的机制。<br>session 用来在服务器端保存用户的状态信息。<br>cookie数据存放在客户的浏览器上，服务器端不用保存。session数据放在服务器上，本地内存也有一份。<br>cookie安全性不如session。因为普通cookie保存在本地硬盘上，黑客可以伪造url等方式发起xss攻击，获取本地硬盘保存状态的cookie，进而窃取用户的敏感信息。<br>session则不同，只有在用户登录此网站时发起xss攻击才能获取session信息，关闭浏览器之后，session即被销毁，安全性较cookie要好<br>Cookie支持跨域名访问，Session仅在他所在的域名内有效。<br>cookie的保存内容大小有限制。</p><h2 id="Ⅷtcp与udp有什么差别，列举几个基于udp和tcp的协议"><a href="#Ⅷtcp与udp有什么差别，列举几个基于udp和tcp的协议" class="headerlink" title="Ⅷtcp与udp有什么差别，列举几个基于udp和tcp的协议"></a>Ⅷtcp与udp有什么差别，列举几个基于udp和tcp的协议</h2><p>TCP—传输控制协议,提供的是面向连接、可靠的字节流服务。当客户和服务器彼此交换数据前，必须先在双方之间建立一个TCP连接，之后才能传输数据。TCP提供超时重发，丢弃重复数据，检验数据，流量控制等功能，保证数据能从一端传到另一端。<br>UDP—用户数据报协议，是一个简单的面向数据报的运输层协议。UDP不提供可靠性，它只是把应用程序传给IP层的数据报发送出去，但是并不能保证它们能到达目的地。由于UDP在传输数据报前不用在客户和服务器之间建立一个连接，且没有超时重发等机制，故而传输速度很快<br>TCP是面向连接的，有比较高的可靠性，<br>一些要求比较高的服务一般使用这个协议，如FTP、Telnet、SMTP、HTTP、POP3等，而UDP是面向无连接的，使用这个协议的常见服务有DNS、SNMP、QQ等。对于QQ必须另外说明一下，QQ2003以前是只使用UDP协议的，其服务器使用8000端口，侦听是否有信息传来，客户端使用4000端口，向外发送信息（这也就不难理解在一般的显IP的QQ版本中显示好友的IP地址信息中端口常为4000或其后续端口的原因了），即QQ程序既接受服务又提供服务，在以后的QQ版本中也支持使用TCP协议了。</p>]]></content>
      
      
      <categories>
          
          <category> php </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>python爬取微博</title>
      <link href="2017/04/05/python%E7%88%AC%E5%8F%96%E5%BE%AE%E5%8D%9A/"/>
      <url>2017/04/05/python%E7%88%AC%E5%8F%96%E5%BE%AE%E5%8D%9A/</url>
      
        <content type="html"><![CDATA[<p>   微博算是用的比较多了，但是一条一条的翻看<br>太过于麻烦，无奈爬取之。</p><span id="more"></span><ul><li><strong>环境：win7+python2.7；</strong></li><li>python模块：request；bs4；beautifulsoup4；lxml；</li><li><strong>chrome浏览器</strong></li><li>实现过程：<h2 id="获取cookie："><a href="#获取cookie：" class="headerlink" title="获取cookie："></a><strong>获取cookie</strong>：</h2>打开chrome然后Ctrl+Shift+I调出开发者工具，点击tooggle device toolbar(Ctrl+shift+M)然后在Responsive选择合适的设备，<img src="http://i.imgur.com/D0MMgUl.png">我这里选择的是nexus5X，接下来打开weibo.com这时候应该看到的就是手机端网页的微博登录页面。<img src="http://i.imgur.com/xKxzCUN.png">在开发者工具中选中Network–Preserve log，然后登录微博。在开发者工具中找到有关m.weibo.cn的复制自己的cookie<img src="http://i.imgur.com/EwCHQaS.png"><h2 id="获取你想爬取微博的user-id："><a href="#获取你想爬取微博的user-id：" class="headerlink" title="获取你想爬取微博的user_id："></a><strong>获取你想爬取微博的user_id</strong>：</h2>就是你要爬取的微博的主页网址中weibo.com/u/后面的数字部分<img src="http://i.imgur.com/0aANYrF.png"><h2 id="开始利用python脚本爬取"><a href="#开始利用python脚本爬取" class="headerlink" title="开始利用python脚本爬取"></a>开始利用python脚本爬取</h2>这是python程序的源码：</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">#-*-coding:utf8-*-</span><br><span class="line">import re</span><br><span class="line">import string</span><br><span class="line">import sys</span><br><span class="line">import os</span><br><span class="line">import urllib</span><br><span class="line">import urllib2</span><br><span class="line">from bs4 import BeautifulSoup</span><br><span class="line">import requests</span><br><span class="line">from lxml import etree</span><br><span class="line"></span><br><span class="line">reload(sys) </span><br><span class="line">sys.setdefaultencoding(&#39;utf-8&#39;)</span><br><span class="line">if(len(sys.argv)&gt;&#x3D;2):</span><br><span class="line">    user_id &#x3D; (int)(sys.argv[1])</span><br><span class="line">else:</span><br><span class="line">    user_id &#x3D; (int)(raw_input(u&quot;请输入user_id: &quot;))</span><br><span class="line"></span><br><span class="line">cookie &#x3D; &#123;&quot;Cookie&quot;: &quot;#your cookie&quot;&#125;</span><br><span class="line">url &#x3D; &#39;http:&#x2F;&#x2F;weibo.cn&#x2F;u&#x2F;%d?filter&#x3D;1&amp;page&#x3D;1&#39;%user_id</span><br><span class="line"></span><br><span class="line">html &#x3D; requests.get(url, cookies &#x3D; cookie).content</span><br><span class="line">selector &#x3D; etree.HTML(html)</span><br><span class="line">pageNum &#x3D; (int)(selector.xpath(&#39;&#x2F;&#x2F;input[@name&#x3D;&quot;mp&quot;]&#39;)[0].attrib[&#39;value&#39;])</span><br><span class="line"></span><br><span class="line">result &#x3D; &quot;&quot; </span><br><span class="line">urllist_set &#x3D; set()</span><br><span class="line">word_count &#x3D; 1</span><br><span class="line">image_count &#x3D; 1</span><br><span class="line">print u&#39;爬虫准备就绪...&#39;</span><br><span class="line"></span><br><span class="line">for page in range(1,pageNum+1):</span><br><span class="line"></span><br><span class="line">  #获取lxml页面</span><br><span class="line">  url &#x3D; &#39;http:&#x2F;&#x2F;weibo.cn&#x2F;u&#x2F;%d?filter&#x3D;1&amp;page&#x3D;%d&#39;%(user_id,page) </span><br><span class="line">  lxml &#x3D; requests.get(url, cookies &#x3D; cookie).content</span><br><span class="line"></span><br><span class="line">  #文字爬取</span><br><span class="line">  selector &#x3D; etree.HTML(lxml)</span><br><span class="line">  content &#x3D; selector.xpath(&#39;&#x2F;&#x2F;span[@class&#x3D;&quot;ctt&quot;]&#39;)</span><br><span class="line">  for each in content:</span><br><span class="line">    text &#x3D; each.xpath(&#39;string(.)&#39;)</span><br><span class="line">    if word_count&gt;&#x3D;4:</span><br><span class="line">      text &#x3D; &quot;%d :&quot;%(word_count-3) +text+&quot;\n\n&quot;</span><br><span class="line">    else :</span><br><span class="line">      text &#x3D; text+&quot;\n\n&quot;</span><br><span class="line">    result &#x3D; result + text</span><br><span class="line">    word_count +&#x3D; 1</span><br><span class="line"></span><br><span class="line">  #图片爬取</span><br><span class="line">  soup &#x3D; BeautifulSoup(lxml, &quot;lxml&quot;)</span><br><span class="line">  urllist &#x3D; soup.find_all(&#39;a&#39;,href&#x3D;re.compile(r&#39;^http:&#x2F;&#x2F;weibo.cn&#x2F;mblog&#x2F;oripic&#39;,re.I))</span><br><span class="line">  first &#x3D; 0</span><br><span class="line">  for imgurl in urllist:</span><br><span class="line">    urllist_set.add(requests.get(imgurl[&#39;href&#39;], cookies &#x3D; cookie).url)</span><br><span class="line">    image_count +&#x3D;1</span><br><span class="line"></span><br><span class="line">fo &#x3D; open(&quot;&#x2F;Users&#x2F;Personals&#x2F;%s&quot;%user_id, &quot;wb&quot;)</span><br><span class="line">fo.write(result)</span><br><span class="line">word_path&#x3D;os.getcwd()+&#39;&#x2F;%d&#39;%user_id</span><br><span class="line">print u&#39;文字微博爬取完毕&#39;</span><br><span class="line"></span><br><span class="line">link &#x3D; &quot;&quot;</span><br><span class="line">fo2 &#x3D; open(&quot;&#x2F;Users&#x2F;Personals&#x2F;%s_imageurls&quot;%user_id, &quot;wb&quot;)</span><br><span class="line">for eachlink in urllist_set:</span><br><span class="line">  link &#x3D; link + eachlink +&quot;\n&quot;</span><br><span class="line">fo2.write(link)</span><br><span class="line">print u&#39;图片链接爬取完毕&#39;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if not urllist_set:</span><br><span class="line">  print u&#39;该页面中不存在图片&#39;</span><br><span class="line">else:</span><br><span class="line">  #下载图片,保存在当前目录的pythonimg文件夹下</span><br><span class="line">  image_path&#x3D;os.getcwd()+&#39;&#x2F;weibo_image&#39;</span><br><span class="line">  if os.path.exists(image_path) is False:</span><br><span class="line">    os.mkdir(image_path)</span><br><span class="line">  x&#x3D;1</span><br><span class="line">  for imgurl in urllist_set:</span><br><span class="line">    temp&#x3D; image_path + &#39;&#x2F;%s.jpg&#39; % x</span><br><span class="line">    print u&#39;正在下载第%s张图片&#39; % x</span><br><span class="line">    try:</span><br><span class="line">      urllib.urlretrieve(urllib2.urlopen(imgurl).geturl(),temp)</span><br><span class="line">    except:</span><br><span class="line">      print u&quot;该图片下载失败:%s&quot;%imgurl</span><br><span class="line">    x+&#x3D;1</span><br><span class="line"></span><br><span class="line">print u&#39;原创微博爬取完毕，共%d条，保存路径%s&#39;%(word_count-4,word_path)</span><br><span class="line">print u&#39;微博图片爬取完毕，共%d张，保存路径%s&#39;%(image_count-1,image_path)</span><br></pre></td></tr></table></figure><p>可以将上面的代码保存为wb.py然后在cmd里面运行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python wb.py</span><br></pre></td></tr></table></figure><p>大功告成</p><hr><p>***2016/12/29 星期四 3:16:40 ***</p><h2 id="补充："><a href="#补充：" class="headerlink" title="补充："></a><em>补充：</em></h2><p>python模块的安装可以用easy_install的命令安装 例如</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">easy_install lxml</span><br></pre></td></tr></table></figure><hr><hr><p>python模块pip安装：<a href="http://jingyan.baidu.com/article/e73e26c0d94e0524adb6a7ff.html">http://jingyan.baidu.com/article/e73e26c0d94e0524adb6a7ff.html</a><br>用Python写一个简单的微博爬虫: <a href="http://www.jianshu.com/p/7c5a4d7545ca">http://www.jianshu.com/p/7c5a4d7545ca</a><br>Microsoft Visual C++ Compiler for Python 2.7:<br><a href="http://www.microsoft.com/en-us/download/details.aspx?id=44266">http://www.microsoft.com/en-us/download/details.aspx?id=44266</a></p>]]></content>
      
      
      <categories>
          
          <category> old </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>VMware安装MacOS</title>
      <link href="2017/04/05/VMware%E5%AE%89%E8%A3%85MacOS%20/"/>
      <url>2017/04/05/VMware%E5%AE%89%E8%A3%85MacOS%20/</url>
      
        <content type="html"><![CDATA[<hr><p>title: VMware安装MacOS<br>date: 2017-01-05 16:51:55<br>tags: mac</p><hr><h2 id="准备工作："><a href="#准备工作：" class="headerlink" title="准备工作："></a>准备工作：</h2><p>VMware12<br>OX 10.12 Sierra镜像cdr<br>Unlocker208–VMware上的Mac补丁<br>（bios intelVT开启）<br><strong>工具地址</strong>：链接：</p><span id="more"></span><p><a href="http://pan.baidu.com/s/1nv0iiZB">http://pan.baidu.com/s/1nv0iiZB</a> 密码：f1tw<br><strong>VMware Workstation 12序列号</strong>: 5A02H-AU243-TZJ49-GTC7K-3C61N </p><h2 id="安装过程"><a href="#安装过程" class="headerlink" title="安装过程"></a>安装过程</h2><ol><li>安装VMware</li><li>安装mac补丁<br>解压unlocker208，右键win-install.cmd以管理员运行，然后等待cmd窗口自己关闭，unlocker208安装完成</li><li>安装VMware里面的mac<br>上述工作准备完成后新建虚拟机里面就会多出Apple Mac OS X(M)选项，安转即可</li><li>不可恢复错误解决问题解决 mac安转完成打开出现提示不可恢复错误，此时进入虚拟机安装目录用记事本类的编辑器，编辑macOS 10.12.vmx加入以下代码：<br><code>smc.version = &quot;0&quot;</code></li></ol><p><strong>完工</strong></p><h2 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h2><p>VMware优化：<a href="http://blog.csdn.net/whitehack/article/details/47074403/">http://blog.csdn.net/whitehack/article/details/47074403/</a></p>]]></content>
      
      
      <categories>
          
          <category> old </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>通过路由器自定义host与连接设备共享host</title>
      <link href="2017/04/05/%E9%80%9A%E8%BF%87%E8%B7%AF%E7%94%B1%E5%99%A8%E8%87%AA%E5%AE%9A%E4%B9%89host%E4%B8%8E%E8%BF%9E%E6%8E%A5%E8%AE%BE%E5%A4%87%E5%85%B1%E4%BA%ABhost/"/>
      <url>2017/04/05/%E9%80%9A%E8%BF%87%E8%B7%AF%E7%94%B1%E5%99%A8%E8%87%AA%E5%AE%9A%E4%B9%89host%E4%B8%8E%E8%BF%9E%E6%8E%A5%E8%AE%BE%E5%A4%87%E5%85%B1%E4%BA%ABhost/</url>
      
        <content type="html"><![CDATA[<p>次奥</p><span id="more"></span><h2 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h2><p>我的路由器是newifi现在刷的是Pandorabox是基于openwrt的路由系统，系统集成的dhcp/dns服务可以自定义host<img src="http://i.imgur.com/wjaVIrT.png">。用winscp连接路由上传我们的host文件到路由，然后在路由设置里的额外的hosts文件打钩，填入我们刚刚的host。然后ssh连接路由输入命令<br><code>/etc/init.d/dnsmasq restart</code><br>Ps：如果是电脑本地的dns不能使用自定义的，需要改为路由器的dns，其实直接改为自动获取dns就行了。</p><h2 id="host"><a href="#host" class="headerlink" title="host"></a>host</h2>]]></content>
      
      
      <categories>
          
          <category> old </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>在github上搭建自己的博客</title>
      <link href="2016/12/14/%E5%9C%A8github%E4%B8%8A%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/"/>
      <url>2016/12/14/%E5%9C%A8github%E4%B8%8A%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/</url>
      
        <content type="html"><![CDATA[<p>的</p>]]></content>
      
      
      <categories>
          
          <category> default </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>服务器搬回国内了</title>
      <link href="2016/12/13/%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AC%E5%9B%9E%E5%9B%BD%E5%86%85%E4%BA%86/"/>
      <url>2016/12/13/%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AC%E5%9B%9E%E5%9B%BD%E5%86%85%E4%BA%86/</url>
      
        <content type="html"><![CDATA[<p><em><strong>网站备案通过了放回国内</strong></em></p>]]></content>
      
      
      <categories>
          
          <category> default </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>PHP常用类库</title>
      <link href="2016/03/06/PHP%E5%B8%B8%E7%94%A8%E7%B1%BB%E5%BA%93/"/>
      <url>2016/03/06/PHP%E5%B8%B8%E7%94%A8%E7%B1%BB%E5%BA%93/</url>
      
        <content type="html"><![CDATA[<p>PHP常用类库</p><span id="more"></span><p>数组类</p><p>class libArray<br>{<br>    /**<br>     * 多维数组合并<br>     * @return array<br>     */<br>    public static function merge ()<br>    {<br>        $args = func_get_args();<br>        $array = [];<br>        foreach ( $args as $arg ) {<br>            if ( is_array($arg) ) {<br>                foreach ( $arg as $k =&gt; $v ) {<br>                    if ( is_array($v) ) {<br>                        $array[$k] = isset($array[$k]) ? $array[$k] : [];<br>                        $array[$k] = self::merge($array[$k], $v);<br>                    } else {<br>                        $array[$k] = $v;<br>                    }<br>                }<br>            }<br>        }<br>        return $array;<br>    }</p><pre><code>/** * 多维to一维 * [1=&gt;[&#39;a&#39;=&gt;&#39;v1&#39;]] to [&#39;1|a&#39;=&gt;&#39;v1&#39;] * @param array $array * @param string $delimiter * @param string $key * @return array */public static function mTo1 (array $array, $delimiter = &#39;|&#39;, $key = &#39;&#39;)&#123;    $data = [];    if ( !is_array($array) ) &#123;        return $data;    &#125;    foreach ( $array as $k =&gt; $v ) &#123;        $keyNew = trim($key.$delimiter.$k, $delimiter);        if ( is_array($v) ) &#123;            $data = array_merge($data, self::mTo1($v, $delimiter, $keyNew));        &#125; else &#123;            $data[$keyNew] = $v;        &#125;    &#125;    return $data;&#125;/** * 数组排序 * @param array $array * @param $column * @param bool $reverse * @return bool */public static function sort (array &amp;$array, $column, $reverse = FALSE)&#123;    $arrColumn = [];    foreach ( $array as $key =&gt; $val ) &#123;        $arrColumn[$key] = $val[$column];    &#125;    return array_multisort($arrColumn, $reverse ? SORT_DESC : SORT_ASC, $array);&#125;/** * 添加索引 * @param array $array * @param $key * @return array */public static function index (array $array, $key)&#123;    $ret = [];    foreach ( $array as $val ) &#123;        $ret[$val[$key]] = $val;    &#125;    return $ret;&#125;/** * 添加前后缀 * @param $array * @param null $pre * @param null $suf * @return array */public static function addFix (array $array, $pre = NULL, $suf = NULL)&#123;    $ret = [];    foreach ( $array as $key =&gt; $val ) &#123;        $ret[$key] = $pre.$val.$suf;    &#125;    return $ret;&#125;</code></pre><p>}<br>数据检查类</p><p>class libCheck<br>{<br>    /**<br>     * 是否为IP（IPv4）<br>     * @param $ip<br>     * @return bool<br>     */<br>    public static function isIP ($ip)<br>    {<br>        $isIP = filter_var($ip, FILTER_VALIDATE_IP) ? TRUE : FALSE;<br>        return $isIP;<br>    }</p><pre><code>/** * 是否为邮箱地址 * @param $mail * @return bool */public static function isMail ($mail)&#123;    $isMail = filter_var($mail, FILTER_VALIDATE_EMAIL) ? TRUE : FALSE;    return $isMail;&#125;/** * 是否为URL * @param $url * @return bool */public static function isURL ($url)&#123;    $isMail = filter_var($url, FILTER_VALIDATE_URL) ? TRUE : FALSE;    return $isMail;&#125;/** * 是否为正整数 * @param $num * @return bool */public static function isPosiInt ($num)&#123;    $isPosiInt = is_int($num) &amp;&amp; $num &gt; 0;    return $isPosiInt;&#125;/** * 是否在范围内 * @param $num * @param int $min * @param null $max * @return bool */public static function isBetween ($num, $min = 0, $max = NULL)&#123;    $isBetween = $num &gt;= $min;    if ( $max ) &#123;        $isBetween = $isBetween &amp;&amp; $num &lt;= $max;    &#125;    return $isBetween;&#125;/** * 是否为有效长度 * @param $str * @param int $min * @param null $max * @return bool */public static function isValidLen ($str, $min = 1, $max = NULL)&#123;    $length = mb_strlen($str);    $isValidLen = self::isBetween($length, $min, $max);    return $isValidLen;&#125;</code></pre><p>}<br>文件类</p><p>class libFile<br>{<br>    /**<br>     * 获取目录下所有文件<br>     * @param $path<br>     * @return array<br>     */<br>    public static function getFiles ($path)<br>    {<br>        $path = self::formatePath($path);<br>        if (!is_dir($path)) {<br>            return [];<br>        }<br>        $dh = opendir($path);<br>        $files = [];<br>        while ( ($filename = readdir($dh)) !== FALSE ) {<br>            if ( $filename != ‘.’ &amp;&amp; $filename != ‘..’ ) {<br>                $files[] = implode(‘/‘, [$path, $filename]);<br>            }<br>        }<br>        closedir($dh);<br>        return $files;<br>    }</p><pre><code>/** * 按模式取目录下文件 * @param $path * @param $pattern * @return array */public static function getFilesByPattern ($path, $pattern)&#123;    $path = self::formatePath($path);    $filePattern = sprintf(&#39;%s/%s&#39;, $path, $pattern);    return glob($filePattern);&#125;/** * 递归删除文件夹 * @param $dir * @return bool */public static function rmDir($dir)&#123;    $dir = self::formatePath($dir);    $dh = opendir($dir);    while ($filename = readdir($dh)) &#123;        if ($filename != &#39;.&#39; &amp;&amp; $filename != &#39;..&#39;) &#123;            $path = sprintf(&#39;%s/%s&#39;, $dir, $filename);            is_dir($path) ? self::rmDir($path) : unlink($path);        &#125;    &#125;    closedir($dh);    return rmdir($dir);&#125;/** * 获取最后修改时间 * @param $path * @return int */public static function getModifiedTime ($path)&#123;    return filemtime($path);&#125;/** * 格式化路径 * @param $path * @return string */public static function formatePath ($path)&#123;    return rtrim($path, &#39;/&#39;);&#125;</code></pre><p>}<br>HTTP类</p><p>class libHttp<br>{<br>    /**<br>     * GET方法<br>     * @param $url<br>     * @param array $options<br>     * @return bool|mixed<br>     */<br>    public static function get ($url, $options = [])<br>    {<br>        return self::send($url, NULL, NULL, $options);<br>    }</p><pre><code>/** * POST方法 * @param $url * @param array $params * @param array $options * @return bool|mixed */public static function post ($url, $params = [], $options = [])&#123;    return self::send($url, &#39;POST&#39;, $params, $options);&#125;/** * @param $url * @param string $method * @param array $params * @param array $options * @return mixed|string */public static function send ($url, $method = &#39;GET&#39;, $params = [], $options = [])&#123;    $ch = curl_init($url);    curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE);    curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 30);    if ($method == &#39;POST&#39;) &#123;        $options[CURLOPT_POST] = TRUE;        $options[CURLOPT_POSTFIELDS] = $params;    &#125;    curl_setopt_array($ch, $options);    $result = curl_exec($ch);    return curl_errno($ch) ? curl_error($ch) : $result;&#125;</code></pre><p>}<br>字符串类</p><p>class libString<br>{<br>    /**<br>     * 随机字符串<br>     * @param int $length<br>     * @param bool $num<br>     * @param bool $lower<br>     * @param bool $upper<br>     * @return string<br>     */<br>    public static function rand ($length=5, $num=TRUE, $lower=TRUE, $upper=TRUE)<br>    {<br>        $str = ‘’;<br>        $num &amp;&amp; $str .= ‘0123456789’;<br>        $lower &amp;&amp; $str .= ‘abcdefghijklmnopqrstuvwxyz’;<br>        $upper &amp;&amp; $str .= ‘ABCDEFGHIJKLMNOPQRSTUVWXYZ’;<br>        $rand = substr(str_shuffle($str), -$length);<br>        return $rand;<br>    }</p><pre><code>/** * 字符串截取（单次） * @param $ld * @param $rd * @param $str * @return string */public static function sub ($ld, $rd, $str)&#123;    $start = strpos($str, $ld) + strlen($ld);    $end = strpos($str, $rd, $start);    $data = substr($str, $start, $end - $start);    return $data;&#125;/** * 字符串截取（批量） * @param $ld * @param $rd * @param $str * @return array */public static function subs ($ld, $rd, $str)&#123;    $data = [];    $lLen = strlen($ld);    $rLen = strlen($rd);    $offset = 0;    while ( ($start = strpos($str, $ld, $offset)) !== FALSE ) &#123;        $start += $lLen;        $end = strpos($str, $rd, $start);        $data[] = substr($str, $start, $end - $start);        $offset = $end + $rLen;    &#125;    return $data;&#125;/** * 生成唯一ID * @return string */public static function uniqid ()&#123;    return md5(uniqid(rand(), true));&#125;</code></pre><p>}<br>其它工具类</p><p>class libTool<br>{<br>    /**<br>     * ip-&gt;int<br>     * @param $ip<br>     * @return string<br>     */<br>    public static function ip2long ($ip)<br>    {<br>        $long = sprintf(‘%u’, ip2long($ip));<br>        return $long;<br>    }</p><pre><code>/** * 系统负载 * @return mixed */public static function loadAvg ()&#123;    $load = sys_getloadavg()[0];    return $load;&#125;/** * 写日志文件 * @param $file * @param $msg * @param bool $newLine */public static function log ($file, $msg, $newLine = TRUE)&#123;    $newLine &amp;&amp; $msg .= &quot;\n&quot;;    file_put_contents($file, $msg, FILE_APPEND);&#125;/** * 内存使用峰值(M) * @return float */public static function memoryUsage ()&#123;    $memory = memory_get_peak_usage(TRUE) / pow(1024, 2);    $memory = round($memory, 2);    return $memery;&#125;/** * 浏览器变量输出 * @param $var * @param bool|FALSE $return * @param bool|TRUE $strict * @return bool|mixed|string */public static function dump ($var, $return = FALSE, $strict = TRUE)&#123;    if (!$strict) &#123;        if (ini_get(&#39;html_errors&#39;)) &#123;            $output = print_r($var, TRUE);            $output = sprintf(&#39;&lt;pre&gt;%s&lt;/pre&gt;&#39;, htmlspecialchars($output, ENT_QUOTES));        &#125; else &#123;            $output = print_r($var, TRUE);        &#125;    &#125; else &#123;        ob_start();        var_dump($var);        $output = ob_get_clean();        if (!extension_loaded(&#39;xdebug&#39;)) &#123;            $output = preg_replace(&#39;/\]\=\&gt;\n(\s+)/m&#39;, &#39;] =&gt; &#39;, $output);            $output = sprintf(&#39;&lt;pre&gt;%s&lt;/pre&gt;&#39;, htmlspecialchars($output, ENT_QUOTES));        &#125;    &#125;    if ($return) &#123;        return $output;    &#125; else &#123;        echo $output;        return TRUE;    &#125;&#125;</code></pre><p>}</p>]]></content>
      
      
      <categories>
          
          <category> php </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>微信二维码技术原理</title>
      <link href="2016/02/10/%E5%BE%AE%E4%BF%A1%E4%BA%8C%E7%BB%B4%E7%A0%81%E6%8A%80%E6%9C%AF%E5%8E%9F%E7%90%86/"/>
      <url>2016/02/10/%E5%BE%AE%E4%BF%A1%E4%BA%8C%E7%BB%B4%E7%A0%81%E6%8A%80%E6%9C%AF%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<p>微信扫描二维码登录网站 网站应用微信登录开发指南</p><p>微信扫描二维码登录网站是微信开放平台下网站应用的一种接口实现的功能。微信开放平台的网址是 <a href="https://open.weixin.qq.com/">https://open.weixin.qq.com</a></p><span id="more"></span><p>准备工作<br>网站应用微信登录是基于OAuth2.0协议标准构建的微信OAuth2.0授权登录系统。</p><p>在进行微信OAuth2.在进行微信OAuth2.0授权登录接入之前，在微信开放平台注册开发者帐号，并拥有一个已审核通过的网站应用，并获得相应的AppID和AppSecret，申请微信登录且通过审核后，可开始接入流程。</p><p>授权流程说明<br>微信OAuth2.0授权登录让微信用户使用微信身份安全登录第三方应用或网站，在微信用户授权登录已接入微信OAuth2.0的第三方应用后，第三方可以获取到用户的接口调用凭证（access_token），通过access_token可以进行微信开放平台授权关系接口调用，从而可实现获取微信用户基本开放信息和帮助用户实现基础开放功能等。</p><p>微信OAuth2.0授权登录目前支持authorization_code模式，适用于拥有server端的应用授权。该模式整体流程为：</p><ol><li>第三方发起微信授权登录请求，微信用户允许授权第三方应用后，微信会拉起应用或重定向到第三方网站，并且带上授权临时票据code参数；</li><li>通过code参数加上AppID和AppSecret等，通过API换取access_token；</li><li>通过access_token进行接口调用，获取用户基本数据资源或帮助用户实现基本操作。<br>获取access_token时序图：</li></ol><p><img src="http://www.worileqing.top/usr/uploads/2017/04/1979070331.png" alt="12168b9.png"></p><p>第一步：请求CODE<br>第三方使用网站应用授权登录前请注意已获取相应网页授权作用域（scope=snsapi_login），则可以通过在PC端打开以下链接：<br><a href="https://open.weixin.qq.com/connect/qrconnect?appid=APPID&amp;redirect_uri=REDIRECT_URI&amp;response_type=code&amp;scope=SCOPE&amp;state=STATE#wechat_redirect">https://open.weixin.qq.com/connect/qrconnect?appid=APPID&amp;redirect_uri=REDIRECT_URI&amp;response_type=code&amp;scope=SCOPE&amp;state=STATE#wechat_redirect</a></p><p>若提示“该链接无法访问”，请检查参数是否填写错误，如redirect_uri的域名与审核时填写的授权域名不一致或scope不为snsapi_login。</p><p>参数说明<br>参数    是否必须    说明<br>appid    是    应用唯一标识<br>redirect_uri    是    重定向地址，需要进行UrlEncode<br>response_type    是    填code<br>scope    是    应用授权作用域，拥有多个作用域用逗号（,）分隔，网页应用目前仅填写snsapi_login即可<br>state    否    用于保持请求和回调的状态，授权请求后原样带回给第三方。该参数可用于防止csrf攻击（跨站请求伪造攻击），建议第三方带上该参数，可设置为简单的随机数加session进行校验<br>返回说明<br>用户允许授权后，将会重定向到redirect_uri的网址上，并且带上code和state参数</p><p>redirect_uri?code=CODE&amp;state=STATE<br>若用户禁止授权，则重定向后不会带上code参数，仅会带上state参数</p><p>redirect_uri?state=STATE<br>请求示例<br>登录一号店网站应用</p><p><a href="https://passport.yhd.com/wechat/login.do">https://passport.yhd.com/wechat/login.do</a></p><p>打开后，一号店会生成state参数，跳转到<br><a href="https://open.weixin.qq.com/connect/qrconnect?appid=wxbdc5610cc59c1631&amp;redirect_uri=https://passport.yhd.com/wechat/callback.do&amp;response_type=code&amp;scope=snsapi_login&amp;state=3d6be0a4035d839573b04816624a415e#wechat_redirect">https://open.weixin.qq.com/connect/qrconnect?appid=wxbdc5610cc59c1631&amp;redirect_uri=https%3A%2F%2Fpassport.yhd.com%2Fwechat%2Fcallback.do&amp;response_type=code&amp;scope=snsapi_login&amp;state=3d6be0a4035d839573b04816624a415e#wechat_redirect</a></p><p>微信用户使用微信扫描二维码并且确认登录后，PC端会跳转到</p><p><a href="https://passport.yhd.com/wechat/callback.do?code=CODE&amp;state=3d6be0a4035d839573b04816624a415e">https://passport.yhd.com/wechat/callback.do?code=CODE&amp;state=3d6be0a4035d839573b04816624a415e</a></p><p>为了满足网站更定制化的需求，我们还提供了第二种获取code的方式，支持网站将微信登录二维码内嵌到自己页面中，用户使用微信扫码授权后通过JS将code返回给网站。</p><p>JS微信登录主要用途：网站希望用户在网站内就能完成登录，无需跳转到微信域下登录后再返回，提升微信登录的流畅性与成功率。 网站内嵌二维码微信登录JS实现办法：</p><p>步骤1：在页面中先引入如下JS文件（支持https）：</p><script src="http://res.wx.qq.com/connect/zh_CN/htmledition/js/wxLogin.js"></script><p>步骤2：在需要使用微信登录的地方实例以下JS对象：<br>                          var obj = new WxLogin({<br>                              id:”login_container”,<br>                              appid: “”,<br>                              scope: “”,<br>                              redirect_uri: “”,<br>                              state: “”,<br>                              style: “”,<br>                              href: “”<br>                            });<br>参数说明<br>参数                是否必须    说明<br>id                是            第三方页面显示二维码的容器id<br>appid                是            应用唯一标识，在微信开放平台提交应用审核通过后获得<br>scope                是            应用授权作用域，拥有多个作用域用逗号（,）分隔，网页应用目前仅填写snsapi_login即可<br>redirect_uri        是            重定向地址，需要进行UrlEncode<br>state                否            用于保持请求和回调的状态，授权请求后原样带回给第三方。该参数可用于防止csrf攻击<br>style                否    提供”black”、”white”可选，默认为黑色文字描述。详见文档底部FAQ<br>href                否    自定义样式链接，第三方可根据实际需求覆盖默认样式。详见文档底部FAQ<br>第二步：通过code获取access_token<br>通过code获取access_token</p><p><a href="https://api.weixin.qq.com/sns/oauth2/access_token?appid=APPID&amp;secret=SECRET&amp;code=CODE&amp;grant_type=authorization_code">https://api.weixin.qq.com/sns/oauth2/access_token?appid=APPID&amp;secret=SECRET&amp;code=CODE&amp;grant_type=authorization_code</a><br>参数说明<br>参数    是否必须    说明<br>appid    是    应用唯一标识，在微信开放平台提交应用审核通过后获得<br>secret    是    应用密钥AppSecret，在微信开放平台提交应用审核通过后获得<br>code    是    填写第一步获取的code参数<br>grant_type    是    填authorization_code<br>返回说明<br>正确的返回：</p><p>{<br>“access_token”:”ACCESS_TOKEN”,<br>“expires_in”:7200,<br>“refresh_token”:”REFRESH_TOKEN”,<br>“openid”:”OPENID”,<br>“scope”:”SCOPE”<br>}<br>参数    说明<br>access_token    接口调用凭证<br>expires_in    access_token接口调用凭证超时时间，单位（秒）<br>refresh_token    用户刷新access_token<br>openid    授权用户唯一标识<br>scope    用户授权的作用域，使用逗号（,）分隔<br>错误返回样例：</p><p>{“errcode”:40029,”errmsg”:”invalid code”}<br>刷新access_token有效期<br>access_token是调用授权关系接口的调用凭证，由于access_token有效期（目前为2个小时）较短，当access_token超时后，可以使用refresh_token进行刷新，access_token刷新结果有两种：</p><ol><li>若access_token已超时，那么进行refresh_token会获取一个新的access_token，新的超时时间；</li><li>若access_token未超时，那么进行refresh_token不会改变access_token，但超时时间会刷新，相当于续期access_token。<br>refresh_token拥有较长的有效期（30天），当refresh_token失效的后，需要用户重新授权。</li></ol><p>请求方法<br>获取第一步的code后，请求以下链接进行refresh_token：</p><p><a href="https://api.weixin.qq.com/sns/oauth2/refresh_token?appid=APPID&amp;grant_type=refresh_token&amp;refresh_token=REFRESH_TOKEN">https://api.weixin.qq.com/sns/oauth2/refresh_token?appid=APPID&amp;grant_type=refresh_token&amp;refresh_token=REFRESH_TOKEN</a><br>参数说明<br>参数    是否必须    说明<br>appid    是    应用唯一标识<br>grant_type    是    填refresh_token<br>refresh_token    是    填写通过access_token获取到的refresh_token参数<br>返回说明<br>正确的返回：</p><p>{<br>“access_token”:”ACCESS_TOKEN”,<br>“expires_in”:7200,<br>“refresh_token”:”REFRESH_TOKEN”,<br>“openid”:”OPENID”,<br>“scope”:”SCOPE”<br>}<br>参数    说明<br>access_token    接口调用凭证<br>expires_in    access_token接口调用凭证超时时间，单位（秒）<br>refresh_token    用户刷新access_token<br>openid    授权用户唯一标识<br>scope    用户授权的作用域，使用逗号（,）分隔<br>错误返回样例：</p><p>{“errcode”:40030,”errmsg”:”invalid refresh_token”}<br>第三步：通过access_token调用接口<br>获取access_token后，进行接口调用，有以下前提：</p><ol><li>access_token有效且未超时；</li><li>微信用户已授权给第三方应用帐号相应接口作用域（scope）。<br>对于接口作用域（scope），能调用的接口有以下：</li></ol><p>授权作用域（scope）    接口    接口说明<br>snsapi_base    /sns/oauth2/access_token    通过code换取access_token、refresh_token和已授权scope<br>/sns/oauth2/refresh_token    刷新或续期access_token使用<br>/sns/auth    检查access_token有效性<br>snsapi_userinfo    /sns/userinfo    获取用户个人信息<br>其中snsapi_base属于基础接口，若应用已拥有其它scope权限，则默认拥有snsapi_base的权限。使用snsapi_base可以让移动端网页授权绕过跳转授权登录页请求用户授权的动作，直接跳转第三方网页带上授权临时票据（code），但会使得用户已授权作用域（scope）仅为snsapi_base，从而导致无法获取到需要用户授权才允许获得的数据和基础功能。</p><p>接口调用方法可查阅《微信授权关系接口调用指南》</p><p>F.A.Q</p><ol><li><p>什么是授权临时票据（code）？<br>答：第三方通过code进行获取access_token的时候需要用到，code的超时时间为10分钟，一个code只能成功换取一次access_token即失效。code的临时性和一次保障了微信授权登录的安全性。第三方可通过使用https和state参数，进一步加强自身授权登录的安全性。</p></li><li><p>什么是授权作用域（scope）？<br>答：授权作用域（scope）代表用户授权给第三方的接口权限，第三方应用需要向微信开放平台申请使用相应scope的权限后，使用文档所述方式让用户进行授权，经过用户授权，获取到相应access_token后方可对接口进行调用。</p></li><li><p>网站内嵌二维码微信登录JS代码中style字段作用？<br>答：第三方页面颜色风格可能为浅色调或者深色调，若第三方页面为浅色背景，style字段应提供”black”值（或者不提供，black为默认值），则对应的微信登录文字样式为黑色。相关效果如下：</p></li></ol><p>若提供”white”值，则对应的文字描述将显示为白色，适合深色背景。相关效果如下：</p><p>4.网站内嵌二维码微信登录JS代码中href字段作用？<br>答：如果第三方觉得微信团队提供的默认样式与自己的页面样式不匹配，可以自己提供样式文件来覆盖默认样式。举个例子，如第三方觉得默认二维码过大，可以提供相关css样式文件，并把链接地址填入href字段</p><p>.impowerBox .qrcode {width: 200px;}<br>.impowerBox .title {display: none;}<br>.impowerBox .info {width: 200px;}<br>.status_icon {display：none}<br>.impowerBox .status {text-align: center;}<br>相关效果如下：</p><p>============================================</p>]]></content>
      
      
      <categories>
          
          <category> php </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>python web服务器nginx+uwsgi+web.py的搭建</title>
      <link href="2016/02/09/python%20web%E6%9C%8D%E5%8A%A1%E5%99%A8nginx+uwsgi+web.py%E7%9A%84%E6%90%AD%E5%BB%BA/"/>
      <url>2016/02/09/python%20web%E6%9C%8D%E5%8A%A1%E5%99%A8nginx+uwsgi+web.py%E7%9A%84%E6%90%AD%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<p>1、环境配置<br>python至少升级到2.6.6版本<br>安装nginx</p><pre><code>#rpm -ivh http://nginx.org/packages/centos/6/noarch/RPMS/nginx-release-centos-6-0.el6.ngx.noarch.rpm#yum install nginx</code></pre><span id="more"></span><p>安装MySQL数据库</p><pre><code>#yum -y install mysql mysql-server mysql-devel libdbi-dbd-mysql #service mysqld start #chkconfig mysqld on安装MySQLdb ( mysql-python ) #easy_install mysql-python安装web.py ( 官网 ) #easy_install web.py安装uwsgi ( 官网 ) #easy_install uwsgi</code></pre><p>2、 配置uwsgi<br>uwsgi 的配置文件 可支持xml yaml ini等格式。这里使用ini格式的配置文件。默认路径为/etc/uwsgi.ini。</p><pre><code>[uwsgi] #使用动态端口，启动后将端口号写入以下文件中socket = /tmp/uwsgi_vhosts.sock#也可以指定使用固定的端口#socket=127.0.0.1:9090 pidfile=/var/run/uwsgi.pid daemonize=/var/log/uwsgi.log master=true vhost=true gid=rootuid=root#性能相关的一些参数，具体内容查看官网文档workers=10max-requests=5000 limit-as=512</code></pre><p>3、 创建uwsgi开机自启动脚本，便于进行系统管理</p><pre><code> vi /etc/init.d/uwsgi，内容如下：    #! /bin/sh          PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin      DESC=&quot;uwsgi daemon&quot;      NAME=uwsgi      DAEMON=/usr/bin/uwsgi      CONFIGFILE=/etc/$NAME.ini      PIDFILE=/var/run/$NAME.pid      SCRIPTNAME=/etc/init.d/$NAME          set -e      [ -x &quot;$DAEMON&quot; ] || exit 0          do_start() &#123;         $DAEMON $CONFIGFILE || echo -n &quot;uwsgi already running&quot;      &#125;          do_stop() &#123;         $DAEMON --stop $PIDFILE || echo -n &quot;uwsgi not running&quot;         rm -f $PIDFILE         echo &quot;$DAEMON STOPED.&quot;      &#125;          do_reload() &#123;         $DAEMON --reload $PIDFILE || echo -n &quot;uwsgi can&#39;t reload&quot;      &#125;          do_status() &#123;         ps aux|grep $DAEMON      &#125;          case &quot;$1&quot; in       status)         echo -en &quot;Status $NAME: \n&quot;         do_status       ;;       start)         echo -en &quot;Starting $NAME: \n&quot;         do_start       ;;       stop)         echo -en &quot;Stopping $NAME: \n&quot;         do_stop       ;;       reload|graceful)         echo -en &quot;Reloading $NAME: \n&quot;         do_reload       ;;       *)         echo &quot;Usage: $SCRIPTNAME &#123;start|stop|reload&#125;&quot; &gt;&amp;2         exit 3       ;;      esac          exit 0将脚本属性修改为可执行：     #chmod 755 /etc/init.d/uwsgi    启用开机自动启动：     #chkconfig uwsgi on    启动uwsgi服务：     #service uwsgi start     </code></pre><p>4、 配置nginx下的uwsgi站点<br>    例如新增以下一个站点uwsgi。<br>    vi /etc/nginx/conf.d/uwsgi.conf, 内容：</p><pre><code> server &#123;       listen  9091;       server_name  localhost;       root /www/uwsgi;       index index.html index.htm;       access_log logs/uwsgi.log;       error_log logs/uwsgi.log;       location / &#123;         #使用动态端口        uwsgi_pass unix:///tmp/uwsgi_vhosts.sock;        #uwsgi_pass 127.0.0.1:9090;     include uwsgi_params;     uwsgi_param UWSGI_SCRIPT index;   #默认载入的脚本文件    uwsgi_param UWSGI_PYHOME $document_root;     uwsgi_param UWSGI_CHDIR  $document_root;   &#125; &#125;启动Nginx服务 #service nginx start #chkconfig nginx on</code></pre><p>5、编写Hello Word！</p><pre><code>#vim index.py 脚本名称和上面nginx虚机配置的uwsgi_param UWSGI_SCRIPT参数要一致不使用web.py框架的写法：01#!/usr/bin/python02import os03import sys06def application(environ, start_response):07    status = &#39;200 OK&#39;08    output = &#39;Hello World!&#39;09    response_headers = [(&#39;Content-type&#39;, &#39;text/plain&#39;),10                    (&#39;Content-Length&#39;, str(len(output)))]11    start_response(status, response_headers)12    return [output]使用web.py框架的写法：#!/usr/bin/env python# -*- coding: utf-8 -*-  import weburls = (  &#39;/t&#39;, &#39;test&#39;, #测试  &#39;/&#39;, &#39;home&#39;)app = web.application(urls, globals())#返回wsgi接口，application 是 wsgi app入口函数application = app.wsgifunc()class test:  &#39;测试&#39;        def GET(self):    # 开发测试用    referer = web.ctx.env.get(&#39;HTTP_REFERER&#39;, &#39;http://google.com&#39;)    client_ip = web.ctx.env.get(&#39;REMOTE_ADDR&#39;)    host = web.ctx.env.get(&#39;host&#39;)    fullpath = web.ctx.fullpath    user_agent = web.ctx.env.get(&#39;HTTP_USER_AGENT&#39;)    data = &quot;&quot;    data += &#39;Client: %s&lt;br/&gt;\n&#39; % client_ip    data += &#39;User-agent: %s&lt;br/&gt;\n&#39; % user_agent    data += &#39;FullPath: %s&lt;br/&gt;\n&#39; % fullpath    data += &#39;Referer: %s&lt;br/&gt;\n&#39; % referer    return data  def POST(self):    passclass home:  &#39;根目录请求的处理&#39;          def GET(self):    return &quot;Hello Web.py&quot;  def POST(self):    return self.GET()#定义404错误显示内容  def notfound():      return web.notfound(&quot;Sorry, the page you were looking for was not found.&quot;)  app.notfound = notfound  if __name__ == &quot;__main__&quot;:  app.run()</code></pre><p>6、重新载入python脚本</p><pre><code> #service uwsgi reload    或者    #python index.py 9092</code></pre><p>表示使用index.py脚本在9092端口新开启一个web服务监听<br>这样你写的hello word就生效了，现在可以在浏览器输入你的ip地址+端口来访问python web内容了</p>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>微信公众号开发-1</title>
      <link href="2016/01/24/%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7%E5%BC%80%E5%8F%91-1/"/>
      <url>2016/01/24/%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7%E5%BC%80%E5%8F%91-1/</url>
      
        <content type="html"><![CDATA[<ol><li>注册微信公众平台账号<br>微信公众平台:<br><a href="https://mp.weixin.qq.com/">https://mp.weixin.qq.com/</a><span id="more"></span>注: 目前一张身份证只能注册两个账号，账号名称关乎加V认证，请慎重注册。</li><li>申请服务器/虚拟主机<br>没有服务器/虚拟主机的童鞋可以使用BAE和SAE，不多介绍。</li><li>开启开发者模式<br>微信公众平台有两个模式，一个是编辑模式（傻瓜模式），简单但功能单一。另一个是开发者模式，可以通过开发实现复杂功能。两个模式互斥，显而易见，登录微信公众平台并通过“高级功能”菜单开启开发者模式。</li><li>填写接口配置信息<br>同样是在“高级功能”菜单中配置，需要配置两项参数:<br>URL: 开发者应用访问地址，目前仅支持80端口，以“<a href="http://www.worileqing.top/weixin/index.php%E2%80%9D%E4%B8%BA%E4%BE%8B%E3%80%82">http://www.worileqing.top/weixin/index.php”为例。</a><br>TOKEN: 随意填写，用于生成签名，以“YoonPer”为例。<br>填写完把下面代码保存为index.php并上传至<a href="http://www.worileqing.top/weixin/%E7%9B%AE%E5%BD%95%EF%BC%8C%E6%9C%80%E5%90%8E%E7%82%B9%E5%87%BB%E2%80%9C%E6%8F%90%E4%BA%A4%E2%80%9D%E5%AE%8C%E6%88%90%E9%AA%8C%E8%AF%81%E3%80%82">http://www.worileqing.top/weixin/目录，最后点击“提交”完成验证。</a><br>01<?php02define("TOKEN", "YoonPer"); //TOKEN值03$wechatObj = new wechat();04$wechatObj->valid();05class wechat {06 public function valid() {07     $echoStr = $_GET["echostr"];08     if($this->checkSignature()){09         echo $echoStr;10         exit;11     }12 }13</li></ol><p>14<br>    private function checkSignature() {<br>15<br>        $signature = $_GET[“signature”];<br>16<br>        $timestamp = $_GET[“timestamp”];<br>17<br>        $nonce = $_GET[“nonce”];<br>18<br>        $token = TOKEN;<br>19<br>        $tmpArr = array($token, $timestamp, $nonce);<br>20<br>        sort($tmpArr);<br>21<br>        $tmpStr = implode( $tmpArr );<br>22<br>        $tmpStr = sha1( $tmpStr );<br>23<br>        if( $tmpStr == $signature ) {<br>24<br>            return true;<br>25<br>        } else {<br>26<br>            return false;<br>27<br>        }<br>28<br>    }<br>29<br>}<br>30<br>?&gt;<br>这玩意儿就是微信公众平台校验URL是否正确接入，研究代码没有实质性意义，验证完即可删除文件，就不详细说明了，有兴趣的童鞋可以查看官方文档。<br>微信公众平台API文档:<br><a href="http://mp.weixin.qq.com/wiki/index.php">http://mp.weixin.qq.com/wiki/index.php</a></p><ol start="5"><li>开发微信公众平台功能<br>OK，上面提到了，微信公众平台与开发者之间的数据交互是通过XML完成的，既然用到XML，当然得遵循规范，所以在着手开发之前先看看官方接口文档提供的XML规范，以文本消息为例:</li></ol><p>当用户向微信公众账号发送消息时，微信服务器会POST给开发者一些数据:<br>01<br><xml><br>02</p><!--开发者微信号--><p>03<br><ToUserName><![CDATA[toUser]]></ToUserName><br>04</p><!--发送方帐号（OpenID）--><p>05<br><FromUserName><![CDATA[fromUser]]></FromUserName><br>06</p><!--消息创建时间 （整型）--><p>07<br><CreateTime>12345678</CreateTime><br>08</p><!--消息类别 （text文本消息）--><p>09<br><MsgType>&lt;![CDATA1]&gt;</MsgType><br>10</p><!--消息内容--><p>11<br><Content><![CDATA[content]]></Content><br>12</p><!--消息ID （64位整型）--><p>13<br><MsgId>1234567890123456</MsgId><br>14<br></xml></p><p>开发者在处理完消息后需要返回数据给微信服务器:<br>01<br><xml><br>02</p><!--接收方帐号（OpenID）--><p>03<br><ToUserName><![CDATA[toUser]]></ToUserName><br>04</p><!--开发者微信号--><p>05<br><FromUserName><![CDATA[fromUser]]></FromUserName><br>06</p><!--消息创建时间 （整型）--><p>07<br><CreateTime>12345678</CreateTime><br>08</p><!--消息类别 （text文本消息）--><p>09<br><MsgType>&lt;![CDATA1]&gt;</MsgType><br>10</p><!--回复消息内容--><p>11<br><Content><![CDATA[content]]></Content><br>12</p><!--星标操作（位0x0001被标志时 星标刚收到的消息）--><p>13<br><FuncFlag>0</FuncFlag><br>14<br></xml><br>除文本消息外，微信公众平台还支持用户发送图片消息、地理位置消息、链接消息、事件推送，而开发者还可以向微信公众平台回复音乐消息和图文消息，各类消息XML规范也可以参见官方文档。</p><p>来看看官方提供的一个PHP示例，我做了一些精简:<br>01<br>&lt;?php<br>02<br>$wechatObj = new wechat();<br>03<br>$wechatObj-&gt;responseMsg();<br>04<br>class wechat {<br>05<br>    public function responseMsg() {<br>06</p><p>07<br>        //———- 接 收 数 据 ———- //<br>08</p><p>09<br>        $postStr = $GLOBALS[“HTTP_RAW_POST_DATA”]; //获取POST数据<br>10</p><p>11<br>        //用SimpleXML解析POST过来的XML数据<br>12<br>        $postObj = simplexml_load_string($postStr,’SimpleXMLElement’,LIBXML_NOCDATA);<br>13</p><p>14<br>        $fromUsername = $postObj-&gt;FromUserName; //获取发送方帐号（OpenID）<br>15<br>        $toUsername = $postObj-&gt;ToUserName; //获取接收方账号<br>16<br>        $keyword = trim($postObj-&gt;Content); //获取消息内容<br>17<br>        $time = time(); //获取当前时间戳<br>18</p><p>19</p><p>20<br>        //———- 返 回 数 据 ———- //<br>21</p><p>22<br>        //返回消息模板<br>23<br>        $textTpl = “<xml><br>24<br>        <ToUserName><![CDATA[%s]]></ToUserName><br>25<br>        <FromUserName><![CDATA[%s]]></FromUserName><br>26<br>        <CreateTime>%s</CreateTime><br>27<br>        <MsgType><![CDATA[%s]]></MsgType><br>28<br>        <Content><![CDATA[%s]]></Content><br>29<br>        <FuncFlag>0</FuncFlag><br>30<br>        </xml>“;<br>31</p><p>32<br>        $msgType = “text”; //消息类型<br>33<br>        $contentStr = ‘<a href="http://www.worileqing.top&/#39;">http://www.worileqing.top&#39;</a>; //返回消息内容<br>34</p><p>35<br>        //格式化消息模板<br>36<br>        $resultStr = sprintf($textTpl,$fromUsername,$toUsername,<br>37<br>        $time,$msgType,$contentStr);<br>38<br>        echo $resultStr; //输出结果<br>39<br>    }<br>40<br>}<br>41<br>?&gt;<br>把代码保存为index.php并上传至<a href="http://www.worileqing.top/weixin/%E7%9B%AE%E5%BD%95%EF%BC%8C%E5%A6%82%E6%9E%9C%E5%88%9A%E6%89%8D%E6%B2%A1%E5%88%A0%E9%99%A4%E8%AF%A5%E6%96%87%E4%BB%B6%EF%BC%8C%E5%88%99%E7%9B%B4%E6%8E%A5%E8%A6%86%E7%9B%96%E3%80%82">http://www.worileqing.top/weixin/目录，如果刚才没删除该文件，则直接覆盖。</a></p><p>现在用户通过微信公众平台发送任何消息公众账号均会返回一条内容为“<a href="http://www.worileqing.top”的消息./">http://www.worileqing.top”的消息。</a><br>接下来需要做的就是根据用户消息动态返回结果~</p><p>SimSimi（小黄鸡）是目前比较火的聊天机器人，我用CURL开发了一个免费的SimSimi（小黄鸡）接口，传入关键词会返回文本回复，这部分不是本文重点，就不多说明，直接上代码(2014.07.28更新):<br>01<br><?php02function simsimi ($keyword)03{04    $keyword = urlencode($keyword);05    //----------- 获取COOKIE ----------//06    $url = "http://www.simsimi.com/";07    $ch = curl_init($url);08    curl_setopt($ch, CURLOPT_HEADER, 1);09    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);10    $content = curl_exec($ch);11    list($header, $body) = explode("\r\n\r\n", $content);12    preg_match_all("/set\-cookie:([^\r\n]*);/iU", $header, $matches);13    $cookie = implode(';', $matches[1]).";simsimi_uid=1;";14    curl_close($ch);15    //----------- 抓 取 回 复 ----------//16    $url = "http://www.simsimi.com/func/reqN?lc=ch&ft=0.0&req=$keyword&fl=http%3A%2F%2Fwww.simsimi.com%2Ftalk.htm";17    $ch = curl_init($url);18    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);19    curl_setopt($ch, CURLOPT_COOKIE, $cookie);20    $content = json_decode(curl_exec($ch), 1);21    curl_close($ch);22    if ( $content['result'] == '200' ) {23        return $content['sentence_resp'];24    } else {25        return '我还不会回答这个问题...';26    }27}28?><br>把上面两段代码整合在一起就大功告成了，需要说明一点，微信服务器在5秒内收不到响应会断掉连接，通过此接口有可能会超时，且SimSimi已经屏蔽了BAE和SAE上的抓取请求，推荐使用SimSimi官方收费API，速度比较快~</p>]]></content>
      
      
      <categories>
          
          <category> php </category>
          
      </categories>
      
      
    </entry>
    
    
  
  
</search>
